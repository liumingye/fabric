!function(){var e=["object","attr","dialogOption","initialColor"];function t(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function n(e,t,n,r,a,i,o){try{var s=e[i](o),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function r(e){return function(){var t=this,r=arguments;return new Promise((function(a,i){var o=e.apply(t,r);function s(e){n(o,a,i,s,l,"next",e)}function l(e){n(o,a,i,s,l,"throw",e)}s(void 0)}))}}function a(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */a=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(M){c=function(e,t,n){return e[t]=n}}function d(e,t,n,a){var i=t&&t.prototype instanceof v?t:v,o=Object.create(i.prototype),s=new O(a||[]);return r(o,"_invoke",{value:w(e,n,s)}),o}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(M){return{type:"throw",arg:M}}}e.wrap=d;var h={};function v(){}function p(){}function g(){}var f={};c(f,o,(function(){return this}));var b=Object.getPrototypeOf,m=b&&b(b(j([])));m&&m!==t&&n.call(m,o)&&(f=m);var y=g.prototype=v.prototype=Object.create(f);function x(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function a(r,i,o,s){var l=u(e[r],e,i);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){a("next",e,o,s)}),(function(e){a("throw",e,o,s)})):t.resolve(d).then((function(e){c.value=e,o(c)}),(function(e){return a("throw",e,o,s)}))}s(l.arg)}var i;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){a(e,n,t,r)}))}return i=i?i.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return A()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=C(o,n);if(s){if(s===h)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=u(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===h)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}function C(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,C(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var a=u(r,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,h;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function _(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function j(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:A}}function A(){return{value:void 0,done:!0}}return p.prototype=g,r(y,"constructor",{value:g,configurable:!0}),r(g,"constructor",{value:p,configurable:!0}),p.displayName=c(g,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,l,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},x(k.prototype),c(k.prototype,s,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new k(d(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},x(y),c(y,l,"Generator"),c(y,o,(function(){return this})),c(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=j,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(s&&l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),_(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;_(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:j(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),h}},e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i,o,s=[],l=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);l=!0);}catch(d){c=!0,a=d}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw a}}return s}}(e,t)||d(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=d(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function d(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}System.register(["./vendor-legacy.91b89e3e.js","./style-legacy.01ed1447.js","./vue-legacy.6a5579be.js","./index-legacy.9dad35e3.js"],(function(n,i){"use strict";var d,u,h,v,p,g,f,b,m,y,x,k,w,C,S,_,O,j,A,M,P,I,T,E,R,D,L,B,z,N,$,H,V,F,W,K,U,G,Y,X,q,J,Z,Q,ee,te,ne,re,ae,ie,oe,se,le,ce,de,ue,he,ve,pe,ge,fe,be,me,ye,xe,ke,we,Ce,Se,_e,Oe,je,Ae,Me,Pe,Ie,Te,Ee,Re,De,Le,Be,ze,Ne,$e,He,Ve,Fe,We,Ke,Ue,Ge,Ye,Xe,qe,Je,Ze,Qe,et,tt,nt,rt,at,it,ot,st,lt,ct,dt,ut,ht,vt,pt,gt,ft,bt,mt,yt,xt,kt,wt,Ct,St,_t,Ot,jt,At,Mt,Pt,It,Tt,Et,Rt,Dt,Lt,Bt,zt,Nt,$t,Ht,Vt,Ft,Wt,Kt,Ut,Gt,Yt,Xt,qt,Jt,Zt,Qt,en,tn,nn,rn,an,on,sn,ln,cn,dn;return{setters:[e=>{d=e.G,u=e.c,h=e.R,v=e.i,p=e.A,g=e.a,f=e.P,b=e.b,m=e.C,y=e.d,x=e.T,k=e.l,w=e.e,C=e.F,S=e.I,_=e.E,O=e.f,j=e.g,A=e.h,M=e.j,P=e.k,I=e.S,T=e.m,E=e.n,R=e.o,D=e.p},null,e=>{L=e.r,B=e.o,z=e.c,N=e.w,$=e.a,H=e.b,V=e.C,F=e.d,W=e.e,K=e.n,U=e.t,G=e.s,Y=e.f,X=e.g,q=e.h,J=e.i,Z=e.j,Q=e.k,ee=e.l,te=e.m,ne=e.p,re=e.q,ae=e.u,ie=e.v,oe=e.x,se=e.y,le=e.z,ce=e.A,de=e.B,ue=e.F,he=e.D,ve=e.E,pe=e.G,ge=e.H,fe=e.I,be=e.J,me=e.K,ye=e.L,xe=e.M,ke=e.N,we=e.O,Ce=e.P,Se=e.Q,_e=e.R,Oe=e.S,je=e.T,Ae=e.U,Me=e.V,Pe=e.W,Ie=e.X,Te=e.Y,Ee=e.Z,Re=e._,De=e.$,Le=e.a0,Be=e.a1,ze=e.a2,Ne=e.a3,$e=e.a4,He=e.a5,Ve=e.a6,Fe=e.a7,We=e.a8,Ke=e.a9,Ue=e.aa,Ge=e.ab,Ye=e.ac,Xe=e.ad,qe=e.ae,Je=e.af,Ze=e.ag,Qe=e.ah,et=e.ai,tt=e.aj,nt=e.ak,rt=e.al,at=e.am,it=e.an,ot=e.ao,st=e.ap,lt=e.aq,ct=e.ar,dt=e.as,ut=e.at,ht=e.au,vt=e.av,pt=e.aw,gt=e.ax,ft=e.ay,bt=e.az,mt=e.aA,yt=e.aB,xt=e.aC,kt=e.aD,wt=e.aE,Ct=e.aF,St=e.aG,_t=e.aH,Ot=e.aI,jt=e.aJ,At=e.aK,Mt=e.aL,Pt=e.aM,It=e.aN,Tt=e.aO,Et=e.aP,Rt=e.aQ,Dt=e.aR,Lt=e.aS,Bt=e.aT,zt=e.aU,Nt=e.aV,$t=e.aW,Ht=e.aX,Vt=e.aY,Ft=e.aZ,Wt=e.a_,Kt=e.a$,Ut=e.b0,Gt=e.b1,Yt=e.b2,Xt=e.b3,qt=e.b4,Jt=e.b5,Zt=e.b6,Qt=e.b7,en=e.b8,tn=e.b9,nn=e.ba,rn=e.bb,an=e.bc,on=e.bd,sn=e.be,ln=e.bf,cn=e.bg,dn=e.bh},null],execute:function(){var i,un;n("g",(function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}));n("c","undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{});var hn=(e,t)=>{var n,r=e.__vccOpts||e,a=c(t);try{for(a.s();!(n=a.n()).done;){var i=l(n.value,2),o=i[0],s=i[1];r[o]=s}}catch(d){a.e(d)}finally{a.f()}return r};var vn=hn({},[["render",function(e,t){var n=L("router-view"),r=V;return B(),z(r,null,{default:N((()=>[$(n,null,{default:N((e=>{var t=e.Component;return[(B(),z(H(t)))]})),_:1})])),_:1})}]]),pn=Math.PI/180,gn="mod+g",fn="mod+shift+g",bn=e=>{if(e.ref)return e;var t=["id","name","hideOnLayer","originX","originY","top","left","width","height","scaleX","scaleY","flipX","flipY","opacity","angle","skewX","skewY","hoverCursor","moveCursor","padding","borderColor","borderDashArray","cornerColor","cornerStrokeColor","cornerStyle","cornerDashArray","centeredScaling","centeredRotation","fill","fillRule","globalCompositeOperation","backgroundColor","selectionBackgroundColor","stroke","strokeWidth","strokeDashArray","strokeDashOffset","strokeLineCap","strokeLineJoin","strokeMiterLimit","shadow","borderScaleFactor","minScaleLimit","selectable","evented","visible","hasControls","hasBorders","perPixelTargetFind","includeDefaultValues","lockMovementX","lockMovementY","lockRotation","lockScalingX","lockScalingY","lockSkewingX","lockSkewingY","lockScalingFlip","excludeFromExport","objectCaching","noScaleCache","strokeUniform","dirty","paintFirst","activeOn","colorProperties","inverted","absolutePositioned"];return e.isType("Rect")&&t.push("rx","ry"),e.isType("Text","Textbox")&&t.push("text","charSpacing","lineHeight","fontSize","fontWeight","fontFamily","fontStyle","pathSide","pathAlign","underline","overline","linethrough","textAlign","direction"),e.ref=F({}),t.forEach((t=>{e.ref[t]=e[t],Object.defineProperty(e,t,{get(){return this.ref[t]},set(e){this.ref[t]!==e&&(this.ref[t]=e)}})})),e};class mn extends(Pn(d)){constructor(e,t,n){super(null==e?void 0:e.map((e=>bn(e))),t,n)}setDirty(){this._set("dirty",!0)}updateLayout(){this._applyLayoutStrategy({type:"object_modified"}),this.setDirty()}}class yn extends mn{static getDefaults(){return o(o({},super.getDefaults()),yn.ownDefaults)}constructor(e,t,n){super(e,t,n),s(this,"subTargetCheck",!0),s(this,"interactive",!0),this.on("scaling",(()=>{var e=this._getTransformedDimensions(),t=e.y,n=e.x;this.set({width:n,height:t,scaleX:1,scaleY:1}),this.setClipPath()})),this.on("added",(()=>{this.setClipPath(),this.updateSelectable(),W((()=>{this.ref.selectable&&this.size()&&(this.ref.selectable=!1)}))}))}updateSelectable(){this.ref&&(this.ref.selectable=!this.size())}setClipPath(){this.clipPath=new h({top:0,left:0,width:this.width,height:this.height,originX:"center",originY:"center"})}_renderBackground(e){h.prototype._render.call(this,e)}render(e){if(super.render(e),this.visible){var t,n,r,a;e.save(),this.transform(e),e.scale(1/(null!==(t=this.zoomX)&&void 0!==t?t:1),1/(null!==(n=this.zoomY)&&void 0!==n?n:1));var i=this.angle*pn,o=Math.sin(i),s=Math.cos(i);Math.abs(o)>Math.abs(s)?e.rotate(-90*Math.sign(o)*pn):e.rotate((-90*Math.sign(s)+90)*pn),e.font="12px Helvetica",e.fillStyle="#888",e.textBaseline="bottom",e.fillText(this.name,-this.width*(null!==(r=this.zoomX)&&void 0!==r?r:1)/2,-this.height*(null!==(a=this.zoomY)&&void 0!==a?a:1)/2-2),e.restore()}}_watchObject(e,t){}_onObjectAdded(e){super._onObjectAdded(e),this.updateSelectable()}_onObjectRemoved(e){super._onObjectRemoved(e),this.updateSelectable()}toObject(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=super.toObject(e);return delete t.clipPath,t}toString(){return`#<Board: (${this.complexity()})>`}}s(yn,"ownDefaults",{padding:4,selectable:!1,layout:"fixed",fill:"#FFFFFF"}),u.setClass(yn),u.setClass(yn,"board");var xn=o(o({},v),{},{isBoard:e=>e instanceof yn,isCollection:e=>!!e&&Array.isArray(e._objects),isGradient:e=>e instanceof g,isPattern:e=>e instanceof f,isActiveSelection:e=>e instanceof p,isTextObject:e=>!!e&&e.isType("Text","IText","Textbox"),isGroup:e=>e instanceof kn,isNativeGroup:e=>e instanceof d,isFiller:e=>!!e&&void 0!==e.toLive,isSerializableFiller:e=>!!e&&"function"==typeof e.toObject});class kn extends mn{constructor(e,t,n){super(e,t,n),s(this,"subTargetCheck",!0),s(this,"interactive",!1),this.on("mousedblclick",this.doubleClickHandler.bind(this))}addDeselectedEvent(e){e.once("deselected",(()=>{var e,t=null===(e=this.canvas)||void 0===e?void 0:e.getActiveObject();t&&t.getAncestors(!0).includes(this)?this.addDeselectedEvent(t):this.set({interactive:!1,objectCaching:!0})}))}onActiveTarget(e){this.canvas&&e.group&&!e.group.interactive&&e.getAncestors(!0).forEach((t=>{var n=t;n.interactive||(n.set({interactive:!0,objectCaching:!1}),n.addDeselectedEvent(e))}))}doubleClickHandler(e){var t;if(this.canvas&&e.target&&e.target===this&&e.subTargets&&0!==e.subTargets.length&&!this.interactive){this.set({interactive:!0,objectCaching:!1}),this.addDeselectedEvent(this);var n=e.subTargets.indexOf(this),r=null!==(t=e.subTargets[n-1])&&void 0!==t?t:e.subTargets[e.subTargets.length-1];this.canvas.setActiveObject(r),this.canvas.requestRenderAll()}}_onObjectRemoved(e,t){if(super._onObjectRemoved(e,t),0===this.size()){var n=this.getParent();n&&n.remove(this)}}}u.setClass(kn);var wn=e=>`url("data:image/svg+xml,<svg height='20' width='20' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'><g fill='none' transform='rotate(${e} 16 16)'><path fill='white' d='M18.24 5.37C11.41 6.04 5.98 11.46 5.32 18.26L0 18.26L7.8 26L15.61 18.27L10.6 18.27C11.21 14.35 14.31 11.25 18.24 10.64L18.24 15.55L26 7.78L18.24 0L18.24 5.37Z'></path><path fill='black' d='M19.5463 6.61441C12.4063 6.68441 6.61632 12.4444 6.56632 19.5644L3.17632 19.5644L7.80632 24.1444L12.4363 19.5644L9.18632 19.5644C9.24632 13.8844 13.8563 9.28441 19.5463 9.22441L19.5463 12.3844L24.1463 7.78441L19.5463 3.16441L19.5463 6.61441Z'></path></g></svg>") 12 12,auto`,Cn=e=>({sizeX:16,sizeY:16,actionHandler:(t,n,r,a)=>{var i;return null===(i=n.target.canvas)||void 0===i||i.setCursor(wn(n.target.angle+e)),((e,t,n,r)=>{var a,i=e.shiftKey,o=t.target,s=b.rotationWithSnapping;i&&(a=o.snapAngle,o.snapAngle=15);var l=s(e,t,n,r);return a&&(o.snapAngle=a),l})(t,n,r,a)},cursorStyleHandler:(t,n,r)=>wn(r.angle+e),render:K,actionName:"rotate"}),Sn={cursorStyleHandler:b.scaleCursorStyleHandler,actionHandler:b.scalingEqually,actionName:"scaling"},_n=()=>({size:new m({x:0,y:.5,cursorStyleHandler:()=>"",offsetY:14,sizeX:1e-4,sizeY:1e-4,touchSizeX:1e-4,touchSizeY:1e-4,render:(e,t,n,r,a)=>{e.save(),e.translate(t,n);var i,o,s,l;e.rotate((i=a.group?a.getTotalAngle():a.angle,o=i*pn,s=Math.sin(o),l=Math.cos(o),(i-(Math.abs(s)>Math.abs(l)?90*Math.sign(s):90*Math.sign(l)-90))*pn));e.font="12px Tahoma",e.textAlign="center",e.textBaseline="middle";var c=a.getWidthHeight(),d=`${c.x} × ${c.y}`,u=e.measureText(d).width+8;e.roundRect(-u/2,-9,u,18,4),e.fillStyle="#0066ff",e.fill(),e.fillStyle="#fff",e.fillText(d,0,1),e.restore()},positionHandler:(e,t,n,r)=>{var a,i=null===(a=n.canvas)||void 0===a?void 0:a.getActiveObject();if(i&&i===n){var o=n.getTotalAngle()*pn,s=Math.sin(o),l=Math.cos(o);if(Math.abs(s)>=Math.abs(l)){var c=Math.sign(s);r.x=c/2,r.y=0,r.offsetX=14*c,r.offsetY=0}else{var d=Math.sign(l);r.x=0,r.y=d/2,r.offsetX=0,r.offsetY=14*d}(e=>{if(e.canvas){var t=e.canvas.getZoom(),n=e.getWidthHeight().scalarMultiply(t),r=e.controls;["ml","mr"].forEach((t=>{r[t].sizeX=e.cornerSize,r[t].sizeY=n.y,r[t].touchSizeX=e.touchCornerSize,r[t].touchSizeY=n.y})),["mt","mb"].forEach((t=>{r[t].sizeX=n.x,r[t].sizeY=e.cornerSize,r[t].touchSizeX=n.x,r[t].touchSizeY=e.touchCornerSize}))}})(n)}return((e,t,n,r)=>new y(r.x*e.x+r.offsetX,r.y*e.y+r.offsetY).transform(t))(e,t,0,r)}}),tlr:new m(o({x:-.5,y:-.5,offsetX:-4,offsetY:-4},Cn(0))),trr:new m(o({x:.5,y:-.5,offsetX:4,offsetY:-4},Cn(90))),brr:new m(o({x:.5,y:.5,offsetX:4,offsetY:4},Cn(180))),blr:new m(o({x:-.5,y:.5,offsetX:-4,offsetY:4},Cn(270))),ml:new m({x:-.5,y:0,actionHandler:b.scalingXOrSkewingY,cursorStyleHandler:b.scaleSkewCursorStyleHandler,actionName:"scaling",render:K}),mr:new m({x:.5,y:0,actionHandler:b.scalingXOrSkewingY,cursorStyleHandler:b.scaleSkewCursorStyleHandler,actionName:"scaling",render:K}),mb:new m({x:0,y:.5,actionHandler:b.scalingYOrSkewingX,cursorStyleHandler:b.scaleSkewCursorStyleHandler,actionName:"scaling",render:K}),mt:new m({x:0,y:-.5,actionHandler:b.scalingYOrSkewingX,cursorStyleHandler:b.scaleSkewCursorStyleHandler,actionName:"scaling",render:K}),tl:new m(o({x:-.5,y:-.5},Sn)),tr:new m(o({x:.5,y:-.5},Sn)),bl:new m(o({x:-.5,y:.5},Sn)),br:new m(o({x:.5,y:.5},Sn))}),On=b.wrapWithFireEvent("scaling",b.wrapWithFixedAnchor(b.changeWidth));Object.assign(x.ownDefaults,{controls:o(o({},_n()),{mr:new m({x:.5,y:0,actionHandler:On,cursorStyleHandler:b.scaleSkewCursorStyleHandler,render:K}),ml:new m({x:-.5,y:0,actionHandler:On,cursorStyleHandler:b.scaleSkewCursorStyleHandler,render:K})}),splitByGrapheme:!0,fontSize:36,fontFamily:"arial"});class jn extends x{constructor(e,t){super(e,t),this.on("scaling",(()=>{var e=this._getTransformedDimensions({strokeWidth:0}),t=e.x,n=e.y;this.set({width:t,height:Math.max(n,1),scaleX:1,scaleY:1}),this.setClipPath()})),this.on("added",(()=>{this.setClipPath()}))}setClipPath(){this.clipPath=new h({top:0,left:0,width:this.width,height:this.height,originX:"center",originY:"center"})}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._forceClearCache&&(this.dirty=!0),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces())}toObject(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=super.toObject(e);return delete t.clipPath,t}_set(e,t){return"group"!==e||t||this.fire("scaling"),super._set(e,t)}exitEditing(){return this.selectionEnd-this.selectionStart>0&&this.clearContextTop(),super.exitEditing()}}u.setClass(jn);var An="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function Mn(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t="",n=0;n<e;n++)t+=An.charAt(Math.floor(Math.random()*An.length));return t}function Pn(e){return class extends e{constructor(){super(...arguments),s(this,"uniqueIds",new Map)}add(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return super.add(...t.map((e=>(this.setDefaultAttr(e),bn(e)))))}insertAt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return super.insertAt(e,...n.map((e=>(this.setDefaultAttr(e),bn(e)))))}_onObjectAdded(e){if(e.noEventObjectAdded&&this.fire!==K){var t=this.fire;this.fire=K;try{super._onObjectAdded(e)}finally{this.fire=t}}else super._onObjectAdded(e);this.updateObjects()}_onObjectRemoved(e){super._onObjectRemoved(e),this.updateObjects()}_onStackOrderChanged(){super._onStackOrderChanged(),this.updateObjects()}updateObjects(){var e,t,n=(null===(e=this.ref)||void 0===e?void 0:e.objects)||(null===(t=this.canvas)||void 0===t?void 0:t.ref.objects);n&&U(n)}setDefaultAttr(e){if(!e.name){var t=e.type,n=this.uniqueIds.get(t)||1;e.set({name:`${t} ${n}`}),this.uniqueIds.set(t,n+1)}e.id||e.set({id:Mn()}),xn.isCollection(e)&&e._objects.forEach((e=>{this.setDefaultAttr(e)}))}}}var In={serviceIds:new Map,DI_TARGET:"$di$target",DI_DEPENDENCIES:"$di$dependencies",getServiceDependencies(e){return e[this.DI_DEPENDENCIES]||[]}},Tn=En("instantiationService");function En(e){if(In.serviceIds.has(e))return In.serviceIds.get(e);var t=function e(t,n,r){if(3!==arguments.length)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");!function(e,t,n){t[In.DI_TARGET]===t?t[In.DI_DEPENDENCIES].push({id:e,index:n}):(t[In.DI_DEPENDENCIES]=[{id:e,index:n}],t[In.DI_TARGET]=t)}(e,t,r)};return t.toString=()=>e,In.serviceIds.set(e,t),t}class Rn{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];s(this,"ctor",void 0),s(this,"staticArguments",void 0),s(this,"supportsDelayedInstantiation",void 0),this.ctor=e,this.staticArguments=t,this.supportsDelayedInstantiation=n}}var Dn=[],Ln=(e=>(e[e.Eager=0]="Eager",e[e.Delayed=1]="Delayed",e))(Ln||{});function Bn(e,t,n){t instanceof Rn||(t=new Rn(t,[],Boolean(n))),Dn.push([e,t])}class zn{constructor(){s(this,"all",new Map)}on(e,t){var n=this.all.get(e);n?n.push(t):this.all.set(e,[t])}once(e,t){var n=()=>{this.off(e,n),t()};this.on(e,n)}off(e,t){var n=this.all.get(e);n&&(t?n.splice(n.indexOf(t)>>>0,1):this.all.set(e,[]))}emit(e,t){var n=this.all.get(e);n&&n.slice().map((e=>{e(t)}));var r=this.all.get("*");r&&r.slice().map((n=>{n(e,t)}))}}class Nn extends zn{}var $n=En("eventbusService");Bn($n,zn,Ln.Eager);class Hn extends Error{constructor(e){super(`Encountered errors while disposing of store. Errors: [${e.join(", ")}]`),this.errors=e}}function Vn(e){if((i=e)&&"object"==typeof i&&"function"==typeof i[Symbol.iterator]){var t,n=[],r=c(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(a)try{a.dispose()}catch(o){n.push(o)}}}catch(s){r.e(s)}finally{r.f()}if(1===n.length)throw n[0];if(n.length>1)throw new Hn(n);return Array.isArray(e)?[]:e}if(e)return e.dispose(),e;var i}class Fn{constructor(){s(this,"_toDispose",new Set),s(this,"_isDisposed",!1)}dispose(){this._isDisposed||(this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(0!==this._toDispose.size)try{Vn(this._toDispose)}finally{this._toDispose.clear()}}add(e){if(!e)return e;if(e===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed?console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(e),e}}s(Fn,"DISABLE_DISPOSED_WARNING",!1);class Wn{constructor(){s(this,"_store",new Fn)}dispose(){this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}}function Kn(e){return{dispose:k.once((()=>{e()}))}}var Un=Object.defineProperty,Gn=Object.getOwnPropertyDescriptor,Yn=En("workspacesService"),Xn=class extends Wn{constructor(e){super(),s(this,"workspaces",[]),s(this,"currentId",""),this.eventbus=e}getCurrentId(){return this.currentId}setCurrentId(e){if(this.get(e)&&this.currentId!==e){var t={oldId:this.currentId,newId:e};this.eventbus.emit("workspaceChangeBefore",t),this.currentId=e,this.eventbus.emit("workspaceChangeAfter",t)}}all(){return this.workspaces}set(e,t){var n=this.get(e);n&&n.name!==t&&(n.name=t)}get(e){return this.workspaces.find((t=>t.id===e))}add(e,t){t||(t=Mn());var n={oldId:this.currentId,newId:t};return this.eventbus.emit("workspaceAddBefore",n),this.workspaces.push({id:t,name:e}),this.eventbus.emit("workspaceAddAfter",n),t}remove(e){if(this.get(e)){this.eventbus.emit("workspaceRemoveBefore",e);var t=this.workspaces.findIndex((t=>t.id===e));this.workspaces.splice(t,1),this.eventbus.emit("workspaceRemoveAfter",e),e===this.currentId&&(this.workspaces[t]?this.setCurrentId(this.workspaces[t].id):this.workspaces[t-1]&&this.setCurrentId(this.workspaces[t-1].id))}}size(){return this.workspaces.length}clear(){this.workspaces.forEach((e=>{var t=e.id;this.eventbus.emit("workspaceRemoveBefore",t),this.eventbus.emit("workspaceRemoveAfter",t)})),this.workspaces=[],this.currentId=""}dispose(){super.dispose(),this.clear()}};Xn=((e,t,n,r)=>{for(var a,i=r>1?void 0:r?Gn(t,n):t,o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r?a(t,n,i):a(i))||i);return r&&i&&Un(t,n,i),i})([((e,t)=>(n,r)=>t(n,r,e))(0,$n)],Xn);var qn,Jn=e=>{var t=(e%360+360)%360;return t>180?t-360:t},Zn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return w.round(e,t)},Qn=(un=class e{constructor(t){s(this,"element",void 0),s(this,"next",void 0),s(this,"prev",void 0),this.element=t,this.next=e.Undefined,this.prev=e.Undefined}},s(un,"Undefined",new un(void 0)),un);i=Symbol.iterator;class er{constructor(){s(this,"_first",Qn.Undefined),s(this,"_last",Qn.Undefined),s(this,"_size",0)}get size(){return this._size}isEmpty(){return this._first===Qn.Undefined}clear(){for(var e=this._first;e!==Qn.Undefined;){var t=e.next;e.prev=Qn.Undefined,e.next=Qn.Undefined,e=t}this._first=Qn.Undefined,this._last=Qn.Undefined,this._size=0}unshift(e){return this._insert(e,!1)}push(e){return this._insert(e,!0)}_insert(e,t){var n=new Qn(e);if(this._first===Qn.Undefined)this._first=n,this._last=n;else if(t){var r=this._last;this._last=n,n.prev=r,r.next=n}else{var a=this._first;this._first=n,n.next=a,a.prev=n}this._size+=1;var i=!1;return()=>{i||(i=!0,this._remove(n))}}shift(){if(this._first!==Qn.Undefined){var e=this._first.element;return this._remove(this._first),e}}pop(){if(this._last!==Qn.Undefined){var e=this._last.element;return this._remove(this._last),e}}_remove(e){if(e.prev!==Qn.Undefined&&e.next!==Qn.Undefined){var t=e.prev;t.next=e.next,e.next.prev=t}else e.prev===Qn.Undefined&&e.next===Qn.Undefined?(this._first=Qn.Undefined,this._last=Qn.Undefined):e.next===Qn.Undefined?(this._last=this._last.prev,this._last.next=Qn.Undefined):e.prev===Qn.Undefined&&(this._first=this._first.next,this._first.prev=Qn.Undefined);this._size-=1}[i](){var e=this;return a().mark((function t(){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e._first;case 1:if(n===Qn.Undefined){t.next=7;break}return t.next=4,n.element;case 4:n=n.next,t.next=1;break;case 7:case"end":return t.stop()}}),t)}))()}}qn="function"!=typeof requestIdleCallback||"function"!=typeof cancelIdleCallback?e=>{setTimeout((()=>{if(!t){var n=Date.now()+15;e(Object.freeze({didTimeout:!0,timeRemaining:()=>Math.max(0,n-Date.now())}))}}));var t=!1;return{dispose(){t||(t=!0)}}}:(e,t)=>{var n=requestIdleCallback(e,"number"==typeof t?{timeout:t}:void 0),r=!1;return{dispose(){r||(r=!0,cancelIdleCallback(n))}}};class tr{constructor(e){s(this,"_executor",void 0),s(this,"_handle",void 0),s(this,"_didRun",!1),s(this,"_value",void 0),s(this,"_error",void 0),this._executor=()=>{try{this._value=e()}catch(t){this._error=t}finally{this._didRun=!0}},this._handle=qn((()=>this._executor()))}dispose(){this._handle.dispose()}get value(){if(this._didRun||(this._handle.dispose(),this._executor()),this._error)throw this._error;return this._value}get isInitialized(){return this._didRun}}var nr=f.prototype.toObject;f.prototype.toObject=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.push("fit"),nr.call(this,e)},f.prototype.fit="fill",Object.assign(C.ownDefaults,{strokeUniform:!0,strokeWidth:0,fill:"#CCCCCC",cornerSize:8,transparentCorners:!1,cornerColor:"#FFF",borderColor:"#2A82E4",cornerStrokeColor:"#2A82E4",controls:_n(),includeDefaultValues:!1,snapAngle:1,paintFirst:"stroke",perPixelTargetFind:!0});var rr=C.prototype._renderControls,ar={getWidthHeight(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getObjectScaling(),n=this._getTransformedDimensions({scaleX:t.x,scaleY:t.y});return e||(n.setX(Zn(n.x)),n.setY(Zn(n.y))),n},getHeight(){return this.getWidthHeight().y},getWidth(){return this.getWidthHeight().x},setHeight(e){e=Math.max(e,this.strokeWidth,.5);var t=w.divide(w.minus(this.getWidthHeight(!0).y,this.strokeWidth),this.scaleY),n=w.divide(w.minus(e,this.strokeWidth),t);n===1/0||Number.isNaN(n)||(this.set("scaleY",n||1e-5),this.fire("scaling"))},setWidth(e){e=Math.max(e,this.strokeWidth,.5);var t=w.divide(w.minus(this.getWidthHeight(!0).x,this.strokeWidth),this.scaleX),n=w.divide(w.minus(e,this.strokeWidth),t);n===1/0||Number.isNaN(n)||(this.set("scaleX",n||1e-5),this.fire("scaling"))},setAngle(e){this.rotate(Zn(Jn(e)))},getLeftTop(){var e=this.getRelativeXY();if(!this.group)return e;var t=this.group.calcTransformMatrix();return e.transform(t)},getLeft(){return this.getLeftTop().x},getTop(){return this.getLeftTop().y},setLeftTop(e){this.group&&(e=e.transform(xn.invertTransform(this.group.calcTransformMatrix()))),this.setRelativeXY(e)},setLeft(e){this.setLeftTop(this.getLeftTop().setX(e))},setTop(e){this.setLeftTop(this.getLeftTop().setY(e))},align(e){var t;if(this instanceof p){var n=this.left,r=this.top,a=this.width,i=this.height,o=new Set;this._objects.forEach((t=>{switch(e){case"alignLeft":t.setX(n);break;case"alignRight":t.setX(n+a-t.getScaledWidth());break;case"alignCenter":t.setX(n+(a-t.getScaledWidth())/2);break;case"verticalTop":t.setY(r);break;case"verticalBottom":t.setY(r+i-t.getScaledHeight());break;case"verticalMiddle":t.setY(r+(i-t.getScaledHeight())/2)}var s=t.getParent(!0);s&&o.add(s)})),o.forEach((e=>{e.setDirty()})),null===(t=this.canvas)||void 0===t||t.requestRenderAll()}},alignLeft(){this.align("alignLeft")},alignRight(){this.align("alignRight")},alignCenter(){this.align("alignCenter")},verticalTop(){this.align("verticalTop")},verticalMiddle(){this.align("verticalMiddle")},verticalBottom(){this.align("verticalBottom")},isType(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.includes(this._type)||t.includes(this.constructor.name)},_renderControls(e,t){this.isMoving?this.setCoords():rr.call(this,e,t)},_applyPatternGradientTransform(e,t){if(!xn.isFiller(t))return{offsetX:0,offsetY:0};var n=t.gradientTransform||t.patternTransform,r=-this.width/2+t.offsetX||0,a=-this.height/2+t.offsetY||0;if("percentage"===t.gradientUnits)e.transform(this.width,0,0,this.height,r,a);else{if(xn.isPattern(t)&&("fill"==t.fit||"padding"==t.fit)&&t.isImageSource()){t.repeat="no-repeat";var i=this.getObjectScaling(),o=t.source,s=o.naturalHeight,l=o.naturalWidth,c=this.getWidthHeight(),d=c.x,u=c.y,h=d/l,v=u/s,p=Math["fill"===t.fit?"max":"min"](h,v);return("fill"===t.fit?h>v:h<v)?a-=(s*p-u)/i.y/2:r-=(l*p-d)/i.x/2,t.patternTransform=[p/i.x,0,0,p/i.y,r,a],e.transform(...t.patternTransform),{offsetX:r,offsetY:a}}e.transform(1,0,0,1,r,a)}return n&&e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),{offsetX:r,offsetY:a}},toObject(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.push("id","name");var t=P.NUM_FRACTION_DIGITS,n=this.clipPath&&!this.clipPath.excludeFromExport?o(o({},this.clipPath.toObject(e)),{},{inverted:this.clipPath.inverted,absolutePositioned:this.clipPath.absolutePositioned}):null,r=o(o({},k.pick(this,e)),{},{type:this.type,originX:this.originX,originY:this.originY,left:Zn(this.left,t),top:Zn(this.top,t),width:Zn(this.width,t),height:Zn(this.height,t),fill:xn.isSerializableFiller(this.fill)?this.fill.toObject():this.fill,stroke:xn.isSerializableFiller(this.stroke)?this.stroke.toObject():this.stroke,strokeWidth:Zn(this.strokeWidth,t),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:Zn(this.strokeMiterLimit,t),scaleX:Zn(this.scaleX,t),scaleY:Zn(this.scaleY,t),angle:Zn(this.angle,t),flipX:this.flipX,flipY:this.flipY,opacity:Zn(this.opacity,t),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:Zn(this.skewX,t),skewY:Zn(this.skewY,t)},n?{clipPath:n}:null);return this.includeDefaultValues?r:this._removeDefaultValues(r)}};Object.assign(C.prototype,ar),delete S.prototype.type,Object.defineProperties(C.prototype,{type:{get(){var e=this._type||this.constructor.name;return"FabricObject"===e?"object":e.toLowerCase()},set(e){}}}),h.prototype._type="Rect",_.prototype._type="Ellipse",O.prototype._type="Text",S.prototype._type="IText",jn.prototype._type="Textbox",j.prototype._type="Path",yn.prototype._type="Board",A.prototype._type="Image",M.prototype._type="Triangle",C.prototype._type="Object",kn.prototype._type="Group",p.prototype._type="ActiveSelection",[O,S,jn,kn,yn].forEach((e=>{e.ownDefaults.perPixelTargetFind=!1}));var ir=d.prototype.setCoords,or=d.prototype._shouldSetNestedCoords;d.prototype.setCoords=function(){this.isMoving?C.prototype.setCoords.call(this):ir.call(this)},d.prototype._shouldSetNestedCoords=function(){return!(!this.canvas||!1===this.canvas.selection||!0===this.canvas.skipTargetFind)&&or.call(this)};var sr=p.prototype.exitGroup;p.prototype.exitGroup=function(e,t){sr.call(this,e,t),e.setCoords()};var lr=(e,t,n)=>{var r=t.left,a=t.top,i=t.width,o=t.height,s=n.includeIntersecting,l=[],c=new y(r,a),d=c.add(new y(i,o));return null==e||e.forEach((e=>{e instanceof yn&&e.evented&&(e.intersectsWithRect(c,d,!0)||e.containsPoint(c,void 0,!0)||e.containsPoint(d,void 0,!0))&&l.push(...lr(e._objects,t,n));var r=xn.isBoard(e),a=(!r||0===e._objects.length)&&s&&(e.intersectsWithRect(c,d,!0)||e.containsPoint(c,void 0,!0)||e.containsPoint(d,void 0,!0));(e.selectable||r&&0!==e._objects.length)&&e.visible&&e.evented&&(e.isContainedWithinRect(c,d,!0)||a)&&l.push(e)})),l};I.prototype.collectObjects=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return lr(this._objects,e,t)};var cr=Object.defineProperty,dr=Object.getOwnPropertyDescriptor,ur=(e,t)=>(n,r)=>t(n,r,e),hr=En("fabricCanvas"),vr=class extends(Pn(E)){constructor(e,t){super(document.createElement("canvas"),Object.assign({hoverCursor:"default",preserveObjectStacking:!0,selectionBorderColor:"rgba(60,126,255,0.8)",selectionColor:"rgba(60,126,255,0.2)",uniformScaling:!1,stopContextMenu:!0,fireMiddleClick:!0,includeDefaultValues:!1})),s(this,"activeObject",G()),s(this,"pageId",void 0),s(this,"pages",new Map),s(this,"ref",{zoom:Y(Zn(this.getZoom(),2)),objects:X((()=>this._objects))}),s(this,"setCoordsStack",new er),s(this,"_setCoords",k.debounce((()=>{var e=this.backgroundImage,t=this.overlayImage,n=this._objects.length;this.setCoordsStack.isEmpty()||this.setCoordsStack.clear();for(var r=0;r<n;r++)this.setCoordsStack.push(this._objects[r]);qn((()=>{for(;!this.setCoordsStack.isEmpty();){var n=this.setCoordsStack.shift();n&&(n.group||n.setCoords())}e&&e.setCoords(),t&&t.setCoords(),this.calcViewportBoundaries()}))}),50)),s(this,"_cacheBoards",void 0),s(this,"_cacheCurrentBoard",void 0),this.workspacesService=e,this.eventbus=t,delete this._objects,delete this._activeObject,this.initActiveSelection(),this.initBoard(),this.pageId=this.workspacesService.getCurrentId(),this.initWorkspace()}get _activeObject(){return this.activeObject?this.activeObject.value:void 0}set _activeObject(e){this.activeObject.value=e}get _objects(){var e,t=this.workspacesService.getCurrentId();return this.pages.has(t)||this.setPageJSON(t,{_objects:[]}),(null===(e=this.pages.get(t))||void 0===e?void 0:e._objects)||[]}set _objects(e){var t=this.workspacesService.getCurrentId();this.setPageJSON(t,{_objects:e})}zoomToPoint(e,t,n){t=q(t,.02,256);var r=e,a=[...this.viewportTransform],i=xn.transformPoint(e,xn.invertTransform(a));a[0]=t,a[3]=t;var o=xn.transformPoint(i,a);a[4]+=r.x-o.x,a[5]+=r.y-o.y,n?(this.viewportTransform=a,this.renderOnAddRemove&&this.requestRenderAll()):this.setViewportTransform(a)}setViewportTransform(e){this.viewportTransform=e,this._setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this.ref.zoom.value=Zn(this.getZoom(),2)}setActiveObject(e,t){var n=e.group;return n&&n instanceof kn&&n.onActiveTarget(e),super.setActiveObject(e,t)}exportPages(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"toObject",n=this.clipPath,r=n&&!n.excludeFromExport?this._toObject(n,t,e):null,a=[];return this.workspacesService.all().forEach((n=>{var r=this.pages.get(n.id);if(r){var i=r._objects,o=r.viewportTransform,s=r.backgroundColor;a.push({id:n.id,viewportTransform:o,objects:i.filter((e=>!e.excludeFromExport)).map((n=>this._toObject(n,t,e))),background:s})}})),o(o({},k.pick(this,e)),{},{workspaces:this.workspacesService.all(),pages:a},r?{clipPath:r}:null)}importPages(e){var t=this;return r(a().mark((function n(){var r,i,o,s,l,d,u,h,v,p,g;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return",Promise.reject(new Error("fabric.js: `json` is undefined")));case 2:if(r="string"==typeof e?JSON.parse(e):e,i=r.workspaces,o=r.pages,i&&o&&0!==i.length&&0!==o.length){n.next=6;break}return n.abrupt("return",Promise.reject(new Error("fabric.js: `json` is not valid")));case 6:t.workspacesService.clear(),t.pages.clear(),s=c(i);try{for(s.s();!(l=s.n()).done;)d=l.value,u=d.name,h=d.id,t.workspacesService.add(u,h)}catch(a){s.e(a)}finally{s.f()}v=c(o.reverse()),n.prev=11,v.s();case 13:if((p=v.n()).done){n.next=20;break}return g=p.value,t.workspacesService.setCurrentId(g.id),n.next=18,t.loadFromJSON(k.omit(g,"id"));case 18:n.next=13;break;case 20:n.next=25;break;case 22:n.prev=22,n.t0=n.catch(11),v.e(n.t0);case 25:return n.prev=25,v.f(),n.finish(25);case 28:t.renderAll();case 29:case"end":return n.stop()}}),n,null,[[11,22,25,28]])})))()}setActiveObjects(e){if(0===e.length)return this.discardActiveObject(),void this.requestRenderAll();if(1!==e.length){var t=this.getActiveSelection();t.removeAll(),t.add(...e),this._hoveredTarget=t,this._hoveredTargets=[...e],this.setActiveObject(t),this._fireSelectionEvents([t])}else this.setActiveObject(e[0])}findObjectById(e){return this.findObjectsByIds([e])[0]}findObjectsByIds(e){var t=e.length,n=Array(t).fill(void 0),r=0,a=new er,i=e=>{var t,n=c(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;a.push(r)}}catch(i){n.e(i)}finally{n.f()}};for(i(this._objects);!a.isEmpty()&&r<t;){var o=a.pop();if(o){var s=e.indexOf(o.id);-1!==s&&(n[s]=o,r++)}xn.isCollection(o)&&i(o._objects)}return n}findTarget(e){if(!this.skipTargetFind){var t=this.getPointer(e,!0),n=this._activeObject,r=this.getActiveObjects();if(this.targets=[],n&&r.length>=1){if(n._findTargetCorner(t,xn.isTouchEvent(e)))return n;var a=this.searchPossibleTargets([n],t);if(r.length>1&&a)return n;if(n===a)return n}return this.searchPossibleTargets(this._objects,t)}}searchPossibleTargets(e,t){var n=this._searchPossibleTargets(e,t);if(n&&xn.isCollection(n)&&n.interactive&&this.targets.length>0){var r=this.targets.findIndex((e=>{var t;return null===(t=e.group)||void 0===t?void 0:t.interactive}));return r>=0?this.targets[r]:this.targets[0]}return n}initWorkspace(){this.workspacesService.all().forEach((e=>{this.setPageJSON(e.id,{_objects:[]})})),this.eventbus.on("workspaceAddAfter",(e=>{var t=e.newId;this.setPageJSON(t,{_objects:[]})})),this.eventbus.on("workspaceRemoveAfter",(e=>{this.pages.delete(e)})),this.eventbus.on("workspaceChangeBefore",(e=>{var t=e.oldId;if(t&&this.pages.has(t)){var n=this.pages.get(t);if(n){var r=this.viewportTransform,a=this.backgroundColor;n.viewportTransform=r,n.backgroundColor=a}}})),this.eventbus.on("workspaceChangeAfter",(e=>{var t=e.newId;if(this.pageId!==t){this.discardActiveObject(),this._objectsToRender=void 0;var n=this.pages.get(t),r=k.omit(n,"_objects");Object.assign(this,r),this.setViewportTransform((null==n?void 0:n.viewportTransform)||T),this.ref.objects.effect.scheduler?this.ref.objects.effect.scheduler():this.ref.objects.effect.run(),this.pageId=t}}))}setPageJSON(e,t){""!==e&&this.pages.set(e,o(o({viewportTransform:this.viewportTransform,backgroundColor:this.backgroundColor,_objects:[]},this.pages.get(e)),t))}getPageJSON(e){return e===this.pageId?{_objects:this._objects,backgroundColor:this.backgroundColor,viewportTransform:this.viewportTransform}:this.pages.get(e)}initActiveSelection(){this._activeSelection=bn(this._activeSelection),this._activeSelection.subTargetCheck=!0,this._activeSelection.on("mouseup",(e=>{e.isClick&&!this._activeSelection.isMoving&&!this._isSelectionKeyPressed(e.e)&&e.subTargets&&e.subTargets.length>0&&(this.setActiveObject(e.subTargets[e.subTargets.length-1]),this.requestRenderAll())}));var e=()=>{var e=new Set;this._activeSelection.forEachObject((t=>{var n=t.getParent(!0);n&&e.add(n)})),e.forEach((e=>{e.setDirty()}))};this._activeSelection.on({modified:e,moving:e,scaling:e,skewing:e,changed:e})}absolutePan(e,t){var n,r=[...this.viewportTransform];if(r[4]=-e.x,r[5]=-e.y,t)return this.viewportTransform=r,null===(n=this._cacheBoards)||void 0===n||n.forEach((e=>{C.prototype.setCoords.call(e)})),void this.requestRenderAll();this.setViewportTransform(r)}relativePan(e,t){return this.absolutePan(new y(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]),t)}initBoard(){this.on("mouse:move",(e=>{var t=e.e,n=e.target,r=e.absolutePointer;if(n&&n.isMoving&&!xn.isBoard(n)&&(this._cacheBoards||(this._cacheBoards=this.getObjects("Board").filter((e=>e!==n)),this.once("mouse:up",(()=>{this._cacheBoards=void 0,this._cacheCurrentBoard=void 0}))),0!==this._cacheBoards.length)){this.targets=[];var a=this._searchPossibleTargets(this._cacheBoards,r);if(a!==this._cacheCurrentBoard){if(this._cacheCurrentBoard=a,xn.isActiveSelection(n)){var i=void 0,o=n._objects.some((e=>xn.isBoard(e)));if(o)return;for(var s=!1,c=n._objects.length-1;c>=0;c--){var d=n._objects[c];if(d.__owningGroup!==a){var u;void 0===i&&(i=n._onAfterObjectsChange,n._onAfterObjectsChange=K),null===(u=d.group)||void 0===u||u.remove(d);var h=l(d.getParent().remove(d),1)[0];(a||this).add(h),h.__owningGroup=a,this._activeSelection.insertAt(c,h),s=!0}}return s&&this._activeSelection.setCoords(),void(void 0!==i&&(n._onAfterObjectsChange=i))}if(!a||!n.getAncestors(!0).includes(a))if(n.group){var v,p=l(n.group.remove(n),1)[0];null===(v=n.group)||void 0===v||v.setDirty(),a?(a.add(p),a.setDirty()):this.add(p),this._setupCurrentTransform(t,p,!1),this.setActiveObject(p)}else if(a&&n!==a){var g=l(n.getParent().remove(n),1)[0];a.add(g),a.setDirty(),this._setupCurrentTransform(t,g,!1),this.setActiveObject(g)}}}}))}};vr=((e,t,n,r)=>{for(var a,i=r>1?void 0:r?dr(t,n):t,o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r?a(t,n,i):a(i))||i);return r&&i&&cr(t,n,i),i})([ur(0,Yn),ur(1,$n)],vr);class pr{constructor(){s(this,"inner_",new er),s(this,"size_",50)}pop(){return this.inner_.pop()}push(e){for(this.inner_.push(e);this.length>this.size_;)this.inner_.shift()}get length(){return this.inner_.size}}class gr{constructor(){s(this,"undoStates",new pr),s(this,"redoStates",new pr),s(this,"isUndoing",!1),s(this,"isTracking",!0),this.push=this.push.bind(this)}pause(){this.isTracking=!1}resume(){this.isTracking=!0}push(e){this.isTracking&&(this.undoStates.push(e),this.redoStates=new pr)}undo(e){if(!this.isUndoing){if(!this.canUndo)throw new Error("Nothing to undo");this.isUndoing=!0;var t=this.undoStates.pop();return this.redoStates.push(e),this.isUndoing=!1,t}}redo(e){if(!this.isUndoing){if(!this.canRedo)throw new Error("Nothing to redo");this.isUndoing=!0;var t=this.redoStates.pop();return this.undoStates.push(e),this.isUndoing=!1,t}}reset(){this.undoStates=new pr,this.redoStates=new pr,this.isUndoing=!1}get canUndo(){return!!this.undoStates.length}get canRedo(){return!!this.redoStates.length}}var fr=En("keybindingServices");class br extends R{constructor(){super(),s(this,"mod",/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"⌘":"Ctrl")}bind(e,t,n){if((k.isString(e)||k.isArray(e))&&k.isFunction(t))return super.bind(e,t,n);if(k.isObject(e)&&!k.isArray(e)&&(!t||k.isString(t)))for(var r in e)super.bind(r,e[r],t);return this}trigger(e,t){return qn((()=>{super.trigger(e,t)})),this}}Bn(fr,br,Ln.Eager);var mr=En("undoRedoService");Bn(mr,class{constructor(){s(this,"_stack",[]),s(this,"_stackIndex",-1)}canUndo(){return this._stackIndex>0}canRedo(){return this._stackIndex<this._stack.length&&this._stack.length>0}clear(){this._stack=[],this._stackIndex=-1}add(e){this.canRedo()&&this._stack.splice(this._stackIndex,this._stack.length),this._stack.push(e),this._stackIndex=this._stack.length}undo(){this.canUndo()&&(this._stackIndex--,this._stack[this._stackIndex].undo())}redo(){this.canRedo()&&(this._stack[this._stackIndex].redo(),this._stackIndex++)}},Ln.Eager);class yr{constructor(){s(this,"_timestamp",void 0),s(this,"_label",""),this._timestamp=(new Date).getTime()}getTimestamp(){return this._timestamp}getDuration(){return 0}get label(){return this._label}set label(e){this._label=e}undo(){throw new Error("Not implemented")}redo(){throw new Error("Not implemented")}}var xr=Object.defineProperty,kr=Object.getOwnPropertyDescriptor,wr=(e,t)=>(n,r)=>t(n,r,e),Cr=En("editorUndoRedoService");class Sr extends yr{constructor(e,t,n){super(),this.workspacesService=e,this.editorUndoRedoService=t,this.pageId=n}undo(){this.workspacesService.setCurrentId(this.pageId),this.editorUndoRedoService.undo()}redo(){this.workspacesService.setCurrentId(this.pageId),this.editorUndoRedoService.redo()}}var _r=class extends Wn{constructor(e,t,n,r,a){super(),s(this,"canvasEvents",void 0),s(this,"pageId",void 0),s(this,"undoRedos",new Map),s(this,"saveDispose",void 0),s(this,"saveState",k.debounce((()=>{var e,t=this.pageId;null===(e=this.saveDispose)||void 0===e||e.dispose(),this.saveDispose=qn((()=>{if(t===this.pageId){var e=this.getUndoRedo();e&&e.instantiation.isTracking&&(this.push(e.lastState),e.lastState=this.getJson(),this.undoRedoService.add(new Sr(this.workspacesService,this,t)))}}))}),300)),this.canvas=e,this.keybinding=t,this.eventbus=n,this.workspacesService=r,this.undoRedoService=a,t.bind("mod+z",(()=>{a.undo()})),t.bind(["mod+y","mod+shift+z"],(()=>{a.redo()})),this.canvasEvents={"object:modified":this.saveState.bind(this)},e.on(this.canvasEvents),this.pageId=this.workspacesService.getCurrentId(),this.initWorkspace()}getUndoRedo(){return this.undoRedos.get(this.pageId)}push(e){var t=this.getUndoRedo();t&&(t.instantiation.push(e),this.eventbus.emit("undoRedoStackChange"))}redo(){var e=this.getUndoRedo();if(e&&e.instantiation.canRedo)return e.lastState=e.instantiation.redo(e.lastState),e.lastState&&(this.loadJson(e.lastState),this.eventbus.emit("undoRedoStackChange")),e.lastState}undo(){var e=this.getUndoRedo();if(e&&e.instantiation.canUndo)return e.lastState=e.instantiation.undo(e.lastState),e.lastState&&(this.loadJson(e.lastState),this.eventbus.emit("undoRedoStackChange")),e.lastState}reset(){var e=this.getUndoRedo();e&&(e.instantiation.reset(),this.eventbus.emit("undoRedoStackChange"))}loadJson(e){var t=this;return r(a().mark((function n(){var r,i;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.getUndoRedo()){n.next=3;break}return n.abrupt("return");case 3:return i=r.instantiation,n.prev=4,i.pause(),n.next=8,t.canvas.loadFromJSON(e);case 8:return n.prev=8,t.canvas.renderAll(),i.resume(),n.finish(8);case 12:case"end":return n.stop()}}),n,null,[[4,,8,12]])})))()}getJson(){return this.canvas.toObject()}initWorkspace(){var e=this.workspacesService.getCurrentId();this.workspacesService.all().forEach((t=>{this.undoRedos.set(t.id,{instantiation:new gr,lastState:this.pageId===e?this.getJson():void 0})})),this.eventbus.on("workspaceAddAfter",(e=>{var t=e.newId;this.undoRedos.set(t,{instantiation:new gr,lastState:this.pageId===t?this.getJson():{}})})),this.eventbus.on("workspaceRemoveAfter",(e=>{this.undoRedos.delete(e)})),this.eventbus.on("workspaceChangeAfter",(e=>{var t=e.newId;this.pageId=t}))}dispose(){super.dispose(),this.keybinding.unbind(["mod+z","mod+y","mod+shift+z"]),this.canvas.off(this.canvasEvents)}};_r=((e,t,n,r)=>{for(var a,i=r>1?void 0:r?kr(t,n):t,o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r?a(t,n,i):a(i))||i);return r&&i&&xr(t,n,i),i})([wr(0,hr),wr(1,fr),wr(2,$n),wr(3,Yn),wr(4,mr)],_r);var Or={editor:null},jr=()=>{if(Or.editor)return Or.editor.service.invokeFunction((e=>({canvas:e.get(hr),keybinding:e.get(fr),undoRedo:e.get(Cr),event:e.get($n),workspaces:e.get(Yn)})));console.warn("app is not ready")},Ar=null;function Mr(){Ar&&(Ar.closeMenu(),Ar=null)}var Pr={defaultMinWidth:100,defaultMaxWidth:600,defaultZindex:100,defaultAdjustPadding:10};function Ir(e,t){var n=e.offsetTop;return null!=e.offsetParent&&e.offsetParent!=t&&(n-=e.offsetParent.scrollTop,n+=Ir(e.offsetParent,t)),n}function Tr(e,t){var n=e.offsetLeft;return null!=e.offsetParent&&e.offsetParent!=t&&(n-=e.offsetParent.scrollLeft,n+=Tr(e.offsetParent,t)),n}var Er="mx-menu-default-container";function Rr(e){var t=e.getContainer,n=e.zIndex;if(t){var r="function"==typeof t?t():t;if(r)return r.style.zIndex=(null==n?void 0:n.toString())||Pr.defaultZindex.toString(),{container:r,isNew:!1}}var a=document.getElementById(Er);return a&&document.body.removeChild(a),(a=document.createElement("div")).setAttribute("id",Er),a.setAttribute("class","mx-menu-ghost-host fullscreen"),a.style.zIndex=(null==n?void 0:n.toString())||Pr.defaultZindex.toString(),document.body.appendChild(a),{container:a,isNew:!0}}var Dr=J({props:{vnode:{type:[Object,Function],default:null},data:{type:Object,default:null}},setup(e){var t=Z(e),n=t.vnode,r=t.data;return()=>"function"==typeof n.value?n.value(r.value):n.value}}),Lr={},Br={class:"mx-checked-mark","aria-hidden":"true",viewBox:"0 0 1024 1024"},zr=[ee("path",{d:"M129.3,428.6L52,512l345,372.5l575-620.8l-69.5-75L400.4,718.2L129.3,428.6z"},null,-1)];var Nr=hn(Lr,[["render",function(e,t){return B(),Q("svg",Br,zr)}]]),$r={},Hr={class:"mx-right-arrow","aria-hidden":"true",viewBox:"0 0 1024 1024"},Vr=[ee("path",{d:"M307.018 49.445c11.517 0 23.032 4.394 31.819 13.18L756.404 480.18c8.439 8.438 13.181 19.885 13.181 31.82s-4.741 23.38-13.181 31.82L338.838 961.376c-17.574 17.573-46.065 17.573-63.64-0.001-17.573-17.573-17.573-46.065 0.001-63.64L660.944 512 275.198 126.265c-17.574-17.573-17.574-46.066-0.001-63.64C283.985 53.839 295.501 49.445 307.018 49.445z"},null,-1)];var Fr=hn($r,[["render",function(e,t){return B(),Q("svg",Hr,Vr)}]]),Wr=J({name:"ContextMenuItem",components:{VNodeRender:Dr,ContextMenuIconCheck:Nr,ContextMenuIconRight:Fr},props:{disabled:{type:Boolean,default:!1},hidden:{type:Boolean,default:!1},customRender:{type:Function,default:null},customClass:{type:String,default:""},clickHandler:{type:Function,default:null},label:{type:[String,Object,Function],default:""},icon:{type:[String,Object,Function],default:""},iconFontClass:{type:String,default:"iconfont"},checked:{type:Boolean,default:!1},shortcut:{type:String,default:""},svgIcon:{type:String,default:""},svgProps:{type:Object,default:null},preserveIconWidth:{type:Boolean,default:!0},showRightArrow:{type:Boolean,default:!1},hasChildren:{type:Boolean,default:!1},clickClose:{type:Boolean,default:!0},clickableWhenHasChildren:{type:Boolean,default:!1}},emits:["click","subMenuOpen","subMenuClose"],setup(e,t){var n=Z(e),r=n.clickHandler,a=n.clickClose,i=n.clickableWhenHasChildren,o=n.disabled,s=n.hidden,l=n.label,c=n.icon,d=n.iconFontClass,u=n.showRightArrow,h=n.shortcut,v=n.hasChildren,p=Y(!1),g=Y(!1),f=Y(),b=te("globalHasSlot"),m=te("globalRenderSlot"),y=te("globalTheme"),x=te("globalIconFontClass"),k=te("globalCloseMenu"),w=te("menuContext"),C={showSubMenu:()=>{p.value?w.markActiveMenuItem(C,!0):v.value&&_()},isDisabledOrHidden:()=>o.value||s.value,getElement:()=>f.value,focus:()=>g.value=!0,blur:()=>g.value=!1,click:S};function S(e){o.value||e&&e.target.classList.contains("mx-context-no-clickable")||(v.value?i.value?("function"==typeof r.value&&r.value(),t.emit("click")):p.value||_():("function"==typeof r.value&&r.value(),t.emit("click"),a.value&&k()))}function _(e){g.value=!1,w.checkCloseOtherSubMenuTimeOut()||w.closeOtherSubMenu(),o.value||(w.markActiveMenuItem(C),v.value&&(e||w.markThisOpenedByKeyBoard(),w.addOpenedSubMenu((()=>{g.value=!1,p.value=!1,t.emit("subMenuClose")})),p.value=!0,t.emit("subMenuOpen")))}ne((()=>{w.isMenuItemDataCollectedFlag()?re((()=>{var e=0,t=w.getElement();if(t)for(var n=0,r=0;r<t.children.length;r++){var a=t.children[r];if("ContextMenuItem"===a.getAttribute("data-type")){if(a===f.value){e=n;break}n++}}w.addChildMenuItem(C,e)})):w.addChildMenuItem(C)})),ae((()=>{w.removeChildMenuItem(C)}));var O=()=>({disabled:o.value,label:l.value,icon:c.value,iconFontClass:d.value,showRightArrow:u.value,clickClose:a.value,clickableWhenHasChildren:i.value,shortcut:h.value,theme:y,isOpen:p,hasChildren:v,onClick:S,onMouseEnter:_});return{getItemDataForChildren:O,showSubMenu:p,keyBoardFocusMenu:g,menuItemRef:f,globalHasSlot:b,globalRenderSlot:m,globalIconFontClass:x,onMouseEnter:_,onClick:S,vnodeItemRender:()=>m("itemRender",O()),vnodeItemIconRender:()=>m("itemIconRender",O()),vnodeItemCheckRender:()=>m("itemCheckRender",O()),vnodeItemLabelRender:()=>m("itemLabelRender",O()),vnodeItemRightArrowRender:()=>m("itemRightArrowRender",O()),vnodeItemShortcutRender:()=>m("itemShortcutRender",O())}}}),Kr={key:0,class:"mx-context-menu-item-wrapper",ref:"menuItemRef","data-type":"ContextMenuItem"},Ur={class:"mx-item-row"},Gr=["xlink:href"],Yr={key:1,class:"label"},Xr={class:"mx-item-row"},qr={class:"mx-shortcut"};var Jr=hn(Wr,[["render",function(e,t,n,r,a,i){var o=L("VNodeRender"),s=L("ContextMenuIconCheck"),l=L("ContextMenuIconRight");return e.hidden?le("",!0):(B(),Q("div",Kr,[e.globalHasSlot("itemRender")?(B(),z(o,{key:0,vnode:e.vnodeItemRender},null,8,["vnode"])):e.customRender?(B(),z(o,{key:1,vnode:e.customRender,data:e.getItemDataForChildren()},null,8,["vnode","data"])):(B(),Q("div",{key:2,class:ie(["mx-context-menu-item",e.disabled?"disabled":"",e.keyBoardFocusMenu?"keyboard-focus":"",e.customClass?" "+e.customClass:"",e.showSubMenu?"open":""]),onClick:t[0]||(t[0]=function(){return e.onClick&&e.onClick(...arguments)}),onMouseenter:t[1]||(t[1]=function(){return e.onMouseEnter&&e.onMouseEnter(...arguments)})},[oe(e.$slots,"default",{},(()=>[ee("div",Ur,[ee("div",{class:ie(["mx-icon-placeholder",e.preserveIconWidth?"preserve-width":""])},[oe(e.$slots,"icon",{},(()=>[e.globalHasSlot("itemIconRender")?(B(),z(o,{key:0,vnode:e.vnodeItemIconRender},null,8,["vnode"])):"string"==typeof e.svgIcon&&e.svgIcon?(B(),Q("svg",se({key:1,class:"icon svg"},e.svgProps),[ee("use",{"xlink:href":e.svgIcon},null,8,Gr)],16)):"string"!=typeof e.icon?(B(),z(o,{key:2,vnode:e.icon,data:e.icon},null,8,["vnode","data"])):"string"==typeof e.icon&&""!==e.icon?(B(),Q("i",{key:3,class:ie(e.icon+" icon "+e.iconFontClass+" "+e.globalIconFontClass)},null,2)):le("",!0)])),e.checked?oe(e.$slots,"check",{key:0},(()=>[e.globalHasSlot("itemCheckRender")?(B(),z(o,{key:0,vnode:e.vnodeItemCheckRender},null,8,["vnode"])):le("",!0),$(s)])):le("",!0)],2),oe(e.$slots,"label",{},(()=>[e.globalHasSlot("itemLabelRender")?(B(),z(o,{key:0,vnode:e.vnodeItemLabelRender},null,8,["vnode"])):"string"==typeof e.label?(B(),Q("span",Yr,ce(e.label),1)):(B(),z(o,{key:2,vnode:e.label,data:e.label},null,8,["vnode","data"]))]))]),ee("div",Xr,[e.shortcut?oe(e.$slots,"shortcut",{key:0},(()=>[e.globalHasSlot("itemShortcutRender")?(B(),z(o,{key:0,vnode:e.vnodeItemShortcutRender},null,8,["vnode"])):le("",!0),ee("span",qr,ce(e.shortcut),1)])):le("",!0),e.showRightArrow?oe(e.$slots,"rightArrow",{key:1},(()=>[e.globalHasSlot("itemRightArrowRender")?(B(),z(o,{key:0,vnode:e.vnodeItemRightArrowRender},null,8,["vnode"])):le("",!0),$(l)])):le("",!0)])]))],34)),e.showSubMenu?oe(e.$slots,"submenu",{key:3}):le("",!0)],512))}]]),Zr=J({name:"ContextMenuSperator"}),Qr={class:"mx-context-menu-item-sperator mx-context-no-clickable"};var ea=hn(Zr,[["render",function(e,t,n,r,a,i){return B(),Q("div",Qr)}]]),ta=J({name:"ContextSubMenu",components:{ContextMenuItem:Jr,ContextMenuSeparator:ea,VNodeRender:Dr,ContextMenuIconRight:Fr},props:{items:{type:Object,default:null},maxWidth:{type:[String,Number],default:0},minWidth:{type:[String,Number],default:0},adjustPosition:{type:Boolean,default:!0}},setup(e){var t=te("menuContext"),n=te("globalOptions"),r=te("globalHasSlot"),a=te("globalRenderSlot"),i=te("globalTheme");te("globalIsFullScreenContainer");var o=t.zIndex,s=t.getMyPosition,l=t.getParentWidth,c=Z(e).adjustPosition,d=Y(),u=Y(),h=[],v=te("globalSetCurrentSubMenu"),p=[],g=null,f=0;function b(){g&&g.blur()}function m(e,t){if(e){for(var n=void 0!==t?t:0;n<p.length;n++)if(!p[n].isDisabledOrHidden()){y(n);break}}else for(var r=void 0!==t?t:p.length-1;r>=0;r--)if(!p[r].isDisabledOrHidden()){y(r);break}}function y(e){if(g&&b(),void 0!==e&&(g=p[Math.max(0,Math.min(e,p.length-1))]),g&&(g.focus(),O.value)){var t=g.getElement();t&&(S.value=Math.min(Math.max(-_.value,-t.offsetTop-t.offsetHeight+A.value),0))}}var x={isTopLevel:()=>null===t.getParentContext(),closeSelfAndActiveParent:()=>{var e,t=C.getParentContext();t&&(t.closeOtherSubMenu(),null===(e=t.getSubMenuInstanceContext())||void 0===e||e.focusCurrentItem())},closeCurrentSubMenu:()=>{var e;return null===(e=C.getParentContext())||void 0===e?void 0:e.closeOtherSubMenu()},moveCurrentItemFirst:()=>m(!0),moveCurrentItemLast:()=>m(!1),moveCurrentItemDown:()=>m(!0,g?p.indexOf(g)+1:0),moveCurrentItemUp:()=>m(!1,g?p.indexOf(g)-1:0),focusCurrentItem:()=>y(),openCurrentItemSubMenu:()=>{var e;return null===(e=g)||void 0===e?void 0:e.showSubMenu()},triggerCurrentItemClick:()=>{var e;return null===(e=g)||void 0===e?void 0:e.click()}},k=!1,w=!1,C={zIndex:o+1,container:t.container,adjustPadding:t.adjustPadding,getMyPosition(){var e={x:0,y:0};return d.value&&(e.x=d.value.offsetWidth+(n.xOffset||0)),n.yOffset&&(e.y=n.yOffset),e},getParentWidth:()=>{var e;return(null===(e=d.value)||void 0===e?void 0:e.offsetWidth)||0},getParentAbsY:()=>d.value?Ir(d.value,t.container):0,addOpenedSubMenu(e){h.push(e)},closeOtherSubMenu(){h.forEach((e=>e())),h.splice(0,h.length),v(x)},checkCloseOtherSubMenuTimeOut:()=>!!f&&(clearTimeout(f),f=0,!0),closeOtherSubMenuWithTimeOut(){f=setTimeout((()=>{f=0,this.closeOtherSubMenu()}),200)},addChildMenuItem:(e,t)=>{void 0===t?p.push(e):p.splice(t,0,e)},removeChildMenuItem:e=>{p.splice(p.indexOf(e),1)},markActiveMenuItem:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];b(),g=e,t&&y()},markThisOpenedByKeyBoard:()=>{k=!0},isOpenedByKeyBoardFlag:()=>!!k&&(k=!1,!0),isMenuItemDataCollectedFlag:()=>w,getElement:()=>d.value||null,getParentContext:()=>t,getSubMenuInstanceContext:()=>x};de("menuContext",C);var S=Y(0),_=Y(0);var O=Y(!1),j=Y({x:0,y:0}),A=Y(0);return ne((()=>{j.value=s(),v(x),re((()=>{var e=d.value;if(c.value&&e&&u.value){var n=t.container,r=t.adjustPadding,a=document.documentElement.scrollHeight,i=document.documentElement.scrollWidth,o=Math.min(i,n.offsetWidth),s=Math.min(a,n.offsetHeight),h=Tr(e,n),v=Ir(e,n),p=h+e.offsetWidth-o,g=v+e.offsetHeight-s;if(_.value=e.offsetHeight-s+2*r,O.value=g>0,p>0&&(j.value.x-=(l?l():0)+e.offsetWidth-r),O.value){var f=Math.min(v-r,g+r);j.value.y-=f,A.value=s-2*r}else A.value=0}null==e||e.focus({preventScroll:!0}),t.isOpenedByKeyBoardFlag()&&m(!0),w=!0}))})),{menu:d,scroll:u,options:n,zIndex:o,constOptions:Pr,scrollValue:S,overflow:O,position:j,scrollHeight:_,maxHeight:A,globalHasSlot:r,globalRenderSlot:a,globalTheme:i,onScroll:function(e){S.value=e?Math.max(S.value-50,-_.value):Math.min(S.value+50,0)},onSubMenuBodyClick:function(){v(x)},vnode:()=>a("separatorRender",{})}}}),na={class:"mx-context-menu-scroll",ref:"scroll"};var ra=hn(ta,[["render",function(e,t,n,r,a,i){var o=L("ContextSubMenu",!0),s=L("ContextMenuItem"),l=L("VNodeRender"),c=L("ContextMenuSeparator"),d=L("ContextMenuIconRight");return B(),Q("div",{class:ie(["mx-context-menu",[e.options.customClass,e.globalTheme]]),style:pe({maxWidth:e.maxWidth?e.maxWidth:`${e.constOptions.defaultMaxWidth}px`,minWidth:e.minWidth?e.minWidth:`${e.constOptions.defaultMinWidth}px`,maxHeight:e.overflow&&e.maxHeight>0?`${e.maxHeight}px`:void 0,zIndex:e.zIndex,left:`${e.position.x}px`,top:`${e.position.y}px`}),"data-type":"ContextSubMenu",onClick:t[2]||(t[2]=function(){return e.onSubMenuBodyClick&&e.onSubMenuBodyClick(...arguments)}),onContextmenu:t[3]||(t[3]=e=>e.preventDefault())},[ee("div",{class:"mx-context-menu-items",ref:"menu",style:pe({top:`${e.scrollValue}px`})},[oe(e.$slots,"default",{},(()=>[(B(!0),Q(ue,null,he(e.items,((t,n)=>(B(),Q(ue,{key:n},[$(s,{clickHandler:t.onClick,disabled:t.disabled,hidden:t.hidden,icon:t.icon,iconFontClass:t.iconFontClass,svgIcon:t.svgIcon,svgProps:t.svgProps,label:t.label,customRender:t.customRender,customClass:t.customClass,checked:t.checked,shortcut:t.shortcut,clickClose:t.clickClose,clickableWhenHasChildren:t.clickableWhenHasChildren,preserveIconWidth:void 0!==t.preserveIconWidth?t.preserveIconWidth:e.options.preserveIconWidth,showRightArrow:t.children&&t.children.length>0,hasChildren:t.children&&t.children.length>0,onSubMenuOpen:t.onSubMenuOpen,onSubMenuClose:t.onSubMenuClose},ve({_:2},[t.children&&t.children.length>0?{name:"submenu",fn:N((()=>[$(o,{items:t.children,maxWidth:t.maxWidth,minWidth:t.minWidth,adjustPosition:void 0!==t.adjustSubMenuPosition?t.adjustSubMenuPosition:e.options.adjustPosition},null,8,["items","maxWidth","minWidth","adjustPosition"])])),key:"0"}:void 0]),1032,["clickHandler","disabled","hidden","icon","iconFontClass","svgIcon","svgProps","label","customRender","customClass","checked","shortcut","clickClose","clickableWhenHasChildren","preserveIconWidth","showRightArrow","hasChildren","onSubMenuOpen","onSubMenuClose"]),t.divided&&e.globalHasSlot("separatorRender")?(B(),z(l,{key:0,vnode:e.vnode},null,8,["vnode"])):t.divided?(B(),z(c,{key:1})):le("",!0)],64)))),128))]))],4),ee("div",na,[ge(ee("div",{class:"mx-context-menu-updown mx-context-no-clickable up",onClick:t[0]||(t[0]=t=>e.onScroll(!1))},[$(d)],512),[[fe,e.overflow&&e.scrollValue<0]]),ge(ee("div",{class:"mx-context-menu-updown mx-context-no-clickable down",onClick:t[1]||(t[1]=t=>e.onScroll(!0))},[$(d)],512),[[fe,e.overflow&&e.scrollValue>-e.scrollHeight]])],512)],38)}]]),aa=be({selector:"body",attribute:"arco-theme",emitAuto:!0,storageKey:"theme",initialValue:"dark",modes:{}}),ia=me(),oa=ye(["light","dark","auto"],{initialValue:aa}).next,sa=X((()=>"auto"===aa.value?ia.value?"dark":"light":aa.value)),la=X((()=>"dark"===sa.value));function ca(){return{isDark:la,mode:aa,trueMode:sa,next:oa}}var da=J({name:"ContextMenu",props:{options:{type:Object,default:null},show:{type:Boolean,default:!1},container:{type:Object,default:null},isFullScreenContainer:{type:Boolean,default:!0}},emits:["update:show","close"],setup(e,t){var n,r,a=Z(e),i=a.options,s=a.show,l=a.container;ne((()=>{s.value&&d()})),ae((()=>{h()})),xe(s,(e=>{e?d():h()}));var c={closeMenu:u};function d(){var e;document.addEventListener("mousedown",f,!0),document.addEventListener("contextmenu",f,!0),document.addEventListener("wheel",g,!0),!1!==i.value.keyboardControl&&document.addEventListener("keydown",p),e=c,Ar&&Mr(),Ar=e}function u(){t.emit("update:show",!1),t.emit("close"),c===Ar&&(Ar=null)}function h(){document.removeEventListener("mousedown",f,!0),document.removeEventListener("contextmenu",f,!0),document.removeEventListener("wheel",g,!0),!1!==i.value.keyboardControl&&document.removeEventListener("keydown",p)}t.expose({closeMenu:u});var v=Y();function p(e){var t,n,r,a,i,o,s=!0;switch(e.key){case"Escape":var l,c;if(!1===(null===(l=v.value)||void 0===l?void 0:l.isTopLevel()))null===(c=v.value)||void 0===c||c.closeCurrentSubMenu();else u();break;case"ArrowDown":null===(t=v.value)||void 0===t||t.moveCurrentItemDown();break;case"ArrowUp":null===(n=v.value)||void 0===n||n.moveCurrentItemUp();break;case"Home":null===(r=v.value)||void 0===r||r.moveCurrentItemFirst();break;case"End":null===(a=v.value)||void 0===a||a.moveCurrentItemLast();break;case"ArrowLeft":var d;null===(d=v.value)||void 0===d||d.closeSelfAndActiveParent();break;case"ArrowRight":null===(i=v.value)||void 0===i||i.openCurrentItemSubMenu();break;case"Enter":null===(o=v.value)||void 0===o||o.triggerCurrentItemClick();break;default:s=!1}s&&v.value&&(e.stopPropagation(),e.preventDefault())}function g(){!1!==i.value.closeWhenScroll&&u()}function f(e){!function(e){for(;e;){if(e.classList&&e.classList.contains("mx-menu-host"))return;e=e.parentNode}h(),u()}(e.target)}return de("globalSetCurrentSubMenu",(e=>v.value=e)),de("globalOptions",i.value),de("globalCloseMenu",u),de("globalTheme",(null===(n=i.value)||void 0===n?void 0:n.theme)||ca().trueMode),de("globalIsFullScreenContainer",e.isFullScreenContainer),de("globalIconFontClass",(null===(r=i.value)||void 0===r?void 0:r.iconFontClass)||"iconfont"),de("globalHasSlot",(e=>void 0!==t.slots[e])),de("globalRenderSlot",((e,n)=>oe(t.slots,e,o({},n)))),de("menuContext",{zIndex:i.value.zIndex||Pr.defaultZindex,container:l.value,adjustPadding:i.value.adjustPadding||Pr.defaultAdjustPadding,getParentAbsY:()=>i.value.y,getMyPosition:()=>({x:i.value.x,y:i.value.y}),getParentWidth:()=>0,closeOtherSubMenuWithTimeOut:()=>{},checkCloseOtherSubMenuTimeOut:()=>!1,addOpenedSubMenu:()=>{},closeOtherSubMenu:()=>{},getParentContext:()=>null,getSubMenuInstanceContext:()=>null,getElement:()=>null,addChildMenuItem:()=>{},removeChildMenuItem:()=>{},markActiveMenuItem:()=>{},markThisOpenedByKeyBoard:()=>{},isOpenedByKeyBoardFlag:()=>!1,isMenuItemDataCollectedFlag:()=>!1}),()=>{var e,n;return s.value?[ke("div",{class:"mx-menu-ghost-host"},[ke(ra,{class:"mx-menu-host",items:null===(e=i.value)||void 0===e?void 0:e.items,adjustPosition:null===(n=i.value)||void 0===n?void 0:n.adjustPosition,maxWidth:i.value.maxWidth||Pr.defaultMaxWidth,minWidth:i.value.minWidth||Pr.defaultMinWidth},{default:t.slots.default})])]:[]}}}),ua=J({name:"ContextMenu",props:{options:{type:Object,default:null},show:{type:Boolean,default:!1}},emits:["update:show","close"],setup(e,t){var n=Z(e),r=n.options,a=n.show,i=null,o=!1;function s(){var e,t;i&&(o&&(null===(t=(e=i).parentNode)||void 0===t||t.removeChild(e)),i=null)}return xe(a,(e=>{var n,a,l,c;e?(n=Rr(r.value),a=n.container,l=n.isNew,c=ke(da,{options:r,show:!0,container:a,isFullScreenContainer:!l,"onUpdate:show":e=>t.emit("update:show",e),onClose:()=>{var e,n;we(null,a),null===(e=(n=r.value).onClose)||void 0===e||e.call(n),t.emit("close")}},t.slots),o=l,i=a,we(c,a)):s()})),t.expose({closeMenu:s}),()=>[]}}),ha=J({name:"ContextMenuGroup",props:{disabled:{type:Boolean,default:!1},hidden:{type:Boolean,default:!1},clickHandler:{type:Function,default:null},label:{type:String,default:""},icon:{type:String,default:""},iconFontClass:{type:String,default:"iconfont"},checked:{type:Boolean,default:!1},shortcut:{type:String,default:""},svgIcon:{type:String,default:""},svgProps:{type:Object,default:null},preserveIconWidth:{type:Boolean,default:!0},showRightArrow:{type:Boolean,default:!1},clickClose:{type:Boolean,default:!0},adjustSubMenuPosition:{type:Boolean,default:void 0},maxWidth:{type:[String,Number],default:0},minWidth:{type:[String,Number],default:0}},setup(e,t){var n=te("globalOptions"),r=Z(e),a=r.adjustSubMenuPosition,i=r.maxWidth,s=r.minWidth,l=void 0!==a.value?a.value:n.adjustPosition;return()=>ke(Jr,o(o({},e),{},{showRightArrow:!0,maxWidth:void 0,minWidth:void 0,adjustSubMenuPosition:void 0,hasChildren:void 0!==t.slots.default}),t.slots.default?{submenu:()=>ke(ra,{maxWidth:i.value,minWidth:s.value,adjustPosition:l},{default:t.slots.default})}:void 0)}});function va(e,t){var n=Rr(e),r=function(e,t,n,r){var a=ke(da,{options:e,show:!0,container:t,isFullScreenContainer:!n,onClose:()=>{var n,r=()=>{var n;we(null,t),null===(n=e.onClose)||void 0===n||n.call(e)};if(null!==(n=a.el)&&void 0!==n&&n.parentElement){var i=a.el.parentElement.querySelector(".mx-context-menu");if(i)return i.addEventListener("transitionend",r,{once:!0}),i.style.opacity="0",void(i.style.pointerEvents="none")}r()}},r);return we(a,t),a.component}(e,n.container,n.isNew,t);return r.exposed}var pa={install(e){e.config.globalProperties.$contextmenu=va,e.component("ContextMenu",ua),e.component("ContextMenuItem",Jr),e.component("ContextMenuGroup",ha),e.component("ContextMenuSperator",ea),e.component("ContextMenuSeparator",ea),e.component("ContextSubMenu",ra)},showContextMenu:(e,t)=>va(e,t),closeContextMenu:Mr,transformMenuPosition:function(e,t,n,r){return{x:Tr(e,r)+t,y:Ir(e,r)+n}}};var ga=J({__name:"menu",setup(e){var t=function(){var e=jr().canvas,t=Ce({types:[{accept:{"application/json":[".json"]}}],dataType:"Text"}),n=t.isSupported,i=t.create,o=t.open,s=t.data,l=t.save,c=Se({accept:"application/json"}),d=c.open;(0,c.onChange)((t=>{var n;t&&(null===(n=t.item(0))||void 0===n||n.text().then((t=>{e.importPages(t)})))}));var u=function(){var t=r(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=9;break}return s.value=void 0,t.next=4,o();case 4:if(_e(s)){t.next=6;break}return t.abrupt("return");case 6:e.importPages(s.value),t.next=10;break;case 9:d();case 10:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),h=function(){var t=r(a().mark((function t(){var r,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=9;break}return t.next=3,i({suggestedName:"未命名.json"});case 3:return s.value=JSON.stringify(e.exportPages()),t.next=6,l();case 6:s.value=void 0,t.next=14;break;case 9:r=new Blob([JSON.stringify(e.exportPages())]),(o=document.createElement("a")).href=URL.createObjectURL(r),o.download="未命名.json",o.click();case 14:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return{importPages:u,exportPages:h}}(),n=t.exportPages,i=t.importPages,o=e=>{pa.showContextMenu({x:e.clientX,y:e.clientY,preserveIconWidth:!1,items:[{label:"导入",onClick:i},{label:"导出",onClick:n}]})};return(e,t)=>{var n=Oe,r=je;return B(),z(r,{onClick:o},{icon:N((()=>[$(n)])),_:1})}}}),fa=["xlink:href","fill"],ba=J({__name:"svgIcon",props:{name:{},prefix:{default:"icon"},size:{default:18},fill:{default:"currentColor"}},setup(e){var t=e,n=X((()=>`#${t.prefix}-${t.name}`)),r=Ae(),a=X((()=>({width:`${t.size}px`,height:`${t.size}px`})));return(e,t)=>(B(),Q("svg",se({"aria-hidden":"true",style:Me(a)},Me(r)),[ee("use",{"xlink:href":Me(n),fill:e.fill},null,8,fa)],16))}});var ma=hn(J({name:"DropdownButton",components:{SvgIcon:ba},props:{active:{type:Boolean,default:!1},popupVisible:{type:Boolean,default:void 0},defaultPopupVisible:{type:Boolean,default:!1},trigger:{type:[String,Array],default:"click"},position:{type:String,default:"br"},popupContainer:{type:[String,Object]},disabled:{type:Boolean,default:!1},size:{type:String},buttonProps:{type:Object},hideOnSelect:{type:Boolean,default:!0}},emits:{"update:popupVisible":e=>!0,popupVisibleChange:e=>!0,click:e=>!0,select:(e,t)=>!0},setup(e,t){var n=t.emit,r=Z(e),a=r.defaultPopupVisible,i=r.popupVisible,o=Pe("dropdown"),s=Ie({defaultPopupVisible:a,popupVisible:i,emit:n});return{prefixCls:o,computedPopupVisible:s.computedPopupVisible,handleClick:e=>{n("click",e)},handleSelect:(e,t)=>{n("select",e,t)},handlePopupVisibleChange:s.handlePopupVisibleChange}}}),[["render",function(e,t,n,r,a,i){var o=L("SvgIcon"),s=je,l=Te;return B(),z(s,se({class:["btn-box",{active:e.active}],size:e.size,disabled:e.disabled},e.buttonProps,{onClick:e.handleClick}),{icon:N((()=>[oe(e.$slots,"default",{},void 0,!0),e.$slots.content?(B(),z(l,{key:0,"popup-visible":e.computedPopupVisible,trigger:e.trigger,position:e.position,"popup-container":e.popupContainer,"hide-on-select":e.hideOnSelect,onSelect:e.handleSelect,onPopupVisibleChange:e.handlePopupVisibleChange},{content:N((()=>[oe(e.$slots,"content",{},void 0,!0)])),default:N((()=>[$(s,{class:"more-btn absolute! w12px! h12px! bottom-0 right-0 bg-transparent! transition translate-0",disabled:e.disabled},{icon:N((()=>[oe(e.$slots,"icon",{popupVisible:e.computedPopupVisible},(()=>[$(o,{name:"dropdown-more",size:12})]),!0)])),_:3},8,["disabled"])])),_:3},8,["popup-visible","trigger","position","popup-container","hide-on-select","onSelect","onPopupVisibleChange"])):le("",!0)])),_:3},16,["class","size","disabled","onClick"])}],["__scopeId","data-v-4758a156"]]),ya=Ee("app",(()=>{var e=Y(0);return{activeTool:Y("move"),zoom:e}})),xa=Re(),ka=J({__name:"tool",setup(e){var t=De(ya()).activeTool,n=Y([{key:"move",icon:"bxs-pointer",name:"选择工具",doption:[{key:"move",icon:"bxs-pointer",name:"选择工具"},{key:"handMove",icon:"bxs-hand",name:"移动视图"}]},{key:"board",icon:"artboard",name:"画板"},{key:"rect",icon:"bx-square",name:"矩形",doption:[{key:"rect",icon:"bx-square",name:"矩形"},{key:"ellipse",icon:"bx-circle",name:"圆形"},{key:"triangle",icon:"bx-triangle",name:"三角形"}]},{key:"vector",icon:"bx-pen",name:"钢笔"},{key:"text",icon:"bx-text",name:"文本"}]),r=e=>{t.value=e};return(e,a)=>{var i=Be,s=ze;return B(),z(s,null,{default:N((()=>[(B(!0),Q(ue,null,he(Me(n),((e,a)=>(B(),z(ma,{key:e.key,active:Me(t)===e.key,onClick:t=>r(e.key),onSelect:e=>{Me(n)[a]=o(o({},Me(n)[a]),e),r(e.key)}},ve({default:N((()=>[$(Me(ba),{name:e.icon},null,8,["name"])])),_:2},[e.doption?{name:"content",fn:N((()=>[(B(!0),Q(ue,null,he(e.doption,(e=>(B(),z(i,{key:e.key,value:e},{icon:N((()=>[$(Me(ba),{name:e.icon},null,8,["name"])])),default:N((()=>[Le(" "+ce(e.name),1)])),_:2},1032,["value"])))),128))])),key:"0"}:void 0]),1032,["active","onClick","onSelect"])))),128))])),_:1})}}}),wa=()=>{var e=jr(),t=e.canvas,n=e.keybinding,r=n.mod;return[{label:"向上移动一层",onClick:()=>{n.trigger("mod+]")},shortcut:`${r} ]`},{label:"移到顶层",onClick:()=>{n.trigger("]")},shortcut:"]"},{label:"向下移动一层",onClick:()=>{n.trigger("mod+[")},shortcut:`${r} [`},{label:"移到底层",onClick:()=>{n.trigger("[")},shortcut:"[",divided:!0},{label:"创建分组",hidden:t.getActiveObject()instanceof yn,onClick:()=>{n.trigger(gn)},shortcut:`${r} G`},{label:"解除分组",hidden:!(t.getActiveObject()instanceof kn),onClick:()=>{n.trigger(fn)},shortcut:`${r} ⇧ G`},{label:"重命名",hidden:t.getActiveObject()instanceof p,onClick:()=>{n.trigger("mod+r")},shortcut:`${r} R`,divided:!0},{label:"显示/隐藏",onClick:()=>{n.trigger("mod+shift+h")},shortcut:`${r} ⇧ H`},{label:"锁定/解锁",onClick:()=>{n.trigger("mod+shift+l")},shortcut:`${r} ⇧ L`}]},Ca=()=>{var e=jr().keybinding;return[{label:"放大",onClick:()=>{e.trigger("+")},shortcut:"+"},{label:"缩小",onClick:()=>{e.trigger("-")},shortcut:"-"}]},Sa=J({__name:"zoom",setup(e){var t=De(ya()).zoom,n=jr(),r=n.canvas,a=n.keybinding,i=Y(),o=Y();W((()=>{o.value=w.times(t.value,100)+"%"}));var s=e=>{var t=e.clientX,n=e.clientY;if(_e(i)){var s,l=null===(s=i.value)||void 0===s?void 0:s.$el.getBoundingClientRect();t=Math.max(l.x-8,0),n=l.y+l.height+4}pa.showContextMenu({x:t,y:n,preserveIconWidth:!1,items:[{customRender:()=>ke("div",{class:"p2"},ke(Ne,{size:"small",modelValue:o.value,"onUpdate:modelValue":e=>{o.value=e},onChange:e=>{var t=parseInt(e);k.isNumber(t)&&!Number.isNaN(t)&&r.zoomToPoint(r.getCenterPoint(),w.divide(t,100))}},{}))},...Ca(),{label:"50%",onClick:()=>{r.zoomToPoint(r.getCenterPoint(),.5)}},{label:"100%",onClick:()=>{a.trigger("mod+0")},shortcut:`${a.mod} 0`},{label:"200%",onClick:()=>{r.zoomToPoint(r.getCenterPoint(),2)},divided:!0},{label:"显示全部",onClick:()=>{a.trigger("mod+1")},shortcut:`${a.mod} 1`},{label:"显示选中内容",onClick:()=>{a.trigger("mod+2")},disabled:!_e(r.activeObject),shortcut:`${a.mod} 2`}]})};return(e,n)=>{var r=$e,a=je;return B(),z(a,{ref_key:"button",ref:i,class:"icon-btn px2!",onClick:s},{default:N((()=>[Le(ce(Me(w).times(Me(t),100))+"% ",1),$(r,{class:"ml1"})])),_:1},512)}}}),_a=J({setup(){var e=jr(),t=e.canvas,n=e.keybinding;return()=>$(ue,null,[$(je,{onClick:()=>n.trigger(gn),class:"icon-btn",disabled:t.activeObject.value instanceof yn},{icon:()=>$(ba,{name:"object-group"},null)}),$(je,{onClick:()=>n.trigger(fn),class:"icon-btn",disabled:!(t.activeObject.value instanceof kn)},{icon:()=>$(ba,{name:"object-ungroup"},null)})])}}),Oa=J({setup:()=>()=>$("div",null,[Le("未命名")])});var ja=hn({},[["render",function(e,t){var n=je,r=ze;return B(),z(r,null,{default:N((()=>[$(n,{onClick:t[0]||(t[0]=t=>e.$router.push({name:"Home"}))},{default:N((()=>[Le(" 退出 ")])),_:1})])),_:1})}]]),Aa={class:"flex items-center h-12 px-2"},Ma={class:"flex-1 flex items-center"},Pa={class:"truncate"},Ia={class:"flex-1 flex justify-end"},Ta=J({__name:"headerBar",setup(e){var t=jr().canvas;return(e,n)=>{var r=He;return B(),Q("div",Aa,[ee("div",Ma,[$(ga),$(r,{direction:"vertical"}),$(ka),$(r,{direction:"vertical"}),$(Sa)]),ee("div",Pa,[Me(_e)(Me(t).activeObject)?(B(),z(Me(_a),{key:0})):(B(),z(Me(Oa),{key:1}))]),ee("div",Ia,[$(ja)])])}}}),Ea=J({setup(){var e=jr().canvas,t=Y();ne((()=>{var n;null===(n=t.value)||void 0===n||n.append(e.wrapperEl),Ve(t,(t=>{var n=l(t,1)[0].contentRect,r=n.width,a=n.height;e.lowerCanvasEl&&e.setDimensions({width:r,height:a})}))}));var n=ca().isDark;return{divRef:t,isDark:n}},render(){return $("div",{ref:"divRef",class:["relative h-full w-full",this.isDark?" bg-$color-neutral-1":" bg-$color-neutral-2"]},null)}}),Ra=Symbol("TreeInjectionKey");function Da(e){return e.selectable&&!e.disabled}function La(e){return!e.isLeaf&&e.children}function Ba(e){return Set.prototype.add.bind(e)}function za(e){return Set.prototype.delete.bind(e)}function Na(e){return!e.disabled&&!e.disableCheckbox&&!!e.checkable}function $a(e){var t,n=[];return null===(t=e.children)||void 0===t||t.forEach((e=>{Na(e)&&n.push(e.key,...$a(e))})),n}function Ha(e){for(var t=e.node,n=e.checkedKeySet,r=e.indeterminateKeySet,a=t.parent,i=function(){if(Na(a)){var e,t=a.key,i=(null===(e=a.children)||void 0===e?void 0:e.filter(Na))||[],o=0,s=i.length;i.some((e=>{var t=e.key;if(n.has(t))o+=1;else if(r.has(t))return o+=.5,!0;return!1})),o&&o!==s?r.add(t):r.delete(t),o&&o===s?n.add(t):n.delete(t)}a=a.parent};a;)i()}function Va(e){var t=e.node,n=e.checked,r=e.checkedKeys,a=e.indeterminateKeys,i=e.checkStrictly,o=void 0!==i&&i,s=t.key,l=new Set(r),c=new Set(a);if(n?l.add(s):l.delete(s),c.delete(s),!o){var d=$a(t);n?d.forEach(Ba(l)):d.forEach(za(l)),d.forEach(za(c)),Ha({node:t,checkedKeySet:l,indeterminateKeySet:c})}return[[...l],[...c]]}function Fa(){return te(Ra)||{}}var Wa,Ka=J({name:"TreeNodeSwitcher",components:{IconLoading:We,RenderFunction:Ke},props:{prefixCls:String,loading:Boolean,showLine:Boolean,treeNodeData:{type:Object},icons:{type:Object},nodeStatus:{type:Object}},emits:["click"],setup(e,t){var n=t.slots,r=t.emit,a=Z(e),i=a.icons,o=a.nodeStatus,s=a.treeNodeData,l=Fa(),c=Ue(n,"switcher-icon"),d=Ue(n,"loading-icon");return{getSwitcherIcon:()=>{var e,t,n,r=null!==(e=null==i||null===(t=i.value)||void 0===t?void 0:t.switcherIcon)&&void 0!==e?e:c.value;return r?r(o.value):null===(n=l.switcherIcon)||void 0===n?void 0:n.call(l,s.value,o.value)},getLoadingIcon:()=>{var e,t,n,r=null!==(e=null==i||null===(t=i.value)||void 0===t?void 0:t.loadingIcon)&&void 0!==e?e:d.value;return r?r(o.value):null===(n=l.loadingIcon)||void 0===n?void 0:n.call(l,s.value,o.value)},onClick(e){r("click",e)}}},render(){var e,t=this.prefixCls,n=this.getSwitcherIcon,r=this.getLoadingIcon,a=this.onClick,i=this.nodeStatus,o=void 0===i?{}:i,s=this.loading,l=this.showLine,c=o.expanded,d=o.isLeaf;if(s)return null!==(e=r())&&void 0!==e?e:ke(We);var u=null,h=!1;if(d){if(l){var v;u=null!==(v=n())&&void 0!==v?v:ke(Ye)}}else{var p,g=l?ke("span",{class:`${t}-${c?"minus":"plus"}-icon`}):ke(Ge);u=null!==(p=n())&&void 0!==p?p:g,h=!l}if(!u)return null;var f=ke("span",{class:`${t}-switcher-icon`,onClick:a},u);return h?ke(Xe,{class:`${t}-icon-hover`},(()=>f)):f}}),Ua=(Wa=0,()=>`__arco_tree${Wa+=1}`);function Ga(e){var t=e.subEnable,n=e.superEnable,r=e.isLeaf,a=e.treeNodeData,i=e.level;return Je(t)?Ze(n)?n(a,{isLeaf:r,level:i}):null!=n&&n:t}function Ya(e){var t,n,r,a,i,s,l,c=e.treeNodeData,d=e.parentNode,u=e.isTail,h=void 0===u||u,v=e.treeProps,p=(v||{}).fieldNames,g=(a=p,i=o({},r=c),a&&Object.keys(a).forEach((e=>{var t=a[e];t!==e&&(i[e]=r[t],delete i[t])})),i),f=v.loadMore?!!g.isLeaf:!(null!==(t=g.children)&&void 0!==t&&t.length),b=d?d.level+1:0,m=o(o({},qe(g,["children"])),{},{key:null!==(n=g.key)&&void 0!==n?n:Ua(),selectable:Ga({subEnable:g.selectable,superEnable:null==v?void 0:v.selectable,isLeaf:f,level:b,treeNodeData:c}),disabled:!!g.disabled,disableCheckbox:!!g.disableCheckbox,checkable:Ga({subEnable:g.checkable,superEnable:null==v?void 0:v.checkable,isLeaf:f,level:b,treeNodeData:c}),isLeaf:f,isTail:h,blockNode:!(null==v||!v.blockNode),showLine:!(null==v||!v.showLine),level:b,lineless:d?[...d.lineless,d.isTail]:[],draggable:(s=g.draggable,l=null==v?void 0:v.draggable,!!(Je(s)?l:s))});return o(o({},m),{},{treeNodeProps:m,treeNodeData:c,parent:d,parentKey:null==d?void 0:d.key,pathParentKeys:d?[...d.pathParentKeys,d.key]:[]})}function Xa(){var e=Qe(),t=()=>{var t;return null!==(t=null==e?void 0:e.vnode.key)&&void 0!==t?t:Ua()},n=Y(t());return et((()=>{n.value=t()})),n}var qa=J({name:"BaseTreeNode",components:{NodeSwitcher:Ka,Checkbox:nt,RenderFunction:Ke,IconDragDotVertical:rt},props:{key:{type:[String,Number]},title:{type:String},selectable:{type:Boolean},disabled:{type:Boolean},disableCheckbox:{type:Boolean},checkable:{type:Boolean},draggable:{type:Boolean},isLeaf:{type:Boolean},icon:{type:Function},switcherIcon:{type:Function},loadingIcon:{type:Function},dragIcon:{type:Function},isTail:{type:Boolean},blockNode:{type:Boolean},showLine:{type:Boolean},level:{type:Number,default:0},lineless:{type:Array,default:()=>[]}},setup(e){var t=Xa(),n=Pe("tree-node"),r=Fa(),a=X((()=>{var e;return null===(e=r.key2TreeNode)||void 0===e?void 0:e.get(t.value)})),i=X((()=>a.value.treeNodeData)),o=X((()=>a.value.children)),s=X((()=>{var e,t=null===(e=r.treeProps)||void 0===e?void 0:e.actionOnNodeClick;return t?at(t):[]})),c=Z(e),d=c.isLeaf,u=c.isTail,h=c.selectable,v=c.disabled,p=c.disableCheckbox,g=c.draggable,f=c.blockNode,b=Y(!1),m=X((()=>{var e;return[`${n}`,{[`${n}-hover`]:b.value,[`${n}-block`]:f.value,[`${n}-selected`]:M.value,[`${n}-is-leaf`]:d.value,[`${n}-is-tail`]:u.value,[`${n}-expanded`]:P.value,[`${n}-disabled-selectable`]:!(h.value||null!==(e=r.treeProps)&&void 0!==e&&e.disableSelectActionOnly),[`${n}-disabled`]:v.value}]})),y=Y(),x=function(e){var t=Z(e),n=t.key,r=t.refTitle,a=Fa(),i=Y(!1),o=Y(!1),s=Y(!1),l=Y(0),c=tt((e=>{if(r.value){var t=r.value.getBoundingClientRect(),i=window.pageYOffset+t.top,o=e.pageY-i;s.value=!a.allowDrop||a.allowDrop(n.value,l.value);var c=s.value?t.height/4:t.height/2;l.value=o<c?-1:o<t.height-c?0:1}}));return{isDragOver:i,isDragging:o,isAllowDrop:s,dropPosition:l,setDragStatus(e,t){switch(e){case"dragStart":o.value=!0,l.value=0,a.onDragStart&&a.onDragStart(n.value,t);break;case"dragEnd":o.value=!1,i.value=!1,l.value=0,c.cancel(),a.onDragEnd&&a.onDragEnd(n.value,t);break;case"dragOver":i.value=!0,c(t),a.onDragOver&&a.onDragOver(n.value,t);break;case"dragLeave":i.value=!1,l.value=0,c.cancel(),a.onDragLeave&&a.onDragLeave(n.value,t);break;case"drop":a.onDrop&&a.onDrop(n.value,l.value,t),i.value=!1,l.value=0,c.cancel()}}}}(F({key:t,refTitle:y})),k=x.isDragOver,w=x.isDragging,C=x.isAllowDrop,S=x.dropPosition,_=x.setDragStatus,O=X((()=>[`${n}-title`,{[`${n}-title-draggable`]:g.value,[`${n}-title-gap-top`]:k.value&&S.value<0,[`${n}-title-gap-bottom`]:k.value&&S.value>0,[`${n}-title-highlight`]:!w.value&&k.value&&C.value&&0===S.value,[`${n}-title-dragging`]:w.value,[`${n}-title-block`]:a.value.blockNode}])),j=X((()=>{var e,n;return null===(e=r.checkedKeys)||void 0===e||null===(n=e.includes)||void 0===n?void 0:n.call(e,t.value)})),A=X((()=>{var e,n;return null===(e=r.indeterminateKeys)||void 0===e||null===(n=e.includes)||void 0===n?void 0:n.call(e,t.value)})),M=X((()=>{var e,n;return null===(e=r.selectedKeys)||void 0===e||null===(n=e.includes)||void 0===n?void 0:n.call(e,t.value)})),P=X((()=>{var e,n;return null===(e=r.expandedKeys)||void 0===e||null===(n=e.includes)||void 0===n?void 0:n.call(e,t.value)})),I=X((()=>{var e,n;return null===(e=r.loadingKeys)||void 0===e||null===(n=e.includes)||void 0===n?void 0:n.call(e,t.value)})),T=X((()=>r.dragIcon)),E=X((()=>r.nodeIcon));function R(e){var n,a;d.value||(null!==(n=o.value)&&void 0!==n&&n.length||!Ze(r.onLoadMore)?null==r||null===(a=r.onExpand)||void 0===a||a.call(r,!P.value,t.value,e):r.onLoadMore(t.value))}var D=F({loading:I,checked:j,selected:M,indeterminate:A,expanded:P,isLeaf:d}),L=X((()=>r.nodeTitle?()=>{var e;return null===(e=r.nodeTitle)||void 0===e?void 0:e.call(r,i.value,D)}:void 0)),B=X((()=>r.nodeExtra?()=>{var e;return null===(e=r.nodeExtra)||void 0===e?void 0:e.call(r,i.value,D)}:void 0)),z=l(it(),2),N=z[0],$=z[1];return{hover:b,DefineTemplate:N,ReuseTemplate:$,nodekey:t,refTitle:y,prefixCls:n,classNames:m,titleClassNames:O,indeterminate:A,checked:j,expanded:P,selected:M,treeTitle:L,treeNodeData:i,loading:I,treeDragIcon:T,treeNodeIcon:E,extra:B,nodeStatus:D,onCheckboxChange(e,n){var a;p.value||v.value||null===(a=r.onCheck)||void 0===a||a.call(r,e,t.value,n)},onTitleClick(e){var n;s.value.includes("expand")&&R(e),h.value&&!v.value&&(null===(n=r.onSelect)||void 0===n||n.call(r,t.value,e))},onTitleDbclick(e){var n;h.value&&!v.value&&(null===(n=r.onNodeDbclick)||void 0===n||n.call(r,t.value,e))},onSwitcherClick:R,onDragStart(e){if(g.value){e.stopPropagation(),_("dragStart",e);try{var t;null===(t=e.dataTransfer)||void 0===t||t.setData("text/plain","")}catch(n){}}},onDragEnd(e){g.value&&(e.stopPropagation(),_("dragEnd",e))},onDragOver(e){g.value&&(e.stopPropagation(),e.preventDefault(),_("dragOver",e))},onDragLeave(e){g.value&&(e.stopPropagation(),_("dragLeave",e))},onDrop(e){g.value&&(e.stopPropagation(),e.preventDefault(),_("drop",e))},onNodeContextmenu(e){var n;null===(n=r.onNodeContextmenu)||void 0===n||n.call(r,t.value,e)}}}}),Ja=["data-level","data-key"],Za=["draggable"];var Qa=hn(qa,[["render",function(e,t,n,r,a,i){var o=L("NodeSwitcher"),s=L("Checkbox"),l=L("RenderFunction"),c=rt;return B(),Q("div",{class:ie(e.classNames),"data-level":e.level,"data-key":e.nodekey,onMouseout:t[8]||(t[8]=t=>e.hover=!1),onMouseover:t[9]||(t[9]=t=>e.hover=!0),onContextmenu:t[10]||(t[10]=function(){return e.onNodeContextmenu&&e.onNodeContextmenu(...arguments)})},[(B(),z(H(e.DefineTemplate),null,{default:N((()=>[ee("span",{class:ie(`${e.prefixCls}-indent`)},[(B(!0),Q(ue,null,he(e.level,(t=>(B(),Q("span",{key:t,class:ie([`${e.prefixCls}-indent-block`,{[`${e.prefixCls}-indent-block-lineless`]:e.lineless[t-1]}])},null,2)))),128))],2),ee("span",{class:ie([`${e.prefixCls}-switcher`,{[`${e.prefixCls}-switcher-expanded`]:e.expanded,"pl1.5 pr4.5 mr-0!":e.blockNode}]),onClick:t[0]||(t[0]=function(){return e.onSwitcherClick&&e.onSwitcherClick(...arguments)})},[$(o,{"prefix-cls":e.prefixCls,loading:e.loading,"show-line":e.showLine,"tree-node-data":e.treeNodeData,icons:{switcherIcon:e.switcherIcon,loadingIcon:e.loadingIcon},"node-status":e.nodeStatus},ve({_:2},[e.$slots["switcher-icon"]?{name:"switcher-icon",fn:N((()=>[oe(e.$slots,"switcher-icon",{},void 0,!0)])),key:"0"}:void 0,e.$slots["loading-icon"]?{name:"loading-icon",fn:N((()=>[oe(e.$slots,"loading-icon",{},void 0,!0)])),key:"1"}:void 0]),1032,["prefix-cls","loading","show-line","tree-node-data","icons","node-status"])],2),e.checkable?(B(),z(s,{key:0,disabled:e.disableCheckbox||e.disabled,"model-value":e.checked,indeterminate:e.indeterminate,"uninject-group-context":"",onChange:e.onCheckboxChange},null,8,["disabled","model-value","indeterminate","onChange"])):le("",!0)])),_:3})),e.blockNode?le("",!0):(B(),z(H(e.ReuseTemplate),{key:0})),ee("span",{ref:"refTitle",class:ie(e.titleClassNames),draggable:e.draggable,onDragstart:t[1]||(t[1]=function(){return e.onDragStart&&e.onDragStart(...arguments)}),onDragend:t[2]||(t[2]=function(){return e.onDragEnd&&e.onDragEnd(...arguments)}),onDragover:t[3]||(t[3]=function(){return e.onDragOver&&e.onDragOver(...arguments)}),onDragleave:t[4]||(t[4]=function(){return e.onDragLeave&&e.onDragLeave(...arguments)}),onDrop:t[5]||(t[5]=function(){return e.onDrop&&e.onDrop(...arguments)}),onClick:t[6]||(t[6]=function(){return e.onTitleClick&&e.onTitleClick(...arguments)}),onDblclick:t[7]||(t[7]=function(){return e.onTitleDbclick&&e.onTitleDbclick(...arguments)})},[e.blockNode?(B(),z(H(e.ReuseTemplate),{key:0})):le("",!0),e.$slots.icon||e.icon||e.treeNodeIcon?(B(),Q("span",{key:1,class:ie([`${e.prefixCls}-icon`,`${e.prefixCls}-custom-icon`])},[e.$slots.icon?oe(e.$slots,"icon",ot(se({key:0},e.nodeStatus)),void 0,!0):e.icon?(B(),z(l,se({key:1,"render-func":e.icon},e.nodeStatus),null,16,["render-func"])):e.treeNodeIcon?(B(),z(l,se({key:2,"render-func":e.treeNodeIcon,node:e.treeNodeData},e.nodeStatus),null,16,["render-func","node"])):le("",!0)],2)):le("",!0),ee("span",{class:ie(`${e.prefixCls}-title-text truncate flex-1`)},[e.treeTitle?(B(),z(l,{key:0,"render-func":e.treeTitle},null,8,["render-func"])):oe(e.$slots,"title",{key:1},(()=>[Le(ce(e.title),1)]),!0)],2),e.draggable&&!e.extra?(B(),Q("span",{key:2,class:ie([`${e.prefixCls}-icon`,`${e.prefixCls}-drag-icon`])},[e.$slots["drag-icon"]?oe(e.$slots,"drag-icon",ot(se({key:0},e.nodeStatus)),void 0,!0):e.dragIcon?(B(),z(l,se({key:1,"render-func":e.dragIcon},e.nodeStatus),null,16,["render-func"])):e.treeDragIcon?(B(),z(l,se({key:2,"render-func":e.treeDragIcon,node:e.treeNodeData},e.nodeStatus),null,16,["render-func","node"])):(B(),z(c,{key:3}))],2)):le("",!0),e.extra?(B(),z(l,{key:3,"render-func":e.extra},null,8,["render-func"])):le("",!0)],42,Za)],42,Ja)}],["__scopeId","data-v-8e20b1b9"]]),ei=J({name:"ExpandTransition",props:{expanded:Boolean},emits:["end"],setup(e,t){var n=t.emit;return{onBeforeEnter(t){t.style.height=e.expanded?"0":`${t.scrollHeight}px`},onEnter(t){t.style.height=e.expanded?`${t.scrollHeight}px`:"0"},onAfterEnter(t){t.style.height=e.expanded?"":"0",n("end")},onBeforeLeave(e){e.style.display="none"}}}});var ti=J({name:"TransitionNodeList",components:{ExpandTransition:hn(ei,[["render",function(e,t,n,r,a,i){return B(),z(st,{onBeforeEnter:e.onBeforeEnter,onEnter:e.onEnter,onAfterEnter:e.onAfterEnter,onBeforeLeave:e.onBeforeLeave},{default:N((()=>[oe(e.$slots,"default")])),_:3},8,["onBeforeEnter","onEnter","onAfterEnter","onBeforeLeave"])}]]),BaseTreeNode:Qa},props:{nodeKey:{type:[String,Number],required:!0}},setup(e){var t=[`${Pe("tree")}-node-list`],n=Fa(),r=Z(e).nodeKey,a=X((()=>{var e,t;return null===(e=n.expandedKeys)||void 0===e||null===(t=e.includes)||void 0===t?void 0:t.call(e,r.value)})),i=X((()=>{var e,t=new Set(n.expandedKeys||[]),i=null===(e=n.flattenTreeData)||void 0===e?void 0:e.filter((e=>{var t,a;return!(null===(t=e.pathParentKeys)||void 0===t||!t.includes(r.value))&&(!n.filterTreeNode||(null===(a=n.filterTreeNode)||void 0===a?void 0:a.call(n,e.treeNodeData)))}));return null==i?void 0:i.filter((e=>{var n;if(a.value)return null===(n=e.pathParentKeys)||void 0===n?void 0:n.every((e=>t.has(e)));var i=e.pathParentKeys.indexOf(r.value);return e.pathParentKeys.slice(i+1).every((e=>t.has(e)))}))})),o=X((()=>{var e,t;return(null===(e=n.currentExpandKeys)||void 0===e?void 0:e.includes(r.value))&&(null===(t=i.value)||void 0===t?void 0:t.length)}));return{classNames:t,visibleNodeList:i,show:o,expanded:a,onTransitionEnd(){var e;null===(e=n.onExpandEnd)||void 0===e||e.call(n,r.value)}}}});var ni=hn(ti,[["render",function(e,t,n,r,a,i){var o=L("BaseTreeNode"),s=L("ExpandTransition");return B(),z(s,{expanded:e.expanded,onEnd:e.onTransitionEnd},{default:N((()=>[e.show?(B(),Q("div",{key:0,class:ie(e.classNames)},[(B(!0),Q(ue,null,he(e.visibleNodeList,(e=>(B(),z(o,se({key:e.key},e.treeNodeProps),null,16)))),128))],2)):le("",!0)])),_:1},8,["expanded","onEnd"])}]]),ri=J({name:"TreeNode",inheritAttrs:!1,props:o({},Qa.props),setup(e,t){var n=t.slots,r=Xa();return()=>$(ue,null,[$(Qa,se(e,{key:r.value}),n),$(ni,{key:r.value,nodeKey:r.value},null)])}});function ai(e){var t=Z(e),n=t.defaultCheckedKeys,r=t.checkedKeys,a=t.key2TreeNode,i=t.checkStrictly,o=t.halfCheckedKeys,s=t.onlyCheckLeaf,c=Y(!1),d=Y([]),u=Y([]),h=Y(),v=Y(),p=e=>function(e){var t=e.initCheckedKeys,n=e.key2TreeNode,r=e.checkStrictly,a=e.onlyCheckLeaf,i=new Set,o=new Set,s=new Set;return r?t.forEach(Ba(i)):t.forEach((e=>{var t,r=n.get(e);if(!(!r||o.has(e)||a&&null!==(t=r.children)&&void 0!==t&&t.length)){var l=$a(r);l.forEach(Ba(o)),l.forEach(za(s)),i.add(e),s.delete(e),Ha({node:r,checkedKeySet:i,indeterminateKeySet:s})}})),[[...i,...o],[...s]]}({initCheckedKeys:e,key2TreeNode:a.value,checkStrictly:i.value,onlyCheckLeaf:s.value}),g=e=>{var t=l(p(e),2);d.value=t[0],u.value=t[1]};return g(r.value||(null==n?void 0:n.value)||[]),W((()=>{if(r.value){var e=l(p(r.value),2);h.value=e[0],v.value=e[1]}else c.value&&(h.value=void 0,v.value=void 0,d.value=[],u.value=[]);c.value||(c.value=!0)})),{checkedKeys:X((()=>h.value||d.value)),indeterminateKeys:X((()=>i.value&&o.value?o.value:v.value||u.value)),setCheckedState(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?g(e):(d.value=e,u.value=t),[d.value,u.value]}}}function ii(e){var t=Z(e),n=t.treeData,r=t.fieldNames,a=t.selectable,i=t.showLine,o=t.blockNode,s=t.checkable,l=t.loadMore,c=t.draggable,d=Y([]);W((()=>{var e,t;d.value=function(e,t){return function e(n,r){if(n){var a=t.fieldNames,i=[];return n.forEach(((o,s)=>{var l=Ya({treeNodeData:o,treeProps:t,parentNode:r,isTail:s===n.length-1});l.children=e(o[(null==a?void 0:a.children)||"children"],l),i.push(l)})),i}}(e)}(n.value||[],{selectable:null!==(e=null==a?void 0:a.value)&&void 0!==e&&e,showLine:!(null==i||!i.value),blockNode:!(null==o||!o.value),checkable:null!==(t=null==s?void 0:s.value)&&void 0!==t&&t,fieldNames:null==r?void 0:r.value,loadMore:!(null==l||!l.value),draggable:!(null==c||!c.value)})}));var u=X((()=>function(e){var t=[];return function e(n){n&&n.forEach((n=>{t.push(n),e(n.children)}))}(e),t}(d.value))),h=X((()=>function(e){var t=new Map;return e.forEach((e=>{t.set(e.key,e)})),t}(u.value)));return{treeData:d,flattenTreeData:u,key2TreeNode:h}}var oi=J({name:"Tree",components:{VirtualList:lt,TreeNode:ri},props:{size:{type:String,default:"medium"},blockNode:{type:Boolean},defaultExpandAll:{type:Boolean,default:!0},multiple:{type:Boolean},checkable:{type:[Boolean,String,Function],default:!1},selectable:{type:[Boolean,Function],default:!0},checkStrictly:{type:Boolean},checkedStrategy:{type:String,default:"all"},defaultSelectedKeys:{type:Array},selectedKeys:{type:Array},defaultCheckedKeys:{type:Array},checkedKeys:{type:Array},defaultExpandedKeys:{type:Array},expandedKeys:{type:Array},data:{type:Array,default:()=>[]},fieldNames:{type:Object},showLine:{type:Boolean},loadMore:{type:Function},draggable:{type:Boolean},allowDrop:{type:Function},filterTreeNode:{type:Function},virtualListProps:{type:Object},defaultExpandSelected:{type:Boolean},defaultExpandChecked:{type:Boolean},autoExpandParent:{type:Boolean,default:!0},halfCheckedKeys:{type:Array},onlyCheckLeaf:{type:Boolean,default:!1},animation:{type:Boolean,default:!0},actionOnNodeClick:{type:String},disableSelectActionOnly:{type:Boolean,default:!1}},emits:{nodeDbclick:(e,t)=>!0,nodeContextmenu:(e,t)=>!0,select:(e,t)=>!0,"update:selectedKeys":e=>!0,check:(e,t)=>!0,"update:checkedKeys":e=>!0,"update:halfCheckedKeys":e=>!0,expand:(e,t)=>!0,"update:expandedKeys":e=>!0,dragStart:(e,t)=>!0,dragEnd:(e,t)=>!0,dragOver:(e,t)=>!0,dragLeave:(e,t)=>!0,drop:e=>!0},setup(e,t){var n=t.emit,i=t.slots,o=Z(e),s=o.data,c=o.showLine,d=o.multiple,u=o.loadMore,h=o.checkStrictly,v=o.checkedKeys,p=o.defaultCheckedKeys,g=o.selectedKeys,f=o.defaultSelectedKeys,b=o.expandedKeys,m=o.defaultExpandedKeys,y=o.checkedStrategy,x=o.selectable,k=o.checkable,w=o.blockNode,C=o.fieldNames,S=o.size,_=o.defaultExpandAll,O=o.filterTreeNode,j=o.draggable,A=o.allowDrop,M=o.defaultExpandSelected,P=o.defaultExpandChecked,I=o.autoExpandParent,T=o.halfCheckedKeys,E=o.onlyCheckLeaf,R=o.animation,D=Pe("tree"),L=X((()=>[`${D}`,{[`${D}-checkable`]:k.value,[`${D}-show-line`]:c.value},`${D}-size-${S.value}`])),B=Ue(i,"switcher-icon"),z=Ue(i,"loading-icon"),N=Ue(i,"drag-icon"),$=Ue(i,"icon"),H=Ue(i,"title"),V=Ue(i,"extra"),W=ii(F({treeData:s,selectable:x,showLine:c,blockNode:w,checkable:k,fieldNames:C,loadMore:u,draggable:j})),K=W.treeData,G=W.flattenTreeData,q=W.key2TreeNode,J=ai(F({defaultCheckedKeys:p,checkedKeys:v,checkStrictly:h,key2TreeNode:q,halfCheckedKeys:T,onlyCheckLeaf:E})),Q=J.checkedKeys,ee=J.indeterminateKeys,te=J.setCheckedState,ne=l(ct((null==f?void 0:f.value)||[],F({value:g})),2),re=ne[0],ae=ne[1],ie=Y([]),oe=Y();var se=l(ct(function(){if(null!=m&&m.value){var e=new Set([]);return m.value.forEach((t=>{if(!e.has(t)){var n=q.value.get(t);n&&[...I.value?n.pathParentKeys:[],t].forEach((t=>e.add(t)))}})),[...e]}if(_.value)return G.value.filter((e=>e.children&&e.children.length)).map((e=>e.key));if(M.value||P.value){var t=new Set([]),n=e=>{e.forEach((e=>{var n=q.value.get(e);n&&(n.pathParentKeys||[]).forEach((e=>t.add(e)))}))};return M.value&&n(re.value),P.value&&n(Q.value),[...t]}return[]}(),F({value:b})),2),le=se[0],ce=se[1],ue=Y([]),he=X((()=>{var e=new Set(le.value),t=new Set(ue.value);return G.value.filter((n=>{var r;if(!(!O||!O.value||(null==O?void 0:O.value(n.treeNodeData))))return!1;var a=Je(n.parentKey),i=null===(r=n.pathParentKeys)||void 0===r?void 0:r.every((n=>e.has(n)&&!t.has(n)));return a||i}))}));function ve(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y.value,n=[...e];return"parent"===t?n=e.filter((t=>{var n=q.value.get(t);return n&&!(!Je(n.parentKey)&&e.includes(n.parentKey))})):"child"===t&&(n=e.filter((e=>{var t,n;return!(null!==(t=q.value.get(e))&&void 0!==t&&null!==(n=t.children)&&void 0!==n&&n.length)}))),n}function pe(e){return e.map((e=>{var t;return(null===(t=q.value.get(e))||void 0===t?void 0:t.treeNodeData)||void 0})).filter(Boolean)}function ge(e){var t=e.targetKey,r=e.targetChecked,a=e.newCheckedKeys,i=e.newIndeterminateKeys,o=e.event,s=t?q.value.get(t):void 0,l=ve(a);n("update:checkedKeys",l),n("update:halfCheckedKeys",i),n("check",l,{checked:r,node:null==s?void 0:s.treeNodeData,checkedNodes:pe(l),halfCheckedKeys:i,halfCheckedNodes:pe(i),e:o})}function fe(e){var t=e.targetKey,r=e.targetSelected,a=e.newSelectedKeys,i=e.event,o=t?q.value.get(t):void 0;n("update:selectedKeys",a),n("select",a,{selected:r,node:null==o?void 0:o.treeNodeData,selectedNodes:pe(a),e:i})}function be(e){var t=e.targetKey,r=e.targetExpanded,a=e.newExpandedKeys,i=e.event,o=t?q.value.get(t):void 0;n("expand",a,{expanded:r,node:null==o?void 0:o.treeNodeData,expandedNodes:pe(a),e:i}),n("update:expandedKeys",a)}function me(e,t,n){var r=q.value.get(t);if(r){var a=l(Va({node:r,checked:e,checkedKeys:Q.value,indeterminateKeys:ee.value,checkStrictly:h.value}),2),i=a[0],o=a[1];te(i,o),ge({targetKey:t,targetChecked:e,newCheckedKeys:i,newIndeterminateKeys:o,event:n})}}function ye(e,t,n){if(!ue.value.includes(t)&&q.value.get(t)){var r=new Set(le.value);e?r.add(t):r.delete(t);var a=[...r];ce(a),R.value&&ue.value.push(t),be({targetKey:t,targetExpanded:e,newExpandedKeys:a,event:n})}}function xe(e){var t=ue.value.indexOf(e);ue.value.splice(t,1)}var ke=X((()=>null!=u&&u.value?function(){var e=r(a().mark((function e(t){var n,r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ze(u.value)){e.next=2;break}return e.abrupt("return");case 2:if(n=q.value.get(t)){e.next=5;break}return e.abrupt("return");case 5:return r=n.treeNodeData,ie.value=[...new Set([...ie.value,t])],e.prev=7,e.next=10,u.value(r);case 10:ie.value=ie.value.filter((e=>e!==t)),ye(!0,t),Q.value.includes(t)&&me(!0,t),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(7),ie.value=ie.value.filter((e=>e!==t)),console.error("[tree]load data error: ",e.t0);case 19:case"end":return e.stop()}}),e,null,[[7,15]])})));return function(t){return e.apply(this,arguments)}}():void 0)),we=F({treeProps:e,switcherIcon:B,loadingIcon:z,dragIcon:N,nodeIcon:$,nodeTitle:H,nodeExtra:V,treeData:K,flattenTreeData:G,key2TreeNode:q,checkedKeys:Q,indeterminateKeys:ee,selectedKeys:re,expandedKeys:le,loadingKeys:ie,currentExpandKeys:ue,onLoadMore:ke,filterTreeNode:O,onCheck:me,onSelect:function(e,t){if(q.value.get(e)){var n,r;if(d.value){var a=new Set(re.value);(r=!a.has(e))?a.add(e):a.delete(e),n=[...a]}else r=!0,n=[e];ae(n),fe({targetKey:e,targetSelected:r,newSelectedKeys:n,event:t})}},onExpand:ye,onExpandEnd:xe,allowDrop(e,t){var n=q.value.get(e);return!n||!Ze(A.value)||!!A.value({dropNode:n.treeNodeData,dropPosition:t})},onDragStart(e,t){var r=q.value.get(e);oe.value=r,r&&n("dragStart",t,r.treeNodeData)},onDragEnd(e,t){var r=q.value.get(e);oe.value=void 0,r&&n("dragEnd",t,r.treeNodeData)},onDragOver(e,t){var r=q.value.get(e);r&&n("dragOver",t,r.treeNodeData)},onDragLeave(e,t){var r=q.value.get(e);r&&n("dragLeave",t,r.treeNodeData)},onDrop(e,t,r){var a=q.value.get(e);oe.value&&a&&a.key!==oe.value.key&&!a.pathParentKeys.includes(oe.value.key||"")&&(we.allowDrop(e,t)||0!==t)&&n("drop",{e:r,dragNode:oe.value.treeNodeData,dropNode:a.treeNodeData,dropPosition:t})},onNodeContextmenu(e,t){var r=q.value.get(e);r&&n("nodeContextmenu",t,r)},onNodeDbclick(e,t){var r=q.value.get(e);r&&n("nodeDbclick",t,r)}});return de(Ra,we),{classNames:L,visibleTreeNodeList:he,treeContext:we,virtualListRef:Y(),computedSelectedKeys:re,computedExpandedKeys:le,computedCheckedKeys:Q,computedIndeterminateKeys:ee,getPublicCheckedKeys:ve,getNodes:pe,internalCheckNodes:function(e,t,n){if(e.length){var r=[...Q.value],a=[...ee.value];e.forEach((e=>{var n=q.value.get(e);if(n){var i=l(Va({node:n,checked:t,checkedKeys:[...r],indeterminateKeys:[...a],checkStrictly:h.value}),2);r=i[0],a=i[1]}})),te(r,a),ge({targetKey:n,targetChecked:Je(n)?void 0:t,newCheckedKeys:r,newIndeterminateKeys:a})}},internalSetCheckedKeys:function(e){var t=l(te(e,[],!0),2);ge({newCheckedKeys:t[0],newIndeterminateKeys:t[1]})},internalSelectNodes:function(e,t,n){if(e.length){var r;if(d.value){var a=new Set(re.value);e.forEach((e=>{t?a.add(e):a.delete(e)})),r=[...a]}else r=t?[e[0]]:[];ae(r),fe({targetKey:n,targetSelected:Je(n)?void 0:t,newSelectedKeys:r})}},internalSetSelectedKeys:function(e){var t=e;!d.value&&e.length>1&&(t=[e[0]]),ae(t),fe({newSelectedKeys:t})},internalExpandNodes:function(e,t,n){var r=new Set(le.value);e.forEach((e=>{t?r.add(e):r.delete(e),xe(e)}));var a=[...r];ce(a),be({targetKey:n,targetExpanded:Je(n)?void 0:t,newExpandedKeys:a})},internalSetExpandedKeys:function(e){ue.value=[],ce(e),be({newExpandedKeys:e})},updateTreeView:()=>U(G)}},methods:{toggleCheck(e,t){var n=this.treeContext,r=n.key2TreeNode,a=n.onCheck,i=!n.checkedKeys.includes(e),o=r.get(e);o&&Na(o)&&a(i,e,t)},scrollIntoView(e){this.virtualListRef&&this.virtualListRef.scrollTo(e)},getSelectedNodes(){return this.getNodes(this.computedSelectedKeys)},getCheckedNodes(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.checkedStrategy,n=e.includeHalfChecked,r=this.getPublicCheckedKeys(this.computedCheckedKeys,t);return[...this.getNodes(r),...n?this.getHalfCheckedNodes():[]]},getHalfCheckedNodes(){return this.getNodes(this.computedIndeterminateKeys)},getExpandedNodes(){return this.getNodes(this.computedExpandedKeys)},checkAll(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.treeContext.key2TreeNode,n=e?[...t.keys()].filter((e=>{var n=t.get(e);return n&&Na(n)})):[];this.internalSetCheckedKeys(n)},checkNode(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.checkStrictly,a=this.treeContext.key2TreeNode,i=dt(e),o=(i?e:[e]).filter((e=>{var t=a.get(e);return t&&Na(t)&&(r||!n||function(e){return Fe(e.isLeaf)?e.isLeaf:!e.children}(t))}));this.internalCheckNodes(o,t,i?void 0:e)},selectAll(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.treeContext.key2TreeNode,n=e?[...t.keys()].filter((e=>{var n=t.get(e);return n&&Da(n)})):[];this.internalSetSelectedKeys(n)},selectNode(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.treeContext.key2TreeNode,r=dt(e),a=(r?e:[e]).filter((e=>{var t=n.get(e);return t&&Da(t)}));this.internalSelectNodes(a,t,r?void 0:e)},expandAll(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.treeContext.key2TreeNode,n=e?[...t.keys()].filter((e=>{var n=t.get(e);return n&&La(n)})):[];this.internalSetExpandedKeys(n)},expandNode(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.treeContext.key2TreeNode,r=dt(e),a=(r?e:[e]).filter((e=>{var t=n.get(e);return t&&La(t)}));this.internalExpandNodes(a,t,r?void 0:e)}}});var si=hn(oi,[["render",function(e,t,n,r,a,i){var o=L("TreeNode"),s=L("VirtualList");return B(),Q("div",{class:ie(e.classNames)},[e.virtualListProps?(B(),z(s,se({key:0,ref:"virtualListRef"},e.virtualListProps,{data:e.visibleTreeNodeList}),{item:N((e=>{var t=e.item;return[(B(),z(o,se({key:t.key},t.treeNodeProps),null,16))]})),_:1},16,["data"])):(B(!0),Q(ue,{key:1},he(e.visibleTreeNodeList,(e=>(B(),z(o,se({key:e.key},e.treeNodeProps),null,16)))),128))],2)}]]),li=Object.assign(si,{install:(e,t)=>{ut(e,t);var n=ht(t);e.component(n+si.name,si)}});function ci(e,t){var n=jr().canvas;n.on(e,t);var r=()=>{n.off(e,t)};return vt(r),r}var di,ui,hi={class:"h-full flex flex-col overflow-hidden"},vi={class:"bg-$color-bg-4 h28px px0.5 flex justify-between items-center"},pi={class:"pl3 color-$color-text-2"},gi=J({__name:"workspaces",setup(e){var t=Y(0),n=jr(),i=n.canvas,o=n.event,s=n.workspaces,l=Y([]),c=Y([]),d=()=>{l.value=s.all().map((e=>({key:e.id,title:e.name}))),c.value=[s.getCurrentId()],t.value=s.size()};d(),o.on("workspaceChangeAfter",d),o.on("workspaceAddAfter",d),o.on("workspaceRemoveAfter",d),pt((()=>{o.off("workspaceChangeAfter",d),o.off("workspaceAddAfter",d),o.off("workspaceRemoveAfter",d)}));var u=e=>{s.setCurrentId(e[0].toString())},h=()=>{s.setCurrentId(s.add("页面")),i.setViewportTransform(T)},v=(e,t)=>{var n;pa.showContextMenu({x:e.clientX,y:e.clientY,preserveIconWidth:!1,items:[{label:"复制",onClick:(n=r(a().mark((function e(){var n,r,o;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.key){e.next=2;break}return e.abrupt("return");case 2:if(n=s.get(t.key.toString())){e.next=5;break}return e.abrupt("return");case 5:return r=i.toObject(),o=s.add(n.name+" 拷贝"),s.setCurrentId(o),e.next=10,i.loadFromJSON(r);case 10:i.renderAll();case 11:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{label:"删除",hidden:s.size()<=1,onClick:()=>{t.key&&s.remove(t.key.toString())},divided:!0},{label:"重命名",onClick:()=>{}}]})};return(e,n)=>{var r=gt,a=je,i=ft;return B(),Q("div",hi,[ee("div",vi,[ee("span",pi,"页面 ("+ce(Me(t))+")",1),ee("div",null,[$(a,{class:"icon-btn",size:"mini",onClick:h},{icon:N((()=>[$(r)])),_:1})])]),$(i,{class:"overflow-y-auto h-full","outer-class":"flex-1 min-h-0"},{default:N((()=>[$(Me(li),{class:"",blockNode:"","selected-keys":Me(c),onSelect:u,data:Me(l),size:"small",onNodeContextmenu:v},null,8,["selected-keys","data"])])),_:1})])}}}),fi=hn(gi,[["__scopeId","data-v-7c0e02cf"]]),bi={class:"flex items-center"},mi=["innerHTML"],yi=J({__name:"layerCatalogue",setup(e){var t=this,n=jr(),i=n.canvas,o=n.event,s=n.undoRedo,d=Y(""),u=Y(void 0),h=Y([]),v=Y(),p=new Map,g=e=>{if(e.isType("Textbox","IText","Text"))return'<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill=\'var(--color-text-2)\'><path d="M853.333333 170.666667H170.666667a42.666667 42.666667 0 0 0-42.666667 42.666666v128a42.666667 42.666667 0 0 0 85.333333 0V256h256v554.666667H384a42.666667 42.666667 0 0 0 0 85.333333h256a42.666667 42.666667 0 0 0 0-85.333333h-85.333333V256h256v85.333333a42.666667 42.666667 0 0 0 85.333333 0V213.333333a42.666667 42.666667 0 0 0-42.666667-42.666666z"></path></svg>';if(e.isType("Group"))return"<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='var(--color-text-2)' width='14' height='14'><path d=\"M20 5h-8.586L9.707 3.293A.997.997 0 0 0 9 3H4c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h16c1.103 0 2-.897 2-2V7c0-1.103-.897-2-2-2zM4 19V7h16l.002 12H4z\"></path></svg>";if(e.isType("Board","Textbox"))return'<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="-1 -1 16 16" fill="var(--color-text-2)"><path d="M3,9.67v-5.34h-1.33c-0.24,0 -0.46,-0.12 -0.58,-0.33c-0.12,-0.21 -0.12,-0.46 0,-0.67c0.12,-0.2 0.34,-0.33 0.58,-0.33h1.33v-1.33c0,-0.24 0.13,-0.46 0.33,-0.58c0.21,-0.12 0.46,-0.12 0.67,0c0.21,0.12 0.33,0.34 0.33,0.58v1.33h5.34v-1.33c0,-0.37 0.3,-0.67 0.66,-0.67c0.37,0 0.67,0.3 0.67,0.67v1.33h1.33c0.37,0 0.67,0.3 0.67,0.67c0,0.36 -0.3,0.66 -0.67,0.66h-1.33v5.34h1.33c0.37,0 0.67,0.3 0.67,0.66c0,0.37 -0.3,0.67 -0.67,0.67h-1.33v1.33c0,0.37 -0.3,0.67 -0.67,0.67c-0.36,0 -0.66,-0.3 -0.66,-0.67v-1.33h-5.34v1.33c0,0.37 -0.3,0.67 -0.66,0.67c-0.37,0 -0.67,-0.3 -0.67,-0.67v-1.33h-1.33c-0.37,0 -0.67,-0.3 -0.67,-0.67c0,-0.36 0.3,-0.66 0.67,-0.66zM9.67,9.67v-5.34h-5.34v5.34z"></path></svg>';if(e.isType("Image")||xn.isPattern(e.fill))return"<svg xmlns='http://www.w3.org/2000/svg' viewBox='2 2 20 20' fill='var(--color-text-2)' width='14' height='14'><path d=\"M19 3H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2V5c0-1.103-.897-2-2-2zM5 19V5h14l.002 14H5z\"></path><path d=\"m10 14-1-1-3 4h12l-5-7z\"></path></svg>";if(p.has(e.id))return p.get(e.id);var t=e._getCoords(!0,!0),n=t.tl,r=t.tr,a=t.br,i=t.bl,o=xn.makeBoundingBoxFromPoints([n,r,a,i]),s=o.left,l=o.top,c=o.height,d=o.width,u=Math.max(c,d);d>c?l+=(c-u)/2:s+=(d-u)/2;var h=`<svg style="width:12px;height:12px" viewBox="${`${s-4} ${l-4} ${u+8} ${u+8}`}" fill="transparent" stroke="var(--color-text-2)">${e._createBaseSVGMarkup(e._toSVG(),{noStyle:!0})}</svg>`;return p.set(e.id,h),h},f=function e(n,r){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=[];if(!n)return i;var o,s=c(n);try{var l=function(){var n=o.value,s=xn.isCollection(n),l=s?e(n._objects,r,a&&n.visible):[];if(n.hideOnLayer)return"continue";var c={visible:a&&n.visible,objectRef:n.ref,isCollection:s,title:n.name||n.constructor.name,key:n.id,setDirty:()=>{var e;return null===(e=n.group)||void 0===e?void 0:e.setDirty()},children:l,draggable:u.value!==n.id,getSvg:g.bind(t,n)};r&&!m(c,r)||i.unshift(c)};for(s.s();!(o=s.n()).done;)l()}catch(d){s.e(d)}finally{s.f()}return i},b=Y([]);W((()=>{b.value=f(i.ref.objects.value,d.value)}));var m=(e,t)=>{var n=t.toLowerCase(),r=new er;r.push(e);for(var a=!1;!r.isEmpty();){var i,o=r.shift(),s=null===(i=o.title)||void 0===i?void 0:i.toLowerCase();if(null!=s&&s.includes(n)&&(a=!0),o.children){var l,d=c(o.children);try{for(d.s();!(l=d.n()).done;){var u=l.value;r.push(u)}}catch(h){d.e(h)}finally{d.f()}}if(a)return!0}return!1},y=e=>e.dropNode.isCollection,x=e=>{var t=e.dragObject,n=e.dropObject,r=e.dropPosition;if(e.excludeGroupObject&&t.getAncestors(!0).some((e=>w.value.includes(e.id))))return;xn.isActiveSelection(t.group)&&t.group.remove(t);var a=t.getParent(),o=n.getParent(),s=o._objects.indexOf(n);if((a!==o||0===r)&&t instanceof yn)return!1;a===o&&(a._objects.indexOf(t)<s&&s--);-1===r&&s++;var c=l(a.remove(t),1)[0];xn.isCollection(n)&&0===r?n.add(c):o.insertAt(s,c),i.getActiveObject()===i.getActiveSelection()?i.getActiveSelection().multiSelectAdd(c):i.setActiveObject(c)},k=e=>{var t=e.e,n=e.dragNode,r=e.dropNode,a=e.dropPosition;if(n.key&&r.key)if(w.value.includes(n.key)){var o=i.findObjectsByIds([r.key,...w.value]),s=o.shift();if(!_e(s))return;-1===a&&(o=o.reverse());for(var c=o.length-1;c>=0;c--){var d=o[c];if(!_e(d))return;x({e:t,dragObject:d,dropObject:s,dropPosition:a,excludeGroupObject:!0})}}else{var u=l(i.findObjectsByIds([r.key,n.key]),2),h=u[0],v=u[1];if(!_e(h)||!_e(v))return;x({e:t,dragObject:v,dropObject:h,dropPosition:a,excludeGroupObject:!1})}},w=Y([]),C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.value,t=[];i.forEachObject((function n(r){xn.isCollection(r)&&r.forEachObject(n),e.includes(r.id)&&t.unshift(r)})),t.length?i.setActiveObjects(t):i.discardActiveObject(),i.requestRenderAll()},S=function(){var e=r(a().mark((function e(){var t,n,r,o,s,l,c,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=i.activeObject.value)&&!r.hideOnLayer){e.next=4;break}return w.value=[],e.abrupt("return");case 4:if(o=new Set,xn.isActiveSelection(r)?(s=[],r.forEachObject((e=>{e.group&&o.add(e.group.id),s.push(e.id)})),w.value=s):(r.group&&o.add(r.group.id),w.value=[r.id]),!o){e.next=10;break}return h.value.push(...o),e.next=10,re();case 10:l=null===(t=v.value)||void 0===t?void 0:t.virtualListRef.containerRef.getBoundingClientRect(),(!(c=null===(n=document.querySelector(`.arco-tree-node[data-key='${w.value[0]}']`))||void 0===n?void 0:n.getBoundingClientRect())||l.top-c.top>c.height||c.top-l.top>O.value)&&(null===(d=v.value)||void 0===d||d.scrollIntoView({key:w.value[0],align:"auto"}));case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();ci({"selection:created":S,"selection:updated":S,"selection:cleared":S,"object:modified":e=>{var t;p.has(e.target.id)&&(p.delete(e.target.id),p.size>128&&p.clear(),null===(t=v.value)||void 0===t||t.updateTreeView())}});var _=Y(),O=Y(0);ne((()=>{var e,t,n;b.value.forEach((e=>{e.children&&e.key&&h.value.push(e.key)})),Ve(null===(e=_.value)||void 0===e||null===(t=e.wrapperRef)||void 0===t||null===(n=t.childNodes)||void 0===n?void 0:n[2],(e=>{var t=l(e,1)[0].contentRect.height;O.value=t-32}))}));var j=Y(!1),A=bt(),M=A.meta,P=A.ctrl;W((()=>{M.value||P.value?j.value=!0:j.value=!1}));var I=(e,t)=>{e.preventDefault(),e.stopImmediatePropagation(),t.key&&(w.value.includes(t.key)||(w.value=[t.key],C()),pa.showContextMenu({x:e.clientX,y:e.clientY,preserveIconWidth:!1,items:wa()}))};o.on("layerRename",(e=>{u.value=e.id}));var T=(e,t)=>{e.preventDefault(),t.key&&(u.value=t.key)},E=e=>{var t=e.el;if(t){var n=t.querySelector("input");n&&(n.focus(),n.select())}},R=(e,t)=>{var n,r=u.value,a=t.target;if(null==a||a.blur(),r&&e){var o=i.findObjectById(r);o&&(o.name=e,null===(n=v.value)||void 0===n||n.updateTreeView(),s.saveState())}};return(e,t)=>{var n=yt,r=Ne,a=xt,o=kt,s=je,l=wt,c=Ct,p=St;return B(),z(p,{ref_key:"splitRef",ref:_,class:"h-[calc(100vh-90px)]",direction:"vertical",min:"40px","default-size":.2},{first:N((()=>[$(fi)])),second:N((()=>[$(r,{modelValue:Me(d),"onUpdate:modelValue":t[0]||(t[0]=e=>mt(d)?d.value=e:null),placeholder:"Search...",class:"bg-transparent! border-none!"},{prefix:N((()=>[$(n)])),_:1},8,["modelValue"]),$(Me(li),{ref_key:"treeRef",ref:v,size:"small",blockNode:"",draggable:"","selected-keys":Me(w),"expanded-keys":Me(h),"onUpdate:expandedKeys":t[3]||(t[3]=e=>mt(h)?h.value=e:null),animation:!1,multiple:Me(j),data:Me(b),allowDrop:y,virtualListProps:{height:Me(O),fixedSize:!0},onDrop:k,onSelect:C,onNodeContextmenu:I,onNodeDbclick:T},{title:N((e=>[ee("div",bi,[ee("div",{innerHTML:e.getSvg(),class:"mr2"},null,8,mi),Me(_e)(e.key)&&Me(u)===e.key?(B(),z(r,{key:0,class:"bg-transparent! border-none! px0!",size:"mini","default-value":e.title,onBlur:t[1]||(t[1]=e=>u.value=void 0),onVnodeMounted:E,onChange:R,onPressEnter:t[2]||(t[2]=e=>u.value=void 0)},null,8,["default-value"])):(B(),Q("span",{key:1,class:ie({"op-50":!e.visible})},ce(e.title),3))])])),extra:N((e=>[Me(u)!==e.key?(B(),Q("div",{key:0,class:ie(["extra pr4px",{show:!e.objectRef.evented||!e.objectRef.visible}])},[$(s,{class:ie([{show:e.objectRef.evented},"icon-btn"]),size:"mini",onClick:t=>{return n=e,t.stopPropagation(),n.objectRef.evented=!n.objectRef.evented,n.objectRef.hasControls=n.objectRef.evented,n.objectRef.selectable=n.objectRef.evented,void i.requestRenderAll();var n}},{icon:N((()=>[e.objectRef.evented?(B(),z(a,{key:0})):(B(),z(o,{key:1}))])),_:2},1032,["class","onClick"]),$(s,{class:ie([{show:e.objectRef.visible},"icon-btn"]),size:"mini",onClick:t=>{return n=e,t.stopPropagation(),n.objectRef.visible=!n.objectRef.visible,n.setDirty(),void i.requestRenderAll();var n}},{icon:N((()=>[e.objectRef.visible?(B(),z(l,{key:0})):(B(),z(c,{key:1}))])),_:2},1032,["class","onClick"])],2)):le("",!0)])),_:1},8,["selected-keys","expanded-keys","multiple","data","virtualListProps"])])),_:1},512)}}}),xi=hn(yi,[["__scopeId","data-v-99b369d3"]]),ki=(e=>(jt("data-v-1fcc3e53"),e=e(),At(),e))((()=>ee("div",{class:"p2"},"资源",-1))),wi=hn(J({__name:"leftPanel",setup:e=>(e,t)=>{var n=_t,r=Ot;return B(),z(r,{"default-active-key":"1",class:"leftPanel flex flex-col"},{default:N((()=>[$(n,{key:"1",title:"图层"},{default:N((()=>[$(xi)])),_:1}),$(n,{key:"2",title:"资源"},{default:N((()=>[ki])),_:1})])),_:1})}}),[["__scopeId","data-v-1fcc3e53"]]),Ci={class:"p2"},Si=["onClick"],_i=hn(J({__name:"panel",props:{title:{},hiddenAdd:{type:Boolean,default:!1},disableAdd:{type:Boolean,default:!1}},emits:["clickAdd"],setup(e,t){var n=t.emit,r=e,a=e=>{r.disableAdd||n("clickAdd",e)};return(e,t)=>{var n=gt,r=je;return B(),Q("div",Ci,[ee("div",{class:ie(["h28px font-bold text-xs flex justify-between items-center",[e.disableAdd||e.hiddenAdd?"mb2px":"gray"]]),onClick:Mt(a,["self"])},[ee("span",null,ce(e.title),1),ee("div",null,[oe(e.$slots,"actions",{},void 0,!0),e.hiddenAdd?le("",!0):(B(),z(r,{key:0,disabled:e.disableAdd,size:"small",class:"icon-btn",onClick:a},{icon:N((()=>[$(n)])),_:1},8,["disabled"]))])],10,Si),e.disableAdd||e.hiddenAdd?oe(e.$slots,"default",{key:0},void 0,!0):le("",!0)])}}}),[["__scopeId","data-v-0a3e0013"]]),Oi={class:"dialog-container"},ji={class:"truncate flex-1 pl3"},Ai={key:0},Mi={class:"flex-shrink-0"},Pi=J({__name:"dialog",props:{hideClose:{type:Boolean},onClose:{type:Function},top:{},left:{},width:{},height:{}},emits:["close"],setup(e,t){var n,r,a=t.expose,i=t.emit,o=e,s=Pt(),l=Y(),c=Y(),d=It(),u=e=>{var t,n,r,a,i=e.x,o=e.y;return{x:q(i,0,d.width.value-(null!==(t=null===(n=l.value)||void 0===n?void 0:n.clientWidth)&&void 0!==t?t:0)),y:q(o,0,d.height.value-(null!==(r=null===(a=l.value)||void 0===a?void 0:a.clientHeight)&&void 0!==r?r:0))}},h=Tt(l,{initialValue:{x:null!==(n=o.left)&&void 0!==n?n:0,y:null!==(r=o.top)&&void 0!==r?r:0},handle:c,onMove(e){var t=u(e),n=t.x,r=t.y;e.x=n,e.y=r}}),v=h.style,p=h.position;xe([d.height,d.width],(()=>{var e=u(p.value),t=e.x,n=e.y;p.value.x=t,p.value.y=n}));var g=()=>{i("close")};return a({handleClose:g}),(e,t)=>{var n=Et,r=je;return B(),Q("div",Oi,[Me(s)?(B(),Q("div",{key:0,ref_key:"el",ref:l,class:"absolute flex flex-col bg-$color-bg-4 border border-$color-border-2 rounded-md z1000 shadow-lg",style:pe([{width:e.width?`${e.width}px`:void 0,height:e.height?`${e.height}px`:void 0},Me(v)])},[ee("div",{ref_key:"handle",ref:c,class:"flex items-center p1 border-b border-$color-border-2"},[ee("div",ji,[oe(e.$slots,"title")]),e.hideClose?le("",!0):(B(),Q("div",Ai,[$(r,{size:"mini",class:"icon-btn",onClick:g},{icon:N((()=>[$(n)])),_:1})]))],512),ee("div",Mi,[oe(e.$slots,"default")])],4)):le("",!0)])}}}),Ii=e=>{if(e)return k.isFunction(e)?e:()=>e},Ti=Object.assign(Pi,{open:(e,t)=>{var n,r,a=((r=document.createElement("div")).setAttribute("class","overlay-dialog"),r),i=e.hideClose,o=e.top,s=e.left,l=e.width,c=e.height,d=ke(Pi,{hideClose:i,onClose:()=>{a&&(we(null,a),document.body.removeChild(a)),a=null,e.onClose&&e.onClose()},top:o,left:s,width:l,height:c},{title:Ii(e.title),default:Ii(e.body)});return d.appContext=null!==(n=null!=t?t:Ti._context)&&void 0!==n?n:null,we(d,a),document.body.appendChild(a),{close:()=>{var e;d.component&&(null===(e=d.component.exposed)||void 0===e||e.handleClose())}}},_context:void 0}),Ei={class:"gradient-controls"},Ri=hn(J({__name:"index",props:{type:{},changeGradientControl:{type:Function}},setup:e=>(e,t)=>{var n=Dt,r=Rt;return B(),Q("div",Ei,[$(r,{size:"small","model-value":e.type,type:"button",onChange:t[0]||(t[0]=t=>e.changeGradientControl(t))},{default:N((()=>[$(n,{value:"color"},{default:N((()=>[Le("纯色")])),_:1}),$(n,{value:"linear"},{default:N((()=>[Le("线性")])),_:1}),$(n,{value:"radial"},{default:N((()=>[Le("径向")])),_:1}),$(n,{value:"pattern"},{default:N((()=>[Le("图案")])),_:1})])),_:1},8,["model-value"])])}}),[["__scopeId","data-v-9038e18a"]]),Di=(e=>(e[e.Null=0]="Null",e[e.Backspace=8]="Backspace",e[e.Tab=9]="Tab",e[e.LineFeed=10]="LineFeed",e[e.CarriageReturn=13]="CarriageReturn",e[e.Space=32]="Space",e[e.ExclamationMark=33]="ExclamationMark",e[e.DoubleQuote=34]="DoubleQuote",e[e.Hash=35]="Hash",e[e.DollarSign=36]="DollarSign",e[e.PercentSign=37]="PercentSign",e[e.Ampersand=38]="Ampersand",e[e.SingleQuote=39]="SingleQuote",e[e.OpenParen=40]="OpenParen",e[e.CloseParen=41]="CloseParen",e[e.Asterisk=42]="Asterisk",e[e.Plus=43]="Plus",e[e.Comma=44]="Comma",e[e.Dash=45]="Dash",e[e.Period=46]="Period",e[e.Slash=47]="Slash",e[e.Digit0=48]="Digit0",e[e.Digit1=49]="Digit1",e[e.Digit2=50]="Digit2",e[e.Digit3=51]="Digit3",e[e.Digit4=52]="Digit4",e[e.Digit5=53]="Digit5",e[e.Digit6=54]="Digit6",e[e.Digit7=55]="Digit7",e[e.Digit8=56]="Digit8",e[e.Digit9=57]="Digit9",e[e.Colon=58]="Colon",e[e.Semicolon=59]="Semicolon",e[e.LessThan=60]="LessThan",e[e.Equals=61]="Equals",e[e.GreaterThan=62]="GreaterThan",e[e.QuestionMark=63]="QuestionMark",e[e.AtSign=64]="AtSign",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.OpenSquareBracket=91]="OpenSquareBracket",e[e.Backslash=92]="Backslash",e[e.CloseSquareBracket=93]="CloseSquareBracket",e[e.Caret=94]="Caret",e[e.Underline=95]="Underline",e[e.BackTick=96]="BackTick",e[e.a=97]="a",e[e.b=98]="b",e[e.c=99]="c",e[e.d=100]="d",e[e.e=101]="e",e[e.f=102]="f",e[e.g=103]="g",e[e.h=104]="h",e[e.i=105]="i",e[e.j=106]="j",e[e.k=107]="k",e[e.l=108]="l",e[e.m=109]="m",e[e.n=110]="n",e[e.o=111]="o",e[e.p=112]="p",e[e.q=113]="q",e[e.r=114]="r",e[e.s=115]="s",e[e.t=116]="t",e[e.u=117]="u",e[e.v=118]="v",e[e.w=119]="w",e[e.x=120]="x",e[e.y=121]="y",e[e.z=122]="z",e))(Di||{});function Li(e,t){return w.round(e,t)}class Bi{constructor(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;s(this,"_rgbaBrand",void 0),s(this,"r",void 0),s(this,"g",void 0),s(this,"b",void 0),s(this,"a",void 0),this.r=0|Math.min(255,Math.max(0,e)),this.g=0|Math.min(255,Math.max(0,t)),this.b=0|Math.min(255,Math.max(0,n)),this.a=Li(Math.max(Math.min(1,r),0),3)}static equals(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}}class zi{constructor(e,t,n,r){s(this,"_hslaBrand",void 0),s(this,"h",void 0),s(this,"s",void 0),s(this,"l",void 0),s(this,"a",void 0),this.h=0|Math.max(Math.min(360,e),0),this.s=Li(Math.max(Math.min(1,t),0),3),this.l=Li(Math.max(Math.min(1,n),0),3),this.a=Li(Math.max(Math.min(1,r),0),3)}static equals(e,t){return e.h===t.h&&e.s===t.s&&e.l===t.l&&e.a===t.a}static fromRGBA(e){var t=e.r/255,n=e.g/255,r=e.b/255,a=e.a,i=Math.max(t,n,r),o=Math.min(t,n,r),s=0,l=0,c=(o+i)/2,d=i-o;if(d>0){switch(l=Math.min(c<=.5?d/(2*c):d/(2-2*c),1),i){case t:s=(n-r)/d+(n<r?6:0);break;case n:s=(r-t)/d+2;break;case r:s=(t-n)/d+4}s*=60,s=Math.round(s)}return new zi(s,l,c,a)}static _hue2rgb(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}static toRGBA(e){var t,n,r,a=e.h/360,i=e.s,o=e.l,s=e.a;if(0===i)t=n=r=o;else{var l=o<.5?o*(1+i):o+i-o*i,c=2*o-l;t=zi._hue2rgb(c,l,a+1/3),n=zi._hue2rgb(c,l,a),r=zi._hue2rgb(c,l,a-1/3)}return new Bi(Math.round(255*t),Math.round(255*n),Math.round(255*r),s)}}class Ni{constructor(e,t,n,r){s(this,"_hsvaBrand",void 0),s(this,"h",void 0),s(this,"s",void 0),s(this,"v",void 0),s(this,"a",void 0),this.h=0|Math.max(Math.min(360,e),0),this.s=Li(Math.max(Math.min(1,t),0),3),this.v=Li(Math.max(Math.min(1,n),0),3),this.a=Li(Math.max(Math.min(1,r),0),3)}static equals(e,t){return e.h===t.h&&e.s===t.s&&e.v===t.v&&e.a===t.a}static fromRGBA(e){var t,n=e.r/255,r=e.g/255,a=e.b/255,i=Math.max(n,r,a),o=i-Math.min(n,r,a),s=0===i?0:o/i;return t=0===o?0:i===n?((r-a)/o%6+6)%6:i===r?(a-n)/o+2:(n-r)/o+4,new Ni(Math.round(60*t),s,i,e.a)}static toRGBA(e){var t=e.h,n=e.s,r=e.v,a=e.a,i=r*n,o=i*(1-Math.abs(t/60%2-1)),s=r-i,l=0,c=0,d=0;return t<60?(l=i,c=o):t<120?(l=o,c=i):t<180?(c=i,d=o):t<240?(c=o,d=i):t<300?(l=o,d=i):t<=360&&(l=i,d=o),l=Math.round(255*(l+s)),c=Math.round(255*(c+s)),d=Math.round(255*(d+s)),new Bi(l,c,d,a)}}class $i{static fromHex(e){return $i.Format.CSS.parseHex(e)||$i.red}static equals(e,t){return!e&&!t||!(!e||!t)&&e.equals(t)}get hsla(){return this._hsla?this._hsla:zi.fromRGBA(this.rgba)}get hsva(){return this._hsva?this._hsva:Ni.fromRGBA(this.rgba)}constructor(e){if(s(this,"rgba",void 0),s(this,"_hsla",void 0),s(this,"_hsva",void 0),s(this,"_toString",void 0),!e)throw new Error("Color needs a value");if(e instanceof Bi)this.rgba=e;else if(e instanceof zi)this._hsla=e,this.rgba=zi.toRGBA(e);else{if(!(e instanceof Ni))throw new Error("Invalid color ctor argument");this._hsva=e,this.rgba=Ni.toRGBA(e)}}equals(e){return!!e&&Bi.equals(this.rgba,e.rgba)&&zi.equals(this.hsla,e.hsla)&&Ni.equals(this.hsva,e.hsva)}getRelativeLuminance(){return Li(.2126*$i._relativeLuminanceForComponent(this.rgba.r)+.7152*$i._relativeLuminanceForComponent(this.rgba.g)+.0722*$i._relativeLuminanceForComponent(this.rgba.b),4)}static _relativeLuminanceForComponent(e){var t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}getContrastRatio(e){var t=this.getRelativeLuminance(),n=e.getRelativeLuminance();return t>n?(t+.05)/(n+.05):(n+.05)/(t+.05)}isDarker(){return(299*this.rgba.r+587*this.rgba.g+114*this.rgba.b)/1e3<128}isLighter(){return(299*this.rgba.r+587*this.rgba.g+114*this.rgba.b)/1e3>=128}isLighterThan(e){return this.getRelativeLuminance()>e.getRelativeLuminance()}isDarkerThan(e){return this.getRelativeLuminance()<e.getRelativeLuminance()}lighten(e){return new $i(new zi(this.hsla.h,this.hsla.s,this.hsla.l+this.hsla.l*e,this.hsla.a))}darken(e){return new $i(new zi(this.hsla.h,this.hsla.s,this.hsla.l-this.hsla.l*e,this.hsla.a))}transparent(e){var t=this.rgba,n=t.r,r=t.g,a=t.b,i=t.a;return new $i(new Bi(n,r,a,i*e))}isTransparent(){return 0===this.rgba.a}isOpaque(){return 1===this.rgba.a}opposite(){return new $i(new Bi(255-this.rgba.r,255-this.rgba.g,255-this.rgba.b,this.rgba.a))}blend(e){var t=e.rgba,n=this.rgba.a,r=t.a,a=n+r*(1-n);if(a<1e-6)return $i.transparent;var i=this.rgba.r*n/a+t.r*r*(1-n)/a,o=this.rgba.g*n/a+t.g*r*(1-n)/a,s=this.rgba.b*n/a+t.b*r*(1-n)/a;return new $i(new Bi(i,o,s,a))}makeOpaque(e){if(this.isOpaque()||1!==e.rgba.a)return this;var t=this.rgba,n=t.r,r=t.g,a=t.b,i=t.a;return new $i(new Bi(e.rgba.r-i*(e.rgba.r-n),e.rgba.g-i*(e.rgba.g-r),e.rgba.b-i*(e.rgba.b-a),1))}flatten(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.reduceRight(((e,t)=>$i._flatten(t,e)));return $i._flatten(this,r)}static _flatten(e,t){var n=1-e.rgba.a;return new $i(new Bi(n*t.rgba.r+e.rgba.a*e.rgba.r,n*t.rgba.g+e.rgba.a*e.rgba.g,n*t.rgba.b+e.rgba.a*e.rgba.b))}toString(){return this._toString||(this._toString=$i.Format.CSS.format(this)),this._toString}static getLighterColor(e,t,n){if(e.isLighterThan(t))return e;n=n||.5;var r=e.getRelativeLuminance(),a=t.getRelativeLuminance();return n=n*(a-r)/a,e.lighten(n)}static getDarkerColor(e,t,n){if(e.isDarkerThan(t))return e;n=n||.5;var r=e.getRelativeLuminance();return n=n*(r-t.getRelativeLuminance())/r,e.darken(n)}}s($i,"white",new $i(new Bi(255,255,255,1))),s($i,"black",new $i(new Bi(0,0,0,1))),s($i,"red",new $i(new Bi(255,0,0,1))),s($i,"blue",new $i(new Bi(0,0,255,1))),s($i,"green",new $i(new Bi(0,255,0,1))),s($i,"cyan",new $i(new Bi(0,255,255,1))),s($i,"lightgrey",new $i(new Bi(211,211,211,1))),s($i,"transparent",new $i(new Bi(0,0,0,0))),di=$i||($i={}),(e=>{function t(e){var t=e.toString(16);return 2!==t.length?"0"+t:t}function n(e){switch(e){case Di.Digit0:return 0;case Di.Digit1:return 1;case Di.Digit2:return 2;case Di.Digit3:return 3;case Di.Digit4:return 4;case Di.Digit5:return 5;case Di.Digit6:return 6;case Di.Digit7:return 7;case Di.Digit8:return 8;case Di.Digit9:return 9;case Di.a:case Di.A:return 10;case Di.b:case Di.B:return 11;case Di.c:case Di.C:return 12;case Di.d:case Di.D:return 13;case Di.e:case Di.E:return 14;case Di.f:case Di.F:return 15}return 0}e.formatRGB=function(e){return 1===e.rgba.a?`rgb(${e.rgba.r}, ${e.rgba.g}, ${e.rgba.b})`:di.Format.CSS.formatRGBA(e)},e.formatRGBA=function(e){return`rgba(${e.rgba.r}, ${e.rgba.g}, ${e.rgba.b}, ${+e.rgba.a.toFixed(2)})`},e.formatHSL=function(e){return 1===e.hsla.a?`hsl(${e.hsla.h}, ${(100*e.hsla.s).toFixed(2)}%, ${(100*e.hsla.l).toFixed(2)}%)`:di.Format.CSS.formatHSLA(e)},e.formatHSLA=function(e){return`hsla(${e.hsla.h}, ${(100*e.hsla.s).toFixed(2)}%, ${(100*e.hsla.l).toFixed(2)}%, ${e.hsla.a.toFixed(2)})`},e.formatHex=function(e){return`#${t(e.rgba.r)}${t(e.rgba.g)}${t(e.rgba.b)}`},e.formatHexA=function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&1===e.rgba.a?di.Format.CSS.formatHex(e):`#${t(e.rgba.r)}${t(e.rgba.g)}${t(e.rgba.b)}${t(Math.round(255*e.rgba.a))}`},e.format=function(e){return e.isOpaque()?di.Format.CSS.formatHex(e):di.Format.CSS.formatRGBA(e)},e.parseHex=function(e){var t=e.length;if(0===t)return null;if(e.charCodeAt(0)!==Di.Hash)return null;if(7===t){var r=16*n(e.charCodeAt(1))+n(e.charCodeAt(2)),a=16*n(e.charCodeAt(3))+n(e.charCodeAt(4)),i=16*n(e.charCodeAt(5))+n(e.charCodeAt(6));return new di(new Bi(r,a,i,1))}if(9===t){var o=16*n(e.charCodeAt(1))+n(e.charCodeAt(2)),s=16*n(e.charCodeAt(3))+n(e.charCodeAt(4)),l=16*n(e.charCodeAt(5))+n(e.charCodeAt(6)),c=16*n(e.charCodeAt(7))+n(e.charCodeAt(8));return new di(new Bi(o,s,l,c/255))}if(4===t){var d=n(e.charCodeAt(1)),u=n(e.charCodeAt(2)),h=n(e.charCodeAt(3));return new di(new Bi(16*d+d,16*u+u,16*h+h))}if(5===t){var v=n(e.charCodeAt(1)),p=n(e.charCodeAt(2)),g=n(e.charCodeAt(3)),f=n(e.charCodeAt(4));return new di(new Bi(16*v+v,16*p+p,16*g+g,(16*f+f)/255))}return null}})((ui=di.Format||(di.Format={})).CSS||(ui.CSS={}));var Hi=J({__name:"index",props:{red:{},green:{},blue:{},alpha:{},updateColor:{type:Function}},setup(e){var t=e,n=Z(t),r=n.red,a=n.green,i=n.blue,s=Y(),l=Y();W((()=>{var e=new $i(new Bi(r.value,a.value,i.value));s.value=$i.Format.CSS.formatHex(e).replace("#","").toLocaleUpperCase(),l.value=Zn(100*t.alpha)}));var c=e=>{var n=$i.fromHex(`#${e.replace("#","")}`),r=n.hsva,a=r.h,i=r.s,s=r.v;t.updateColor(o(o({},n.rgba),{},{hue:a,saturation:i,value:s}))},d=e=>{_e(e)&&t.updateColor({a:e/100})};return(e,t)=>{var n=Ne,r=Lt,a=Bt,i=zt;return B(),z(i,{wrap:!1,gutter:4},{default:N((()=>[$(r,{span:13},{default:N((()=>[$(n,{size:"small",modelValue:Me(s),"onUpdate:modelValue":t[0]||(t[0]=e=>mt(s)?s.value=e:null),onChange:c},null,8,["modelValue"])])),_:1}),$(r,{span:11},{default:N((()=>[$(a,{size:"small",modelValue:Me(l),"onUpdate:modelValue":t[1]||(t[1]=e=>mt(l)?l.value=e:null),"hide-button":"",min:0,max:100,onChange:d},{suffix:N((()=>[Le("%")])),_:1},8,["modelValue"])])),_:1})])),_:1})}}}),Vi=J({__name:"index",props:{value:{},type:{default:"text"},label:{default:""},onChange:{type:Function,default:e=>!1}},setup(e){var t=e;Qe();var n=F({inputValue:t.value||0,inProgress:!1});return xe((()=>t.value),(()=>{t.value!==+n.inputValue&&""!==n.inputValue&&(n.inputValue=t.value)})),(e,t)=>(B(),Q("div"))}}),Fi=J({__name:"index",props:{red:{default:0},green:{default:0},blue:{default:0},alpha:{default:0},updateColor:{type:Function,default:()=>!1}},setup(e){var t=e;return(e,n)=>(B(),Q(ue,null,[$(Vi,{value:t.red,type:"number",label:"R","on-change":e=>{}},null,8,["value","on-change"]),$(Vi,{value:t.green,type:"number",label:"G","on-change":e=>{}},null,8,["value","on-change"]),$(Vi,{value:t.blue,type:"number",label:"B","on-change":e=>{}},null,8,["value","on-change"]),$(Vi,{value:100*t.alpha,type:"number",label:"Alpha","on-change":e=>{}},null,8,["value","on-change"])],64))}}),Wi={class:"color-preview-area"},Ki=J({__name:"index",props:{mode:{},red:{},green:{},blue:{},alpha:{},updateColor:{type:Function}},setup(e){var t=e;return(e,n)=>{var r=$e,a=je,i=Be,o=Te,s=ze;return B(),Q("div",Wi,[$(s,null,{default:N((()=>["hex"===e.mode?(B(),z(Hi,{key:0,red:t.red,green:t.green,blue:t.blue,alpha:t.alpha,"update-color":t.updateColor},null,8,["red","green","blue","alpha","update-color"])):"rgb"===e.mode?(B(),z(Fi,{key:1,red:t.red,green:t.green,blue:t.blue,alpha:t.alpha,"update-color":t.updateColor},null,8,["red","green","blue","alpha","update-color"])):le("",!0),$(o,{"popup-max-height":!1},{content:N((()=>[$(i,null,{default:N((()=>[Le("HEX")])),_:1}),$(i,{disabled:""},{default:N((()=>[Le("RGB")])),_:1})])),default:N((()=>[$(a,{class:"px1! icon-btn",size:"small"},{default:N((()=>[$(r)])),_:1})])),_:1})])),_:1})])}}}),Ui=ee("div",{class:"spectrum"},null,-1),Gi=J({__name:"index",props:{red:{},green:{},blue:{},alpha:{},hue:{},saturation:{},value:{},updateColor:{type:Function}},setup(e){var t,n=e,r=Y(),a=F({width:0,height:0}),i=X((()=>Math.round(n.saturation*a.width-8))),s=X((()=>Math.max(Math.round(a.height-n.value*a.height-14),-6))),l=X((()=>({backgroundColor:`rgb(${n.red}, ${n.green}, ${n.blue})`,left:`${i.value}px`,top:`${s.value}px`}))),c=X((()=>{var e=new $i(new Ni(n.hue,1,1,1)).rgba;return{backgroundColor:`rgb(${e.r}, ${e.g}, ${e.b})`}}));ne((()=>{_e(r)&&(a.width=r.value.clientWidth,a.height=r.value.clientHeight)}));var d=()=>{if(_e(t)){var e=q(u.x-t.x,0,a.width),r=q(u.y-t.y,0,a.height),i=e/a.width,s=1-r/a.height;return o(o({},new $i(new Ni(n.hue,i,s,n.alpha)).rgba),{},{saturation:i,value:s})}},u=Nt(r,{threshold:0,onSwipeStart(){var e;t=null===(e=r.value)||void 0===e?void 0:e.getBoundingClientRect(),n.updateColor(d(),"onStartChange")},onSwipe(){n.updateColor(d(),"onChange")},onSwipeEnd(){n.updateColor(d(),"onEndChange")}}).posEnd;return(e,t)=>(B(),Q("div",{ref_key:"pickerAreaRef",ref:r,class:"spectrum-map",style:pe(c.value)},[Ui,ee("div",{class:"picker-cursor",style:pe(l.value)},null,4)],4))}});function Yi(e,t){var n="",r=e.slice();return r.sort(((e,t)=>e.left-t.left)),n="linear"===t?"linear-gradient(90deg,":"radial-gradient(",r.forEach(((e,t)=>{n+=`rgba(${e.red}, ${e.green}, ${e.blue}, ${e.alpha}) ${e.left}%`,t!==r.length-1&&(n+=",")})),n+=")"}var Xi={class:"preview-area"},qi=J({__name:"index",props:{isGradient:{type:Boolean,default:!1},red:{default:255},green:{default:0},blue:{default:0},alpha:{default:1},points:{default:()=>[{left:0,red:0,green:0,blue:0,alpha:1},{left:100,red:255,green:0,blue:0,alpha:1}]},gradientType:{default:""}},setup(e){var t=e,n=X((()=>{var e,n,r,a;return["linear","radial"].includes(t.gradientType)?{background:Yi(t.points,t.gradientType)}:(e=t.red,n=t.green,r=t.blue,a=t.alpha,{backgroundColor:`rgba(${e}, ${n}, ${r}, ${a})`})}));return(e,t)=>(B(),Q("div",Xi,[ee("div",{class:"preview-box",style:pe(n.value)},null,4)]))}}),Ji={class:"hue"},Zi=J({__name:"index",props:{hue:{},saturation:{},value:{},updateColor:{type:Function}},setup(e){var t,n=e,r=Y(),a=F({width:0}),i=X((()=>{var e=new $i(new Ni(n.hue,1,1,1)).rgba,t=e.r,r=e.g,i=e.b;return{left:`${(n.hue*a.width/360|0)-8}px`,background:`rgb(${t}, ${r}, ${i})`}}));ne((()=>{_e(r)&&(a.width=r.value.clientWidth)}));var o=()=>{if(_e(t)){var e=s.x-t.x,r=new Ni(360*e/a.width,n.saturation,n.value,1),i=new $i(r).rgba;return{r:i.r,g:i.g,b:i.b,hue:r.h}}},s=Nt(r,{threshold:0,onSwipeStart(){var e;t=null===(e=r.value)||void 0===e?void 0:e.getBoundingClientRect(),n.updateColor(o(),"onStartChange")},onSwipe(){_e(t)&&n.updateColor(o(),"onChange")},onSwipeEnd(){_e(t)&&n.updateColor(o(),"onEndChange")}}).posEnd;return(e,t)=>(B(),Q("div",Ji,[ee("div",{ref_key:"hueRef",ref:r,class:"hue-area"},[ee("div",{class:"picker-cursor",style:pe(i.value)},null,4)],512)]))}}),Qi={class:"alpha"},eo={class:"alpha-area"},to=J({__name:"index",props:{red:{},green:{},blue:{},alpha:{},updateColor:{type:Function}},setup(e){var t,n=e,r=Y(),a=F({width:0}),i=X((()=>Math.round(n.alpha*a.width)-8)),o=X((()=>({left:`${i.value}px`}))),s=X((()=>({background:`linear-gradient(to right, rgba(0, 0, 0, 0), rgb(${n.red}, ${n.green}, ${n.blue}))`})));ne((()=>{_e(r)&&(a.width=r.value.clientWidth)}));var l=()=>{if(_e(t))return{a:q(Number(((c.x-t.x)/a.width).toFixed(2)),0,1)}},c=Nt(r,{threshold:0,onSwipeStart(){var e;t=null===(e=r.value)||void 0===e?void 0:e.getBoundingClientRect(),n.updateColor(l(),"onStartChange")},onSwipe(){_e(t)&&n.updateColor(l(),"onChange")},onSwipeEnd(){_e(t)&&n.updateColor(l(),"onEndChange")}}).posEnd;return(e,t)=>(B(),Q("div",Qi,[ee("div",{class:"gradient",style:pe(s.value)},null,4),ee("div",eo,[ee("div",{ref_key:"alphaMaskRef",ref:r,class:"alpha-mask"},[ee("div",{class:"picker-cursor",style:pe(o.value)},null,4)],512)])]))}}),no=J({__name:"index",props:{point:{},active:{type:Boolean},width:{},index:{},removePoint:{type:Function}},setup(e){var t=e,n=X((()=>{var e=t.point,n=e.red,r=e.green,a=e.blue,i=e.alpha;return{left:e.left*(t.width/100)+"px",background:`rgba(${n}, ${r}, ${a}, ${i})`}}));return(e,r)=>(B(),Q("div",{class:ie(["picker-cursor",{active:e.active}]),style:pe(n.value),onDblclick:r[0]||(r[0]=()=>t.removePoint(e.index))},null,38))}}),ro=J({__name:"index",props:{points:Array,activePointIndex:Number,changeActivePointIndex:Function,updateGradientLeft:Function,addPoint:Function,removePoint:Function},setup(e){var t=e,n=Y(),r=Y(0),a=X((()=>({background:Yi(t.points,"linear")}))),i=0,o=e=>{if(_e(n)){var a=n.value.getBoundingClientRect(),o=100*(i=e.clientX-a.x)/r.value;t.addPoint(o)}};ne((()=>{_e(n)&&(r.value=n.value.clientWidth)}));var s=Nt(n,{threshold:0,onSwipeStart(){t.updateGradientLeft(t.points[t.activePointIndex].left,t.activePointIndex,"onStartChange")},onSwipe(){t.updateGradientLeft(100*(i-s.value)/r.value,t.activePointIndex,"onChange")},onSwipeEnd(){t.updateGradientLeft(t.points[t.activePointIndex].left,t.activePointIndex,"onEndChange")}}).distanceX;return(e,s)=>(B(),Q("div",{class:"gradient",onMousedown:o},[ee("div",{class:"gradient-points-bg",style:pe(Me(a))},null,4),ee("div",{ref_key:"pointsContainerRef",ref:n,class:"gradient-slider-container"},[(B(!0),Q(ue,null,he(t.points,((e,n)=>(B(),z(no,{key:n,index:n,point:e,width:Me(r),"remove-point":t.removePoint,active:t.activePointIndex===n,onMousedown:Mt((e=>((e,n)=>{t.changeActivePointIndex(n),e.target instanceof HTMLDivElement&&(i=e.target.offsetLeft)})(e,n)),["stop"])},null,8,["index","point","width","remove-point","active","onMousedown"])))),128))],512)],32))}}),ao={class:"picker-area"},io={key:0,class:"px10px py8px"},oo={class:"preview"},so={class:"color-hue-alpha"},lo=J({__name:"index",props:{isGradient:{type:Boolean},red:{},green:{},blue:{},alpha:{},hue:{},saturation:{},value:{},updateColor:{type:Function},points:{},type:{},activePointIndex:{},changeGradientControl:{type:Function},changeActivePointIndex:{type:Function},updateGradientLeft:{type:Function},addPoint:{type:Function},removePoint:{type:Function}},setup:e=>(e,t)=>(B(),Q("div",ao,[["linear","radial"].includes(e.type)?(B(),Q("div",io,[e.isGradient?(B(),z(ro,{key:0,type:e.type,points:e.points,"active-point-index":e.activePointIndex,"change-active-point-index":e.changeActivePointIndex,"update-gradient-left":e.updateGradientLeft,"add-point":e.addPoint,"remove-point":e.removePoint},null,8,["type","points","active-point-index","change-active-point-index","update-gradient-left","add-point","remove-point"])):le("",!0)])):le("",!0),$(Gi,{red:e.red,green:e.green,blue:e.blue,hue:e.hue,alpha:e.alpha,saturation:e.saturation,value:e.value,"update-color":e.updateColor},null,8,["red","green","blue","hue","alpha","saturation","value","update-color"]),ee("div",oo,[$(qi,{red:e.red,green:e.green,blue:e.blue,alpha:e.alpha,"is-gradient":e.isGradient,points:e.points,"gradient-type":e.type},null,8,["red","green","blue","alpha","is-gradient","points","gradient-type"]),ee("div",so,[$(Zi,{hue:e.hue,saturation:e.saturation,value:e.value,"update-color":e.updateColor},null,8,["hue","saturation","value","update-color"]),$(to,{alpha:e.alpha,red:e.red,green:e.green,blue:e.blue,"update-color":e.updateColor},null,8,["alpha","red","green","blue","update-color"])])])]))}),co=e=>{var t=jr().canvas,n=Y(),r=!1;W((()=>{if(_e(t.activeObject)){var a,i=t.activeObject.value;switch(r=!0,e){case"width":a=i.getWidth();break;case"height":a=i.getHeight();break;case"opacity":a=w.times(i.opacity,100);break;case"angle":a=Jn(i.angle);break;case"left":a=i.getParent(!0)?i.getLeftTop().x:i.left;break;case"top":a=i.getParent(!0)?i.getLeftTop().y:i.top;break;case"fontSize":if(xn.isTextObject(i)){for(var o=i.getStyleAtPosition(0).fontSize,s=!0,l=1;l<i.text.length;l++){var c=i.getStyleAtPosition(l).fontSize;if(!k.isEqual(c,o)){s=!1;break}o=c}a=s?i.fontSize:"多个值"}else a=i[e];break;default:a=i[e]}n.value=k.isNumber(a)?Zn(a):a,requestAnimationFrame((()=>r=!1))}else n.value=void 0}));var a=(t,n)=>{"opacity"===e&&(n=w.divide(n,100)),t.get(e)!==n&&t.set(e,n)},i=(n,i)=>{var o=t.activeObject.value;if(!r&&_e(o)){var s;if(["width","height","left","top","angle"].includes(e))o["width"===e?"setWidth":"height"===e?"setHeight":"left"===e?"setLeft":"top"===e?"setTop":"setAngle"](Number(n)),"change"===i&&null!==(s=o.group)&&void 0!==s&&s.updateLayout&&o.group.updateLayout();else o.isType("Text","Textbox")&&["fontSize"].includes(e)&&o.selectionEnd-o.selectionStart>0?o.setSelectionStyles({fontSize:n}):xn.isBoard(o)&&["fill"].includes(e)?a(o,n):xn.isCollection(o)&&!["left","top","visible","globalCompositeOperation","opacity"].includes(e)?o.forEachObject((e=>{a(e,n)})):a(o,n);t.requestRenderAll()}};return X((()=>({disabled:!_e(t.activeObject.value),modelValue:n.value,onSwipe:e=>{i(e,"swipe")},onChange:e=>{i(e,"change"),_e(t.activeObject)&&t.fire("object:modified",{target:t.activeObject.value})}})))},uo={key:1},ho=J({__name:"index",props:{solidColor:{type:Boolean},mode:{},gradient:{},onChange:{type:Function},onStartChange:{type:Function},onEndChange:{type:Function}},setup(e){var t=e,n=jr(),r=n.canvas,a=n.undoRedo,i=co("fill"),s=X({get(){if(xn.isPattern(i.value.modelValue))return i.value.modelValue.fit},set(e){var t;xn.isPattern(i.value.modelValue)&&e&&(i.value.modelValue.fit=e,null===(t=r.activeObject.value)||void 0===t||t._set("dirty",!0),r.requestRenderAll(),a.saveState())}}),l=F({activePointIndex:0,gradientPoints:t.gradient.points,activePoint:t.gradient.points[0],colorRed:t.gradient.points[0].red,colorGreen:t.gradient.points[0].green,colorBlue:t.gradient.points[0].blue,colorAlpha:t.gradient.points[0].alpha,colorHue:0,colorSaturation:1,colorValue:1,gradientType:t.gradient.type}),c=()=>({points:"color"===l.gradientType?[l.gradientPoints[l.activePointIndex]]:l.gradientPoints,type:l.gradientType}),d=()=>{t.onChange&&t.onChange(c())},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.activePointIndex;l.gradientPoints.length<=2||(l.gradientPoints.splice(e,1),e>0&&(l.activePointIndex=e-1),d())},h=e=>{46!==e.keyCode&&8!==e.keyCode||u(l.activePointIndex)},v=e=>{l.activePointIndex=e,l.activePoint=l.gradientPoints[e];var t=l.activePoint,n=t.red,r=t.green,a=t.blue,i=t.alpha;l.colorRed=n,l.colorGreen=r,l.colorBlue=a,l.colorAlpha=i;var o=new $i(new Bi(n,r,a,1)).hsva,s=o.h,c=o.s,d=o.v;l.colorHue=s,l.colorSaturation=c,l.colorValue=d},p=e=>{var t;e=null!==(t=e)&&void 0!==t?t:l.gradientType,l.gradientType=e,d()},g=function(e){var n,r,a,i,s,d,u,h=e.r,v=e.g,p=e.b,g=e.a,f=e.hue,b=e.saturation,m=e.value,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"onChange";h=null!==(n=h)&&void 0!==n?n:l.colorRed,v=null!==(r=v)&&void 0!==r?r:l.colorGreen,p=null!==(a=p)&&void 0!==a?a:l.colorBlue,g=null!==(i=g)&&void 0!==i?i:l.colorAlpha,f=null!==(s=f)&&void 0!==s?s:l.colorHue,b=null!==(d=b)&&void 0!==d?d:l.colorSaturation,m=null!==(u=m)&&void 0!==u?u:l.colorValue;var x=l.gradientPoints.slice();x[l.activePointIndex]=o(o({},x[l.activePointIndex]),{},{red:h,green:v,blue:p,alpha:g}),l.colorRed=h,l.colorGreen=v,l.colorBlue=p,l.colorAlpha=g,l.colorHue=f,l.colorSaturation=b,l.colorValue=m,l.gradientPoints=x;var k=t[y];k&&k(c())},f=function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"onChange";l.gradientPoints[n].left=q(e,0,100);var a=t[r];a&&a(c())},b=e=>{e=q(e,0,100),l.gradientPoints.push(o(o({},l.gradientPoints[l.activePointIndex]),{},{left:e,alpha:1})),l.activePointIndex=l.gradientPoints.length-1,d()};return ne((()=>{var e=new $i(new Bi(l.colorRed,l.colorGreen,l.colorBlue,1)).hsva,t=e.h,n=e.s,r=e.v;l.colorHue=t,l.colorSaturation=n,l.colorValue=r,document.addEventListener("keyup",h)})),ae((()=>{document.removeEventListener("keyup",h)})),(e,t)=>{var n=Ht,r=$t;return B(),Q(ue,null,[e.solidColor?le("",!0):(B(),z(Ri,{key:0,type:l.gradientType,"change-gradient-control":p},null,8,["type"])),"pattern"===l.gradientType?(B(),Q("div",uo,[$(r,{modelValue:Me(s),"onUpdate:modelValue":t[0]||(t[0]=e=>mt(s)?s.value=e:null)},{default:N((()=>[$(n,{value:"fill"},{default:N((()=>[Le("填充")])),_:1}),$(n,{value:"padding"},{default:N((()=>[Le("适应")])),_:1}),$(n,{value:"clip"},{default:N((()=>[Le("裁剪")])),_:1})])),_:1},8,["modelValue"])])):(B(),Q(ue,{key:2},[$(lo,{red:l.colorRed,green:l.colorGreen,blue:l.colorBlue,alpha:l.colorAlpha,hue:l.colorHue,saturation:l.colorSaturation,value:l.colorValue,"update-color":g,"is-gradient":!0,type:l.gradientType,points:l.gradientPoints,"active-point-index":l.activePointIndex,"change-gradient-control":p,"change-active-point-index":v,"update-gradient-left":f,"add-point":b,"remove-point":u},null,8,["red","green","blue","alpha","hue","saturation","value","type","points","active-point-index"]),$(Ki,{red:l.colorRed,green:l.colorGreen,blue:l.colorBlue,alpha:l.colorAlpha,"update-color":g,mode:e.mode},null,8,["red","green","blue","alpha","mode"])],64))],64)}}}),vo={class:"ui-color-picker"},po=J({__name:"colorPicker",props:{solidColor:{type:Boolean,default:!1},mode:{default:"hex"},gradient:{default:()=>({type:"color",points:[{left:0,red:255,green:0,blue:0,alpha:1},{left:100,red:255,green:255,blue:255,alpha:0}]})},onChange:{type:Function,default:K},onStartChange:{type:Function,default:K},onEndChange:{type:Function,default:K}},setup(e){var t=e;return(e,n)=>(B(),Q("div",vo,[$(ho,ot(Vt(t)),null,16)]))}});function go(e,t){var n=function(e,t){return Math.atan2(e.y-t.y,e.x-t.x)}(e,t),r=function(e){return 180/Math.PI*e}(n),a=function(e,t){var n=Math.abs(e.x-t.x),r=Math.abs(e.y-t.y),a=Math.sqrt(Math.pow(n,2)+Math.pow(r,2));return a}(e,t);return{x:e.x+a*Math.cos(r*Math.PI/180),y:e.y+a*Math.sin(r*Math.PI/180)}}var fo,bo=e=>e.padEnd(6,e),mo=()=>{fo&&fo.close(),fo=void 0},yo=(n,r)=>{var a,i=r.object,s=r.attr,c=r.dialogOption,d=r.initialColor,u=t(r,e),h=n.get(hr),v=n.get(Cr),p="color",b=i&&s?i[s]:d;if(b instanceof g)a=b.colorStops.map((e=>{var t=l(new D(e.color).getSource(),4),n=t[0],r=t[1],a=t[2],i=t[3];return{left:100*e.offset,red:n,green:r,blue:a,alpha:i}})),p=b.type;else if(b instanceof f)a=[{left:0,red:255,green:255,blue:255,alpha:1},{left:100,red:255,green:255,blue:255,alpha:0}],p=b.type;else if(b){var m=l(new D(b).getSource(),4),y=m[0],x=m[1],k=m[2],w=m[3];a=[{left:0,red:y,green:x,blue:k,alpha:w},{left:100,red:255,green:255,blue:255,alpha:0}]}return Ti.open(o(o({width:240,top:window.innerHeight/2-202,left:window.innerWidth-240-240,title:"颜色"},c),{},{body:()=>ke(po,o(o({onChange(e){if(_e(i)&&_e(s)){if("color"===e.type){if(e.points.length<1)return;var t=l(e.points,1)[0],n=t.red,r=t.green,a=t.blue,o=t.alpha;i.set(s,`rgba(${n}, ${r}, ${a}, ${o})`)}else if("linear"===e.type||"radial"===e.type){var c=(e=>e.map((e=>({offset:e.left/100,color:`rgba(${e.red}, ${e.green}, ${e.blue}, ${e.alpha})`}))))(e.points),d=void 0,u=i[s];if(u instanceof g&&(d=u.coords),!d){var v=(p=-parseInt(180+"",10)*pn,{x1:Math.round(50+50*Math.sin(p))/100,y1:Math.round(50+50*Math.cos(p))/100,x2:Math.round(50+50*Math.sin(p+Math.PI))/100,y2:Math.round(50+50*Math.cos(p+Math.PI))/100});d={x1:v.x1*i.width,y1:v.y1*i.height,x2:v.x2*i.width,y2:v.y2*i.height}}i.set(s,new g({type:"linear",coords:d,colorStops:c}))}var p;h.requestRenderAll()}},onEndChange(){v.saveState()}},u),{},{gradient:{type:p,points:a}})),onClose(){var e;fo=void 0,null==c||null===(e=c.onClose)||void 0===e||e.call(c)}}))},xo=Object.assign(po,{open:e=>(fo||(fo=Or.editor.service.invokeFunction(yo,e)),mo),close:mo}),ko=J({__name:"backgroundColorAttr",setup(e){var t,n=jr().canvas,r=()=>{t&&t(),t=void 0},a=e=>{(e=e.replace(/^#/,"")).length<6&&(e=bo(e));var t=new D(e);o.backgroundColor=t.toRgba()};xe(n.activeObject,(()=>r()));var i=()=>{t=xo.open({initialColor:n.backgroundColor,solidColor:!0,onChange:e=>{if(!(e.points.length<1)){var t=l(e.points,1)[0],n=t.red,r=t.green,a=t.blue,i=t.alpha;o.backgroundColor=`rgba(${n}, ${r}, ${a}, ${i})`}}})};pt((()=>{r()}));var o=F({backgroundColor:n.backgroundColor,inputValue:""});return xe((()=>o.backgroundColor),(e=>{k.isString(e)?o.inputValue=new D(e).toHex().toUpperCase():o.inputValue="",n.set("backgroundColor",e),n.requestRenderAll()}),{immediate:!0}),(e,t)=>{var n=je,r=Ne,s=Lt,l=Ft,c=zt;return B(),z(_i,{title:"画布背景色","disable-add":!!Me(o).backgroundColor,onClickAdd:t[2]||(t[2]=e=>Me(o).backgroundColor="#F4F4F4")},{default:N((()=>[$(c,{gutter:[4,4],align:"center"},{default:N((()=>[$(s,{span:10},{default:N((()=>[$(r,{size:"mini",modelValue:Me(o).inputValue,"onUpdate:modelValue":t[0]||(t[0]=e=>Me(o).inputValue=e),onChange:a,class:"pl0!"},{prefix:N((()=>[$(n,{size:"mini",class:"icon-btn",onClick:i},{icon:N((()=>[ee("div",{class:"w18px h18px rd-4px",style:pe({background:Me(o).backgroundColor,border:"1px solid #cccccc90"})},null,4)])),_:1})])),_:1},8,["modelValue"])])),_:1}),$(s,{span:3.5,class:"mlauto"},{default:N((()=>[$(n,{size:"small",class:"icon-btn",onClick:t[1]||(t[1]=e=>Me(o).backgroundColor="")},{icon:N((()=>[$(l)])),_:1})])),_:1})])),_:1})])),_:1},8,["disable-add"])}}}),wo={class:"key"};var Co=hn({},[["render",function(e,t){return B(),Q("div",wo,[oe(e.$slots,"default",{},void 0,!0)])}],["__scopeId","data-v-778c73e1"]]),So=J({__name:"key",props:{keys:{}},setup:e=>(e,t)=>{var n=ze;return B(),z(n,{size:"mini"},{default:N((()=>[(B(!0),Q(ue,null,he(e.keys,((e,t)=>(B(),z(Co,{key:t},{default:N((()=>[Le(ce(e),1)])),_:2},1024)))),128))])),_:1})}}),_o={class:"flex-shrink-0"},Oo=hn(J({__name:"tipContentKey",props:{keys:{},content:{}},setup:e=>(e,t)=>{var n=ze;return B(),z(n,null,{default:N((()=>[ee("div",_o,ce(e.content),1),e.keys?(B(),z(Me(So),{key:0,keys:e.keys},null,8,["keys"])):le("",!0)])),_:1})}}),[["__scopeId","data-v-ef96d75d"]]),jo=J({__name:"layoutAlign",setup(e){var t=[{name:"HorizontalLeft",icon:"bxs-objects-horizontal-left",tip:"左对齐",onClick:()=>a.trigger("alt+a"),key:["Alt","A"]},{name:"HorizontalCenter",icon:"bxs-objects-horizontal-center",tip:"水平居中对齐",onClick:()=>a.trigger("alt+h"),key:["Alt","H"]},{name:"HorizontalRight",icon:"bxs-objects-horizontal-right",tip:"右对齐",onClick:()=>a.trigger("alt+d"),key:["Alt","D"]},{name:"VerticalTop",icon:"bxs-objects-vertical-top",tip:"顶对齐",onClick:()=>a.trigger("alt+w"),key:["Alt","W"]},{name:"VerticalCenter",icon:"bxs-objects-vertical-center",tip:"垂直居中对齐",onClick:()=>a.trigger("alt+v"),key:["Alt","V"]},{name:"VerticalBottom",icon:"bxs-objects-vertical-bottom",tip:"底对齐",onClick:()=>a.trigger("alt+s"),key:["Alt","S"]}],n=jr(),r=n.canvas,a=n.keybinding,i=X((()=>!(r.activeObject.value instanceof p)));return(e,n)=>{var r=je,a=Wt,o=Lt,s=zt;return B(),z(s,{wrap:!1,class:"p2",justify:"space-between",align:"center"},{default:N((()=>[(B(),Q(ue,null,he(t,(e=>$(o,{flex:"none",key:e.name},{default:N((()=>[$(a,{mini:"",position:"bottom",popupVisible:!!e.tip&&void 0},ve({default:N((()=>[$(r,{class:"button",size:"small",disabled:Me(i),onClick:e.onClick},{icon:N((()=>[$(ba,{name:e.icon},null,8,["name"])])),_:2},1032,["disabled","onClick"])])),_:2},[e.tip?{name:"content",fn:N((()=>[$(Oo,{content:e.tip,keys:e.key},null,8,["content","keys"])])),key:"0"}:void 0]),1032,["popupVisible"])])),_:2},1024))),64))])),_:1})}}}),Ao=hn(J({__name:"swipeNumber",props:{label:{},modelValue:{},modelEvent:{default:"change"},step:{default:1},max:{},min:{}},emits:["update:modelValue","change","swipe"],setup(e,t){var n=t.emit,r=e,a=Kt(),i=Ut(r,"modelValue",n);xe(i,(e=>{e&&(i.value=Zn(e))}),{immediate:!0});var o=(e,t)=>{n("change",e,t)},s=bt(),l=s.shift,c=s.alt,d=Y(),u=Y(),h=Nt(d,{threshold:0,onSwipeStart:()=>{u.value=i.value},onSwipe:e=>{if(k.isNumber(u.value)){var t=r.step;l.value&&(t*=10),c.value&&(t/=10),t=Math.max(t,.01);var a=u.value+Math.round(p.x-v.x)*t;_e(r.min)&&a<r.min&&(a=r.min),_e(r.max)&&a>r.max&&(a=r.max),a=Zn(a),i.value=a,n("swipe",a,e)}},onSwipeEnd:e=>{n("change",i.value,e),u.value=void 0}}),v=h.posStart,p=h.posEnd,g=X((()=>!!r.label||!!a.label));return(e,t)=>{var n=Bt;return B(),z(n,{modelValue:Me(i),"onUpdate:modelValue":t[0]||(t[0]=e=>mt(i)?i.value=e:null),modelEvent:e.modelEvent,step:e.step,max:e.max,min:e.min,"hide-button":Me(g),class:ie({hasLabel:Me(g)}),onChange:o},ve({_:2},[Me(g)?{name:"prefix",fn:N((()=>[ee("div",{ref_key:"labelRef",ref:d,class:"w26px text-center cursor-ew-resize"},[e.$slots.label?oe(e.$slots,"label",{key:0},void 0,!0):(B(),Q(ue,{key:1},[Le(ce(e.label),1)],64))],512)])),key:"0"}:void 0,he(Me(a),((t,n)=>({name:n,fn:N((()=>[oe(e.$slots,n,{},void 0,!0)]))})))]),1032,["modelValue","modelEvent","step","max","min","hide-button","class"])}}}),[["__scopeId","data-v-5f5ef608"]]),Mo={class:"p2"},Po=(e=>(jt("data-v-0d66fab4"),e=e(),At(),e))((()=>ee("div",{class:"absolute top-1 right-1"},"°",-1))),Io=hn(J({__name:"baseAttr",setup(e){var t=jr(),n=t.keybinding,r=t.canvas,a=t.undoRedo,i=co("left"),o=co("top"),s=co("angle"),l=co("width"),c=co("height"),d=co("rx"),u=co("ry");return(e,t)=>{var h=Lt,v=je,p=Wt,g=ze,f=zt;return B(),Q("div",Mo,[$(f,{gutter:[4,4],align:"center"},{default:N((()=>[$(h,{span:10},{default:N((()=>[$(Me(Ao),se({size:"small",label:"X"},Me(i)),null,16)])),_:1}),$(h,{span:10},{default:N((()=>[$(Me(Ao),se({size:"small",label:"Y"},Me(o)),null,16)])),_:1}),$(h,{span:10},{default:N((()=>[$(Me(Ao),se({size:"small",min:.5,label:"W"},Me(l)),null,16)])),_:1}),$(h,{span:10},{default:N((()=>[$(Me(Ao),se({size:"small",min:.5,label:"H"},Me(c)),null,16)])),_:1}),$(h,{span:10},{default:N((()=>[$(Me(Ao),se({size:"small"},Me(s)),{label:N((()=>[$(Me(ba),{name:"bx-revision"})])),suffix:N((()=>[Po])),_:1},16)])),_:1}),$(h,{span:8},{default:N((()=>[$(g,{size:"mini"},{default:N((()=>[$(p,{mini:"",position:"bottom"},{content:N((()=>[$(Oo,{content:"水平翻转",keys:["Shift","H"]})])),default:N((()=>[$(v,{size:"small",disabled:!Me(_e)(Me(r).activeObject),onClick:t[0]||(t[0]=e=>Me(n).trigger("shift+h"))},{icon:N((()=>[$(Me(ba),{name:"bx-reflect-vertical"})])),_:1},8,["disabled"])])),_:1}),$(p,{mini:"",position:"bottom"},{content:N((()=>[$(Oo,{content:"垂直翻转",keys:["Shift","V"]})])),default:N((()=>[$(v,{size:"small",disabled:!Me(_e)(Me(r).activeObject),onClick:t[1]||(t[1]=e=>Me(n).trigger("shift+v"))},{icon:N((()=>[$(Me(ba),{name:"bx-reflect-horizontal"})])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1}),Me(_e)(Me(r).activeObject)&&"rx"in Me(r).activeObject.value.ref&&"ry"in Me(r).activeObject.value.ref?(B(),z(h,{key:0,span:10},{default:N((()=>[$(Me(Ao),{size:"small",min:0,max:Math.min(Me(r).activeObject.value.width,Me(r).activeObject.value.height)/2,modelValue:Me(d).modelValue,"onUpdate:modelValue":t[2]||(t[2]=e=>Me(d).modelValue=e),onSwipe:t[3]||(t[3]=e=>{Me(d).onSwipe(e),Me(u).onSwipe(e)}),onChange:t[4]||(t[4]=e=>{Me(d).onSwipe(e),Me(u).onSwipe(e),Me(a).saveState()})},{label:N((()=>[$(Me(ba),{name:"round"})])),_:1},8,["max","modelValue"])])),_:1})):le("",!0)])),_:1})])}}}),[["__scopeId","data-v-0d66fab4"]]),To=()=>{var e=`a${Mn()}`;return{triggerProps:{contentClass:e},onPopupVisibleChange:t=>{t&&re((()=>{var t=document.querySelector(`.${e} .arco-select-dropdown-list-wrapper`);t&&(t.style.maxHeight=window.innerHeight-t.getBoundingClientRect().top-8+"px")}))}}},Eo=J({__name:"layerAttr",setup(e){var t=co("opacity"),n=co("globalCompositeOperation"),r=co("visible"),a=F([{value:"source-over",label:"正常"},{isGroup:!0,label:"暗色",options:[{value:"darken",label:"变暗"},{value:"multiply",label:"正片叠底"},{value:"color-burn",label:"颜色加深"}]},{isGroup:!0,label:"亮色",options:[{value:"lighten",label:"变亮"},{value:"screen",label:"滤色"},{value:"color-dodge",label:"颜色减淡"},{value:"lighter",label:"提亮"}]},{isGroup:!0,label:"对比",options:[{value:"overlay",label:"叠加"},{value:"soft-light",label:"柔光"},{value:"hard-light",label:"强光"}]},{isGroup:!0,label:"比较",options:[{value:"difference",label:"差集"},{value:"exclusion",label:"排除"}]},{isGroup:!0,label:"颜色",options:[{value:"hue",label:"色相"},{value:"saturation",label:"饱和度"},{value:"color",label:"颜色"},{value:"luminosity",label:"明度"}]}]);return(e,i)=>{var s=$t,l=Lt,c=Bt,d=wt,u=Ct,h=je,v=zt;return B(),z(_i,{title:"图层","hidden-add":""},{default:N((()=>[$(v,{gutter:[4,4],align:"center"},{default:N((()=>[$(l,{span:10},{default:N((()=>[$(s,se({size:"small"},o(o({},Me(n)),Me(To)()),{options:Me(a)}),null,16,["options"])])),_:1}),$(l,{span:7},{default:N((()=>[$(c,se({size:"small"},Me(t),{"hide-button":"",min:0,max:100}),{suffix:N((()=>[Le("%")])),_:1},16)])),_:1}),$(l,{span:3.5,class:"mlauto"},{default:N((()=>[$(h,{size:"small",class:"icon-btn",onClick:i[0]||(i[0]=e=>Me(r).onChange(!Me(r).modelValue))},{icon:N((()=>[!0===Me(r).modelValue?(B(),z(d,{key:0})):(B(),z(u,{key:1}))])),_:1})])),_:1})])),_:1})])),_:1})}}}),Ro=J({__name:"textAttr",setup(e){var t=F([{value:"arial",label:"Arial"},{value:"Times New Roman",label:"Times New Roman"},{value:"Microsoft Yahei",label:"微软雅黑"}]),n=F([{value:"normal",label:"常规体"},{value:"lighter",label:"细体"},{value:"bold",label:"粗体"},{value:"italic",label:"斜体"}]),r=F([8,9,10,11,12,14,16,18,21,24,36,48,60,72].map((e=>({value:e,label:e.toString()})))),a=co("fontFamily"),i=co("fontSize");co("lineHeight"),co("charSpacing"),co("textAlign");var s=Y(),l=jr().canvas;W((()=>{var e=qt(l.activeObject);_e(e)&&("italic"===e.value.get("fontStyle")?s.value=e.value.get("fontStyle"):["bold","lighter","normal"].includes(e.value.get("fontWeight"))&&(s.value=e.value.get("fontWeight")))}));var c=e=>{var t=qt(l.activeObject);_e(t)&&(t.value.set("fontStyle","normal"),t.value.set("fontWeight","normal"),["bold","lighter","normal"].includes(e.toString())?t.value.set("fontWeight",e):"italic"===e&&t.value.set("fontStyle",e),l.requestRenderAll())};return(e,l)=>{var d=$t,u=Lt,h=zt;return B(),z(_i,{title:"文本","hidden-add":""},{default:N((()=>[$(h,{gutter:[4,4]},{default:N((()=>[$(u,null,{default:N((()=>[$(d,se({size:"small",class:"mb1"},o(o({},Me(a)),Me(To)()),{options:Me(t)}),null,16,["options"])])),_:1}),$(u,{span:14},{default:N((()=>[$(d,{size:"small","model-value":Me(s),options:Me(n),onChange:c},null,8,["model-value","options"])])),_:1}),$(u,{span:10},{default:N((()=>[$(d,se(o(o({},Me(i)),Me(To)()),{size:"small",options:Me(r)}),null,16,["options"])])),_:1})])),_:1})])),_:1})}}});function Do(e,t){var n,r=X((()=>{var t,n,r,a,i,o="";return k.isString(e.value)?o+=e.value:xn.isPattern(e.value)?e.value.isImageSource()&&(o+=`url(${e.value.source.src}) center center / 14px no-repeat`):xn.isGradient(e.value)&&("linear"===e.value.type?o+=`linear-gradient(${t=e.value.coords,n=t.x1,r=t.y1,a=t.x2,i=t.y2,180*Math.atan2(i-r,a-n)/Math.PI+90}deg`:o+="radial-gradient(8px 8px at 8px 8px",o+=`,${e.value.colorStops.map((e=>`${e.color} ${100*e.offset}%`)).join(",")})`),{class:"w18px h18px rd-4px",style:{border:"1px solid #cccccc90",background:o||"#fff"}}})),a=Y(),i=Y();xe(e,(e=>{if(k.isString(e)){var t=new D(e);return i.value=t.toHex().toUpperCase(),void(a.value=w.times(t.getAlpha(),100))}return xn.isGradient(e)?(i.value="linear"===e.type?"线性渐变":"径向渐变",void(a.value=void 0)):xn.isPattern(e)?(i.value="图案填充",void(a.value=void 0)):(i.value="",void(a.value=void 0))}),{immediate:!0});var o=()=>{n&&n()};return vt((()=>{o()})),{formatValue:i,colorBlock:r,opacity:a,openColorPicker:()=>{n||xo.close(),Or.editor.service.invokeFunction((e=>{var r=e.get(hr);_e(r.activeObject)&&(n=xo.open({object:r.activeObject.value,attr:t.attr,dialogOption:{onClose(){n=void 0}}}))}))},closeColorPicker:o,readonly:X((()=>!k.isString(e.value))),changeOpacity(n){if(k.isString(e.value)&&_e(n)){var r=new D(e.value).setAlpha(w.divide(n,100));t.onChange(r.toRgba())}},changeColor(e){(e=e.replace(/^#/,"")).length<6&&(e=bo(e));var n=new D(e).setAlpha(w.divide(a.value||100,100));t.onChange(n.toRgba())}}}var Lo,Bo=J({__name:"fillAttr",setup(e){var t=jr().canvas,n=co("fill"),r=Do(X((()=>n.value.modelValue)),{attr:"fill",onChange(e){n.value.onChange(e)}}),a=r.formatValue,i=r.colorBlock,o=r.changeColor,s=r.changeOpacity,l=r.opacity,c=r.closeColorPicker,d=r.openColorPicker,u=r.readonly;return xe(t.activeObject,(()=>c())),(e,t)=>{var r=je,c=Ne,h=Lt,v=Bt,p=Ft,g=zt;return B(),z(_i,{title:"填充","disable-add":!!Me(n).modelValue,onClickAdd:t[3]||(t[3]=e=>Me(n).onChange("#cccccc"))},{default:N((()=>[$(g,{gutter:[4,4],align:"center"},{default:N((()=>[$(h,{span:10},{default:N((()=>[$(c,{size:"mini",modelValue:Me(a),"onUpdate:modelValue":t[0]||(t[0]=e=>mt(a)?a.value=e:null),readonly:Me(u),onChange:Me(o),class:"pl0!"},{prefix:N((()=>[$(r,{size:"mini",class:"icon-btn",onClick:Me(d)},{icon:N((()=>[ee("div",ot(Vt(Me(i))),null,16)])),_:1},8,["onClick"])])),_:1},8,["modelValue","readonly","onChange"])])),_:1}),Me(k.isNumber)(Me(l))?(B(),z(h,{key:0,span:7},{default:N((()=>[$(v,{size:"small",modelValue:Me(l),"onUpdate:modelValue":t[1]||(t[1]=e=>mt(l)?l.value=e:null),"hide-button":"",min:0,max:100,onChange:Me(s)},{suffix:N((()=>[Le("%")])),_:1},8,["modelValue","onChange"])])),_:1})):le("",!0),$(h,{span:3.5,class:"mlauto"},{default:N((()=>[$(r,{size:"small",class:"icon-btn",onClick:t[2]||(t[2]=e=>Me(n).onChange(null))},{icon:N((()=>[$(p)])),_:1})])),_:1})])),_:1})])),_:1},8,["disable-add"])}}}),zo=J({__name:"strokeAttr",setup(e){var t=jr().canvas,n=co("stroke"),r=co("strokeWidth"),a=co("paintFirst"),i=Do(X((()=>n.value.modelValue)),{attr:"stroke",onChange(e){n.value.onChange(e)}}),o=i.formatValue,s=i.colorBlock,l=i.changeColor,c=i.closeColorPicker,d=i.openColorPicker,u=i.readonly;xe(t.activeObject,(()=>c()));var h=F([{value:"fill",label:"内部"},{value:"stroke",label:"外部"}]);return(e,t)=>{var i=je,c=Ne,v=Lt,p=Ft,g=$t,f=zt;return B(),z(_i,{title:"边框","disable-add":!!Me(r).modelValue,onClickAdd:t[2]||(t[2]=()=>{null===Me(n).modelValue&&Me(n).onChange("#979797"),Me(r).onChange(1)})},{default:N((()=>[$(f,{gutter:[4,4],align:"center"},{default:N((()=>[$(v,{span:10},{default:N((()=>[$(c,{size:"mini",modelValue:Me(o),"onUpdate:modelValue":t[0]||(t[0]=e=>mt(o)?o.value=e:null),readonly:Me(u),onChange:Me(l),class:"pl0!"},{prefix:N((()=>[$(i,{size:"mini",class:"icon-btn",onClick:Me(d)},{icon:N((()=>[ee("div",ot(Vt(Me(s))),null,16)])),_:1},8,["onClick"])])),_:1},8,["modelValue","readonly","onChange"])])),_:1}),$(v,{span:10},{default:N((()=>[$(Me(Ao),se({size:"small",min:1,label:"W"},Me(r),{"hide-button":!1}),null,16)])),_:1}),$(v,{span:3.5,class:"mlauto"},{default:N((()=>[$(i,{size:"small",class:"icon-btn",onClick:t[1]||(t[1]=e=>Me(r).onChange(0))},{icon:N((()=>[$(p)])),_:1})])),_:1}),$(v,{span:10},{default:N((()=>[$(g,se({size:"small"},Me(a),{options:Me(h)}),null,16,["options"])])),_:1})])),_:1})])),_:1},8,["disable-add"])}}}),No={class:"pb2"},$o=J({__name:"rightPanel",setup(e){var t=jr().canvas,n=X((()=>{var e=t.activeObject.value;return[{name:"LayoutAlign",component:jo,visual:!0},{name:"BaseAttr",component:Io,visual:!0},{name:"BackgroundColor",component:ko,visual:!_e(e)},{name:"LayerAttr",component:Eo,visual:_e(e)&&!xn.isActiveSelection(e)},{name:"TextAttr",component:Ro,visual:_e(e)&&e.isType("IText","Textbox")},{name:"FillAttr",component:Bo,visual:_e(e)&&(xn.isBoard(e)||!xn.isCollection(e))},{name:"StrokeAttr",component:zo,visual:_e(e)&&!xn.isCollection(e)}]})),r=Or.editor.getPluginSlots("rightPanel");return(e,t)=>{var a=He,i=ft;return B(),z(i,{style:{height:"100%",overflow:"auto"},"outer-style":{height:"100%"}},{default:N((()=>[ee("div",No,[(B(!0),Q(ue,null,he(Me(n),((e,t)=>(B(),Q(ue,{key:e.name},[e.visual?(B(),Q(ue,{key:0},[0!==t?(B(),z(a,{key:0,margin:0})):le("",!0),(B(),z(H(e.component)))],64)):le("",!0)],64)))),128)),(B(!0),Q(ue,null,he(Me(r),((e,t)=>(B(),Q(ue,{key:t},[t!==e.length-1?(B(),z(a,{key:0,margin:0})):le("",!0),(B(),z(H(e)))],64)))),128))])])),_:1})}}}),Ho=hn($o,[["__scopeId","data-v-f4b2aeb5"]]),Vo=()=>Lo;class Fo{constructor(e,t){s(this,"incoming",new Map),s(this,"outgoing",new Map),this.key=e,this.data=t}}class Wo{constructor(e){s(this,"_nodes",new Map),this._hashFn=e}roots(){var e,t=[],n=c(this._nodes.values());try{for(n.s();!(e=n.n()).done;){var r=e.value;0===r.outgoing.size&&t.push(r)}}catch(a){n.e(a)}finally{n.f()}return t}insertEdge(e,t){var n=this.lookupOrInsertNode(e),r=this.lookupOrInsertNode(t);n.outgoing.set(r.key,r),r.incoming.set(n.key,n)}removeNode(e){var t=this._hashFn(e);this._nodes.delete(t);var n,r=c(this._nodes.values());try{for(r.s();!(n=r.n()).done;){var a=n.value;a.outgoing.delete(t),a.incoming.delete(t)}}catch(i){r.e(i)}finally{r.f()}}lookupOrInsertNode(e){var t=this._hashFn(e),n=this._nodes.get(t);return n||(n=new Fo(t,e),this._nodes.set(t,n)),n}lookup(e){return this._nodes.get(this._hashFn(e))}isEmpty(){return 0===this._nodes.size}toString(){var e,t=[],n=c(this._nodes);try{for(n.s();!(e=n.n()).done;){var r=l(e.value,2),a=r[0],i=r[1];t.push(`${a}\n\t(-> incoming)[${[...i.incoming.keys()].join(", ")}]\n\t(outgoing ->)[${[...i.outgoing.keys()].join(",")}]\n`)}}catch(o){n.e(o)}finally{n.f()}return t.join("\n")}findCycleSlow(){var e,t=c(this._nodes);try{for(t.s();!(e=t.n()).done;){var n=l(e.value,2),r=n[0],a=n[1],i=new Set([r]),o=this._findCycle(a,i);if(o)return o}}catch(s){t.e(s)}finally{t.f()}}_findCycle(e,t){var n,r=c(e.outgoing);try{for(r.s();!(n=r.n()).done;){var a=l(n.value,2),i=a[0],o=a[1];if(t.has(i))return[...t,i].join(" -> ");t.add(i);var s=this._findCycle(o,t);if(s)return s;t.delete(i)}}catch(d){r.e(d)}finally{r.f()}}}class Ko{constructor(){s(this,"_entries",new Map);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,a=t;r<a.length;r++){var i=l(a[r],2),o=i[0],c=i[1];this.set(o,c)}}set(e,t){var n=this._entries.get(e);return this._entries.set(e,t),n}has(e){return this._entries.has(e)}get(e){return this._entries.get(e)}}class Uo extends Error{constructor(e){var t;super("cyclic dependency between services"),this.message=null!==(t=e.findCycleSlow())&&void 0!==t?t:`UNABLE to detect cycle, dumping graph: \n${e.toString()}`}}class Go{constructor(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ko,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];s(this,"_globalGraph",void 0),s(this,"_globalGraphImplicitDependency",void 0),s(this,"_activeInstantiations",new Set),this._services=t,this._strict=n,this._parent=r,this._enableTracing=a,this._services.set(Tn,this),this._globalGraph=a?null!==(e=null==r?void 0:r._globalGraph)&&void 0!==e?e:new Wo((e=>e)):void 0}createChild(e){return new Go(e,this._strict,this,this._enableTracing)}invokeFunction(e){var t=Yo.traceInvocation(this._enableTracing,e),n=!1;try{for(var r={get:e=>{if(n)throw new Error("service accessor is only valid during the invocation of its target method");var r=this._getOrCreateServiceInstance(e,t);if(!r)throw new Error(`[invokeFunction] unknown service '${e}'`);return r}},a=arguments.length,i=new Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];return e(r,...i)}finally{n=!0,t.stop()}}createInstance(e){for(var t,n,r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];return e instanceof Rn?(t=Yo.traceCreation(this._enableTracing,e.ctor),n=this._createInstance(e.ctor,e.staticArguments.concat(a),t)):(t=Yo.traceCreation(this._enableTracing,e),n=this._createInstance(e,a,t)),t.stop(),n}_createInstance(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,a=In.getServiceDependencies(e).sort(((e,t)=>e.index-t.index)),i=[],o=c(a);try{for(o.s();!(t=o.n()).done;){var s=t.value,l=this._getOrCreateServiceInstance(s.id,r);l||this._throwIfStrict(`[createInstance] ${e.name} depends on UNKNOWN service ${s.id}.`,!1),i.push(l)}}catch(h){o.e(h)}finally{o.f()}var d=a.length>0?a[0].index:n.length;if(n.length!==d){console.trace(`[createInstance] First service dependency of ${e.name} at position ${d+1} conflicts with ${n.length} static arguments`);var u=d-n.length;n=u>0?n.concat(new Array(u)):n.slice(0,d)}return Reflect.construct(e,n.concat(i))}_setServiceInstance(e,t){if(this._services.get(e)instanceof Rn)this._services.set(e,t);else{if(!this._parent)throw new Error("illegalState - setting UNKNOWN service instance");this._parent._setServiceInstance(e,t)}}_getServiceInstanceOrDescriptor(e){var t=this._services.get(e);return!t&&this._parent?this._parent._getServiceInstanceOrDescriptor(e):t}_getOrCreateServiceInstance(e,t){this._globalGraph&&this._globalGraphImplicitDependency&&this._globalGraph.insertEdge(this._globalGraphImplicitDependency,String(e));var n=this._getServiceInstanceOrDescriptor(e);return n instanceof Rn?this._safeCreateAndCacheServiceInstance(e,n,t.branch(e,!0)):(t.branch(e,!1),n)}_safeCreateAndCacheServiceInstance(e,t,n){if(this._activeInstantiations.has(e))throw new Error(`illegal state - RECURSIVELY instantiating service '${e}'`);this._activeInstantiations.add(e);try{return this._createAndCacheServiceInstance(e,t,n)}finally{this._activeInstantiations.delete(e)}}_createAndCacheServiceInstance(e,t,n){for(var r=new Wo((e=>e.id.toString())),a=0,i=[{id:e,desc:t,_trace:n}];i.length;){var o=i.pop();if(r.lookupOrInsertNode(o),a++>1e3)throw new Uo(r);var s,l=c(In.getServiceDependencies(o.desc.ctor));try{for(l.s();!(s=l.n()).done;){var d,u=s.value,h=this._getServiceInstanceOrDescriptor(u.id);if(h||this._throwIfStrict(`[createInstance] ${e} depends on ${u.id} which is NOT registered.`,!0),null===(d=this._globalGraph)||void 0===d||d.insertEdge(String(o.id),String(u.id)),h instanceof Rn){var v={id:u.id,desc:h,_trace:o._trace.branch(u.id,!0)};r.insertEdge(o,v),i.push(v)}}}catch(y){l.e(y)}finally{l.f()}}for(;;){var p=r.roots();if(0===p.length){if(!r.isEmpty())throw new Uo(r);break}var g,f=c(p);try{for(f.s();!(g=f.n()).done;){var b=g.value.data;if(this._getServiceInstanceOrDescriptor(b.id)instanceof Rn){var m=this._createServiceInstanceWithOwner(b.id,b.desc.ctor,b.desc.staticArguments,b.desc.supportsDelayedInstantiation,b._trace);this._setServiceInstance(b.id,m)}r.removeNode(b)}}catch(y){f.e(y)}finally{f.f()}}return this._getServiceInstanceOrDescriptor(e)}_createServiceInstanceWithOwner(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(this._services.get(e)instanceof Rn)return this._createServiceInstance(e,t,n,r,a);if(this._parent)return this._parent._createServiceInstanceWithOwner(e,t,n,r,a);throw new Error(`illegalState - creating UNKNOWN service instance ${t.name}`)}_createServiceInstance(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>4?arguments[4]:void 0;if(arguments.length>3?arguments[3]:void 0){var a=new Go(void 0,this._strict,this,this._enableTracing);a._globalGraphImplicitDependency=String(e);var i=new Map,o=new tr((()=>{var e,o=a._createInstance(t,n,r),s=c(i);try{for(s.s();!(e=s.n()).done;){var d=l(e.value,2),u=d[0],h=d[1],v=o[u];if("function"==typeof v){var p,g=c(h);try{for(g.s();!(p=g.n()).done;){var f=p.value;v.apply(o,f)}}catch(b){g.e(b)}finally{g.f()}}}}catch(b){s.e(b)}finally{s.f()}return i.clear(),o}));return new Proxy(Object.create(null),{get(e,t){if(!o.isInitialized&&"string"==typeof t&&(t.startsWith("onDid")||t.startsWith("onWill"))){var n=i.get(t);n||(n=new er,i.set(t,n));return(e,t,r)=>Kn(n.push([e,t,r]))}if(t in e)return e[t];var r=o.value,a=r[t];return"function"!=typeof a||(a=a.bind(r),e[t]=a),a},set:(e,t,n)=>(o.value[t]=n,!0),getPrototypeOf:e=>t.prototype})}return this._createInstance(t,n,r)}_throwIfStrict(e,t){if(t&&console.warn(e),this._strict)throw new Error(e)}}class Yo{constructor(e,t){s(this,"_start",Date.now()),s(this,"_dep",[]),this.type=e,this.name=t}static traceInvocation(e,t){return e?new Yo(2,t.name||(new Error).stack.split("\n").slice(3,4).join("\n")):Yo._None}static traceCreation(e,t){return e?new Yo(1,t.name):Yo._None}branch(e,t){var n=new Yo(3,e.toString());return this._dep.push([e,t,n]),n}stop(){var e=Date.now()-this._start;Yo._totals+=e;var t=!1;var n=[`${1===this.type?"CREATE":"CALL"} ${this.name}`,`${function e(n,r){var a,i=[],o=new Array(n+1).join("\t"),s=c(r._dep);try{for(s.s();!(a=s.n()).done;){var d=l(a.value,3),u=d[0],h=d[1],v=d[2];if(h&&v){t=!0,i.push(`${o}CREATES -> ${u}`);var p=e(n+1,v);p&&i.push(p)}else i.push(`${o}uses -> ${u}`)}}catch(g){s.e(g)}finally{s.f()}return i.join("\n")}(1,this)}`,`DONE, took ${e.toFixed(2)}ms (grand total ${Yo._totals.toFixed(2)}ms)`];(e>2||t)&&Yo.all.add(n.join("\n"))}}s(Yo,"all",new Set),s(Yo,"_None",new class extends Yo{constructor(){super(0,null)}stop(){}branch(){return this}}),s(Yo,"_totals",0);var Xo=()=>{var e,t=new Ko,n=c(Dn);try{for(n.s();!(e=n.n()).done;){var r=l(e.value,2),a=r[0],i=r[1];t.set(a,i)}}catch(o){n.e(o)}finally{n.f()}return new Go(t,!0)};function qo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.onSwipe,n=e.onSwipeEnd,r=e.onSwipeStart,a=F({x:0,y:0}),i=F({x:0,y:0}),o=Y(!1),s=Y(!1),l=X((()=>i.x-a.x)),c=X((()=>i.y-a.y)),d=e=>{i.x=e.x,i.y=e.y},u=ci({"mouse:down":e=>{var t;e.e instanceof TouchEvent&&1!==e.e.touches.length||(s.value=!0,t=e.absolutePointer,a.x=t.x,a.y=t.y,d(e.absolutePointer),null==r||r(e))},"mouse:move":e=>{s.value&&(e.e instanceof TouchEvent&&1!==e.e.touches.length||(d(e.absolutePointer),o.value=!0,null==t||t(e)))},"mouse:up":e=>{o.value&&(null==n||n(e)),s.value=!1,o.value=!1}});return vt(u),{isSwiping:o,coordsStart:a,coordsEnd:i,lengthX:l,lengthY:c,stop:u}}var Jo=Object.defineProperty,Zo=Object.getOwnPropertyDescriptor,Qo=(e,t)=>(n,r)=>t(n,r,e),es=class extends Wn{constructor(e,t,n){super(),s(this,"space",bt().space),s(this,"options",{move:{defaultCursor:"default",skipTargetFind:!1,selection:!0},handMove:{defaultCursor:"grab",skipTargetFind:!0,selection:!1},shape:{defaultCursor:"crosshair",skipTargetFind:!0,selection:!1}}),s(this,"toolStop",void 0),s(this,"_handMoveActivate",!1),this.canvas=e,this.keybinding=t,this.eventbus=n,ya().activeTool="move",this.initWatch(),this.initHandMove(),this.initKeybinding()}applyOption(e){var t,n;e=null!==(t=e)&&void 0!==t?t:De(ya()).activeTool.value;var r=null!==(n=this.options[e])&&void 0!==n?n:this.options.shape,a=r.defaultCursor,i=r.skipTargetFind,o=r.selection;this.canvas.defaultCursor=a,this.canvas.setCursor(a),this.canvas.skipTargetFind=i,this.canvas.selection=o}initWatch(){var e=De(ya()).activeTool;xe(e,((e,t)=>{this.toolStop&&(this.toolStop(),this.toolStop=void 0),"handMove"===t&&(this.handMoveActivate=!1),this.applyOption(),"handMove"===e?this.handMoveActivate=!0:["board","rect","ellipse","triangle","text"].includes(e)?this.switchShape(e):"vector"===e&&this.switchVector()}))}switchShape(e){var t,n,r=this.canvas,a=qo({onSwipeStart:a=>{if(1===a.button&&!this.space.value){switch(o.value=!0,t=a.pointer,e){case"board":n=new yn([],{fill:""});break;case"rect":n=new h({});break;case"ellipse":n=new _({rx:50,ry:50});break;case"triangle":n=new M({});break;case"text":n=new jn("",{})}n.set({left:t.x,top:t.y,width:100,height:100,scaleX:.01,scaleY:.01,hideOnLayer:!0}),n.noEventObjectAdded=!0,(this.canvas._searchPossibleTargets(this.canvas.getObjects("Board"),a.absolutePointer)||r).add(n),n.noEventObjectAdded=!1,r.setActiveObject(n),n.__corner="br",r._setupCurrentTransform(a.e,n,!0)}},onSwipeEnd:e=>{n&&(n.scaleX<=.01&&n.scaleY<=.01&&n.set({left:n.left-50,top:n.top-50,scaleX:1,scaleY:1}),n.set({width:n.getScaledWidth(),height:n.getScaledHeight(),scaleX:1,scaleY:1,hideOnLayer:!1}),n instanceof yn?n.set({fill:"#ffffff"}):n instanceof _?n.set({rx:n.width/2,ry:n.height/2}):n instanceof jn&&(n.set({text:"输入文本"}),r.defaultCursor="default",n.enterEditing(e.e),n.selectAll()),n.group||r._onObjectAdded(n),r.fire("selection:updated"),r.requestRenderAll(),n=void 0,ya().activeTool="move")}}),i=a.stop,o=a.isSwiping;this.toolStop=i}switchVector(){var e,t=new j([],{fill:"",stroke:"#979797",strokeWidth:1,padding:2}),n=!1,r=void 0,a=!1,i=qo({onSwipeStart:i=>{if(1===(e=i.button)){var o=i.pointer;if(!n)return n=!0,t.path.push(["M",o.x,o.y]),t.setBoundingBox(!0),this.canvas.add(t),void t.setCoords();var s=t.path[t.path.length-1];if(a&&"C"===s[0]){var l=go(new y(s[5],s[6]),new y(s[1],s[2]));r=["C",l.x,l.y,o.x,o.y,o.x,o.y]}else r=["L",o.x,o.y];t.path.push(r),t.setBoundingBox(!0),t.setCoords(),t._set("dirty",!0),this.canvas.requestRenderAll(),a=!1}},onSwipe:()=>{1===e&&r&&"M"!==r[0]&&(t.path.pop(),"L"===r[0]?t.path.push(["C",r[1]-s.value,r[2]-l.value,r[1],r[2],r[1],r[2]]):t.path.push(["C",r[1]-s.value,r[2]-l.value,r[3]-s.value,r[4]-l.value,r[5],r[6]]),t.setBoundingBox(!0),t._set("dirty",!0),this.canvas.requestRenderAll(),a=!0)},onSwipeEnd:()=>{r=void 0,e=void 0}}),o=i.stop,s=i.lengthX,l=i.lengthY;this.toolStop=()=>{t.setCoords(),o()}}get handMoveActivate(){return this._handMoveActivate}set handMoveActivate(e){this._handMoveActivate=e,this.eventbus.emit("setEdgeMoveStatus",!e)}initHandMove(){var e=this.canvas,t=De(ya()).activeTool,n=!1,r=e.viewportTransform,a=qo({onSwipeStart:n=>{(2===n.button||this.space.value&&1===n.button||"handMove"===t.value)&&(s.value=!0,r=e.viewportTransform,this.handMoveActivate=!0,this.applyOption("handMove"),e.setCursor("grabbing"))},onSwipe:()=>{this.handMoveActivate&&(e.setCursor("grabbing"),requestAnimationFrame((()=>{var t=new y(i.value,o.value).scalarDivide(e.getZoom()).transform(r).scalarMultiply(-1);e.absolutePan(t,!0),n=!0})))},onSwipeEnd:()=>{this.handMoveActivate&&(this.space.value?this.applyOption("handMove"):this.applyOption(),"handMove"===t.value||this.space.value||(this.handMoveActivate=!1),n&&(e.setViewportTransform(e.viewportTransform),n=!1))}}),i=a.lengthX,o=a.lengthY,s=a.isSwiping,l=Zt(),c=X((()=>{var e,t;return"INPUT"!==(null===(e=l.value)||void 0===e?void 0:e.tagName)&&"TEXTAREA"!==(null===(t=l.value)||void 0===t?void 0:t.tagName)}));xe(X((()=>[this.space.value,c.value].every((e=>Qt(e))))),(e=>{s.value||(this.handMoveActivate=e,e?this.applyOption("handMove"):this.applyOption())}))}initKeybinding(){var e=De(ya()).activeTool;this.keybinding.bind({v:()=>e.value="move",h:()=>e.value="handMove",r:()=>e.value="rect",o:()=>e.value="ellipse",t:()=>e.value="text",esc:()=>{"move"!==e.value?e.value="move":(this.canvas.discardActiveObject(),this.canvas.requestRenderAll())}})}};es=((e,t,n,r)=>{for(var a,i=r>1?void 0:r?Zo(t,n):t,o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r?a(t,n,i):a(i))||i);return r&&i&&Jo(t,n,i),i})([Qo(0,hr),Qo(1,fr),Qo(2,$n)],es);class ts{constructor(e,t,n,r){s(this,"_handler",void 0),s(this,"_node",void 0),s(this,"_type",void 0),s(this,"_options",void 0),this._node=e,this._type=t,this._handler=n,this._options=r||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}}var ns=Object.defineProperty,rs=Object.getOwnPropertyDescriptor,as=class extends Wn{constructor(e){var t,n;super(),s(this,"canvasEvents",void 0),s(this,"lineWidth",2),s(this,"hoveredTarget",void 0),this.canvas=e,this.canvasEvents={"mouse:out":this.drawBorder.bind(this),"mouse:over":this.clearBorder.bind(this)},e.on(this.canvasEvents),this._register((t=this.canvas.upperCanvasEl,new ts(t,"mouseout",(()=>{this.canvas.contextTopDirty&&this.hoveredTarget&&(this.clearContextTop(this.hoveredTarget.group||this.hoveredTarget),this.hoveredTarget=void 0)}),n)))}clearContextTop(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.canvas.contextTop;n.save(),n.transform(...this.canvas.viewportTransform),e.transform(n);var r=e.strokeWidth,a=e.scaleX,i=e.scaleY,o=e.strokeUniform,s=this.canvas.getZoom(),l=e.width+4/s+(o?r/a:r),c=e.height+4/s+(o?r/i:r);return n.clearRect(-l/2,-c/2,l,c),t||n.restore(),n}clearBorder(e){var t=e.target;this.hoveredTarget=void 0,t&&t!==this.canvas._activeObject&&this.canvas.contextTopDirty&&this.clearContextTop(t)}drawBorder(e){var t=e.target;if(t&&!xn.isBoard(t)&&t!==this.canvas._activeObject){this.hoveredTarget=t;var n=this.clearContextTop(t,!0);if(n){var r=k.clone(t);if(r instanceof jn)return r.underline=!0,r.fill="rgb(60,126,255)",r._renderTextDecoration(n,"underline"),r._drawClipPath(n,r.clipPath),n.restore(),void(this.canvas.contextTopDirty=!0);xn.isCollection(r)&&(r._render=h.prototype._render);var a=r.strokeWidth,i=r.strokeUniform,o=r.width,s=r.height;o+=i?a/r.scaleX:a,s+=i?a/r.scaleY:a;var l=r.getTotalObjectScaling(),c=Math.min(this.lineWidth,o*l.x,s*l.y);o-=c/l.x,s-=c/l.y,r.set({width:o,height:s,stroke:"rgb(60,126,255)",strokeWidth:c,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4}),r._renderPaintInOrder=()=>{n.save();var e=r.getTotalObjectScaling();n.scale(1/e.x,1/e.y),r._setLineDash(n,r.strokeDashArray),r._setStrokeStyles(n,r),n.stroke(),n.restore()},r._render(n),n.restore(),this.canvas.contextTopDirty=!0}}}dispose(){super.dispose(),this.canvas.off(this.canvasEvents)}};as=((e,t,n,r)=>{for(var a,i=r>1?void 0:r?rs(t,n):t,o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r?a(t,n,i):a(i))||i);return r&&i&&ns(t,n,i),i})([((e,t)=>(n,r)=>t(n,r,e))(0,hr)],as);var is=Object.defineProperty,os=Object.getOwnPropertyDescriptor,ss=(e,t)=>(n,r)=>t(n,r,e),ls=class extends Wn{constructor(e,t){super(),s(this,"edgeMoveStatus",!0),s(this,"setCoords",k.debounce((()=>{var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1,this.canvas.setViewportTransform(this.canvas.viewportTransform),this.canvas.renderOnAddRemove=e}),150)),this.canvas=e,this.eventbus=t,this.initWhellScroll(),this.initEdgeMove()}initWhellScroll(){var e=bt(),t=e.ctrl,n=e.cmd,r=e.shift,a=e=>{e.e.preventDefault(),e.e.stopPropagation();var a=e.e,i=a.deltaX,o=a.deltaY,s=a.offsetX,l=a.offsetY;if(t.value||n.value){var c=Math.abs(o)<10?2*o:o/3,d=this.canvas.getZoom()*(1-c/200);return d>.97&&d<1.03&&(d=1),this.canvas.zoomToPoint(new y(s,l),d,!0),void this.setCoords()}var u=new y;r.value?u.x=i>0?-20:20:u.y=o>0?-20:20,this.canvas.relativePan(u,!0),this.setCoords()};this.canvas.on("mouse:wheel",a),this._register(Kn((()=>{this.canvas.off("mouse:wheel",a)})))}initEdgeMove(){var e,t=!1,n=en((()=>{if(e){var n=new y(24,24),r=new y(this.canvas.width,this.canvas.height).subtract(n),a=l(this.judgePosition(e.absolutePointer,n,r),2),i=a[0],o=a[1];if(0!==i){var s=new y,c=Math.min(o,20);1&i&&(s.x=c),2&i&&(s.x=-c),4&i&&(s.y=c),8&i&&(s.y=-c),0!==s.x&&0!==s.y&&(s=s.scalarDivide(1.5)),this.canvas.relativePan(s,!0),this.canvas._onMouseMove(e.e),t=!0}}}),16,{immediate:!1}),r=n.pause,a=n.resume,i=qo({onSwipeStart:()=>{this.edgeMoveStatus&&(i.value=!0,a())},onSwipe:t=>{this.edgeMoveStatus&&(e=t)},onSwipeEnd:()=>{r(),e=void 0,t&&(this.setCoords(),t=!1)}}).isSwiping;this.eventbus.on("setEdgeMoveStatus",(e=>{this.edgeMoveStatus=e}))}judgePosition(e,t,n){var r=0,a=0;return e.x<t.x?(r|=1,a+=t.x-e.x):e.x>n.x&&(r|=2,a+=e.x-n.x),e.y<t.y?(r|=4,a+=t.y-e.y):e.y>n.y&&(r|=8,a+=e.y-n.y),[r,a]}};ls=((e,t,n,r)=>{for(var a,i=r>1?void 0:r?os(t,n):t,o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r?a(t,n,i):a(i))||i);return r&&i&&is(t,n,i),i})([ss(0,hr),ss(1,$n)],ls);var cs=En("clipboardService");Bn(cs,class{constructor(){s(this,"memoryBlob",void 0)}readMemoryBlob(){var e=this;return r(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.memoryBlob);case 1:case"end":return t.stop()}}),t)})))()}writeMemoryBlob(e){var t=this;return r(a().mark((function n(){return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t.memoryBlob=e;case 1:case"end":return n.stop()}}),n)})))()}writeBlob(e){var t=this;return r(a().mark((function n(){return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,t.writeMemoryBlob([e]),n.next=4,navigator.clipboard.write([new ClipboardItem({[e.type]:e})]);case 4:return n.abrupt("return",n.sent);case 7:n.prev=7,n.t0=n.catch(0),console.error(n.t0);case 10:case"end":return n.stop()}}),n,null,[[0,7]])})))()}readBlob(){var e=this;return r(a().mark((function t(){var n,r,i,o,s,l,d,u;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.clipboard.read();case 3:n=t.sent,r=[],i=c(n),t.prev=6,i.s();case 8:if((o=i.n()).done){t.next=32;break}s=o.value,l=c(s.types),t.prev=11,l.s();case 13:if((d=l.n()).done){t.next=22;break}return u=d.value,t.t0=r,t.next=18,s.getType(u);case 18:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 20:t.next=13;break;case 22:t.next=27;break;case 24:t.prev=24,t.t2=t.catch(11),l.e(t.t2);case 27:return t.prev=27,l.f(),t.finish(27);case 30:t.next=8;break;case 32:t.next=37;break;case 34:t.prev=34,t.t3=t.catch(6),i.e(t.t3);case 37:return t.prev=37,i.f(),t.finish(37);case 40:return t.abrupt("return",r);case 43:return t.prev=43,t.t4=t.catch(0),console.error(t.t4),t.next=48,e.readMemoryBlob();case 48:return t.abrupt("return",t.sent);case 49:case"end":return t.stop()}}),t,null,[[0,43],[6,34,37,40],[11,24,27,30]])})))()}writeText(e){return r(a().mark((function t(){var n,r,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,navigator.clipboard.writeText(e);case 3:return t.abrupt("return",t.sent);case 6:t.prev=6,t.t0=t.catch(0),console.error(t.t0);case 9:return n=document.activeElement,(r=document.createElement("textarea")).setAttribute("aria-hidden","true"),(i=document.body.appendChild(r)).style.height="1px",i.style.width="1px",i.style.position="absolute",i.value=e,i.focus(),i.select(),document.execCommand("copy"),n instanceof HTMLElement&&n.focus(),document.body.removeChild(i),t.abrupt("return");case 23:case"end":return t.stop()}}),t,null,[[0,6]])})))()}readText(){return r(a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.readText();case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return","");case 10:case"end":return e.stop()}}),e,null,[[0,6]])})))()}},Ln.Eager);var ds=function(){var e=r(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof Blob)){e.next=5;break}return n=new Image,e.abrupt("return",new Promise(((e,r)=>{n.onload=()=>{var t=document.createElement("canvas"),a=t.getContext("2d");a?(t.width=n.width,t.height=n.height,a.drawImage(n,0,0,t.width,t.height),e(a)):r()},n.onerror=()=>{r()},n.src=URL.createObjectURL(t)})));case 5:if(!(t instanceof CanvasRenderingContext2D)){e.next=9;break}return e.abrupt("return",t);case 9:if(!(t instanceof HTMLCanvasElement)){e.next=11;break}return e.abrupt("return",t.getContext("2d"));case 11:throw Error("toContext: bad img type");case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),us=e=>{if(e instanceof Uint8Array||e instanceof Uint8ClampedArray)return e;if(k.isNumber(e)||k.isString(e))return k.isNumber(e)&&(e=String.fromCharCode(e)),(new TextEncoder).encode(e);throw Error("toUint8Array: bad msg type")},hs=e=>[e>>vs[0].shift,e>>vs[1].shift&vs[1].msgMask,e&vs[2].msgMask],vs=[{shift:5,msgMask:7,dataMask:248},{shift:3,msgMask:3,dataMask:252},{shift:0,msgMask:7,dataMask:248}],ps=(e,t,n)=>{var r=t*n;if(r<e.length)throw Error(`encode: image size < msg.length: ${r} ${e.length}`)},gs=e=>{for(var t=3;t<e.length;t+=4)if(254===e[t])return(t-3)/4;throw Error(`decode: no message terminator in image data, length = ${e.length}`)};function fs(e,t){return bs.apply(this,arguments)}function bs(){return bs=r(a().mark((function e(t,n){var r,i,o,s,c,d,u,h;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ds(t);case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return");case 6:return i=r.canvas,o=i.width,s=i.height,ps(n,o,s),c=us(n),d=r.getImageData(0,0,o,s),u=d.data,c.forEach(((e,t)=>{var n=l(hs(e),3),r=n[0],a=n[1],i=n[2];u[h=4*t]=(u[h++]&vs[0].dataMask)+r,u[h]=(u[h++]&vs[1].dataMask)+a,u[h]=(u[h++]&vs[2].dataMask)+i,u[h]=255})),h&&(u[h+4]=254),r.putImageData(d,0,0),e.abrupt("return",r);case 17:return e.prev=17,e.t0=e.catch(0),e.abrupt("return");case 20:case"end":return e.stop()}}),e,null,[[0,17]])}))),bs.apply(this,arguments)}function ms(e,t){return ys.apply(this,arguments)}function ys(){return ys=r(a().mark((function e(t,n){var r,i,o,s,l,c,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ds(t);case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return");case 6:if(i=r.canvas,o=i.width,s=i.height,l=r.getImageData(0,0,o,s).data,c=gs(l),(d=new Uint8Array(c)).forEach(((e,t)=>{var n=4*t,r=(vs[0].msgMask&l[n++])<<vs[0].shift,a=(vs[1].msgMask&l[n++])<<vs[1].shift,i=(vs[2].msgMask&l[n++])<<vs[2].shift;d[t]=r+a+i})),!n){e.next=13;break}return e.abrupt("return",d);case 13:return e.abrupt("return",(new TextDecoder).decode(d));case 16:return e.prev=16,e.t0=e.catch(0),e.abrupt("return");case 19:case"end":return e.stop()}}),e,null,[[0,16]])}))),ys.apply(this,arguments)}var xs=Object.defineProperty,ks=Object.getOwnPropertyDescriptor,ws=(e,t)=>(n,r)=>t(n,r,e),Cs=class extends Wn{constructor(e,t,n,r){super(),s(this,"canvasEvents",void 0),s(this,"pointer",new y),this.canvas=e,this.keybinding=t,this.clipboard=n,this.undoRedo=r,t.bind({"mod+x":this.clip.bind(this),"mod+c":this.copy.bind(this),"mod+v":this.paste.bind(this,!1),"mod+shift+v":this.paste.bind(this,!0)}),this.canvasEvents={"mouse:move":this.updatePointer.bind(this)},e.on(this.canvasEvents)}updatePointer(e){this.pointer=e.pointer}copy(){var e=this;return r(a().mark((function t(){var n,r,i,o,s,l,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.canvas.getActiveObject()){t.next=3;break}return t.abrupt("return");case 3:return r=k.clone(n),i=r.toCanvasElement(),(o=r.getParent(!0))&&(null==o||o.exitGroup(r)),s=JSON.stringify(r.toObject()),t.next=10,fs(i,s);case 10:if(l=t.sent){t.next=13;break}return t.abrupt("return");case 13:(c=e.dataURLtoBlob(l.canvas.toDataURL()))&&e.clipboard.writeBlob(c);case 15:case"end":return t.stop()}}),t)})))()}readText(e){var t=this;return r(a().mark((function n(){var r,i,o;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.text();case 2:if(r=n.sent){n.next=5;break}return n.abrupt("return");case 5:i=t.canvas.getVpCenter(),(o=new jn(r,{width:550})).width=k.clamp(o.calcTextWidth(),50,500),o.height=o.calcTextHeight(),o.left=i.x-o.width/2,o.top=i.y-o.height/2,t.canvas.add(o);case 12:case"end":return n.stop()}}),n)})))()}readImage(e){var t=this;return r(a().mark((function n(){var r;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=t.canvas.getVpCenter(),xn.loadImage(URL.createObjectURL(e)).then((e=>{t.canvas.add(new h({width:e.width,height:e.height,left:r.x-e.width/2,top:r.y-e.height/2,fill:new f({source:e})}))}));case 2:case"end":return n.stop()}}),n)})))()}paste(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.clipboard.readBlob().then((n=>{n&&n.forEach(function(){var n=r(a().mark((function n(r){var i,o,s,l,c;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("text/plain"!==r.type){n.next=3;break}return e.readText(r),n.abrupt("return");case 3:return n.next=5,ms(r);case 5:if(i=n.sent)try{o=JSON.parse(i)}catch(a){}if(o){n.next=10;break}return["image/png","image/jpeg"].includes(r.type)&&e.readImage(r),n.abrupt("return");case 10:s=!0,l=t=>{t.forEach((t=>{s&&(t.set("canvas",e.canvas),t.isOnScreen()&&(s=!1),t.set("canvas",void 0)),t.id=Mn(),xn.isCollection(t)&&l(t._objects)}))},c=t=>{var n=e.canvas.getActiveObject();(!xn.isCollection(n)||n instanceof p?e.canvas:n).add(...t)},xn.enlivenObjects([o],{reviver:(e,t)=>{xn.isCollection(t)&&l(t._objects),l([t])}}).then((n=>{var r=n.flatMap((n=>{if(t){var r,a=(null===(r=Or.editor.contextMenu)||void 0===r?void 0:r.pointer)||e.pointer,i=a.x,o=a.y;n.left=i,n.top=o}else if(s){var l=n.translateToOriginPoint(e.canvas.getVpCenter(),"left","top"),c=l.x,d=l.y;n.left=c,n.top=d}return n instanceof p?n.removeAll().reverse():[n]}));t&&(Or.editor.contextMenu.pointer=void 0),c(r),e.canvas.setActiveObjects(r),e.canvas.requestRenderAll(),e.undoRedo.saveState()}));case 14:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}))}clip(){this.copy(),this.keybinding.trigger("del")}dataURLtoBlob(e){var t=e.split(",");if(t&&!(t.length<1)){var n=t[0].match(/:(.*?);/);if(n&&!(n.length<2)){for(var r=n[1],a=window.atob(t[1]),i=a.length,o=new Uint8Array(i);i--;)o[i]=a.charCodeAt(i);return new Blob([o],{type:r})}}}dispose(){super.dispose(),this.keybinding.unbind(["mod+x","mod+c","mod+v","mod+shift+v"]),this.canvas.off(this.canvasEvents)}};Cs=((e,t,n,r)=>{for(var a,i=r>1?void 0:r?ks(t,n):t,o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r?a(t,n,i):a(i))||i);return r&&i&&xs(t,n,i),i})([ws(0,hr),ws(1,fr),ws(2,cs),ws(3,Cr)],Cs);var Ss=Object.defineProperty,_s=Object.getOwnPropertyDescriptor,Os=(e,t)=>(n,r)=>t(n,r,e),js=class extends Wn{constructor(e,t,n,r){super(),this.canvas=e,this.keybinding=t,this.eventbus=n,this.undoRedo=r,this.keybinding.bind(["del","backspace"],(()=>{var t=e.getActiveObjects();if(0!==t.length)return this.deleteLayer(t),e.discardActiveObject(),e.requestRenderAll(),this.undoRedo.saveState(),!1})),this.keybinding.bind("[",(()=>{if(e.getActiveObject())return this.objForEach((e=>{e.getParent().sendObjectToBack(e)}),!0),e.requestRenderAll(),this.undoRedo.saveState(),!1})),this.keybinding.bind("]",(()=>{if(e.getActiveObjects())return this.objForEach((e=>{e.getParent().bringObjectToFront(e)})),e.requestRenderAll(),this.undoRedo.saveState(),!1})),this.keybinding.bind("mod+[",(()=>{var t=e.getActiveObject();if(t){var n=xn.isActiveSelection(t);return this.objForEach((e=>{var r=e.getParent();n&&r._objects.indexOf(e)===t._objects.indexOf(e)||r.sendObjectBackwards(e)})),e.requestRenderAll(),this.undoRedo.saveState(),!1}})),this.keybinding.bind("mod+]",(()=>{var t=e.getActiveObject();if(t){var n=xn.isActiveSelection(t);return this.objForEach((e=>{var r=e.getParent();n&&r._objects.indexOf(e)+t._objects.length===t._objects.indexOf(e)+r._objects.length||r.bringObjectForward(e)}),!0),e.requestRenderAll(),this.undoRedo.saveState(),!1}})),this.keybinding.bind(gn,(()=>{var t=e.getActiveObjects();if(0!==t.length){var n=t[0].getParent(),r=n._objects.indexOf(t[0]);e.discardActiveObject();var a=new kn(this.deleteLayer(t.filter(((e,t,n)=>{if(e instanceof yn)return!1;var r=e.getParent(!0);return!r||!n.includes(r)})).reverse()));return n.insertAt(r,a),e.setActiveObject(a),this.undoRedo.saveState(),!1}})),this.keybinding.bind(fn,(()=>{var t=e.getActiveObject();if(t&&xn.isCollection(t)){var n=t.getParent(),r=n._objects.indexOf(t),a=t.removeAll();return n.insertAt(r,...a),e.setActiveObjects(a.reverse()),this.undoRedo.saveState(),!1}})),this.keybinding.bind("mod+a",(()=>{var t=e.getActiveObject(),n=(null==t?void 0:t.getParent())||e;return e.setActiveObjects(n.getObjects().reverse()),e.requestRenderAll(),!1})),this.keybinding.bind("mod+shift+h",(()=>(this.objForEach((e=>{var t;e.visible=!e.visible,null===(t=e.getParent(!0))||void 0===t||t.setDirty()})),e.requestRenderAll(),this.undoRedo.saveState(),!1))),this.keybinding.bind("mod+shift+l",(()=>(this.objForEach((e=>{e.evented=!e.evented,e.hasControls=e.evented,e.selectable=e.evented})),e.requestRenderAll(),this.undoRedo.saveState(),!1)));var a=t=>{var n=e.getActiveObject();if(n)return n.set("opacity",t),e.requestRenderAll(),this.undoRedo.saveState(),!1};this.keybinding.bind({0:a.bind(this,1),1:a.bind(this,.1),2:a.bind(this,.2),3:a.bind(this,.3),4:a.bind(this,.4),5:a.bind(this,.5),6:a.bind(this,.6),7:a.bind(this,.7),8:a.bind(this,.8),9:a.bind(this,.9)}),this.keybinding.bind("mod+r",(()=>{var t=e.getActiveObject();if(t)return n.emit("layerRename",{id:t.id}),!1})),this.keybinding.bind("shift+h",(()=>{var t=e.getActiveObjects();if(0!==t.length)return t.forEach((e=>{e.flipX=!e.flipX})),e.requestRenderAll(),this.undoRedo.saveState(),!1})),this.keybinding.bind("shift+v",(()=>{var t=e.getActiveObjects();if(0!==t.length)return t.forEach((e=>{e.flipY=!e.flipY})),e.requestRenderAll(),this.undoRedo.saveState(),!1})),this.bindAlign(),this.bindArrow()}bindArrow(){var e=e=>{var t=this.canvas.getActiveObject();if(t){var n=e.shiftKey?10:1,r=t.top,a=t.left;switch(e.key){case"ArrowUp":t.top=r-n;break;case"ArrowRight":t.left=a+n;break;case"ArrowDown":t.top=r+n;break;case"ArrowLeft":t.left=a-n}return this.canvas.requestRenderAll(),!1}},t=e=>{var t=this.canvas.getActiveObject();if(t){var n=e.shiftKey?10:1;switch(e.key){case"ArrowUp":t.setHeight(t.getHeight()-n);break;case"ArrowRight":t.setWidth(t.getWidth()+n);break;case"ArrowDown":t.setHeight(t.getHeight()+n);break;case"ArrowLeft":t.setWidth(t.getWidth()-n)}return this.canvas.requestRenderAll(),!1}};this.keybinding.bind({up:e,right:e,down:e,left:e,"shift+up":e,"shift+right":e,"shift+down":e,"shift+left":e,"mod+up":t,"mod+right":t,"mod+down":t,"mod+left":t,"shift+mod+up":t,"shift+mod+right":t,"shift+mod+down":t,"shift+mod+left":t})}bindAlign(){var e=e=>{var t=this.canvas.getActiveObject();if(t)return t[e](),this.undoRedo.saveState(),!1};this.keybinding.bind({"alt+a":e.bind(this,"alignLeft"),"alt+d":e.bind(this,"alignRight"),"alt+h":e.bind(this,"alignCenter"),"alt+w":e.bind(this,"verticalTop"),"alt+s":e.bind(this,"verticalBottom"),"alt+v":e.bind(this,"verticalMiddle")})}objForEach(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.canvas.getActiveObjects();t&&n.reverse();for(var r=n.length-1,a=r;a>=0;a--)e(n[r-a])}deleteLayer(e){return e.flatMap((e=>e.getParent().remove(e)))}};js=((e,t,n,r)=>{for(var a,i=r>1?void 0:r?_s(t,n):t,o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r?a(t,n,i):a(i))||i);return r&&i&&Ss(t,n,i),i})([Os(0,hr),Os(1,fr),Os(2,$n),Os(3,Cr)],js);var As=Object.defineProperty,Ms=Object.getOwnPropertyDescriptor,Ps=(e,t)=>(n,r)=>t(n,r,e),Is=class extends Wn{constructor(e,t){super(),s(this,"canvasEvents",void 0),s(this,"options",void 0),s(this,"objectRect",void 0),this.canvas=e,this.keybinding=t,this.options=Object.assign({ruleSize:24,fontSize:10,enabled:!0});var n=ca().isDark;W((()=>{this.options=o(o({},this.options),n.value?{backgroundColor:"#242424",borderColor:"#555",highlightColor:"#165dff3b",textColor:"#ddd"}:{backgroundColor:"#fff",borderColor:"#ccc",highlightColor:"#165dff3b",textColor:"#444"}),this.render({ctx:this.canvas.contextContainer})})),this.canvasEvents={"after:render":this.render.bind(this)},this.keybinding.bind("shift+r",(()=>{this.enabled=!this.enabled})),this.enabled=this.options.enabled}get enabled(){return this.options.enabled}set enabled(e){this.options.enabled=e,e?(this.canvas.on(this.canvasEvents),this.render({ctx:this.canvas.contextContainer})):(this.canvas.off(this.canvasEvents),this.canvas.requestRenderAll())}getSize(){return{width:this.canvas.width,height:this.canvas.height}}render(e){var t=e.ctx;if(t===this.canvas.contextContainer){var n=this.canvas.viewportTransform;this.calcObjectRect(),this.draw({ctx:t,isHorizontal:!0,rulerLength:this.getSize().width,startCalibration:-n[4]/n[0]}),this.draw({ctx:t,isHorizontal:!1,rulerLength:this.getSize().height,startCalibration:-n[5]/n[3]});var r=this.options,a=r.borderColor,i=r.backgroundColor,o=r.ruleSize,s=r.textColor;this.darwRect(t,{left:0,top:0,width:o,height:o,fill:i,stroke:a}),this.darwText(t,{text:"px",left:o/2,top:o/2,align:"center",baseline:"middle",fill:s})}}draw(e){var t=e.ctx,n=e.isHorizontal,r=e.rulerLength,a=e.startCalibration,i=this.canvas.getZoom(),o=this.getGap(i),s=Math.ceil(r/i),c=Math.floor(a/o)*o,d=c-a,u=this.getSize(),h=this.options,v=h.textColor,p=h.borderColor,g=h.ruleSize,f=h.highlightColor;this.darwRect(t,{left:0,top:0,width:n?u.width:g,height:n?g:u.height,fill:this.options.backgroundColor,stroke:this.options.borderColor});for(var b=0;b+d<=s;b+=o)for(var m=0;m<10;m++){var y=Math.round((d+b+o*m/10)*i),x=0===m,k=l(n?[y,x?0:g-8]:[x?0:g-8,y],2),w=k[0],C=k[1],S=l(n?[0,g-C]:[g-w,0],2),_=S[0],O=S[1];this.darwLine(t,{left:w,top:C,width:_,height:O,stroke:p})}if(this.objectRect){var j=n?"x":"y";this.objectRect[j].forEach((e=>{if(e.skip!==j){var r=l(n?[(e.left-a)*i,0,e.width*i,g]:[0,(e.top-a)*i,g,e.height*i],4),o=r[0],s=r[1],c=r[2],d=r[3];this.darwRect(t,{left:o,top:s,width:c,height:d,fill:f})}}))}for(var A=0;A+d<=s;A+=o){var M=(d+A)*i,P=(c+A).toString(),I=l(n?[M+6,2.5,0]:[2.5,M-6,-90],3),T=I[0],E=I[1],R=I[2];this.darwText(t,{text:P,left:T,top:E,fill:v,angle:R})}}getGap(e){for(var t=[.02,.03,.05,.1,.2,.5,1,2,5],n=0;n<t.length&&t[n]<e;)n++;return[5e3,2500,1e3,500,200,100,50,20,10][n-1]||1e4}darwRect(e,t){var n=t.left,r=t.top,a=t.width,i=t.height,o=t.fill,s=t.stroke,l=t.strokeWidth;e.save(),e.beginPath(),o&&(e.fillStyle=o),e.rect(n,r,a,i),e.fill(),s&&(e.strokeStyle=s,e.lineWidth=null!=l?l:1,e.stroke()),e.restore()}darwText(e,t){var n=t.left,r=t.top,a=t.text,i=t.fill,o=t.align,s=t.angle,l=t.fontSize,c=t.baseline;e.save(),i&&(e.fillStyle=i),e.textAlign=null!=o?o:"left",e.textBaseline=null!=c?c:"top",e.font=`${null!=l?l:12}px Helvetica`,s&&(e.translate(n,r),e.rotate(pn*s),e.translate(-n,-r)),e.fillText(a,n,r),e.restore()}darwLine(e,t){var n=t.left,r=t.top,a=t.width,i=t.height,o=t.stroke,s=t.lineWidth;e.save(),e.beginPath(),o&&(e.strokeStyle=o),e.lineWidth=null!=s?s:1,e.moveTo(n,r),e.lineTo(n+a,r+i),e.stroke(),e.restore()}calcObjectRect(){var e=this.canvas.getActiveObjects();if(0!==e.length){var t=e.reduce(((e,t)=>{var n=t.getBoundingRect(!0);return e.push(n),e}),[]);0!==t.length&&(this.objectRect={x:this.mergeLines(t,!0),y:this.mergeLines(t,!1)})}else this.objectRect=void 0}mergeLines(e,t){var n=t?"left":"top",r=t?"width":"height";e.sort(((e,t)=>e[n]-t[n]));for(var a=[],i=Object.assign({},e[0]),o=1;o<e.length;o++){var s=Object.assign({},e[o]);i[n]+i[r]>=s[n]?i[r]=Math.max(i[n]+i[r],s[n]+s[r])-i[n]:(a.push(i),i=Object.assign({},s))}return a.push(i),a}dispose(){super.dispose(),this.enabled=!1}};Is=((e,t,n,r)=>{for(var a,i=r>1?void 0:r?Ms(t,n):t,o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r?a(t,n,i):a(i))||i);return r&&i&&As(t,n,i),i})([Ps(0,hr),Ps(1,fr)],Is);var Ts=Object.defineProperty,Es=Object.getOwnPropertyDescriptor,Rs=(e,t)=>(n,r)=>t(n,r,e),Ds=class extends Wn{constructor(e,t){super(),s(this,"pointer",void 0),this.canvas=e,this.keybindingService=t,e.on("contextmenu",this.showLayerContextMenu.bind(this))}showBlankContextMenu(e){var t=e.e;this.pointer=this.canvas.getPointer(t);var n=this.keybindingService.mod;pa.showContextMenu({x:t.clientX,y:t.clientY,preserveIconWidth:!1,items:[{label:"选择全部",onClick:()=>{this.keybindingService.trigger("mod+a")},shortcut:`${n} A`},{label:"粘贴到当前位置",onClick:()=>{this.keybindingService.trigger("mod+shift+v")},shortcut:`${n} ⇧ V`},...Ca()]})}showLayerContextMenu(e){if(e.target&&this.canvas.setActiveObject(e.target),e.target||this.canvas.getActiveObject()){var t=e.e;pa.showContextMenu({x:t.clientX,y:t.clientY,preserveIconWidth:!1,items:wa()}),this.canvas.requestRenderAll()}else this.showBlankContextMenu(e)}};Ds=((e,t,n,r)=>{for(var a,i=r>1?void 0:r?Es(t,n):t,o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r?a(t,n,i):a(i))||i);return r&&i&&Ts(t,n,i),i})([Rs(0,hr),Rs(1,fr)],Ds);var Ls=Object.defineProperty,Bs=Object.getOwnPropertyDescriptor,zs=(e,t)=>(n,r)=>t(n,r,e),Ns=class extends Wn{constructor(e,t){super(),s(this,"scalePadding",.9),this.canvas=e,this.keybindingService=t,t.bind("+",(()=>{var t=e.getZoom();t=t<1&&2*t>1?1:2*t,this.zoomToPoint(t)})),t.bind("-",(()=>{var t=e.getZoom();t=t>1&&t/2<1?1:t/2,this.zoomToPoint(t)})),t.bind("mod+0",(()=>(this.zoomToPoint(1),!1))),t.bind("mod+1",(()=>(this.showAllContent(),!1))),t.bind("mod+2",(()=>(this.showSelectedContent(),!1)));var n=De(ya()).zoom;W((()=>{n.value=e.ref.zoom.value}))}zoomToPoint(e){this.canvas.zoomToPoint(this.canvas.getCenterPoint(),e)}showAllContent(){var e=this.canvas.getObjects();if(0!==e.length){var t=kn.prototype.getObjectsBoundingBox(e);if(t){var n=Math.min(this.canvas.getWidth()/t.width,this.canvas.getHeight()/t.height)*this.scalePadding;this.canvas.setZoom(n),this.canvas.absolutePan(new y(t.centerX,t.centerY).scalarMultiply(n).subtract(this.canvas.getCenterPoint()))}}else this.canvas.setViewportTransform(T)}showSelectedContent(){var e=this.canvas.getActiveObject();if(e){var t=Math.min(this.canvas.getWidth()/e.getWidth(),this.canvas.getHeight()/e.getHeight())*this.scalePadding;this.canvas.setZoom(t),this.canvas.absolutePan(e.getCenterPoint().scalarMultiply(t).subtract(this.canvas.getCenterPoint()))}}};Ns=((e,t,n,r)=>{for(var a,i=r>1?void 0:r?Bs(t,n):t,o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r?a(t,n,i):a(i))||i);return r&&i&&Ls(t,n,i),i})([zs(0,hr),zs(1,fr)],Ns);var $s=Object.defineProperty,Hs=Object.getOwnPropertyDescriptor,Vs=e=>Object.keys(e),Fs=class extends Wn{constructor(e){super(),s(this,"canvasEvents",void 0),s(this,"aligningLineMargin",10),s(this,"aligningLineWidth",1),s(this,"aligningLineColor","#F68066"),s(this,"verticalLines",[]),s(this,"horizontalLines",[]),s(this,"activeObj",void 0),s(this,"ignoreObjTypes",[]),s(this,"pickObjTypes",[]),s(this,"dirty",!1),this.canvas=e;this.canvasEvents={"before:render":this.clearGuideline.bind(this),"after:render":this.drawGuideLines.bind(this),"object:moving":this.objectMoving.bind(this),"mouse:up":()=>{(this.horizontalLines.length||this.verticalLines.length)&&(this.clearGuideline(),this.clearLinesMeta())}},e.on(this.canvasEvents)}objectMoving(e){var t=e.target;if(this.clearLinesMeta(),this.canvas._currentTransform){this.activeObj=t;var n=this.canvas.getActiveObjects(),r=[],a=e=>{var i=e.getObjects().filter((e=>this.ignoreObjTypes.length?!this.ignoreObjTypes.some((t=>e.get(t.key)===t.value)):this.pickObjTypes.length?this.pickObjTypes.some((t=>e.get(t.key)===t.value)):!n.includes(e)&&(xn.isActiveSelection(e)?(a(e),!1):!xn.isCollection(e)||!t.group||e!==t.group||(a(e),!1))));r.push(...i)};if(xn.isActiveSelection(t)){var i=new Set;t.forEachObject((e=>{var t=e.getParent();i.add(t)})),i.forEach((e=>{xn.isNativeGroup(e)&&r.push(e),a(e)}))}else{var o=t.getParent();xn.isNativeGroup(o)&&r.push(o),a(o)}this.traversAllObjects(t,r)}}clearLinesMeta(){this.verticalLines.length=this.horizontalLines.length=0}getObjDraggingObjCoords(e){var t=this.getCoords(e),n=this.calcCenterPointByACoords(t).subtract(e.getCenterPoint()),r=Vs(t).map((e=>t[e].subtract(n)));return{tl:r[0],tr:r[1],br:r[2],bl:r[3],c:e.getCenterPoint()}}getObjMaxWidthHeightByCoords(e){var t=e.c,n=e.tl,r=e.tr;return{objHeight:2*Math.max(Math.abs(t.y-n.y),Math.abs(t.y-r.y)),objWidth:2*Math.max(Math.abs(t.x-n.x),Math.abs(t.x-r.x))}}omitCoords(e,t){var n=e,r="vertical"===t?"x":"y";return Vs(e).forEach((t=>{e[t][r]<n.tl[r]&&(n[t]=e[t]),e[t][r]>n.tl[r]&&(n[t]=e[t])})),n}isInRange(e,t){return Math.abs(Math.round(e)-Math.round(t))<=this.aligningLineMargin/this.canvas.getZoom()}getCoords(e){var t=l(e.getCoords(!0),4);return{tl:t[0],tr:t[1],br:t[2],bl:t[3]}}calcCenterPointByACoords(e){return new y((e.tl.x+e.br.x)/2,(e.tl.y+e.br.y)/2)}traversAllObjects(e,t){for(var n=this,r=this.getObjDraggingObjCoords(e),a=new Set,i=new Set,s=function(s){var l=o(o({},n.getCoords(t[s])),{},{c:t[s].getCenterPoint()}),c=n.getObjMaxWidthHeightByCoords(l),d=c.objHeight,u=c.objWidth;Vs(r).forEach((a=>{var c=0!==t[s].angle?n.omitCoords(l,"horizontal"):l;Vs(c).forEach((t=>{if(n.isInRange(r[a].y,l[t].y)){var s=l[t].y,c=r[a].y-s;i.add(r.c.y-c);var d=n.getCoords(e),h=function(e,t){var n,r;return"c"===e?(n=Math.min(l.c.x-u/2,t[a].x),r=Math.max(l.c.x+u/2,t[a].x)):(n=Math.min(l[e].x,t[a].x),r=Math.max(l[e].x,t[a].x)),{x1:n,x2:r}}(t,o(o({},d),{},{c:n.calcCenterPointByACoords(d)})),v=h.x1,p=h.x2;n.horizontalLines.push({y:s,x1:v,x2:p})}}))})),Vs(r).forEach((i=>{var c=0!==t[s].angle?n.omitCoords(l,"vertical"):l;Vs(c).forEach((t=>{if(n.isInRange(r[i].x,l[t].x)){var s=l[t].x,u=r[i].x-s;a.add(r.c.x-u);var h=n.getCoords(e),v=function(e,t){var n,r;return"c"===e?(n=Math.min(c.c.y-d/2,t[i].y),r=Math.max(c.c.y+d/2,t[i].y)):(n=Math.min(l[e].y,t[i].y),r=Math.max(l[e].y,t[i].y)),{y1:n,y2:r}}(t,o(o({},h),{},{c:n.calcCenterPointByACoords(h)})),p=v.y1,g=v.y2;n.verticalLines.push({x:s,y1:p,y2:g})}}))}))},l=t.length;l--;)s(l);this.snap({activeObject:e,draggingObjCoords:r,snapXPoints:a,snapYPoints:i})}snap(e){var t=e.activeObject,n=e.draggingObjCoords,r=e.snapXPoints,a=e.snapYPoints;if(0!==r.size||0!==a.size){var i=(e,t)=>0===e.size?t:[...e].sort(((e,n)=>Math.abs(t-e)-Math.abs(t-n)))[0];t.setXY(new y(i(r,n.c.x),i(a,n.c.y)),"center","center")}}drawSign(e,t){var n=this.canvas.getTopContext();n.strokeStyle=this.aligningLineColor,n.beginPath();n.moveTo(e-3,t-3),n.lineTo(e+3,t+3),n.moveTo(e+3,t-3),n.lineTo(e-3,t+3),n.stroke()}drawLine(e,t,n,r){var a=this.canvas.getTopContext(),i=xn.transformPoint(new y(e,t),this.canvas.viewportTransform),o=xn.transformPoint(new y(n,r),this.canvas.viewportTransform);a.save(),a.lineWidth=this.aligningLineWidth,a.strokeStyle=this.aligningLineColor,a.beginPath(),a.moveTo(i.x,i.y),a.lineTo(o.x,o.y),a.stroke(),this.drawSign(i.x,i.y),this.drawSign(o.x,o.y),a.restore(),this.dirty=!0}drawVerticalLine(e,t){Object.values(t).some((t=>Math.abs(t.x-e.x)<1e-4))&&this.drawLine(e.x,Math.min(e.y1,e.y2),e.x,Math.max(e.y1,e.y2))}drawHorizontalLine(e,t){Object.values(t).some((t=>Math.abs(t.y-e.y)<1e-4))&&this.drawLine(Math.min(e.x1,e.x2),e.y,Math.max(e.x1,e.x2),e.y)}drawGuideLines(e){if(e.ctx&&(this.verticalLines.length||this.horizontalLines.length)&&this.activeObj){for(var t=this.getObjDraggingObjCoords(this.activeObj),n=this.verticalLines.length;n--;)this.drawVerticalLine(this.verticalLines[n],t);for(var r=this.horizontalLines.length;r--;)this.drawHorizontalLine(this.horizontalLines[r],t)}}clearGuideline(){this.dirty&&(this.dirty=!1,this.canvas.clearContext(this.canvas.getTopContext()))}dispose(){super.dispose(),this.canvas.off(this.canvasEvents)}};Fs=((e,t,n,r)=>{for(var a,i=r>1?void 0:r?Hs(t,n):t,o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r?a(t,n,i):a(i))||i);return r&&i&&$s(t,n,i),i})([((e,t)=>(n,r)=>t(n,r,e))(0,hr)],Fs);class Ws extends Wn{constructor(){super(),s(this,"scope",void 0),this.scope=tn()}scopeRun(e){this.scope.run(e)}dispose(){var e;super.dispose(),null===(e=this.scope)||void 0===e||e.stop()}}var Ks=Object.defineProperty,Us=Object.getOwnPropertyDescriptor,Gs=class extends Ws{constructor(e){super(),s(this,"service",void 0),s(this,"pluginInstance",new Map),s(this,"contextMenu",void 0),this.instantiationService=e}startup(){super.scopeRun((()=>{this.service=this.initServices(),this.service.invokeFunction((e=>{var t=e.get(Yn);0===t.size()&&t.setCurrentId(t.add("页面 1"))})),[this.service.createInstance(Is),this.service.createInstance(js),this.service.createInstance(es),this.service.createInstance(as),this.service.createInstance(ls),this.service.createInstance(Fs),this.service.createInstance(Ns),this.contextMenu=this.service.createInstance(Ds),this.service.createInstance(Cs)].forEach((e=>{this._register(e)})),de("useEditor",jr),Vo()._p.forEach((e=>{this.use(e)}))}))}use(e){var t=e({service:this.service,use:this.use});t._id=Symbol(),this.pluginInstance.set(t._id,t),qn((()=>{var e;null===(e=t.setup)||void 0===e||e.call(t),this._register(Kn((()=>{var e;null===(e=t.dispose)||void 0===e||e.call(t),this.pluginInstance.delete(t._id)})))}))}initServices(){var e=new Ko,t=(t,n)=>{e.has(t)||e.set(t,new Rn(n))};return t($n,Nn),t(Yn,Xn),t(hr,vr),t(Cr,_r),t(fr,br),this.instantiationService.createChild(e)}dispose(){try{de("useEditor",void 0),super.dispose(),this.service.invokeFunction((e=>{e.get(fr).reset(),e.get(Cr).reset(),e.get(mr).clear(),e.get(hr).dispose(),e.get(Yn).dispose(),e.get($n).all.clear()})),this.service=void 0}catch(e){console.error(e)}}getPluginSlots(e){var t=[];return this.pluginInstance.forEach((n=>{if(n.slots){var r=n.slots[e];r&&t.push(...r)}})),t}};Gs=((e,t,n,r)=>{for(var a,i=r>1?void 0:r?Us(t,n):t,o=e.length-1;o>=0;o--)(a=e[o])&&(i=(r?a(t,n,i):a(i))||i);return r&&i&&Ks(t,n,i),i})([((e,t)=>(n,r)=>t(n,r,e))(0,Tn)],Gs);var Ys=hn(J({__name:"editor",setup(e){var t=e=>{var t=e.target||e.srcElement,n=t&&["INPUT","TEXTAREA","TEXT"].includes(t.tagName),r=n&&t.disabled;t&&n&&!r||e.preventDefault()};return nn((()=>{var e=Vo().service;Or.editor=e.createInstance(Gs),Or.editor.startup()})),ae((()=>{Or.editor.dispose(),Or.editor=null})),(e,n)=>{var r=an,a=on,i=sn,o=rn;return B(),Q("div",{onContextmenu:t},[$(o,{class:"h-screen"},{default:N((()=>[$(r,{class:"bg-$color-bg-4! b-solid b-b b-$color-neutral-3"},{default:N((()=>[$(Me(Ta))])),_:1}),$(o,{class:"flex-1 min-h-0"},{default:N((()=>[$(a,{class:"bg-$color-bg-4! z1",width:240},{default:N((()=>[$(Me(wi))])),_:1}),$(i,null,{default:N((()=>[$(Me(Ea))])),_:1}),$(a,{class:"bg-$color-bg-4!",width:240},{default:N((()=>[$(Me(Ho))])),_:1})])),_:1})])),_:1})],32)}}}),[["__scopeId","data-v-737f3112"]]);var Xs=hn({},[["render",function(e,t){var n=je;return B(),z(n,{onClick:t[0]||(t[0]=t=>e.$router.push({name:"Editor"}))},{default:N((()=>[Le(" 进入编辑器 ")])),_:1})}]]),qs=ln({history:cn(),routes:[{path:"/",name:"Home",component:Xs},{path:"/editor",name:"Editor",component:Ys}]});if("undefined"!=typeof window){function nl(){var e=document.body,t=document.getElementById("__svg__icons__dom__");t||((t=document.createElementNS("http://www.w3.org/2000/svg","svg")).style.position="absolute",t.style.width="0",t.style.height="0",t.id="__svg__icons__dom__",t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:link","http://www.w3.org/1999/xlink")),t.innerHTML='<symbol  viewBox="0 0 14 14" id="icon-artboard"><path d="M3 9.67V4.33H1.67c-.24 0-.46-.12-.58-.33a.668.668 0 0 1 0-.67c.12-.2.34-.33.58-.33H3V1.67c0-.24.13-.46.33-.58.21-.12.46-.12.67 0 .21.12.33.34.33.58V3h5.34V1.67c0-.37.3-.67.66-.67.37 0 .67.3.67.67V3h1.33c.37 0 .67.3.67.67 0 .36-.3.66-.67.66H11v5.34h1.33c.37 0 .67.3.67.66 0 .37-.3.67-.67.67H11v1.33c0 .37-.3.67-.67.67-.36 0-.66-.3-.66-.67V11H4.33v1.33c0 .37-.3.67-.66.67a.67.67 0 0 1-.67-.67V11H1.67a.67.67 0 0 1-.67-.67c0-.36.3-.66.67-.66zm6.67 0V4.33H4.33v5.34z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bx-circle"><path d="M12 2C6.486 2 2 6.486 2 12c.001 5.515 4.487 10.001 10 10.001 5.514 0 10-4.486 10.001-10.001 0-5.514-4.486-10-10.001-10zm0 18.001c-4.41 0-7.999-3.589-8-8.001 0-4.411 3.589-8 8-8 4.412 0 8.001 3.589 8.001 8-.001 4.412-3.59 8.001-8.001 8.001z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bx-horizontal-center"><path d="m5.005 15.995 4-4-4-4v3h-3v2h3zm14-5v-3l-4 4 4 4v-3h3v-2h-2.072zm-8 7h2v3h-2zm0-5h2v3h-2zm0-5h2v3h-2zm0-5h2v3h-2z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bx-pen"><path d="M18.404 2.998c-.757-.754-2.077-.751-2.828.005l-1.784 1.791L11.586 7H7a.998.998 0 0 0-.939.658l-4 11c-.133.365-.042.774.232 1.049l2 2a.997.997 0 0 0 1.049.232l11-4A.998.998 0 0 0 17 17v-4.586l2.207-2.207v-.001h.001L21 8.409c.378-.378.586-.881.585-1.415 0-.535-.209-1.038-.588-1.415l-2.593-2.581zm-3.111 8.295A.996.996 0 0 0 15 12v4.3l-9.249 3.363 4.671-4.671c.026.001.052.008.078.008A1.5 1.5 0 1 0 9 13.5c0 .026.007.052.008.078l-4.671 4.671L7.7 9H12c.266 0 .52-.105.707-.293L14.5 6.914 17.086 9.5l-1.793 1.793zm3.206-3.208-2.586-2.586 1.079-1.084 2.593 2.581-1.086 1.089z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bx-polygon"><path d="M16.707 2.293A.996.996 0 0 0 16 2H8a.996.996 0 0 0-.707.293l-5 5A.996.996 0 0 0 2 8v8c0 .266.105.52.293.707l5 5A.996.996 0 0 0 8 22h8c.266 0 .52-.105.707-.293l5-5A.996.996 0 0 0 22 16V8a.996.996 0 0 0-.293-.707l-5-5zM20 15.586 15.586 20H8.414L4 15.586V8.414L8.414 4h7.172L20 8.414v7.172z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bx-reflect-horizontal"><path d="M6 21h12l-6-6-6 6zM18 3H6l6 6 6-6zM3 11h3v2H3zm5 0h3v2H8zm5 0h3v2h-3zm5 0h3v2h-3z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bx-reflect-vertical"><path d="m3 18 6-6-6-6v12zm12-6 6 6V6l-6 6zm-4-9h2v3h-2zm0 5h2v3h-2zm0 5h2v3h-2zm0 5h2v3h-2z" /></symbol><symbol viewBox="0 0 1024 1024"  id="icon-bx-revision"><path d="M634.88 512a87.04 87.04 0 1 1-174.08 0 87.04 87.04 0 0 1 174.08 0zm-87.04 394.24A393.728 393.728 0 0 1 222.4 734.464l62.368-32.576A324.64 324.64 0 0 0 550.4 839.68c179.552 0 325.12-145.568 325.12-325.12S729.952 189.44 550.4 189.44c-159.424 0-291.968 114.784-319.68 266.208h76.448L191.936 645.12 76.704 455.648h80.96c27.36-191.04 191.584-337.888 390.176-337.888 217.728 0 394.24 176.512 394.24 394.24S765.568 906.24 547.84 906.24z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bx-square"><path d="M20 3H4a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zm-1 16H5V5h14v14z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bx-star"><path d="m6.516 14.323-1.49 6.452a.998.998 0 0 0 1.529 1.057L12 18.202l5.445 3.63a1.001 1.001 0 0 0 1.517-1.106l-1.829-6.4 4.536-4.082a1 1 0 0 0-.59-1.74l-5.701-.454-2.467-5.461a.998.998 0 0 0-1.822 0L8.622 8.05l-5.701.453a1 1 0 0 0-.619 1.713l4.214 4.107zm2.853-4.326a.998.998 0 0 0 .832-.586L12 5.43l1.799 3.981a.998.998 0 0 0 .832.586l3.972.315-3.271 2.944c-.284.256-.397.65-.293 1.018l1.253 4.385-3.736-2.491a.995.995 0 0 0-1.109 0l-3.904 2.603 1.05-4.546a1 1 0 0 0-.276-.94l-3.038-2.962 4.09-.326z" /></symbol><symbol viewBox="0 0 1024 1024"  id="icon-bx-text"><path d="M853.333 170.667H170.667A42.667 42.667 0 0 0 128 213.333v128a42.667 42.667 0 0 0 85.333 0V256h256v554.667H384A42.667 42.667 0 0 0 384 896h256a42.667 42.667 0 0 0 0-85.333h-85.333V256h256v85.333a42.667 42.667 0 0 0 85.333 0v-128a42.667 42.667 0 0 0-42.667-42.666z" /></symbol><symbol  viewBox="0 0 1024 1024" id="icon-bx-triangle"><path d="M934.4 942.08H89.6a46.72 46.72 0 0 1-40.64-23.488 49.92 49.92 0 0 1 0-46.912l422.4-732.16a46.72 46.72 0 0 1 40.704-23.488 46.72 46.72 0 0 1 40.64 23.488l422.4 732.16a49.92 49.92 0 0 1 0 46.912 46.72 46.72 0 0 1-40.64 23.488zm-763.328-93.888H853.12l-340.992-591.36-341.12 591.36z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bx-vertical-center"><path d="M13 5V2h-2v3H8l4 4 4-4zm0 17v-3h3l-4-4-4 4h3v3zM3 11h3v2H3zm5 0h3v2H8zm5 0h3v2h-3zm5 0h3v2h-3z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bxs-grid"><path d="M4 4h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4zM4 10h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4zM4 16h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4z" /></symbol><symbol  fill="none" viewBox="0 0 24 24" id="icon-bxs-hand"><path stroke-width="2" stroke="currentColor" d="M20.5 5A1.5 1.5 0 0 0 19 6.5V11h-1V4.5a1.5 1.5 0 0 0-3 0V11h-1V3.5a1.5 1.5 0 0 0-3 0V11h-1V5.5a1.5 1.5 0 0 0-3 0v10.81l-2.22-3.6a1.5 1.5 0 0 0-2.56 1.58l3.31 5.34A5 5 0 0 0 9.78 22H17a5 5 0 0 0 5-5V6.5A1.5 1.5 0 0 0 20.5 5z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bxs-objects-horizontal-center"><path d="M19 13h-6v-2h4a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-4V2h-2v3H7a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h4v2H5a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h6v3h2v-3h6a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bxs-objects-horizontal-left"><path d="M2 2h2v20H2z" /><rect x="6" y="13" width="16" height="6" rx="1" /><rect x="6" y="5" width="12" height="6" rx="1" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bxs-objects-horizontal-right"><path d="M20 2h2v20h-2z" /><rect x="2" y="13" width="16" height="6" rx="1" /><rect x="6" y="5" width="12" height="6" rx="1" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bxs-objects-vertical-bottom"><path d="M2 20h20v2H2z" /><rect x="5" y="2" width="6" height="16" rx="1" /><rect x="13" y="6" width="6" height="12" rx="1" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bxs-objects-vertical-center"><path d="M19 7a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v4h-2V5a1 1 0 0 0-1-1H6a1 1 0 0 0-1 1v6H2v2h3v6a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-6h2v4a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-4h3v-2h-3z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bxs-objects-vertical-top"><path d="M2 2h20v2H2z" /><rect x="5" y="6" width="6" height="16" rx="1" /><rect x="13" y="6" width="6" height="12" rx="1" /></symbol><symbol  fill="none" viewBox="0 0 24 24" id="icon-bxs-pointer"><path d="M20.978 13.21a1 1 0 0 0-.396-1.024l-14-10a.999.999 0 0 0-1.575.931l2 17a1 1 0 0 0 1.767.516l3.612-4.416c.505-.558.967-.86 1.721-1.02l6.089-1.218a.995.995 0 0 0 .782-.769z" stroke-width="2" stroke="currentColor" /></symbol><symbol viewBox="0 0 1024 1024"  id="icon-dropdown-more"><path d="M686.113 297.628 685.99 670.3l-371.457-.122 371.579-372.551zm0 0" /></symbol><symbol  viewBox="0 0 1024 1024" id="icon-object-group"><path d="M160 160v128h32v448h-32v128h128v-32h448v32h128V736h-32V288h32V160H736v32H288v-32zm128 96h448v32h32v448h-32v32H288v-32h-32V288h32zm32 64v256h128v128h256V448H576V320zm64 64h128v128H384zm192 128h64v128H512v-64h64z" /></symbol><symbol  viewBox="0 0 1024 1024" id="icon-object-ungroup"><path d="M160 160v128h32v320h-32v128h128v-32h64v64h-32v128h128v-32h320v32h128V768h-32V448h32V320H768v32h-64v-64h32V160H608v32H288v-32zm128 96h320v32h32v320h-32v32H288v-32h-32V288h32zm416 160h64v32h32v320h-32v32H448v-32h-32v-64h192v32h128V608h-32z" /></symbol><symbol viewBox="0 0 1024 1024"  id="icon-round"><path d="M245 855h-76V556.4c0-52.3 10.2-103 30.5-150.8 19.5-46.1 47.4-87.6 83-123.1s77-63.5 123.1-83c47.8-20.2 98.5-30.5 150.8-30.5H855v76H556.4c-83.2 0-161.4 32.4-220.2 91.2S245 473.2 245 556.4V855z" /></symbol>',e.insertBefore(t,e.lastChild)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",nl):nl()}var Js={class:"p2"},Zs=ee("div",null,"测试插件插槽",-1),Qs=J({__name:"testSlot",setup(e){var t=te("useEditor")().canvas,n=()=>{if(0!==Yo.all.size){var e,t=c(Yo.all);try{for(t.s();!(e=t.n()).done;){var n=e.value;console.log(n)}}catch(r){t.e(r)}finally{t.f()}}else console.log("Enable via `instantiationService.ts#_enableAllTracing`")};return(e,r)=>{var a,i=je;return B(),Q("div",Js,[Zs,$(i,{onClick:n,hidden:""},{default:N((()=>[Le("打印Trace")])),_:1}),(B(!0),Q(ue,null,he(null===(a=Me(t).activeObject.value)||void 0===a?void 0:a.ref,((e,t)=>(B(),Q("div",{key:t},ce(t)+": "+ce(e),1)))),128))])}}}),el=e=>{var t=l(e.service.invokeFunction((e=>[e.get(hr),e.get(Cr)])),2),n=t[0],r=t[1];return{setup(){function t(){return"#"+Math.random().toString(16).substring(2,8)}console.log("myPlugin setup"),console.log(e);var a=new yn([],{top:50,left:50,width:300,height:300}),i=new yn([],{top:400,left:50,width:800,height:800,fill:"#f2b8ca",name:"画板 1000个元素"}),o=new kn([new h({top:k.random(400,500),left:k.random(300,400),width:k.random(50,100),height:k.random(50,100),fill:t(),strokeWidth:k.random(0,10),stroke:t()}),new h({top:k.random(400,500),left:k.random(400,500),width:k.random(50,100),height:k.random(50,100),fill:t(),strokeWidth:k.random(0,10),stroke:t()})],{});n.add(o);var s=[],l=new M({top:10,left:10,width:200,height:200,fill:""});n.add(l),xn.loadImage("https://img.js.design/assets/img/6486fff21a74fef8078bf782.jpg#4d6a3f65b147c75a22effca8347bc5ce",{crossOrigin:"anonymous"}).then((e=>{l.fill=new f({crossOrigin:"anonymous",source:e,fit:"fill"}),l.set("dirty",!0),n.requestRenderAll()}));for(var c=0;c<50;c++)s.push(new h({top:k.random(100,300),left:k.random(400,800),width:k.random(50,100),height:k.random(50,100),fill:new g({type:"linear",coords:{x1:0,y1:0,x2:100,y2:100},colorStops:[{color:t(),offset:0},{color:t(),offset:1}]})}));for(var d=0;d<1e3;d++)i.add(new h({top:k.random(400,1100),left:k.random(50,750),width:k.random(50,100),height:k.random(50,100),fill:t()}));n.add(...s),n.add(a,i),r.saveState()},dispose(){console.log("myPlugin dispose")},slots:{rightPanel:[Qs]}}},tl=(()=>{var e=Xo(),t=Jt({install(e){this._a=e,(e=>{Lo=e})(t)},use(e){var t;return this._p.push(e),null===(t=Or.editor)||void 0===t||t.use(e),this},service:e,_p:[],_a:null});return t})();tl.use(el),w.enableBoundaryChecking(!1),dn(vn).use(xa).use(qs).use(tl).use((e=>{Gt._context=e._context,Yt._context=e._context,Xt._context=e._context,Ti._context=e._context})).mount("#app")}}}))}();
