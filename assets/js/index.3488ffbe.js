var ti=Object.defineProperty;var ni=(n,e,t)=>e in n?ti(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var _=(n,e,t)=>(ni(n,typeof e!="symbol"?e+"":e,t),t);import{G as zt,c as hn,R as Ue,i as si,A as at,a as Gt,P as Ot,b as Oe,C as $e,d as ke,T as Fs,l as V,e as _e,F as At,I as Qn,E as Tn,f as Vs,g as Ks,h as oi,j as es,k as ii,S as ai,m as ts,n as ri,o as li,p as kt}from"./vendor.e0ceea51.js";/* empty css              */import{r as xe,o as g,c as O,w as y,a as f,b as Tt,C as ci,d as ge,e as Ge,n as Le,t as Ws,s as ui,f as I,g as j,h as ht,i as B,j as Te,k as T,l as N,m as Ae,p as Qe,q as pn,u as fn,v as ve,x as se,y as oe,z as Z,A as Be,B as De,F as he,D as ze,E as qt,G as He,H as ys,I as _s,J as di,K as hi,L as pi,M as Fe,N as Pe,O as jt,P as fi,Q as vi,R as U,S as gi,T as we,U as mi,V as m,W as vn,X as bi,Y as Us,Z as yi,_ as _i,$ as _t,a0 as me,a1 as Gs,a2 as Nt,a3 as Ht,a4 as Ys,a5 as Xs,a6 as qs,a7 as wi,a8 as ws,a9 as Js,aa as lt,ab as ki,ac as Si,ad as xi,ae as Ci,af as yt,ag as rn,ah as Zs,ai as Mi,aj as Oi,ak as Ai,al as Qs,am as Pi,an as Ii,ao as Yt,ap as $i,aq as Ti,ar as ks,as as Pn,at as Ei,au as Ri,av as ns,aw as eo,ax as to,ay as no,az as gn,aA as rt,aB as Di,aC as ji,aD as Li,aE as so,aF as oo,aG as Bi,aH as zi,aI as Ni,aJ as io,aK as ao,aL as ro,aM as Hi,aN as Fi,aO as Vi,aP as Ki,aQ as Wi,aR as Ui,aS as pt,aT as mn,aU as ft,aV as Jt,aW as bn,aX as Gi,aY as ss,aZ as os,a_ as lo,a$ as Yi,b0 as Xi,b1 as qi,b2 as Ji,b3 as Zi,b4 as Ss,b5 as Qi,b6 as ea,b7 as ta,b8 as na,b9 as sa,ba as oa,bb as ia,bc as aa,bd as ra,be as la,bf as ca,bg as ua,bh as da}from"./vue.425f24e9.js";import"./index.3488ffbe.js";function fd(){import.meta.url,import("_").catch(()=>1);async function*n(){}}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();var yd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _d(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}const le=(n,e)=>{const t=n.__vccOpts||n;for(const[s,o]of e)t[s]=o;return t},ha={};function pa(n,e){const t=xe("router-view"),s=ci;return g(),O(s,null,{default:y(()=>[f(t,null,{default:y(({Component:o})=>[(g(),O(Tt(o)))]),_:1})]),_:1})}const fa=le(ha,[["render",pa]]),ct=Math.PI/180,Lt={group:"mod+g",ungroup:"mod+shift+g"},ln=n=>{if(n.ref)return n;const e=["id","name","hideOnLayer","originX","originY","top","left","width","height","scaleX","scaleY","flipX","flipY","opacity","angle","skewX","skewY","hoverCursor","moveCursor","padding","borderColor","borderDashArray","cornerColor","cornerStrokeColor","cornerStyle","cornerDashArray","centeredScaling","centeredRotation","fill","fillRule","globalCompositeOperation","backgroundColor","selectionBackgroundColor","stroke","strokeWidth","strokeDashArray","strokeDashOffset","strokeLineCap","strokeLineJoin","strokeMiterLimit","shadow","borderScaleFactor","minScaleLimit","selectable","evented","visible","hasControls","hasBorders","perPixelTargetFind","includeDefaultValues","lockMovementX","lockMovementY","lockRotation","lockScalingX","lockScalingY","lockSkewingX","lockSkewingY","lockScalingFlip","excludeFromExport","objectCaching","noScaleCache","strokeUniform","dirty","paintFirst","activeOn","colorProperties","inverted","absolutePositioned"];return n.isType("Rect")&&e.push("rx","ry"),n.isType("Text","Textbox")&&e.push("text","charSpacing","lineHeight","fontSize","fontWeight","fontFamily","fontStyle","pathSide","pathAlign","underline","overline","linethrough","textAlign","direction"),n.ref=ge({}),e.forEach(t=>{n.ref[t]=n[t],Object.defineProperty(n,t,{get(){return this.ref[t]},set(s){this.ref[t]!==s&&(this.ref[t]=s)}})}),n};class co extends ho(zt){constructor(e,t,s){super(e==null?void 0:e.map(o=>ln(o)),t,s)}setDirty(){this._set("dirty",!0)}updateLayout(){this._applyLayoutStrategy({type:"object_modified"}),this.setDirty()}}const va={padding:4,selectable:!1,layout:"fixed",fill:"#FFFFFF"},fs=class extends co{constructor(t,s,o){super(t,s,o);_(this,"subTargetCheck",!0);_(this,"interactive",!0);this.on("scaling",()=>{const{y:a,x:i}=this._getTransformedDimensions();this.set({width:i,height:a,scaleX:1,scaleY:1}),this.setClipPath()}),this.on("added",()=>{this.setClipPath(),this.updateSelectable(),Ge(()=>{this.ref.selectable&&this.size()&&(this.ref.selectable=!1)})})}static getDefaults(){return{...super.getDefaults(),...fs.ownDefaults}}updateSelectable(){this.ref&&(this.ref.selectable=!this.size())}setClipPath(){this.clipPath=new Ue({top:0,left:0,width:this.width,height:this.height,originX:"center",originY:"center"})}_renderBackground(t){Ue.prototype._render.call(this,t)}render(t){var s,o,a,i;if(super.render(t),this.visible){t.save(),this.transform(t),t.scale(1/((s=this.zoomX)!=null?s:1),1/((o=this.zoomY)!=null?o:1));const r=this.angle*ct,l=Math.sin(r),u=Math.cos(r),c=Math.abs(l),d=Math.abs(u);c>d?t.rotate(Math.sign(l)*-90*ct):t.rotate((Math.sign(u)*-90+90)*ct),t.font="12px Helvetica",t.fillStyle="#888",t.textBaseline="bottom",t.fillText(this.name,-this.width*((a=this.zoomX)!=null?a:1)/2,-this.height*((i=this.zoomY)!=null?i:1)/2-2),t.restore()}}_watchObject(t,s){}_onObjectAdded(t){super._onObjectAdded(t),this.updateSelectable()}_onObjectRemoved(t){super._onObjectRemoved(t),this.updateSelectable()}toObject(t=[]){const s=super.toObject(t);return delete s.clipPath,s}toString(){return`#<Board: (${this.complexity()})>`}};let Ce=fs;_(Ce,"ownDefaults",va);hn.setClass(Ce);hn.setClass(Ce,"board");const ga=n=>n instanceof at,ma=n=>n instanceof Ce,ba=n=>n instanceof et,ya=n=>!!n&&Array.isArray(n._objects),_a=n=>n instanceof zt,wa=n=>n instanceof Gt,ka=n=>n instanceof Ot,Sa=n=>!!n&&n.isType("Text","IText","Textbox"),xa=n=>!!n&&n.toLive!==void 0,Ca=n=>!!n&&typeof n.toObject=="function",L={...si,isBoard:ma,isCollection:ya,isGradient:wa,isPattern:ka,isActiveSelection:ga,isTextObject:Sa,isGroup:ba,isNativeGroup:_a,isFiller:xa,isSerializableFiller:Ca};class et extends co{constructor(t,s,o){super(t,s,o);_(this,"subTargetCheck",!0);_(this,"interactive",!1);this.on("mousedblclick",this.doubleClickHandler.bind(this))}addDeselectedEvent(t){t.once("deselected",()=>{var o;const s=(o=this.canvas)==null?void 0:o.getActiveObject();!s||!s.getAncestors(!0).includes(this)?this.set({interactive:!1,objectCaching:!0}):this.addDeselectedEvent(s)})}onActiveTarget(t){!this.canvas||!t.group||t.group.interactive||t.getAncestors(!0).forEach(s=>{const o=s;o.interactive||(o.set({interactive:!0,objectCaching:!1}),o.addDeselectedEvent(t))})}doubleClickHandler(t){var a;if(!this.canvas||!t.target||t.target!==this||!t.subTargets||t.subTargets.length===0||this.interactive)return;this.set({interactive:!0,objectCaching:!1}),this.addDeselectedEvent(this);const s=t.subTargets.indexOf(this),o=(a=t.subTargets[s-1])!=null?a:t.subTargets[t.subTargets.length-1];this.canvas.setActiveObject(o),this.canvas.requestRenderAll()}_onObjectRemoved(t,s){if(super._onObjectRemoved(t,s),this.size()===0){const o=this.getParent();o&&o.remove(this)}}}hn.setClass(et);const Ma=(n,e,t,s)=>new ke(s.x*n.x+s.offsetX,s.y*n.y+s.offsetY).transform(e),Oa=n=>{if(!n.canvas)return;const e=n.canvas.getZoom(),t=n.getWidthHeight().scalarMultiply(e),s=n.controls;["ml","mr"].forEach(i=>{s[i].sizeX=n.cornerSize,s[i].sizeY=t.y,s[i].touchSizeX=n.touchCornerSize,s[i].touchSizeY=t.y}),["mt","mb"].forEach(i=>{s[i].sizeX=t.x,s[i].sizeY=n.cornerSize,s[i].touchSizeX=t.x,s[i].touchSizeY=n.touchCornerSize})},xs=n=>`url("data:image/svg+xml,<svg height='20' width='20' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg'><g fill='none' transform='rotate(${n} 16 16)'><path fill='white' d='M18.24 5.37C11.41 6.04 5.98 11.46 5.32 18.26L0 18.26L7.8 26L15.61 18.27L10.6 18.27C11.21 14.35 14.31 11.25 18.24 10.64L18.24 15.55L26 7.78L18.24 0L18.24 5.37Z'></path><path fill='black' d='M19.5463 6.61441C12.4063 6.68441 6.61632 12.4444 6.56632 19.5644L3.17632 19.5644L7.80632 24.1444L12.4363 19.5644L9.18632 19.5644C9.24632 13.8844 13.8563 9.28441 19.5463 9.22441L19.5463 12.3844L24.1463 7.78441L19.5463 3.16441L19.5463 6.61441Z'></path></g></svg>") 12 12,auto`,Aa=(n,e,t,s)=>{const{shiftKey:o}=n,{target:a}=e,{rotationWithSnapping:i}=Oe;let r;o&&(r=a.snapAngle,a.snapAngle=15);const l=i(n,e,t,s);return r&&(a.snapAngle=r),l},en=n=>({sizeX:16,sizeY:16,actionHandler:(e,t,s,o)=>{var a;return(a=t.target.canvas)==null||a.setCursor(xs(t.target.angle+n)),Aa(e,t,s,o)},cursorStyleHandler:(e,t,s)=>xs(s.angle+n),render:Le,actionName:"rotate"}),tn={cursorStyleHandler:Oe.scaleCursorStyleHandler,actionHandler:Oe.scalingEqually,actionName:"scaling"},uo=()=>({size:new $e({x:0,y:.5,cursorStyleHandler:()=>"",offsetY:14,sizeX:1e-4,sizeY:1e-4,touchSizeX:1e-4,touchSizeY:1e-4,render:(n,e,t,s,o)=>{n.save(),n.translate(e,t);const a=()=>{const p=o.group?o.getTotalAngle():o.angle,h=p*ct,v=Math.sin(h),w=Math.cos(h),b=Math.abs(v)>Math.abs(w)?Math.sign(v)*90:Math.sign(w)*90-90;return(p-b)*ct};n.rotate(a());const i=12;n.font=`${i}px Tahoma`,n.textAlign="center",n.textBaseline="middle";const{x:r,y:l}=o.getWidthHeight(),u=`${r} × ${l}`,c=n.measureText(u).width+8,d=i+6;n.roundRect(-c/2,-d/2,c,d,4),n.fillStyle="#0066ff",n.fill(),n.fillStyle="#fff",n.fillText(u,0,1),n.restore()},positionHandler:(n,e,t,s)=>{var a;const o=(a=t.canvas)==null?void 0:a.getActiveObject();if(o&&o===t){const r=t.getTotalAngle()*ct,l=Math.sin(r),u=Math.cos(r);if(Math.abs(l)>=Math.abs(u)){const c=Math.sign(l);s.x=c/2,s.y=0,s.offsetX=c*14,s.offsetY=0}else{const c=Math.sign(u);s.x=0,s.y=c/2,s.offsetX=0,s.offsetY=c*14}Oa(t)}return Ma(n,e,t,s)}}),tlr:new $e({x:-.5,y:-.5,offsetX:-4,offsetY:-4,...en(0)}),trr:new $e({x:.5,y:-.5,offsetX:4,offsetY:-4,...en(90)}),brr:new $e({x:.5,y:.5,offsetX:4,offsetY:4,...en(180)}),blr:new $e({x:-.5,y:.5,offsetX:-4,offsetY:4,...en(270)}),ml:new $e({x:-.5,y:0,actionHandler:Oe.scalingXOrSkewingY,cursorStyleHandler:Oe.scaleSkewCursorStyleHandler,actionName:"scaling",render:Le}),mr:new $e({x:.5,y:0,actionHandler:Oe.scalingXOrSkewingY,cursorStyleHandler:Oe.scaleSkewCursorStyleHandler,actionName:"scaling",render:Le}),mb:new $e({x:0,y:.5,actionHandler:Oe.scalingYOrSkewingX,cursorStyleHandler:Oe.scaleSkewCursorStyleHandler,actionName:"scaling",render:Le}),mt:new $e({x:0,y:-.5,actionHandler:Oe.scalingYOrSkewingX,cursorStyleHandler:Oe.scaleSkewCursorStyleHandler,actionName:"scaling",render:Le}),tl:new $e({x:-.5,y:-.5,...tn}),tr:new $e({x:.5,y:-.5,...tn}),bl:new $e({x:-.5,y:.5,...tn}),br:new $e({x:.5,y:.5,...tn})}),Cs=Oe.wrapWithFireEvent("scaling",Oe.wrapWithFixedAnchor(Oe.changeWidth)),Pa=()=>({mr:new $e({x:.5,y:0,actionHandler:Cs,cursorStyleHandler:Oe.scaleSkewCursorStyleHandler,render:Le}),ml:new $e({x:-.5,y:0,actionHandler:Cs,cursorStyleHandler:Oe.scaleSkewCursorStyleHandler,render:Le})}),Ia=()=>({...uo(),...Pa()});Object.assign(Fs.ownDefaults,{controls:Ia(),splitByGrapheme:!0,fontSize:36,fontFamily:"arial"});class xt extends Fs{constructor(e,t){super(e,t),this.on("scaling",()=>{const{x:s,y:o}=this._getTransformedDimensions({strokeWidth:0});this.set({width:s,height:Math.max(o,1),scaleX:1,scaleY:1}),this.setClipPath()}),this.on("added",()=>{this.setClipPath()})}setClipPath(){this.clipPath=new Ue({top:0,left:0,width:this.width,height:this.height,originX:"center",originY:"center"})}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._forceClearCache&&(this.dirty=!0),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces())}toObject(e=[]){const t=super.toObject(e);return delete t.clipPath,t}_set(e,t){return e==="group"&&!t&&this.fire("scaling"),super._set(e,t)}exitEditing(){return this.selectionEnd-this.selectionStart>0&&this.clearContextTop(),super.exitEditing()}}hn.setClass(xt);const Ms="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function yn(n=10){let e="";for(let t=0;t<n;t++)e+=Ms.charAt(Math.floor(Math.random()*Ms.length));return e}function ho(n){class e extends n{constructor(){super(...arguments);_(this,"uniqueIds",new Map)}add(...o){return super.add(...o.map(a=>(this.setDefaultAttr(a),ln(a))))}insertAt(o,...a){return super.insertAt(o,...a.map(i=>(this.setDefaultAttr(i),ln(i))))}_onObjectAdded(o){if(o.noEventObjectAdded&&this.fire!==Le){const a=this.fire;this.fire=Le;try{super._onObjectAdded(o)}finally{this.fire=a}}else super._onObjectAdded(o);this.updateObjects()}_onObjectRemoved(o){super._onObjectRemoved(o),this.updateObjects()}_onStackOrderChanged(){super._onStackOrderChanged(),this.updateObjects()}updateObjects(){var a,i;const o=((a=this.ref)==null?void 0:a.objects)||((i=this.canvas)==null?void 0:i.ref.objects);o&&Ws(o)}setDefaultAttr(o){if(!o.name){const a=o.type,i=this.uniqueIds.get(a)||1;o.set({name:`${a} ${i}`}),this.uniqueIds.set(a,i+1)}o.id||o.set({id:yn()}),L.isCollection(o)&&o._objects.forEach(a=>{this.setDefaultAttr(a)})}}return e}const it={serviceIds:new Map,DI_TARGET:"$di$target",DI_DEPENDENCIES:"$di$dependencies",getServiceDependencies(n){return n[this.DI_DEPENDENCIES]||[]}},po=vt("instantiationService");function $a(n,e,t){e[it.DI_TARGET]===e?e[it.DI_DEPENDENCIES].push({id:n,index:t}):(e[it.DI_DEPENDENCIES]=[{id:n,index:t}],e[it.DI_TARGET]=e)}function vt(n){if(it.serviceIds.has(n))return it.serviceIds.get(n);const e=function(t,s,o){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");$a(e,t,o)};return e.toString=()=>n,it.serviceIds.set(n,e),e}class st{constructor(e,t=[],s=!1){_(this,"ctor");_(this,"staticArguments");_(this,"supportsDelayedInstantiation");this.ctor=e,this.staticArguments=t,this.supportsDelayedInstantiation=s}}const fo=[];var Zt=(n=>(n[n.Eager=0]="Eager",n[n.Delayed=1]="Delayed",n))(Zt||{});function _n(n,e,t){e instanceof st||(e=new st(e,[],!!t)),fo.push([n,e])}function Ta(){return fo}class vo{constructor(){_(this,"all",new Map)}on(e,t){const s=this.all.get(e);s?s.push(t):this.all.set(e,[t])}once(e,t){const s=()=>{this.off(e,s),t()};this.on(e,s)}off(e,t){const s=this.all.get(e);s&&(t?s.splice(s.indexOf(t)>>>0,1):this.all.set(e,[]))}emit(e,t){const s=this.all.get(e);s&&s.slice().map(a=>{a(t)});const o=this.all.get("*");o&&o.slice().map(a=>{a(e,t)})}}class Ea extends vo{}const Ze=vt("eventbusService");_n(Ze,vo,Zt.Eager);function Ra(n){return n&&typeof n=="object"&&typeof n[Symbol.iterator]=="function"}class Da extends Error{constructor(e){super(`Encountered errors while disposing of store. Errors: [${e.join(", ")}]`),this.errors=e}}function ja(n){if(Ra(n)){const e=[];for(const t of n)if(t)try{t.dispose()}catch(s){e.push(s)}if(e.length===1)throw e[0];if(e.length>1)throw new Da(e);return Array.isArray(n)?[]:n}else if(n)return n.dispose(),n}class go{constructor(){_(this,"_toDispose",new Set);_(this,"_isDisposed",!1)}dispose(){this._isDisposed||(this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{ja(this._toDispose)}finally{this._toDispose.clear()}}add(e){if(!e)return e;if(e===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed?console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(e),e}}_(go,"DISABLE_DISPOSED_WARNING",!1);class Ve{constructor(){_(this,"_store",new go)}dispose(){this._store.dispose()}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}}function is(n){return{dispose:V.once(()=>{n()})}}var La=Object.defineProperty,Ba=Object.getOwnPropertyDescriptor,za=(n,e,t,s)=>{for(var o=s>1?void 0:s?Ba(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(o=(s?i(e,t,o):i(o))||o);return s&&o&&La(e,t,o),o},Na=(n,e)=>(t,s)=>e(t,s,n);const Et=vt("workspacesService");let En=class extends Ve{constructor(e){super();_(this,"workspaces",[]);_(this,"currentId","");this.eventbus=e}getCurrentId(){return this.currentId}setCurrentId(e){if(!this.get(e)||this.currentId===e)return;const t={oldId:this.currentId,newId:e};this.eventbus.emit("workspaceChangeBefore",t),this.currentId=e,this.eventbus.emit("workspaceChangeAfter",t)}all(){return this.workspaces}set(e,t){const s=this.get(e);!s||s.name===t||(s.name=t)}get(e){return this.workspaces.find(t=>t.id===e)}add(e,t){t||(t=yn());const s={oldId:this.currentId,newId:t};return this.eventbus.emit("workspaceAddBefore",s),this.workspaces.push({id:t,name:e}),this.eventbus.emit("workspaceAddAfter",s),t}remove(e){if(!this.get(e))return;this.eventbus.emit("workspaceRemoveBefore",e);const t=this.workspaces.findIndex(s=>s.id===e);this.workspaces.splice(t,1),this.eventbus.emit("workspaceRemoveAfter",e),e===this.currentId&&(this.workspaces[t]?this.setCurrentId(this.workspaces[t].id):this.workspaces[t-1]&&this.setCurrentId(this.workspaces[t-1].id))}size(){return this.workspaces.length}clear(){this.workspaces.forEach(({id:e})=>{this.eventbus.emit("workspaceRemoveBefore",e),this.eventbus.emit("workspaceRemoveAfter",e)}),this.workspaces=[],this.currentId=""}dispose(){super.dispose(),this.clear()}};En=za([Na(0,Ze)],En);const mo=n=>{const e=(n%360+360)%360;return e>180?e-360:e},pe=(n,e=2)=>_e.round(n,e);var dt;let de=(dt=class{constructor(e){_(this,"element");_(this,"next");_(this,"prev");this.element=e,this.next=dt.Undefined,this.prev=dt.Undefined}},_(dt,"Undefined",new dt(void 0)),dt);class Xt{constructor(){_(this,"_first",de.Undefined);_(this,"_last",de.Undefined);_(this,"_size",0)}get size(){return this._size}isEmpty(){return this._first===de.Undefined}clear(){let e=this._first;for(;e!==de.Undefined;){const t=e.next;e.prev=de.Undefined,e.next=de.Undefined,e=t}this._first=de.Undefined,this._last=de.Undefined,this._size=0}unshift(e){return this._insert(e,!1)}push(e){return this._insert(e,!0)}_insert(e,t){const s=new de(e);if(this._first===de.Undefined)this._first=s,this._last=s;else if(t){const a=this._last;this._last=s,s.prev=a,a.next=s}else{const a=this._first;this._first=s,s.next=a,a.prev=s}this._size+=1;let o=!1;return()=>{o||(o=!0,this._remove(s))}}shift(){if(this._first!==de.Undefined){const e=this._first.element;return this._remove(this._first),e}}pop(){if(this._last!==de.Undefined){const e=this._last.element;return this._remove(this._last),e}}_remove(e){if(e.prev!==de.Undefined&&e.next!==de.Undefined){const t=e.prev;t.next=e.next,e.next.prev=t}else e.prev===de.Undefined&&e.next===de.Undefined?(this._first=de.Undefined,this._last=de.Undefined):e.next===de.Undefined?(this._last=this._last.prev,this._last.next=de.Undefined):e.prev===de.Undefined&&(this._first=this._first.next,this._first.prev=de.Undefined);this._size-=1}*[Symbol.iterator](){let e=this._first;for(;e!==de.Undefined;)yield e.element,e=e.next}}let Ct;typeof requestIdleCallback!="function"||typeof cancelIdleCallback!="function"?Ct=n=>{setTimeout(()=>{if(e)return;const t=Date.now()+15;n(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,t-Date.now())}}))});let e=!1;return{dispose(){e||(e=!0)}}}:Ct=(n,e)=>{const t=requestIdleCallback(n,typeof e=="number"?{timeout:e}:void 0);let s=!1;return{dispose(){s||(s=!0,cancelIdleCallback(t))}}};class Ha{constructor(e){_(this,"_executor");_(this,"_handle");_(this,"_didRun",!1);_(this,"_value");_(this,"_error");this._executor=()=>{try{this._value=e()}catch(t){this._error=t}finally{this._didRun=!0}},this._handle=Ct(()=>this._executor())}dispose(){this._handle.dispose()}get value(){if(this._didRun||(this._handle.dispose(),this._executor()),this._error)throw this._error;return this._value}get isInitialized(){return this._didRun}}const Fa=Ot.prototype.toObject;Ot.prototype.toObject=function(n=[]){return n.push("fit"),Fa.call(this,n)};Ot.prototype.fit="fill";Object.assign(At.ownDefaults,{strokeUniform:!0,strokeWidth:0,fill:"#CCCCCC",cornerSize:8,transparentCorners:!1,cornerColor:"#FFF",borderColor:"#2A82E4",cornerStrokeColor:"#2A82E4",controls:uo(),includeDefaultValues:!1,snapAngle:1,paintFirst:"stroke",perPixelTargetFind:!0});const Va=At.prototype._renderControls,Ka={getWidthHeight(n=!1){const e=this.getObjectScaling(),t=this._getTransformedDimensions({scaleX:e.x,scaleY:e.y});return n||(t.setX(pe(t.x)),t.setY(pe(t.y))),t},getHeight(){return this.getWidthHeight().y},getWidth(){return this.getWidthHeight().x},setHeight(n){n=Math.max(n,this.strokeWidth,.5);const e=_e.divide(_e.minus(this.getWidthHeight(!0).y,this.strokeWidth),this.scaleY),t=_e.divide(_e.minus(n,this.strokeWidth),e);t===1/0||Number.isNaN(t)||(this.set("scaleY",t||1e-5),this.fire("scaling"))},setWidth(n){n=Math.max(n,this.strokeWidth,.5);const e=_e.divide(_e.minus(this.getWidthHeight(!0).x,this.strokeWidth),this.scaleX),t=_e.divide(_e.minus(n,this.strokeWidth),e);t===1/0||Number.isNaN(t)||(this.set("scaleX",t||1e-5),this.fire("scaling"))},setAngle(n){this.rotate(pe(mo(n)))},getLeftTop(){const n=this.getRelativeXY();if(!this.group)return n;const e=this.group.calcTransformMatrix();return n.transform(e)},getLeft(){return this.getLeftTop().x},getTop(){return this.getLeftTop().y},setLeftTop(n){this.group&&(n=n.transform(L.invertTransform(this.group.calcTransformMatrix()))),this.setRelativeXY(n)},setLeft(n){this.setLeftTop(this.getLeftTop().setX(n))},setTop(n){this.setLeftTop(this.getLeftTop().setY(n))},align(n){var i;if(!(this instanceof at))return;const{left:e,top:t,width:s,height:o}=this,a=new Set;this._objects.forEach(r=>{switch(n){case"alignLeft":r.setX(e);break;case"alignRight":r.setX(e+s-r.getScaledWidth());break;case"alignCenter":r.setX(e+(s-r.getScaledWidth())/2);break;case"verticalTop":r.setY(t);break;case"verticalBottom":r.setY(t+o-r.getScaledHeight());break;case"verticalMiddle":r.setY(t+(o-r.getScaledHeight())/2);break}const l=r.getParent(!0);l&&a.add(l)}),a.forEach(r=>{r.setDirty()}),(i=this.canvas)==null||i.requestRenderAll()},alignLeft(){this.align("alignLeft")},alignRight(){this.align("alignRight")},alignCenter(){this.align("alignCenter")},verticalTop(){this.align("verticalTop")},verticalMiddle(){this.align("verticalMiddle")},verticalBottom(){this.align("verticalBottom")},isType(...n){return n.includes(this._type)||n.includes(this.constructor.name)},_renderControls(n,e){if(this.isMoving){this.setCoords();return}Va.call(this,n,e)},_applyPatternGradientTransform(n,e){if(!L.isFiller(e))return{offsetX:0,offsetY:0};const t=e.gradientTransform||e.patternTransform;let s=-this.width/2+e.offsetX||0,o=-this.height/2+e.offsetY||0;if(e.gradientUnits==="percentage")n.transform(this.width,0,0,this.height,s,o);else if(L.isPattern(e)&&(e.fit=="fill"||e.fit=="padding")&&e.isImageSource()){e.repeat="no-repeat";const a=this.getObjectScaling(),{naturalHeight:i,naturalWidth:r}=e.source,{x:l,y:u}=this.getWidthHeight(),c=l/r,d=u/i,p=Math[e.fit==="fill"?"max":"min"](c,d);return(e.fit==="fill"?c>d:c<d)?o-=(i*p-u)/a.y/2:s-=(r*p-l)/a.x/2,e.patternTransform=[p/a.x,0,0,p/a.y,s,o],n.transform(...e.patternTransform),{offsetX:s,offsetY:o}}else n.transform(1,0,0,1,s,o);return t&&n.transform(t[0],t[1],t[2],t[3],t[4],t[5]),{offsetX:s,offsetY:o}},toObject(n=[]){n.push("id","name");const e=ii.NUM_FRACTION_DIGITS,t=this.clipPath&&!this.clipPath.excludeFromExport?{...this.clipPath.toObject(n),inverted:this.clipPath.inverted,absolutePositioned:this.clipPath.absolutePositioned}:null,s={...V.pick(this,n),type:this.type,originX:this.originX,originY:this.originY,left:pe(this.left,e),top:pe(this.top,e),width:pe(this.width,e),height:pe(this.height,e),fill:L.isSerializableFiller(this.fill)?this.fill.toObject():this.fill,stroke:L.isSerializableFiller(this.stroke)?this.stroke.toObject():this.stroke,strokeWidth:pe(this.strokeWidth,e),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:pe(this.strokeMiterLimit,e),scaleX:pe(this.scaleX,e),scaleY:pe(this.scaleY,e),angle:pe(this.angle,e),flipX:this.flipX,flipY:this.flipY,opacity:pe(this.opacity,e),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:pe(this.skewX,e),skewY:pe(this.skewY,e),...t?{clipPath:t}:null};return this.includeDefaultValues?s:this._removeDefaultValues(s)}};Object.assign(At.prototype,Ka);delete Qn.prototype.type;Object.defineProperties(At.prototype,{type:{get(){const n=this._type||this.constructor.name;return n==="FabricObject"?"object":n.toLowerCase()},set(n){}}});Ue.prototype._type="Rect";Tn.prototype._type="Ellipse";Vs.prototype._type="Text";Qn.prototype._type="IText";xt.prototype._type="Textbox";Ks.prototype._type="Path";Ce.prototype._type="Board";oi.prototype._type="Image";es.prototype._type="Triangle";At.prototype._type="Object";et.prototype._type="Group";at.prototype._type="ActiveSelection";const Wa=[Vs,Qn,xt,et,Ce];Wa.forEach(n=>{n.ownDefaults.perPixelTargetFind=!1});const Ua=zt.prototype.setCoords,Ga=zt.prototype._shouldSetNestedCoords;zt.prototype.setCoords=function(){this.isMoving?At.prototype.setCoords.call(this):Ua.call(this)};zt.prototype._shouldSetNestedCoords=function(){return!this.canvas||this.canvas.selection===!1||this.canvas.skipTargetFind===!0?!1:Ga.call(this)};const Ya=at.prototype.exitGroup;at.prototype.exitGroup=function(n,e){Ya.call(this,n,e),n.setCoords()};const bo=(n,e,t)=>{const{left:s,top:o,width:a,height:i}=e,{includeIntersecting:r}=t,l=[],u=new ke(s,o),c=u.add(new ke(a,i));return n==null||n.forEach(d=>{d instanceof Ce&&d.evented&&(d.intersectsWithRect(u,c,!0)||d.containsPoint(u,void 0,!0)||d.containsPoint(c,void 0,!0))&&l.push(...bo(d._objects,e,t));const p=L.isBoard(d),h=(!p||d._objects.length===0)&&r&&(d.intersectsWithRect(u,c,!0)||d.containsPoint(u,void 0,!0)||d.containsPoint(c,void 0,!0));(d.selectable||p&&d._objects.length!==0)&&d.visible&&d.evented&&(d.isContainedWithinRect(u,c,!0)||h)&&l.push(d)}),l};ai.prototype.collectObjects=function(n,e={}){return bo(this._objects,n,e)};var Xa=Object.defineProperty,qa=Object.getOwnPropertyDescriptor,Ja=(n,e,t,s)=>{for(var o=s>1?void 0:s?qa(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(o=(s?i(e,t,o):i(o))||o);return s&&o&&Xa(e,t,o),o},Os=(n,e)=>(t,s)=>e(t,s,n);const Ie=vt("fabricCanvas");let Rn=class extends ho(ri){constructor(e,t){super((()=>document.createElement("canvas"))(),Object.assign({hoverCursor:"default",preserveObjectStacking:!0,selectionBorderColor:"rgba(60,126,255,0.8)",selectionColor:"rgba(60,126,255,0.2)",uniformScaling:!1,stopContextMenu:!0,fireMiddleClick:!0,includeDefaultValues:!1}));_(this,"activeObject",ui());_(this,"pageId");_(this,"pages",new Map);_(this,"ref",{zoom:I(pe(this.getZoom(),2)),objects:j(()=>this._objects)});_(this,"setCoordsStack",new Xt);_(this,"_setCoords",V.debounce(()=>{const e=this.backgroundImage,t=this.overlayImage,s=this._objects.length;this.setCoordsStack.isEmpty()||this.setCoordsStack.clear();for(let o=0;o<s;o++)this.setCoordsStack.push(this._objects[o]);Ct(()=>{for(;!this.setCoordsStack.isEmpty();){const o=this.setCoordsStack.shift();o&&(o.group||o.setCoords())}e&&e.setCoords(),t&&t.setCoords(),this.calcViewportBoundaries()})},50));_(this,"_cacheBoards");_(this,"_cacheCurrentBoard");this.workspacesService=e,this.eventbus=t,delete this._objects,delete this._activeObject,this.initActiveSelection(),this.initBoard(),this.pageId=this.workspacesService.getCurrentId(),this.initWorkspace()}get _activeObject(){return this.activeObject?this.activeObject.value:void 0}set _activeObject(e){this.activeObject.value=e}get _objects(){var t;const e=this.workspacesService.getCurrentId();return this.pages.has(e)||this.setPageJSON(e,{_objects:[]}),((t=this.pages.get(e))==null?void 0:t._objects)||[]}set _objects(e){const t=this.workspacesService.getCurrentId();this.setPageJSON(t,{_objects:e})}zoomToPoint(e,t,s){t=ht(t,.02,256);const o=e,a=[...this.viewportTransform],i=L.transformPoint(e,L.invertTransform(a));a[0]=t,a[3]=t;const r=L.transformPoint(i,a);a[4]+=o.x-r.x,a[5]+=o.y-r.y,s?(this.viewportTransform=a,this.renderOnAddRemove&&this.requestRenderAll()):this.setViewportTransform(a)}setViewportTransform(e){this.viewportTransform=e,this._setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this.ref.zoom.value=pe(this.getZoom(),2)}setActiveObject(e,t){const s=e.group;return s&&s instanceof et&&s.onActiveTarget(e),super.setActiveObject(e,t)}exportPages(e=[],t="toObject"){const s=this.clipPath,o=s&&!s.excludeFromExport?this._toObject(s,t,e):null,a=[];return this.workspacesService.all().forEach(i=>{const r=this.pages.get(i.id);if(!r)return;const{_objects:l,viewportTransform:u,backgroundColor:c}=r;a.push({id:i.id,viewportTransform:u,objects:l.filter(d=>!d.excludeFromExport).map(d=>this._toObject(d,t,e)),background:c})}),{...V.pick(this,e),workspaces:this.workspacesService.all(),pages:a,...o?{clipPath:o}:null}}async importPages(e){if(!e)return Promise.reject(new Error("fabric.js: `json` is undefined"));const t=typeof e=="string"?JSON.parse(e):e,{workspaces:s,pages:o}=t;if(!s||!o||s.length===0||o.length===0)return Promise.reject(new Error("fabric.js: `json` is not valid"));this.workspacesService.clear(),this.pages.clear();for(const{name:a,id:i}of s)this.workspacesService.add(a,i);for(const a of o.reverse())this.workspacesService.setCurrentId(a.id),await this.loadFromJSON(V.omit(a,"id"));this.renderAll()}setActiveObjects(e){if(e.length===0){this.discardActiveObject(),this.requestRenderAll();return}if(e.length===1){this.setActiveObject(e[0]);return}const t=this.getActiveSelection();t.removeAll(),t.add(...e),this._hoveredTarget=t,this._hoveredTargets=[...e],this.setActiveObject(t),this._fireSelectionEvents([t])}findObjectById(e){return this.findObjectsByIds([e])[0]}findObjectsByIds(e){const t=e.length,s=Array(t).fill(void 0);let o=0;const a=new Xt,i=r=>{for(const l of r)a.push(l)};for(i(this._objects);!a.isEmpty()&&o<t;){const r=a.pop();if(r){const l=e.indexOf(r.id);l!==-1&&(s[l]=r,o++)}L.isCollection(r)&&i(r._objects)}return s}findTarget(e){if(this.skipTargetFind)return;const t=this.getPointer(e,!0),s=this._activeObject,o=this.getActiveObjects();if(this.targets=[],s&&o.length>=1){if(s._findTargetCorner(t,L.isTouchEvent(e)))return s;const a=this.searchPossibleTargets([s],t);if(o.length>1&&a)return s;if(s===a)return s}return this.searchPossibleTargets(this._objects,t)}searchPossibleTargets(e,t){const s=this._searchPossibleTargets(e,t);if(s&&L.isCollection(s)&&s.interactive&&this.targets.length>0){const o=this.targets.findIndex(a=>{var i;return(i=a.group)==null?void 0:i.interactive});return o>=0?this.targets[o]:this.targets[0]}return s}initWorkspace(){this.workspacesService.all().forEach(e=>{this.setPageJSON(e.id,{_objects:[]})}),this.eventbus.on("workspaceAddAfter",({newId:e})=>{this.setPageJSON(e,{_objects:[]})}),this.eventbus.on("workspaceRemoveAfter",e=>{this.pages.delete(e)}),this.eventbus.on("workspaceChangeBefore",({oldId:e})=>{if(!e||!this.pages.has(e))return;const t=this.pages.get(e);if(!t)return;const{viewportTransform:s,backgroundColor:o}=this;t.viewportTransform=s,t.backgroundColor=o}),this.eventbus.on("workspaceChangeAfter",({newId:e})=>{if(this.pageId!==e){this.discardActiveObject(),this._objectsToRender=void 0;const t=this.pages.get(e),s=V.omit(t,"_objects");Object.assign(this,s),this.setViewportTransform((t==null?void 0:t.viewportTransform)||ts),this.ref.objects.effect.scheduler?this.ref.objects.effect.scheduler():this.ref.objects.effect.run(),this.pageId=e}})}setPageJSON(e,t){e!==""&&this.pages.set(e,{viewportTransform:this.viewportTransform,backgroundColor:this.backgroundColor,_objects:[],...this.pages.get(e),...t})}getPageJSON(e){return e===this.pageId?{_objects:this._objects,backgroundColor:this.backgroundColor,viewportTransform:this.viewportTransform}:this.pages.get(e)}initActiveSelection(){this._activeSelection=ln(this._activeSelection),this._activeSelection.subTargetCheck=!0,this._activeSelection.on("mouseup",t=>{t.isClick&&!this._activeSelection.isMoving&&!this._isSelectionKeyPressed(t.e)&&t.subTargets&&t.subTargets.length>0&&(this.setActiveObject(t.subTargets[t.subTargets.length-1]),this.requestRenderAll())});const e=()=>{const t=new Set;this._activeSelection.forEachObject(s=>{const o=s.getParent(!0);o&&t.add(o)}),t.forEach(s=>{s.setDirty()})};this._activeSelection.on({modified:e,moving:e,scaling:e,skewing:e,changed:e})}absolutePan(e,t){var o;const s=[...this.viewportTransform];if(s[4]=-e.x,s[5]=-e.y,t){this.viewportTransform=s,(o=this._cacheBoards)==null||o.forEach(a=>{At.prototype.setCoords.call(a)}),this.requestRenderAll();return}this.setViewportTransform(s)}relativePan(e,t){return this.absolutePan(new ke(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]),t)}initBoard(){this.on("mouse:move",({e,target:t,absolutePointer:s})=>{var a,i;if(!t||!t.isMoving||L.isBoard(t)||(this._cacheBoards||(this._cacheBoards=this.getObjects("Board").filter(r=>r!==t),this.once("mouse:up",()=>{this._cacheBoards=void 0,this._cacheCurrentBoard=void 0})),this._cacheBoards.length===0))return;this.targets=[];const o=this._searchPossibleTargets(this._cacheBoards,s);if(o!==this._cacheCurrentBoard){if(this._cacheCurrentBoard=o,L.isActiveSelection(t)){let r;if(t._objects.some(d=>L.isBoard(d)))return;const u=t._objects.length;let c=!1;for(let d=u-1;d>=0;d--){const p=t._objects[d];if(p.__owningGroup!==o){r===void 0&&(r=t._onAfterObjectsChange,t._onAfterObjectsChange=Le),(a=p.group)==null||a.remove(p);const[h]=p.getParent().remove(p);(o||this).add(h),h.__owningGroup=o,this._activeSelection.insertAt(d,h),c=!0}}c&&this._activeSelection.setCoords(),r!==void 0&&(t._onAfterObjectsChange=r);return}if(!o||!t.getAncestors(!0).includes(o)){if(t.group){const[r]=t.group.remove(t);(i=t.group)==null||i.setDirty(),o?(o.add(r),o.setDirty()):this.add(r),this._setupCurrentTransform(e,r,!1),this.setActiveObject(r)}else if(o&&t!==o){const[r]=t.getParent().remove(t);o.add(r),o.setDirty(),this._setupCurrentTransform(e,r,!1),this.setActiveObject(r)}}}})}};Rn=Ja([Os(0,Et),Os(1,Ze)],Rn);class Wt{constructor(){_(this,"inner_",new Xt);_(this,"size_",50)}pop(){return this.inner_.pop()}push(e){for(this.inner_.push(e);this.length>this.size_;)this.inner_.shift()}get length(){return this.inner_.size}}class As{constructor(){_(this,"undoStates",new Wt);_(this,"redoStates",new Wt);_(this,"isUndoing",!1);_(this,"isTracking",!0);this.push=this.push.bind(this)}pause(){this.isTracking=!1}resume(){this.isTracking=!0}push(e){this.isTracking&&(this.undoStates.push(e),this.redoStates=new Wt)}undo(e){if(this.isUndoing)return;if(!this.canUndo)throw new Error("Nothing to undo");this.isUndoing=!0;const t=this.undoStates.pop();return this.redoStates.push(e),this.isUndoing=!1,t}redo(e){if(this.isUndoing)return;if(!this.canRedo)throw new Error("Nothing to redo");this.isUndoing=!0;const t=this.redoStates.pop();return this.undoStates.push(e),this.isUndoing=!1,t}reset(){this.undoStates=new Wt,this.redoStates=new Wt,this.isUndoing=!1}get canUndo(){return!!this.undoStates.length}get canRedo(){return!!this.redoStates.length}}const Ye=vt("keybindingServices");class yo extends li{constructor(){super();_(this,"mod",/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"⌘":"Ctrl")}bind(t,s,o){if((V.isString(t)||V.isArray(t))&&V.isFunction(s))return super.bind(t,s,o);if(V.isObject(t)&&!V.isArray(t)&&(!s||V.isString(s)))for(const a in t)super.bind(a,t[a],s);return this}trigger(t,s){return Ct(()=>{super.trigger(t,s)}),this}}_n(Ye,yo,Zt.Eager);const as=vt("undoRedoService");class Za{constructor(){_(this,"_stack",[]);_(this,"_stackIndex",-1)}canUndo(){return this._stackIndex>0}canRedo(){return this._stackIndex<this._stack.length&&this._stack.length>0}clear(){this._stack=[],this._stackIndex=-1}add(e){this.canRedo()&&this._stack.splice(this._stackIndex,this._stack.length),this._stack.push(e),this._stackIndex=this._stack.length}undo(){this.canUndo()&&(this._stackIndex--,this._stack[this._stackIndex].undo())}redo(){this.canRedo()&&(this._stack[this._stackIndex].redo(),this._stackIndex++)}}_n(as,Za,Zt.Eager);class Qa{constructor(){_(this,"_timestamp");_(this,"_label","");this._timestamp=new Date().getTime()}getTimestamp(){return this._timestamp}getDuration(){return 0}get label(){return this._label}set label(e){this._label=e}undo(){throw new Error("Not implemented")}redo(){throw new Error("Not implemented")}}var er=Object.defineProperty,tr=Object.getOwnPropertyDescriptor,nr=(n,e,t,s)=>{for(var o=s>1?void 0:s?tr(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(o=(s?i(e,t,o):i(o))||o);return s&&o&&er(e,t,o),o},Ut=(n,e)=>(t,s)=>e(t,s,n);const Mt=vt("editorUndoRedoService");class sr extends Qa{constructor(e,t,s){super(),this.workspacesService=e,this.editorUndoRedoService=t,this.pageId=s}undo(){this.workspacesService.setCurrentId(this.pageId),this.editorUndoRedoService.undo()}redo(){this.workspacesService.setCurrentId(this.pageId),this.editorUndoRedoService.redo()}}let Dn=class extends Ve{constructor(e,t,s,o,a){super();_(this,"canvasEvents");_(this,"pageId");_(this,"undoRedos",new Map);_(this,"saveDispose");_(this,"saveState",V.debounce(()=>{var t;const e=this.pageId;(t=this.saveDispose)==null||t.dispose(),this.saveDispose=Ct(()=>{if(e!==this.pageId)return;const s=this.getUndoRedo();!s||!s.instantiation.isTracking||(this.push(s.lastState),s.lastState=this.getJson(),this.undoRedoService.add(new sr(this.workspacesService,this,e)))})},300));this.canvas=e,this.keybinding=t,this.eventbus=s,this.workspacesService=o,this.undoRedoService=a,t.bind("mod+z",()=>{a.undo()}),t.bind(["mod+y","mod+shift+z"],()=>{a.redo()}),this.canvasEvents={"object:modified":this.saveState.bind(this)},e.on(this.canvasEvents),this.pageId=this.workspacesService.getCurrentId(),this.initWorkspace()}getUndoRedo(){return this.undoRedos.get(this.pageId)}push(e){const t=this.getUndoRedo();t&&(t.instantiation.push(e),this.eventbus.emit("undoRedoStackChange"))}redo(){const e=this.getUndoRedo();if(e&&e.instantiation.canRedo)return e.lastState=e.instantiation.redo(e.lastState),e.lastState&&(this.loadJson(e.lastState),this.eventbus.emit("undoRedoStackChange")),e.lastState}undo(){const e=this.getUndoRedo();if(e&&e.instantiation.canUndo)return e.lastState=e.instantiation.undo(e.lastState),e.lastState&&(this.loadJson(e.lastState),this.eventbus.emit("undoRedoStackChange")),e.lastState}reset(){const e=this.getUndoRedo();e&&(e.instantiation.reset(),this.eventbus.emit("undoRedoStackChange"))}async loadJson(e){const t=this.getUndoRedo();if(!t)return;const{instantiation:s}=t;try{s.pause(),await this.canvas.loadFromJSON(e)}finally{this.canvas.renderAll(),s.resume()}}getJson(){return this.canvas.toObject()}initWorkspace(){const e=this.workspacesService.getCurrentId();this.workspacesService.all().forEach(t=>{this.undoRedos.set(t.id,{instantiation:new As,lastState:this.pageId===e?this.getJson():void 0})}),this.eventbus.on("workspaceAddAfter",({newId:t})=>{this.undoRedos.set(t,{instantiation:new As,lastState:this.pageId===t?this.getJson():{}})}),this.eventbus.on("workspaceRemoveAfter",t=>{this.undoRedos.delete(t)}),this.eventbus.on("workspaceChangeAfter",({newId:t})=>{this.pageId=t})}dispose(){super.dispose(),this.keybinding.unbind(["mod+z","mod+y","mod+shift+z"]),this.canvas.off(this.canvasEvents)}};Dn=nr([Ut(0,Ie),Ut(1,Ye),Ut(2,Ze),Ut(3,Et),Ut(4,as)],Dn);const Ne={editor:null},ye=()=>{if(!Ne.editor){console.warn("app is not ready");return}return Ne.editor.service.invokeFunction(n=>({canvas:n.get(Ie),keybinding:n.get(Ye),undoRedo:n.get(Mt),event:n.get(Ze),workspaces:n.get(Et)}))};let St=null;function or(n){St&&_o(),St=n}function ir(n){n===St&&(St=null)}function _o(){St&&(St.closeMenu(),St=null)}const wt={defaultMinWidth:100,defaultMaxWidth:600,defaultZindex:100,defaultAdjustPadding:10};function cn(n,e){let t=n.offsetTop;return n.offsetParent!=null&&n.offsetParent!=e&&(t-=n.offsetParent.scrollTop,t+=cn(n.offsetParent,e)),t}function rs(n,e){let t=n.offsetLeft;return n.offsetParent!=null&&n.offsetParent!=e&&(t-=n.offsetParent.scrollLeft,t+=rs(n.offsetParent,e)),t}function ar(n,e,t,s){return{x:rs(n,s)+e,y:cn(n,s)+t}}function rr(n){var e;(e=n.parentNode)==null||e.removeChild(n)}const Ps="mx-menu-default-container";function wo(n){const{getContainer:e,zIndex:t}=n;if(e){const o=typeof e=="function"?e():e;if(o)return o.style.zIndex=(t==null?void 0:t.toString())||wt.defaultZindex.toString(),{container:o,isNew:!1}}let s=document.getElementById(Ps);return s&&document.body.removeChild(s),s=document.createElement("div"),s.setAttribute("id",Ps),s.setAttribute("class","mx-menu-ghost-host fullscreen"),s.style.zIndex=(t==null?void 0:t.toString())||wt.defaultZindex.toString(),document.body.appendChild(s),{container:s,isNew:!0}}const ko=B({props:{vnode:{type:[Object,Function],default:null},data:{type:Object,default:null}},setup(n){const{vnode:e,data:t}=Te(n);return()=>typeof e.value=="function"?e.value(t.value):e.value}}),lr={},cr={class:"mx-checked-mark","aria-hidden":"true",viewBox:"0 0 1024 1024"},ur=N("path",{d:"M129.3,428.6L52,512l345,372.5l575-620.8l-69.5-75L400.4,718.2L129.3,428.6z"},null,-1),dr=[ur];function hr(n,e){return g(),T("svg",cr,dr)}const pr=le(lr,[["render",hr]]),fr={},vr={class:"mx-right-arrow","aria-hidden":"true",viewBox:"0 0 1024 1024"},gr=N("path",{d:"M307.018 49.445c11.517 0 23.032 4.394 31.819 13.18L756.404 480.18c8.439 8.438 13.181 19.885 13.181 31.82s-4.741 23.38-13.181 31.82L338.838 961.376c-17.574 17.573-46.065 17.573-63.64-0.001-17.573-17.573-17.573-46.065 0.001-63.64L660.944 512 275.198 126.265c-17.574-17.573-17.574-46.066-0.001-63.64C283.985 53.839 295.501 49.445 307.018 49.445z"},null,-1),mr=[gr];function br(n,e){return g(),T("svg",vr,mr)}const So=le(fr,[["render",br]]),yr=B({name:"ContextMenuItem",components:{VNodeRender:ko,ContextMenuIconCheck:pr,ContextMenuIconRight:So},props:{disabled:{type:Boolean,default:!1},hidden:{type:Boolean,default:!1},customRender:{type:Function,default:null},customClass:{type:String,default:""},clickHandler:{type:Function,default:null},label:{type:[String,Object,Function],default:""},icon:{type:[String,Object,Function],default:""},iconFontClass:{type:String,default:"iconfont"},checked:{type:Boolean,default:!1},shortcut:{type:String,default:""},svgIcon:{type:String,default:""},svgProps:{type:Object,default:null},preserveIconWidth:{type:Boolean,default:!0},showRightArrow:{type:Boolean,default:!1},hasChildren:{type:Boolean,default:!1},clickClose:{type:Boolean,default:!0},clickableWhenHasChildren:{type:Boolean,default:!1}},emits:["click","subMenuOpen","subMenuClose"],setup(n,e){const{clickHandler:t,clickClose:s,clickableWhenHasChildren:o,disabled:a,hidden:i,label:r,icon:l,iconFontClass:u,showRightArrow:c,shortcut:d,hasChildren:p}=Te(n),h=I(!1),v=I(!1),w=I(),b=Ae("globalHasSlot"),S=Ae("globalRenderSlot"),C=Ae("globalTheme"),z=Ae("globalIconFontClass"),J=Ae("globalCloseMenu"),K=Ae("menuContext"),G={showSubMenu:()=>{h.value?K.markActiveMenuItem(G,!0):p.value&&te()},isDisabledOrHidden:()=>a.value||i.value,getElement:()=>w.value,focus:()=>v.value=!0,blur:()=>v.value=!1,click:ie};Qe(()=>{K.isMenuItemDataCollectedFlag()?pn(()=>{let ce=0;const Se=K.getElement();if(Se){let Ee=0;for(let Re=0;Re<Se.children.length;Re++){const P=Se.children[Re];if(P.getAttribute("data-type")==="ContextMenuItem"){if(P===w.value){ce=Ee;break}Ee++}}}K.addChildMenuItem(G,ce)}):K.addChildMenuItem(G)}),fn(()=>{K.removeChildMenuItem(G)});function ie(ce){a.value||ce&&ce.target.classList.contains("mx-context-no-clickable")||(p.value?o.value?(typeof t.value=="function"&&t.value(),e.emit("click")):h.value||te():(typeof t.value=="function"&&t.value(),e.emit("click"),s.value&&J()))}function te(ce){v.value=!1,K.checkCloseOtherSubMenuTimeOut()||K.closeOtherSubMenu(),a.value||(K.markActiveMenuItem(G),p.value&&(ce||K.markThisOpenedByKeyBoard(),K.addOpenedSubMenu(()=>{v.value=!1,h.value=!1,e.emit("subMenuClose")}),h.value=!0,e.emit("subMenuOpen")))}const ee=()=>({disabled:a.value,label:r.value,icon:l.value,iconFontClass:u.value,showRightArrow:c.value,clickClose:s.value,clickableWhenHasChildren:o.value,shortcut:d.value,theme:C,isOpen:h,hasChildren:p,onClick:ie,onMouseEnter:te});return{getItemDataForChildren:ee,showSubMenu:h,keyBoardFocusMenu:v,menuItemRef:w,globalHasSlot:b,globalRenderSlot:S,globalIconFontClass:z,onMouseEnter:te,onClick:ie,vnodeItemRender:()=>S("itemRender",ee()),vnodeItemIconRender:()=>S("itemIconRender",ee()),vnodeItemCheckRender:()=>S("itemCheckRender",ee()),vnodeItemLabelRender:()=>S("itemLabelRender",ee()),vnodeItemRightArrowRender:()=>S("itemRightArrowRender",ee()),vnodeItemShortcutRender:()=>S("itemShortcutRender",ee())}}}),_r={key:0,class:"mx-context-menu-item-wrapper",ref:"menuItemRef","data-type":"ContextMenuItem"},wr={class:"mx-item-row"},kr=["xlink:href"],Sr={key:1,class:"label"},xr={class:"mx-item-row"},Cr={class:"mx-shortcut"};function Mr(n,e,t,s,o,a){const i=xe("VNodeRender"),r=xe("ContextMenuIconCheck"),l=xe("ContextMenuIconRight");return n.hidden?Z("",!0):(g(),T("div",_r,[n.globalHasSlot("itemRender")?(g(),O(i,{key:0,vnode:n.vnodeItemRender},null,8,["vnode"])):n.customRender?(g(),O(i,{key:1,vnode:n.customRender,data:n.getItemDataForChildren()},null,8,["vnode","data"])):(g(),T("div",{key:2,class:ve(["mx-context-menu-item",n.disabled?"disabled":"",n.keyBoardFocusMenu?"keyboard-focus":"",n.customClass?" "+n.customClass:"",n.showSubMenu?"open":""]),onClick:e[0]||(e[0]=(...u)=>n.onClick&&n.onClick(...u)),onMouseenter:e[1]||(e[1]=(...u)=>n.onMouseEnter&&n.onMouseEnter(...u))},[se(n.$slots,"default",{},()=>[N("div",wr,[N("div",{class:ve(["mx-icon-placeholder",n.preserveIconWidth?"preserve-width":""])},[se(n.$slots,"icon",{},()=>[n.globalHasSlot("itemIconRender")?(g(),O(i,{key:0,vnode:n.vnodeItemIconRender},null,8,["vnode"])):typeof n.svgIcon=="string"&&n.svgIcon?(g(),T("svg",oe({key:1,class:"icon svg"},n.svgProps),[N("use",{"xlink:href":n.svgIcon},null,8,kr)],16)):typeof n.icon!="string"?(g(),O(i,{key:2,vnode:n.icon,data:n.icon},null,8,["vnode","data"])):typeof n.icon=="string"&&n.icon!==""?(g(),T("i",{key:3,class:ve(n.icon+" icon "+n.iconFontClass+" "+n.globalIconFontClass)},null,2)):Z("",!0)]),n.checked?se(n.$slots,"check",{key:0},()=>[n.globalHasSlot("itemCheckRender")?(g(),O(i,{key:0,vnode:n.vnodeItemCheckRender},null,8,["vnode"])):Z("",!0),f(r)]):Z("",!0)],2),se(n.$slots,"label",{},()=>[n.globalHasSlot("itemLabelRender")?(g(),O(i,{key:0,vnode:n.vnodeItemLabelRender},null,8,["vnode"])):typeof n.label=="string"?(g(),T("span",Sr,Be(n.label),1)):(g(),O(i,{key:2,vnode:n.label,data:n.label},null,8,["vnode","data"]))])]),N("div",xr,[n.shortcut?se(n.$slots,"shortcut",{key:0},()=>[n.globalHasSlot("itemShortcutRender")?(g(),O(i,{key:0,vnode:n.vnodeItemShortcutRender},null,8,["vnode"])):Z("",!0),N("span",Cr,Be(n.shortcut),1)]):Z("",!0),n.showRightArrow?se(n.$slots,"rightArrow",{key:1},()=>[n.globalHasSlot("itemRightArrowRender")?(g(),O(i,{key:0,vnode:n.vnodeItemRightArrowRender},null,8,["vnode"])):Z("",!0),f(l)]):Z("",!0)])])],34)),n.showSubMenu?se(n.$slots,"submenu",{key:3}):Z("",!0)],512))}const ls=le(yr,[["render",Mr]]),Or=B({name:"ContextMenuSperator"}),Ar={class:"mx-context-menu-item-sperator mx-context-no-clickable"};function Pr(n,e,t,s,o,a){return g(),T("div",Ar)}const jn=le(Or,[["render",Pr]]),Ir=B({name:"ContextSubMenu",components:{ContextMenuItem:ls,ContextMenuSeparator:jn,VNodeRender:ko,ContextMenuIconRight:So},props:{items:{type:Object,default:null},maxWidth:{type:[String,Number],default:0},minWidth:{type:[String,Number],default:0},adjustPosition:{type:Boolean,default:!0}},setup(n){const e=Ae("menuContext"),t=Ae("globalOptions"),s=Ae("globalHasSlot"),o=Ae("globalRenderSlot"),a=Ae("globalTheme");Ae("globalIsFullScreenContainer");const{zIndex:i,getMyPosition:r,getParentWidth:l}=e,{adjustPosition:u}=Te(n),c=I(),d=I(),p=[],h=Ae("globalSetCurrentSubMenu"),v=[];let w=null,b=0;function S(){w&&w.blur()}function C(k,D){if(k){for(let E=D!==void 0?D:0;E<v.length;E++)if(!v[E].isDisabledOrHidden()){z(E);break}}else for(let E=D!==void 0?D:v.length-1;E>=0;E--)if(!v[E].isDisabledOrHidden()){z(E);break}}function z(k){if(w&&S(),k!==void 0&&(w=v[Math.max(0,Math.min(k,v.length-1))]),!!w&&(w.focus(),Ee.value)){const D=w.getElement();D&&(ee.value=Math.min(Math.max(-ce.value,-D.offsetTop-D.offsetHeight+P.value),0))}}function J(){h(K)}const K={isTopLevel:()=>e.getParentContext()===null,closeSelfAndActiveParent:()=>{var D;const k=te.getParentContext();k&&(k.closeOtherSubMenu(),(D=k.getSubMenuInstanceContext())==null||D.focusCurrentItem())},closeCurrentSubMenu:()=>{var k;return(k=te.getParentContext())==null?void 0:k.closeOtherSubMenu()},moveCurrentItemFirst:()=>C(!0),moveCurrentItemLast:()=>C(!1),moveCurrentItemDown:()=>C(!0,w?v.indexOf(w)+1:0),moveCurrentItemUp:()=>C(!1,w?v.indexOf(w)-1:0),focusCurrentItem:()=>z(),openCurrentItemSubMenu:()=>w==null?void 0:w.showSubMenu(),triggerCurrentItemClick:()=>w==null?void 0:w.click()};let G=!1,ie=!1;const te={zIndex:i+1,container:e.container,adjustPadding:e.adjustPadding,getMyPosition(){const k={x:0,y:0};return c.value&&(k.x=c.value.offsetWidth+(t.xOffset||0)),t.yOffset&&(k.y=t.yOffset),k},getParentWidth:()=>{var k;return((k=c.value)==null?void 0:k.offsetWidth)||0},getParentAbsY:()=>c.value?cn(c.value,e.container):0,addOpenedSubMenu(k){p.push(k)},closeOtherSubMenu(){p.forEach(k=>k()),p.splice(0,p.length),h(K)},checkCloseOtherSubMenuTimeOut(){return b?(clearTimeout(b),b=0,!0):!1},closeOtherSubMenuWithTimeOut(){b=setTimeout(()=>{b=0,this.closeOtherSubMenu()},200)},addChildMenuItem:(k,D)=>{D===void 0?v.push(k):v.splice(D,0,k)},removeChildMenuItem:k=>{v.splice(v.indexOf(k),1)},markActiveMenuItem:(k,D=!1)=>{S(),w=k,D&&z()},markThisOpenedByKeyBoard:()=>{G=!0},isOpenedByKeyBoardFlag:()=>G?(G=!1,!0):!1,isMenuItemDataCollectedFlag:()=>ie,getElement:()=>c.value||null,getParentContext:()=>e,getSubMenuInstanceContext:()=>K};De("menuContext",te);const ee=I(0),ce=I(0);function Se(k){k?ee.value=Math.max(ee.value-50,-ce.value):ee.value=Math.min(ee.value+50,0)}const Ee=I(!1),Re=I({x:0,y:0}),P=I(0);return Qe(()=>{Re.value=r(),h(K),pn(()=>{const k=c.value;if(u.value&&k&&d.value){const{container:D,adjustPadding:E}=e,Y=document.documentElement.scrollHeight,X=document.documentElement.scrollWidth,Q=Math.min(X,D.offsetWidth),x=Math.min(Y,D.offsetHeight),R=rs(k,D),ue=cn(k,D),H=R+k.offsetWidth-Q,Me=ue+k.offsetHeight-x;if(ce.value=k.offsetHeight-x+E*2,Ee.value=Me>0,H>0&&(Re.value.x-=(l?l():0)+k.offsetWidth-E),Ee.value){const tt=Math.min(ue-E,Me+E);Re.value.y-=tt,P.value=x-E*2}else P.value=0}k==null||k.focus({preventScroll:!0}),e.isOpenedByKeyBoardFlag()&&C(!0),ie=!0})}),{menu:c,scroll:d,options:t,zIndex:i,constOptions:wt,scrollValue:ee,overflow:Ee,position:Re,scrollHeight:ce,maxHeight:P,globalHasSlot:s,globalRenderSlot:o,globalTheme:a,onScroll:Se,onSubMenuBodyClick:J,vnode:()=>o("separatorRender",{})}}}),$r={class:"mx-context-menu-scroll",ref:"scroll"};function Tr(n,e,t,s,o,a){const i=xe("ContextSubMenu",!0),r=xe("ContextMenuItem"),l=xe("VNodeRender"),u=xe("ContextMenuSeparator"),c=xe("ContextMenuIconRight");return g(),T("div",{class:ve(["mx-context-menu",[n.options.customClass,n.globalTheme]]),style:He({maxWidth:n.maxWidth?n.maxWidth:`${n.constOptions.defaultMaxWidth}px`,minWidth:n.minWidth?n.minWidth:`${n.constOptions.defaultMinWidth}px`,maxHeight:n.overflow&&n.maxHeight>0?`${n.maxHeight}px`:void 0,zIndex:n.zIndex,left:`${n.position.x}px`,top:`${n.position.y}px`}),"data-type":"ContextSubMenu",onClick:e[2]||(e[2]=(...d)=>n.onSubMenuBodyClick&&n.onSubMenuBodyClick(...d)),onContextmenu:e[3]||(e[3]=d=>d.preventDefault())},[N("div",{class:"mx-context-menu-items",ref:"menu",style:He({top:`${n.scrollValue}px`})},[se(n.$slots,"default",{},()=>[(g(!0),T(he,null,ze(n.items,(d,p)=>(g(),T(he,{key:p},[f(r,{clickHandler:d.onClick,disabled:d.disabled,hidden:d.hidden,icon:d.icon,iconFontClass:d.iconFontClass,svgIcon:d.svgIcon,svgProps:d.svgProps,label:d.label,customRender:d.customRender,customClass:d.customClass,checked:d.checked,shortcut:d.shortcut,clickClose:d.clickClose,clickableWhenHasChildren:d.clickableWhenHasChildren,preserveIconWidth:d.preserveIconWidth!==void 0?d.preserveIconWidth:n.options.preserveIconWidth,showRightArrow:d.children&&d.children.length>0,hasChildren:d.children&&d.children.length>0,onSubMenuOpen:d.onSubMenuOpen,onSubMenuClose:d.onSubMenuClose},qt({_:2},[d.children&&d.children.length>0?{name:"submenu",fn:y(()=>[f(i,{items:d.children,maxWidth:d.maxWidth,minWidth:d.minWidth,adjustPosition:d.adjustSubMenuPosition!==void 0?d.adjustSubMenuPosition:n.options.adjustPosition},null,8,["items","maxWidth","minWidth","adjustPosition"])]),key:"0"}:void 0]),1032,["clickHandler","disabled","hidden","icon","iconFontClass","svgIcon","svgProps","label","customRender","customClass","checked","shortcut","clickClose","clickableWhenHasChildren","preserveIconWidth","showRightArrow","hasChildren","onSubMenuOpen","onSubMenuClose"]),d.divided&&n.globalHasSlot("separatorRender")?(g(),O(l,{key:0,vnode:n.vnode},null,8,["vnode"])):d.divided?(g(),O(u,{key:1})):Z("",!0)],64))),128))])],4),N("div",$r,[ys(N("div",{class:"mx-context-menu-updown mx-context-no-clickable up",onClick:e[0]||(e[0]=d=>n.onScroll(!1))},[f(c)],512),[[_s,n.overflow&&n.scrollValue<0]]),ys(N("div",{class:"mx-context-menu-updown mx-context-no-clickable down",onClick:e[1]||(e[1]=d=>n.onScroll(!0))},[f(c)],512),[[_s,n.overflow&&n.scrollValue>-n.scrollHeight]])],512)],38)}const cs=le(Ir,[["render",Tr]]),un=di({selector:"body",attribute:"arco-theme",emitAuto:!0,storageKey:"theme",initialValue:"dark",modes:{}}),Er=hi(),{next:Rr}=pi(["light","dark","auto"],{initialValue:un}),xo=j(()=>un.value==="auto"?Er.value?"dark":"light":un.value),Dr=j(()=>xo.value==="dark");function us(){return{isDark:Dr,mode:un,trueMode:xo,next:Rr}}const Co=B({name:"ContextMenu",props:{options:{type:Object,default:null},show:{type:Boolean,default:!1},container:{type:Object,default:null},isFullScreenContainer:{type:Boolean,default:!0}},emits:["update:show","close"],setup(n,e){var w,b;const{options:t,show:s,container:o}=Te(n);Qe(()=>{s.value&&i()}),fn(()=>{u()}),Fe(s,S=>{S?i():u()});const a={closeMenu:r};function i(){l(),or(a)}function r(){e.emit("update:show",!1),e.emit("close"),ir(a)}e.expose({closeMenu:r});function l(){document.addEventListener("mousedown",h,!0),document.addEventListener("contextmenu",h,!0),document.addEventListener("wheel",p,!0),t.value.keyboardControl!==!1&&document.addEventListener("keydown",d)}function u(){document.removeEventListener("mousedown",h,!0),document.removeEventListener("contextmenu",h,!0),document.removeEventListener("wheel",p,!0),t.value.keyboardControl!==!1&&document.removeEventListener("keydown",d)}const c=I();De("globalSetCurrentSubMenu",S=>c.value=S);function d(S){var z,J,K,G,ie,te,ee,ce,Se;let C=!0;switch(S.key){case"Escape":{((z=c.value)==null?void 0:z.isTopLevel())===!1?(J=c.value)==null||J.closeCurrentSubMenu():r();break}case"ArrowDown":(K=c.value)==null||K.moveCurrentItemDown();break;case"ArrowUp":(G=c.value)==null||G.moveCurrentItemUp();break;case"Home":(ie=c.value)==null||ie.moveCurrentItemFirst();break;case"End":(te=c.value)==null||te.moveCurrentItemLast();break;case"ArrowLeft":{(ee=c.value)==null||ee.closeSelfAndActiveParent();break}case"ArrowRight":(ce=c.value)==null||ce.openCurrentItemSubMenu();break;case"Enter":(Se=c.value)==null||Se.triggerCurrentItemClick();break;default:C=!1;break}C&&c.value&&(S.stopPropagation(),S.preventDefault())}function p(){t.value.closeWhenScroll!==!1&&r()}function h(S){v(S.target)}function v(S){for(;S;){if(S.classList&&S.classList.contains("mx-menu-host"))return;S=S.parentNode}u(),r()}return De("globalOptions",t.value),De("globalCloseMenu",r),De("globalTheme",((w=t.value)==null?void 0:w.theme)||us().trueMode),De("globalIsFullScreenContainer",n.isFullScreenContainer),De("globalIconFontClass",((b=t.value)==null?void 0:b.iconFontClass)||"iconfont"),De("globalHasSlot",S=>e.slots[S]!==void 0),De("globalRenderSlot",(S,C)=>se(e.slots,S,{...C})),De("menuContext",{zIndex:t.value.zIndex||wt.defaultZindex,container:o.value,adjustPadding:t.value.adjustPadding||wt.defaultAdjustPadding,getParentAbsY:()=>t.value.y,getMyPosition:()=>({x:t.value.x,y:t.value.y}),getParentWidth:()=>0,closeOtherSubMenuWithTimeOut:()=>{},checkCloseOtherSubMenuTimeOut:()=>!1,addOpenedSubMenu:()=>{},closeOtherSubMenu:()=>{},getParentContext:()=>null,getSubMenuInstanceContext:()=>null,getElement:()=>null,addChildMenuItem:()=>{},removeChildMenuItem:()=>{},markActiveMenuItem:()=>{},markThisOpenedByKeyBoard:()=>{},isOpenedByKeyBoardFlag:()=>!1,isMenuItemDataCollectedFlag:()=>!1}),()=>{var S,C;return s.value?[Pe("div",{class:"mx-menu-ghost-host"},[Pe(cs,{class:"mx-menu-host",items:(S=t.value)==null?void 0:S.items,adjustPosition:(C=t.value)==null?void 0:C.adjustPosition,maxWidth:t.value.maxWidth||wt.defaultMaxWidth,minWidth:t.value.minWidth||wt.defaultMinWidth},{default:e.slots.default})])]:[]}}}),jr=B({name:"ContextMenu",props:{options:{type:Object,default:null},show:{type:Boolean,default:!1}},emits:["update:show","close"],setup(n,e){const{options:t,show:s}=Te(n);let o=null,a=!1;function i(){const{container:l,isNew:u}=wo(t.value),c=Pe(Co,{options:t,show:!0,container:l,isFullScreenContainer:!u,"onUpdate:show":d=>e.emit("update:show",d),onClose:()=>{var d,p;jt(null,l),(p=(d=t.value).onClose)==null||p.call(d),e.emit("close")}},e.slots);a=u,o=l,jt(c,l)}function r(){o&&(a&&rr(o),o=null)}return Fe(s,l=>{l?i():r()}),e.expose({closeMenu:r}),()=>[]}}),Lr=B({name:"ContextMenuGroup",props:{disabled:{type:Boolean,default:!1},hidden:{type:Boolean,default:!1},clickHandler:{type:Function,default:null},label:{type:String,default:""},icon:{type:String,default:""},iconFontClass:{type:String,default:"iconfont"},checked:{type:Boolean,default:!1},shortcut:{type:String,default:""},svgIcon:{type:String,default:""},svgProps:{type:Object,default:null},preserveIconWidth:{type:Boolean,default:!0},showRightArrow:{type:Boolean,default:!1},clickClose:{type:Boolean,default:!0},adjustSubMenuPosition:{type:Boolean,default:void 0},maxWidth:{type:[String,Number],default:0},minWidth:{type:[String,Number],default:0}},setup(n,e){const t=Ae("globalOptions"),{adjustSubMenuPosition:s,maxWidth:o,minWidth:a}=Te(n),i=typeof s.value<"u"?s.value:t.adjustPosition;return()=>Pe(ls,{...n,showRightArrow:!0,maxWidth:void 0,minWidth:void 0,adjustSubMenuPosition:void 0,hasChildren:typeof e.slots.default<"u"},e.slots.default?{submenu:()=>Pe(cs,{maxWidth:o.value,minWidth:a.value,adjustPosition:i},{default:e.slots.default})}:void 0)}});function Br(n,e,t,s){const o=Pe(Co,{options:n,show:!0,container:e,isFullScreenContainer:!t,onClose:()=>{var i;const a=()=>{var r;jt(null,e),(r=n.onClose)==null||r.call(n)};if((i=o.el)!=null&&i.parentElement){const r=o.el.parentElement.querySelector(".mx-context-menu");if(r){r.addEventListener("transitionend",a,{once:!0}),r.style.opacity="0",r.style.pointerEvents="none";return}}a()}},s);return jt(o,e),o.component}function Is(n,e){const t=wo(n);return Br(n,t.container,t.isNew,e).exposed}const Bt={install(n){n.config.globalProperties.$contextmenu=Is,n.component("ContextMenu",jr),n.component("ContextMenuItem",ls),n.component("ContextMenuGroup",Lr),n.component("ContextMenuSperator",jn),n.component("ContextMenuSeparator",jn),n.component("ContextSubMenu",cs)},showContextMenu(n,e){return Is(n,e)},closeContextMenu:_o,transformMenuPosition:ar};function zr(){const{canvas:n}=ye(),{isSupported:e,create:t,open:s,data:o,save:a}=fi({types:[{accept:{"application/json":[".json"]}}],dataType:"Text"}),{open:i,onChange:r}=vi({accept:"application/json"});return r(c=>{var d;c&&((d=c.item(0))==null||d.text().then(p=>{n.importPages(p)}))}),{importPages:async()=>{if(e){if(o.value=void 0,await s(),!U(o))return;n.importPages(o.value)}else i()},exportPages:async()=>{if(e)await t({suggestedName:"未命名.json"}),o.value=JSON.stringify(n.exportPages()),await a(),o.value=void 0;else{const c=new Blob([JSON.stringify(n.exportPages())]),d=document.createElement("a");d.href=URL.createObjectURL(c),d.download="未命名.json",d.click()}}}}const Nr=B({__name:"menu",setup(n){const{exportPages:e,importPages:t}=zr(),s=o=>{Bt.showContextMenu({x:o.clientX,y:o.clientY,preserveIconWidth:!1,items:[{label:"导入",onClick:t},{label:"导出",onClick:e}]})};return(o,a)=>{const i=gi,r=we;return g(),O(r,{onClick:s},{icon:y(()=>[f(i)]),_:1})}}}),Hr=["xlink:href","fill"],qe=B({__name:"svgIcon",props:{name:{},prefix:{default:"icon"},size:{default:18},fill:{default:"currentColor"}},setup(n){const e=n,t=j(()=>`#${e.prefix}-${e.name}`),s=mi(),o=j(()=>({width:`${e.size}px`,height:`${e.size}px`}));return(a,i)=>(g(),T("svg",oe({"aria-hidden":"true",style:m(o)},m(s)),[N("use",{"xlink:href":m(t),fill:a.fill},null,8,Hr)],16))}}),Fr=B({name:"DropdownButton",components:{SvgIcon:qe},props:{active:{type:Boolean,default:!1},popupVisible:{type:Boolean,default:void 0},defaultPopupVisible:{type:Boolean,default:!1},trigger:{type:[String,Array],default:"click"},position:{type:String,default:"br"},popupContainer:{type:[String,Object]},disabled:{type:Boolean,default:!1},size:{type:String},buttonProps:{type:Object},hideOnSelect:{type:Boolean,default:!0}},emits:{"update:popupVisible":n=>!0,popupVisibleChange:n=>!0,click:n=>!0,select:(n,e)=>!0},setup(n,{emit:e}){const{defaultPopupVisible:t,popupVisible:s}=Te(n),o=vn("dropdown"),{computedPopupVisible:a,handlePopupVisibleChange:i}=bi({defaultPopupVisible:t,popupVisible:s,emit:e});return{prefixCls:o,computedPopupVisible:a,handleClick:u=>{e("click",u)},handleSelect:(u,c)=>{e("select",u,c)},handlePopupVisibleChange:i}}});function Vr(n,e,t,s,o,a){const i=xe("SvgIcon"),r=we,l=Us;return g(),O(r,oe({class:["btn-box",{active:n.active}],size:n.size,disabled:n.disabled},n.buttonProps,{onClick:n.handleClick}),{icon:y(()=>[se(n.$slots,"default",{},void 0,!0),n.$slots.content?(g(),O(l,{key:0,"popup-visible":n.computedPopupVisible,trigger:n.trigger,position:n.position,"popup-container":n.popupContainer,"hide-on-select":n.hideOnSelect,onSelect:n.handleSelect,onPopupVisibleChange:n.handlePopupVisibleChange},{content:y(()=>[se(n.$slots,"content",{},void 0,!0)]),default:y(()=>[f(r,{class:"more-btn absolute! w12px! h12px! bottom-0 right-0 bg-transparent! transition translate-0",disabled:n.disabled},{icon:y(()=>[se(n.$slots,"icon",{popupVisible:n.computedPopupVisible},()=>[f(i,{name:"dropdown-more",size:12})],!0)]),_:3},8,["disabled"])]),_:3},8,["popup-visible","trigger","position","popup-container","hide-on-select","onSelect","onPopupVisibleChange"])):Z("",!0)]),_:3},16,["class","size","disabled","onClick"])}const Kr=le(Fr,[["render",Vr],["__scopeId","data-v-4758a156"]]),ot=yi("app",()=>{const n=I(0);return{activeTool:I("move"),zoom:n}}),Wr=_i(),Ur=B({__name:"tool",setup(n){const{activeTool:e}=_t(ot()),t=I([{key:"move",icon:"bxs-pointer",name:"选择工具",doption:[{key:"move",icon:"bxs-pointer",name:"选择工具"},{key:"handMove",icon:"bxs-hand",name:"移动视图"}]},{key:"board",icon:"artboard",name:"画板"},{key:"rect",icon:"bx-square",name:"矩形",doption:[{key:"rect",icon:"bx-square",name:"矩形"},{key:"ellipse",icon:"bx-circle",name:"圆形"},{key:"triangle",icon:"bx-triangle",name:"三角形"}]},{key:"vector",icon:"bx-pen",name:"钢笔"},{key:"text",icon:"bx-text",name:"文本"}]),s=o=>{e.value=o};return(o,a)=>{const i=Gs,r=Nt;return g(),O(r,null,{default:y(()=>[(g(!0),T(he,null,ze(m(t),(l,u)=>(g(),O(Kr,{key:l.key,active:m(e)===l.key,onClick:c=>s(l.key),onSelect:c=>{m(t)[u]={...m(t)[u],...c},s(c.key)}},qt({default:y(()=>[f(m(qe),{name:l.icon},null,8,["name"])]),_:2},[l.doption?{name:"content",fn:y(()=>[(g(!0),T(he,null,ze(l.doption,c=>(g(),O(i,{key:c.key,value:c},{icon:y(()=>[f(m(qe),{name:c.icon},null,8,["name"])]),default:y(()=>[me(" "+Be(c.name),1)]),_:2},1032,["value"]))),128))]),key:"0"}:void 0]),1032,["active","onClick","onSelect"]))),128))]),_:1})}}}),Mo=()=>{const{canvas:n,keybinding:e}=ye(),{mod:t}=e;return[{label:"向上移动一层",onClick:()=>{e.trigger("mod+]")},shortcut:`${t} ]`},{label:"移到顶层",onClick:()=>{e.trigger("]")},shortcut:"]"},{label:"向下移动一层",onClick:()=>{e.trigger("mod+[")},shortcut:`${t} [`},{label:"移到底层",onClick:()=>{e.trigger("[")},shortcut:"[",divided:!0},{label:"创建分组",hidden:n.getActiveObject()instanceof Ce,onClick:()=>{e.trigger(Lt.group)},shortcut:`${t} G`},{label:"解除分组",hidden:!(n.getActiveObject()instanceof et),onClick:()=>{e.trigger(Lt.ungroup)},shortcut:`${t} ⇧ G`},{label:"重命名",hidden:n.getActiveObject()instanceof at,onClick:()=>{e.trigger("mod+r")},shortcut:`${t} R`,divided:!0},{label:"显示/隐藏",onClick:()=>{e.trigger("mod+shift+h")},shortcut:`${t} ⇧ H`},{label:"锁定/解锁",onClick:()=>{e.trigger("mod+shift+l")},shortcut:`${t} ⇧ L`}]},Oo=()=>{const{keybinding:n}=ye();return[{label:"放大",onClick:()=>{n.trigger("+")},shortcut:"+"},{label:"缩小",onClick:()=>{n.trigger("-")},shortcut:"-"}]},Gr=B({__name:"zoom",setup(n){const{zoom:e}=_t(ot()),{canvas:t,keybinding:s}=ye(),o=I(),a=I();Ge(()=>{a.value=_e.times(e.value,100)+"%"});const i=r=>{var c;let l=r.clientX,u=r.clientY;if(U(o)){const d=(c=o.value)==null?void 0:c.$el.getBoundingClientRect();l=Math.max(d.x-8,0),u=d.y+d.height+4}Bt.showContextMenu({x:l,y:u,preserveIconWidth:!1,items:[{customRender:()=>Pe("div",{class:"p2"},Pe(Ht,{size:"small",modelValue:a.value,"onUpdate:modelValue":d=>{a.value=d},onChange:d=>{const p=parseInt(d);!V.isNumber(p)||Number.isNaN(p)||t.zoomToPoint(t.getCenterPoint(),_e.divide(p,100))}},{}))},...Oo(),{label:"50%",onClick:()=>{t.zoomToPoint(t.getCenterPoint(),.5)}},{label:"100%",onClick:()=>{s.trigger("mod+0")},shortcut:`${s.mod} 0`},{label:"200%",onClick:()=>{t.zoomToPoint(t.getCenterPoint(),2)},divided:!0},{label:"显示全部",onClick:()=>{s.trigger("mod+1")},shortcut:`${s.mod} 1`},{label:"显示选中内容",onClick:()=>{s.trigger("mod+2")},disabled:!U(t.activeObject),shortcut:`${s.mod} 2`}]})};return(r,l)=>{const u=Ys,c=we;return g(),O(c,{ref_key:"button",ref:o,class:"icon-btn px2!",onClick:i},{default:y(()=>[me(Be(m(_e).times(m(e),100))+"% ",1),f(u,{class:"ml1"})]),_:1},512)}}}),Yr=B({setup(){const{canvas:n,keybinding:e}=ye(),t=()=>f(we,{onClick:()=>e.trigger(Lt.group),class:"icon-btn",disabled:n.activeObject.value instanceof Ce},{icon:()=>f(qe,{name:"object-group"},null)}),s=()=>f(we,{onClick:()=>e.trigger(Lt.ungroup),class:"icon-btn",disabled:!(n.activeObject.value instanceof et)},{icon:()=>f(qe,{name:"object-ungroup"},null)});return()=>f(he,null,[t(),s()])}}),Xr=B({setup(){return()=>f("div",null,[me("未命名")])}}),qr={};function Jr(n,e){const t=we,s=Nt;return g(),O(s,null,{default:y(()=>[f(t,{onClick:e[0]||(e[0]=o=>n.$router.push({name:"Home"}))},{default:y(()=>[me(" 退出 ")]),_:1})]),_:1})}const Zr=le(qr,[["render",Jr]]),Qr={class:"flex items-center h-12 px-2"},el={class:"flex-1 flex items-center"},tl={class:"truncate"},nl={class:"flex-1 flex justify-end"},sl=B({__name:"headerBar",setup(n){const{canvas:e}=ye();return(t,s)=>{const o=Xs;return g(),T("div",Qr,[N("div",el,[f(Nr),f(o,{direction:"vertical"}),f(Ur),f(o,{direction:"vertical"}),f(Gr)]),N("div",tl,[m(U)(m(e).activeObject)?(g(),O(m(Yr),{key:0})):(g(),O(m(Xr),{key:1}))]),N("div",nl,[f(Zr)])])}}}),ol=B({setup(){const{canvas:n}=ye(),e=I();Qe(()=>{var s;(s=e.value)==null||s.append(n.wrapperEl),qs(e,o=>{const[a]=o,{width:i,height:r}=a.contentRect;n.lowerCanvasEl&&n.setDimensions({width:i,height:r})})});const{isDark:t}=us();return{divRef:e,isDark:t}},render(){return f("div",{ref:"divRef",class:["relative h-full w-full",this.isDark?" bg-$color-neutral-1":" bg-$color-neutral-2"]},null)}}),Ao=Symbol("TreeInjectionKey");function il(n){const e=[];function t(s){s&&s.forEach(o=>{e.push(o),t(o.children)})}return t(n),e}function al(n){const e=new Map;return n.forEach(t=>{e.set(t.key,t)}),e}function $s(n){return n.selectable&&!n.disabled}function Ts(n){return!n.isLeaf&&n.children}function rl(n){return wi(n.isLeaf)?n.isLeaf:!n.children}function Ln(n){return Set.prototype.add.bind(n)}function Bn(n){return Set.prototype.delete.bind(n)}function Rt(n){return n.disabled||n.disableCheckbox?!1:!!n.checkable}function ds(n){var t;const e=[];return(t=n.children)==null||t.forEach(s=>{Rt(s)&&e.push(s.key,...ds(s))}),e}function Po(n){var a;const{node:e,checkedKeySet:t,indeterminateKeySet:s}=n;let o=e.parent;for(;o;){if(Rt(o)){const i=o.key,r=((a=o.children)==null?void 0:a.filter(Rt))||[];let l=0;const u=r.length;r.some(({key:c})=>{if(t.has(c))l+=1;else if(s.has(c))return l+=.5,!0;return!1}),l&&l!==u?s.add(i):s.delete(i),l&&l===u?t.add(i):t.delete(i)}o=o.parent}}function Es(n){const{node:e,checked:t,checkedKeys:s,indeterminateKeys:o,checkStrictly:a=!1}=n,{key:i}=e,r=new Set(s),l=new Set(o);if(t?r.add(i):r.delete(i),l.delete(i),!a){const u=ds(e);t?u.forEach(Ln(r)):u.forEach(Bn(r)),u.forEach(Bn(l)),Po({node:e,checkedKeySet:r,indeterminateKeySet:l})}return[[...r],[...l]]}function ll(n){const{initCheckedKeys:e,key2TreeNode:t,checkStrictly:s,onlyCheckLeaf:o}=n,a=new Set,i=new Set,r=new Set;return s?e.forEach(Ln(a)):e.forEach(l=>{var d;const u=t.get(l);if(!u||i.has(l)||o&&((d=u.children)!=null&&d.length))return;const c=ds(u);c.forEach(Ln(i)),c.forEach(Bn(r)),a.add(l),r.delete(l),Po({node:u,checkedKeySet:a,indeterminateKeySet:r})}),[[...a,...i],[...r]]}function wn(){return Ae(Ao)||{}}const cl=B({name:"TreeNodeSwitcher",components:{IconLoading:ws,RenderFunction:Js},props:{prefixCls:String,loading:Boolean,showLine:Boolean,treeNodeData:{type:Object},icons:{type:Object},nodeStatus:{type:Object}},emits:["click"],setup(n,{slots:e,emit:t}){const{icons:s,nodeStatus:o,treeNodeData:a}=Te(n),i=wn(),r=lt(e,"switcher-icon"),l=lt(e,"loading-icon");return{getSwitcherIcon:()=>{var c,d,p;const u=(d=(c=s==null?void 0:s.value)==null?void 0:c.switcherIcon)!=null?d:r.value;return u?u(o.value):(p=i.switcherIcon)==null?void 0:p.call(i,a.value,o.value)},getLoadingIcon:()=>{var c,d,p;const u=(d=(c=s==null?void 0:s.value)==null?void 0:c.loadingIcon)!=null?d:l.value;return u?u(o.value):(p=i.loadingIcon)==null?void 0:p.call(i,a.value,o.value)},onClick(u){t("click",u)}}},render(){var p,h,v;const{prefixCls:n,getSwitcherIcon:e,getLoadingIcon:t,onClick:s,nodeStatus:o={},loading:a,showLine:i}=this,{expanded:r,isLeaf:l}=o;if(a)return(p=t())!=null?p:Pe(ws);let u=null,c=!1;if(l)i&&(u=(v=e())!=null?v:Pe(Si));else{const w=i?Pe("span",{class:`${n}-${r?"minus":"plus"}-icon`}):Pe(ki);u=(h=e())!=null?h:w,c=!i}if(!u)return null;const d=Pe("span",{class:`${n}-switcher-icon`,onClick:s},u);return c?Pe(xi,{class:`${n}-icon-hover`},()=>d):d}}),Io=(()=>{let n=0;return()=>(n+=1,`__arco_tree${n}`)})();function ul(n,e){return!!(yt(n)?e:n)}function dl(n,e){const t={...n};return e&&Object.keys(e).forEach(o=>{const a=e[o];a!==o&&(t[o]=n[a],delete t[a])}),t}function Rs({subEnable:n,superEnable:e,isLeaf:t,treeNodeData:s,level:o}){return yt(n)?rn(e)?e(s,{isLeaf:t,level:o}):e!=null?e:!1:n}function hl(n){var d,p;const{treeNodeData:e,parentNode:t,isTail:s=!0,treeProps:o}=n,{fieldNames:a}=o||{},i=dl(e,a),r=o.loadMore?!!i.isLeaf:!((d=i.children)!=null&&d.length),l=t?t.level+1:0,u={...Ci(i,["children"]),key:(p=i.key)!=null?p:Io(),selectable:Rs({subEnable:i.selectable,superEnable:o==null?void 0:o.selectable,isLeaf:r,level:l,treeNodeData:e}),disabled:!!i.disabled,disableCheckbox:!!i.disableCheckbox,checkable:Rs({subEnable:i.checkable,superEnable:o==null?void 0:o.checkable,isLeaf:r,level:l,treeNodeData:e}),isLeaf:r,isTail:s,blockNode:!!(o!=null&&o.blockNode),showLine:!!(o!=null&&o.showLine),level:l,lineless:t?[...t.lineless,t.isTail]:[],draggable:ul(i.draggable,o==null?void 0:o.draggable)};return{...u,treeNodeProps:u,treeNodeData:e,parent:t,parentKey:t==null?void 0:t.key,pathParentKeys:t?[...t.pathParentKeys,t.key]:[]}}function pl(n,e){function t(s,o){if(!s)return;const{fieldNames:a}=e,i=[];return s.forEach((r,l)=>{const u=hl({treeNodeData:r,treeProps:e,parentNode:o,isTail:l===s.length-1});u.children=t(r[(a==null?void 0:a.children)||"children"],u),i.push(u)}),i}return t(n)}function $o(){const n=Zs(),e=()=>{var s;return(s=n==null?void 0:n.vnode.key)!=null?s:Io()},t=I(e());return Mi(()=>{t.value=e()}),t}function fl(n){const{key:e,refTitle:t}=Te(n),s=wn(),o=I(!1),a=I(!1),i=I(!1),r=I(0),l=Oi(u=>{if(!t.value)return;const c=t.value.getBoundingClientRect(),d=window.pageYOffset+c.top,{pageY:p}=u,h=p-d;i.value=s.allowDrop?s.allowDrop(e.value,r.value):!0;const v=i.value?c.height/4:c.height/2;r.value=h<v?-1:h<c.height-v?0:1});return{isDragOver:o,isDragging:a,isAllowDrop:i,dropPosition:r,setDragStatus(u,c){switch(u){case"dragStart":a.value=!0,r.value=0,s.onDragStart&&s.onDragStart(e.value,c);break;case"dragEnd":a.value=!1,o.value=!1,r.value=0,l.cancel(),s.onDragEnd&&s.onDragEnd(e.value,c);break;case"dragOver":o.value=!0,l(c),s.onDragOver&&s.onDragOver(e.value,c);break;case"dragLeave":o.value=!1,r.value=0,l.cancel(),s.onDragLeave&&s.onDragLeave(e.value,c);break;case"drop":s.onDrop&&s.onDrop(e.value,r.value,c),o.value=!1,r.value=0,l.cancel();break}}}}const vl=B({name:"BaseTreeNode",components:{NodeSwitcher:cl,Checkbox:Ai,RenderFunction:Js,IconDragDotVertical:Qs},props:{key:{type:[String,Number]},title:{type:String},selectable:{type:Boolean},disabled:{type:Boolean},disableCheckbox:{type:Boolean},checkable:{type:Boolean},draggable:{type:Boolean},isLeaf:{type:Boolean},icon:{type:Function},switcherIcon:{type:Function},loadingIcon:{type:Function},dragIcon:{type:Function},isTail:{type:Boolean},blockNode:{type:Boolean},showLine:{type:Boolean},level:{type:Number,default:0},lineless:{type:Array,default:()=>[]}},setup(n){const e=$o(),t=vn("tree-node"),s=wn(),o=j(()=>{var x;return(x=s.key2TreeNode)==null?void 0:x.get(e.value)}),a=j(()=>o.value.treeNodeData),i=j(()=>o.value.children),r=j(()=>{var R;const x=(R=s.treeProps)==null?void 0:R.actionOnNodeClick;return x?Pi(x):[]}),{isLeaf:l,isTail:u,selectable:c,disabled:d,disableCheckbox:p,draggable:h,blockNode:v}=Te(n),w=I(!1),b=j(()=>{var x;return[`${t}`,{[`${t}-hover`]:w.value,[`${t}-block`]:v.value,[`${t}-selected`]:ce.value,[`${t}-is-leaf`]:l.value,[`${t}-is-tail`]:u.value,[`${t}-expanded`]:Se.value,[`${t}-disabled-selectable`]:!c.value&&!((x=s.treeProps)!=null&&x.disableSelectActionOnly),[`${t}-disabled`]:d.value}]}),S=I(),{isDragOver:C,isDragging:z,isAllowDrop:J,dropPosition:K,setDragStatus:G}=fl(ge({key:e,refTitle:S})),ie=j(()=>[`${t}-title`,{[`${t}-title-draggable`]:h.value,[`${t}-title-gap-top`]:C.value&&K.value<0,[`${t}-title-gap-bottom`]:C.value&&K.value>0,[`${t}-title-highlight`]:!z.value&&C.value&&J.value&&K.value===0,[`${t}-title-dragging`]:z.value,[`${t}-title-block`]:o.value.blockNode}]),te=j(()=>{var x,R;return(R=(x=s.checkedKeys)==null?void 0:x.includes)==null?void 0:R.call(x,e.value)}),ee=j(()=>{var x,R;return(R=(x=s.indeterminateKeys)==null?void 0:x.includes)==null?void 0:R.call(x,e.value)}),ce=j(()=>{var x,R;return(R=(x=s.selectedKeys)==null?void 0:x.includes)==null?void 0:R.call(x,e.value)}),Se=j(()=>{var x,R;return(R=(x=s.expandedKeys)==null?void 0:x.includes)==null?void 0:R.call(x,e.value)}),Ee=j(()=>{var x,R;return(R=(x=s.loadingKeys)==null?void 0:x.includes)==null?void 0:R.call(x,e.value)}),Re=j(()=>s.dragIcon),P=j(()=>s.nodeIcon);function k(x){var R,ue;l.value||(!((R=i.value)!=null&&R.length)&&rn(s.onLoadMore)?s.onLoadMore(e.value):(ue=s==null?void 0:s.onExpand)==null||ue.call(s,!Se.value,e.value,x))}const D=ge({loading:Ee,checked:te,selected:ce,indeterminate:ee,expanded:Se,isLeaf:l}),E=j(()=>s.nodeTitle?()=>{var x;return(x=s.nodeTitle)==null?void 0:x.call(s,a.value,D)}:void 0),Y=j(()=>s.nodeExtra?()=>{var x;return(x=s.nodeExtra)==null?void 0:x.call(s,a.value,D)}:void 0),[X,Q]=Ii();return{hover:w,DefineTemplate:X,ReuseTemplate:Q,nodekey:e,refTitle:S,prefixCls:t,classNames:b,titleClassNames:ie,indeterminate:ee,checked:te,expanded:Se,selected:ce,treeTitle:E,treeNodeData:a,loading:Ee,treeDragIcon:Re,treeNodeIcon:P,extra:Y,nodeStatus:D,onCheckboxChange(x,R){var ue;p.value||d.value||(ue=s.onCheck)==null||ue.call(s,x,e.value,R)},onTitleClick(x){var R;r.value.includes("expand")&&k(x),!(!c.value||d.value)&&((R=s.onSelect)==null||R.call(s,e.value,x))},onTitleDbclick(x){var R;!c.value||d.value||(R=s.onNodeDbclick)==null||R.call(s,e.value,x)},onSwitcherClick:k,onDragStart(x){var R;if(h.value){x.stopPropagation(),G("dragStart",x);try{(R=x.dataTransfer)==null||R.setData("text/plain","")}catch(ue){}}},onDragEnd(x){h.value&&(x.stopPropagation(),G("dragEnd",x))},onDragOver(x){h.value&&(x.stopPropagation(),x.preventDefault(),G("dragOver",x))},onDragLeave(x){h.value&&(x.stopPropagation(),G("dragLeave",x))},onDrop(x){h.value&&(x.stopPropagation(),x.preventDefault(),G("drop",x))},onNodeContextmenu(x){var R;(R=s.onNodeContextmenu)==null||R.call(s,e.value,x)}}}}),gl=["data-level","data-key"],ml=["draggable"];function bl(n,e,t,s,o,a){const i=xe("NodeSwitcher"),r=xe("Checkbox"),l=xe("RenderFunction"),u=Qs;return g(),T("div",{class:ve(n.classNames),"data-level":n.level,"data-key":n.nodekey,onMouseout:e[8]||(e[8]=c=>n.hover=!1),onMouseover:e[9]||(e[9]=c=>n.hover=!0),onContextmenu:e[10]||(e[10]=(...c)=>n.onNodeContextmenu&&n.onNodeContextmenu(...c))},[(g(),O(Tt(n.DefineTemplate),null,{default:y(()=>[N("span",{class:ve(`${n.prefixCls}-indent`)},[(g(!0),T(he,null,ze(n.level,c=>(g(),T("span",{key:c,class:ve([`${n.prefixCls}-indent-block`,{[`${n.prefixCls}-indent-block-lineless`]:n.lineless[c-1]}])},null,2))),128))],2),N("span",{class:ve([`${n.prefixCls}-switcher`,{[`${n.prefixCls}-switcher-expanded`]:n.expanded,"pl1.5 pr4.5 mr-0!":n.blockNode}]),onClick:e[0]||(e[0]=(...c)=>n.onSwitcherClick&&n.onSwitcherClick(...c))},[f(i,{"prefix-cls":n.prefixCls,loading:n.loading,"show-line":n.showLine,"tree-node-data":n.treeNodeData,icons:{switcherIcon:n.switcherIcon,loadingIcon:n.loadingIcon},"node-status":n.nodeStatus},qt({_:2},[n.$slots["switcher-icon"]?{name:"switcher-icon",fn:y(()=>[se(n.$slots,"switcher-icon",{},void 0,!0)]),key:"0"}:void 0,n.$slots["loading-icon"]?{name:"loading-icon",fn:y(()=>[se(n.$slots,"loading-icon",{},void 0,!0)]),key:"1"}:void 0]),1032,["prefix-cls","loading","show-line","tree-node-data","icons","node-status"])],2),n.checkable?(g(),O(r,{key:0,disabled:n.disableCheckbox||n.disabled,"model-value":n.checked,indeterminate:n.indeterminate,"uninject-group-context":"",onChange:n.onCheckboxChange},null,8,["disabled","model-value","indeterminate","onChange"])):Z("",!0)]),_:3})),n.blockNode?Z("",!0):(g(),O(Tt(n.ReuseTemplate),{key:0})),N("span",{ref:"refTitle",class:ve(n.titleClassNames),draggable:n.draggable,onDragstart:e[1]||(e[1]=(...c)=>n.onDragStart&&n.onDragStart(...c)),onDragend:e[2]||(e[2]=(...c)=>n.onDragEnd&&n.onDragEnd(...c)),onDragover:e[3]||(e[3]=(...c)=>n.onDragOver&&n.onDragOver(...c)),onDragleave:e[4]||(e[4]=(...c)=>n.onDragLeave&&n.onDragLeave(...c)),onDrop:e[5]||(e[5]=(...c)=>n.onDrop&&n.onDrop(...c)),onClick:e[6]||(e[6]=(...c)=>n.onTitleClick&&n.onTitleClick(...c)),onDblclick:e[7]||(e[7]=(...c)=>n.onTitleDbclick&&n.onTitleDbclick(...c))},[n.blockNode?(g(),O(Tt(n.ReuseTemplate),{key:0})):Z("",!0),n.$slots.icon||n.icon||n.treeNodeIcon?(g(),T("span",{key:1,class:ve([`${n.prefixCls}-icon`,`${n.prefixCls}-custom-icon`])},[n.$slots.icon?se(n.$slots,"icon",Yt(oe({key:0},n.nodeStatus)),void 0,!0):n.icon?(g(),O(l,oe({key:1,"render-func":n.icon},n.nodeStatus),null,16,["render-func"])):n.treeNodeIcon?(g(),O(l,oe({key:2,"render-func":n.treeNodeIcon,node:n.treeNodeData},n.nodeStatus),null,16,["render-func","node"])):Z("",!0)],2)):Z("",!0),N("span",{class:ve(`${n.prefixCls}-title-text truncate flex-1`)},[n.treeTitle?(g(),O(l,{key:0,"render-func":n.treeTitle},null,8,["render-func"])):se(n.$slots,"title",{key:1},()=>[me(Be(n.title),1)],!0)],2),n.draggable&&!n.extra?(g(),T("span",{key:2,class:ve([`${n.prefixCls}-icon`,`${n.prefixCls}-drag-icon`])},[n.$slots["drag-icon"]?se(n.$slots,"drag-icon",Yt(oe({key:0},n.nodeStatus)),void 0,!0):n.dragIcon?(g(),O(l,oe({key:1,"render-func":n.dragIcon},n.nodeStatus),null,16,["render-func"])):n.treeDragIcon?(g(),O(l,oe({key:2,"render-func":n.treeDragIcon,node:n.treeNodeData},n.nodeStatus),null,16,["render-func","node"])):(g(),O(u,{key:3}))],2)):Z("",!0),n.extra?(g(),O(l,{key:3,"render-func":n.extra},null,8,["render-func"])):Z("",!0)],42,ml)],42,gl)}const zn=le(vl,[["render",bl],["__scopeId","data-v-8e20b1b9"]]),yl=B({name:"ExpandTransition",props:{expanded:Boolean},emits:["end"],setup(n,{emit:e}){return{onBeforeEnter(t){t.style.height=n.expanded?"0":`${t.scrollHeight}px`},onEnter(t){t.style.height=n.expanded?`${t.scrollHeight}px`:"0"},onAfterEnter(t){t.style.height=n.expanded?"":"0",e("end")},onBeforeLeave(t){t.style.display="none"}}}});function _l(n,e,t,s,o,a){return g(),O($i,{onBeforeEnter:n.onBeforeEnter,onEnter:n.onEnter,onAfterEnter:n.onAfterEnter,onBeforeLeave:n.onBeforeLeave},{default:y(()=>[se(n.$slots,"default")]),_:3},8,["onBeforeEnter","onEnter","onAfterEnter","onBeforeLeave"])}const wl=le(yl,[["render",_l]]),kl=B({name:"TransitionNodeList",components:{ExpandTransition:wl,BaseTreeNode:zn},props:{nodeKey:{type:[String,Number],required:!0}},setup(n){const t=[`${vn("tree")}-node-list`],s=wn(),{nodeKey:o}=Te(n),a=j(()=>{var l,u;return(u=(l=s.expandedKeys)==null?void 0:l.includes)==null?void 0:u.call(l,o.value)}),i=j(()=>{var c;const l=new Set(s.expandedKeys||[]),u=(c=s.flattenTreeData)==null?void 0:c.filter(d=>{var p,h;return(p=d.pathParentKeys)!=null&&p.includes(o.value)?!s.filterTreeNode||((h=s.filterTreeNode)==null?void 0:h.call(s,d.treeNodeData)):!1});return u==null?void 0:u.filter(d=>{var h;if(a.value)return(h=d.pathParentKeys)==null?void 0:h.every(v=>l.has(v));const p=d.pathParentKeys.indexOf(o.value);return d.pathParentKeys.slice(p+1).every(v=>l.has(v))})}),r=j(()=>{var l,u;return((l=s.currentExpandKeys)==null?void 0:l.includes(o.value))&&((u=i.value)==null?void 0:u.length)});return{classNames:t,visibleNodeList:i,show:r,expanded:a,onTransitionEnd(){var l;(l=s.onExpandEnd)==null||l.call(s,o.value)}}}});function Sl(n,e,t,s,o,a){const i=xe("BaseTreeNode"),r=xe("ExpandTransition");return g(),O(r,{expanded:n.expanded,onEnd:n.onTransitionEnd},{default:y(()=>[n.show?(g(),T("div",{key:0,class:ve(n.classNames)},[(g(!0),T(he,null,ze(n.visibleNodeList,l=>(g(),O(i,oe({key:l.key},l.treeNodeProps),null,16))),128))],2)):Z("",!0)]),_:1},8,["expanded","onEnd"])}const xl=le(kl,[["render",Sl]]),Cl=B({name:"TreeNode",inheritAttrs:!1,props:{...zn.props},setup(n,{slots:e}){const t=$o();return()=>f(he,null,[f(zn,oe(n,{key:t.value}),e),f(xl,{key:t.value,nodeKey:t.value},null)])}});function Ml(n){const{defaultCheckedKeys:e,checkedKeys:t,key2TreeNode:s,checkStrictly:o,halfCheckedKeys:a,onlyCheckLeaf:i}=Te(n),r=I(!1),l=I([]),u=I([]),c=I(),d=I(),p=v=>ll({initCheckedKeys:v,key2TreeNode:s.value,checkStrictly:o.value,onlyCheckLeaf:i.value}),h=v=>{const w=p(v);[l.value,u.value]=w};return h(t.value||(e==null?void 0:e.value)||[]),Ge(()=>{t.value?[c.value,d.value]=p(t.value):r.value&&(c.value=void 0,d.value=void 0,l.value=[],u.value=[]),r.value||(r.value=!0)}),{checkedKeys:j(()=>c.value||l.value),indeterminateKeys:j(()=>o.value&&a.value?a.value:d.value||u.value),setCheckedState(v,w,b=!1){return b?h(v):(l.value=v,u.value=w),[l.value,u.value]}}}function Ol(n){const{treeData:e,fieldNames:t,selectable:s,showLine:o,blockNode:a,checkable:i,loadMore:r,draggable:l}=Te(n),u=I([]);Ge(()=>{var p,h;u.value=pl(e.value||[],{selectable:(p=s==null?void 0:s.value)!=null?p:!1,showLine:!!(o!=null&&o.value),blockNode:!!(a!=null&&a.value),checkable:(h=i==null?void 0:i.value)!=null?h:!1,fieldNames:t==null?void 0:t.value,loadMore:!!(r!=null&&r.value),draggable:!!(l!=null&&l.value)})});const c=j(()=>il(u.value)),d=j(()=>al(c.value));return{treeData:u,flattenTreeData:c,key2TreeNode:d}}const Al=B({name:"Tree",components:{VirtualList:Ti,TreeNode:Cl},props:{size:{type:String,default:"medium"},blockNode:{type:Boolean},defaultExpandAll:{type:Boolean,default:!0},multiple:{type:Boolean},checkable:{type:[Boolean,String,Function],default:!1},selectable:{type:[Boolean,Function],default:!0},checkStrictly:{type:Boolean},checkedStrategy:{type:String,default:"all"},defaultSelectedKeys:{type:Array},selectedKeys:{type:Array},defaultCheckedKeys:{type:Array},checkedKeys:{type:Array},defaultExpandedKeys:{type:Array},expandedKeys:{type:Array},data:{type:Array,default:()=>[]},fieldNames:{type:Object},showLine:{type:Boolean},loadMore:{type:Function},draggable:{type:Boolean},allowDrop:{type:Function},filterTreeNode:{type:Function},virtualListProps:{type:Object},defaultExpandSelected:{type:Boolean},defaultExpandChecked:{type:Boolean},autoExpandParent:{type:Boolean,default:!0},halfCheckedKeys:{type:Array},onlyCheckLeaf:{type:Boolean,default:!1},animation:{type:Boolean,default:!0},actionOnNodeClick:{type:String},disableSelectActionOnly:{type:Boolean,default:!1}},emits:{nodeDbclick:(n,e)=>!0,nodeContextmenu:(n,e)=>!0,select:(n,e)=>!0,"update:selectedKeys":n=>!0,check:(n,e)=>!0,"update:checkedKeys":n=>!0,"update:halfCheckedKeys":n=>!0,expand:(n,e)=>!0,"update:expandedKeys":n=>!0,dragStart:(n,e)=>!0,dragEnd:(n,e)=>!0,dragOver:(n,e)=>!0,dragLeave:(n,e)=>!0,drop:n=>!0},setup(n,{emit:e,slots:t}){const{data:s,showLine:o,multiple:a,loadMore:i,checkStrictly:r,checkedKeys:l,defaultCheckedKeys:u,selectedKeys:c,defaultSelectedKeys:d,expandedKeys:p,defaultExpandedKeys:h,checkedStrategy:v,selectable:w,checkable:b,blockNode:S,fieldNames:C,size:z,defaultExpandAll:J,filterTreeNode:K,draggable:G,allowDrop:ie,defaultExpandSelected:te,defaultExpandChecked:ee,autoExpandParent:ce,halfCheckedKeys:Se,onlyCheckLeaf:Ee,animation:Re}=Te(n),P=vn("tree"),k=j(()=>[`${P}`,{[`${P}-checkable`]:b.value,[`${P}-show-line`]:o.value},`${P}-size-${z.value}`]),D=lt(t,"switcher-icon"),E=lt(t,"loading-icon"),Y=lt(t,"drag-icon"),X=lt(t,"icon"),Q=lt(t,"title"),x=lt(t,"extra"),{treeData:R,flattenTreeData:ue,key2TreeNode:H}=Ol(ge({treeData:s,selectable:w,showLine:o,blockNode:S,checkable:b,fieldNames:C,loadMore:i,draggable:G})),{checkedKeys:Me,indeterminateKeys:tt,setCheckedState:kn}=Ml(ge({defaultCheckedKeys:u,checkedKeys:l,checkStrictly:r,key2TreeNode:H,halfCheckedKeys:Se,onlyCheckLeaf:Ee})),[Ft,Sn]=ks((d==null?void 0:d.value)||[],ge({value:c})),gt=I([]),Pt=I();function Wo(){if(h!=null&&h.value){const M=new Set([]);return h.value.forEach(A=>{if(M.has(A))return;const $=H.value.get(A);$&&[...ce.value?$.pathParentKeys:[],A].forEach(F=>M.add(F))}),[...M]}if(J.value)return ue.value.filter(M=>M.children&&M.children.length).map(M=>M.key);if(te.value||ee.value){const M=new Set([]),A=$=>{$.forEach(F=>{const W=H.value.get(F);W&&(W.pathParentKeys||[]).forEach(q=>M.add(q))})};return te.value&&A(Ft.value),ee.value&&A(Me.value),[...M]}return[]}const[Vt,xn]=ks(Wo(),ge({value:p})),mt=I([]),Uo=j(()=>{const M=new Set(Vt.value),A=new Set(mt.value);return ue.value.filter($=>{var nt;if(!(!K||!K.value||(K==null?void 0:K.value($.treeNodeData))))return!1;const W=yt($.parentKey),q=(nt=$.pathParentKeys)==null?void 0:nt.every(It=>M.has(It)&&!A.has(It));return W||q})});function vs(M,A=v.value){let $=[...M];return A==="parent"?$=M.filter(F=>{const W=H.value.get(F);return W&&!(!yt(W.parentKey)&&M.includes(W.parentKey))}):A==="child"&&($=M.filter(F=>{var W,q;return!((q=(W=H.value.get(F))==null?void 0:W.children)!=null&&q.length)})),$}function Kt(M){return M.map(A=>{var $;return(($=H.value.get(A))==null?void 0:$.treeNodeData)||void 0}).filter(Boolean)}function Cn(M){const{targetKey:A,targetChecked:$,newCheckedKeys:F,newIndeterminateKeys:W,event:q}=M,nt=A?H.value.get(A):void 0,It=vs(F);e("update:checkedKeys",It),e("update:halfCheckedKeys",W),e("check",It,{checked:$,node:nt==null?void 0:nt.treeNodeData,checkedNodes:Kt(It),halfCheckedKeys:W,halfCheckedNodes:Kt(W),e:q})}function Mn(M){const{targetKey:A,targetSelected:$,newSelectedKeys:F,event:W}=M,q=A?H.value.get(A):void 0;e("update:selectedKeys",F),e("select",F,{selected:$,node:q==null?void 0:q.treeNodeData,selectedNodes:Kt(F),e:W})}function On(M){const{targetKey:A,targetExpanded:$,newExpandedKeys:F,event:W}=M,q=A?H.value.get(A):void 0;e("expand",F,{expanded:$,node:q==null?void 0:q.treeNodeData,expandedNodes:Kt(F),e:W}),e("update:expandedKeys",F)}function Go(M){const[A,$]=kn(M,[],!0);Cn({newCheckedKeys:A,newIndeterminateKeys:$})}function Yo(M){let A=M;!a.value&&M.length>1&&(A=[M[0]]),Sn(A),Mn({newSelectedKeys:A})}function Xo(M){mt.value=[],xn(M),On({newExpandedKeys:M})}function qo(M,A,$){if(!M.length)return;let F=[...Me.value],W=[...tt.value];M.forEach(q=>{const nt=H.value.get(q);nt&&([F,W]=Es({node:nt,checked:A,checkedKeys:[...F],indeterminateKeys:[...W],checkStrictly:r.value}))}),kn(F,W),Cn({targetKey:$,targetChecked:yt($)?void 0:A,newCheckedKeys:F,newIndeterminateKeys:W})}function Jo(M,A,$){if(!M.length)return;let F;if(a.value){const W=new Set(Ft.value);M.forEach(q=>{A?W.add(q):W.delete(q)}),F=[...W]}else F=A?[M[0]]:[];Sn(F),Mn({targetKey:$,targetSelected:yt($)?void 0:A,newSelectedKeys:F})}function Zo(M,A,$){const F=new Set(Vt.value);M.forEach(q=>{A?F.add(q):F.delete(q),bs(q)});const W=[...F];xn(W),On({targetKey:$,targetExpanded:yt($)?void 0:A,newExpandedKeys:W})}function gs(M,A,$){const F=H.value.get(A);if(!F)return;const[W,q]=Es({node:F,checked:M,checkedKeys:Me.value,indeterminateKeys:tt.value,checkStrictly:r.value});kn(W,q),Cn({targetKey:A,targetChecked:M,newCheckedKeys:W,newIndeterminateKeys:q,event:$})}function Qo(M,A){if(!H.value.get(M))return;let F,W;if(a.value){const q=new Set(Ft.value);W=!q.has(M),W?q.add(M):q.delete(M),F=[...q]}else W=!0,F=[M];Sn(F),Mn({targetKey:M,targetSelected:W,newSelectedKeys:F,event:A})}function ms(M,A,$){if(mt.value.includes(A)||!H.value.get(A))return;const W=new Set(Vt.value);M?W.add(A):W.delete(A);const q=[...W];xn(q),Re.value&&mt.value.push(A),On({targetKey:A,targetExpanded:M,newExpandedKeys:q,event:$})}function bs(M){const A=mt.value.indexOf(M);mt.value.splice(A,1)}const ei=j(()=>i!=null&&i.value?async M=>{if(!rn(i.value))return;const A=H.value.get(M);if(!A)return;const{treeNodeData:$}=A;gt.value=[...new Set([...gt.value,M])];try{await i.value($),gt.value=gt.value.filter(F=>F!==M),ms(!0,M),Me.value.includes(M)&&gs(!0,M)}catch(F){gt.value=gt.value.filter(W=>W!==M),console.error("[tree]load data error: ",F)}}:void 0),An=ge({treeProps:n,switcherIcon:D,loadingIcon:E,dragIcon:Y,nodeIcon:X,nodeTitle:Q,nodeExtra:x,treeData:R,flattenTreeData:ue,key2TreeNode:H,checkedKeys:Me,indeterminateKeys:tt,selectedKeys:Ft,expandedKeys:Vt,loadingKeys:gt,currentExpandKeys:mt,onLoadMore:ei,filterTreeNode:K,onCheck:gs,onSelect:Qo,onExpand:ms,onExpandEnd:bs,allowDrop(M,A){const $=H.value.get(M);return $&&rn(ie.value)?!!ie.value({dropNode:$.treeNodeData,dropPosition:A}):!0},onDragStart(M,A){const $=H.value.get(M);Pt.value=$,$&&e("dragStart",A,$.treeNodeData)},onDragEnd(M,A){const $=H.value.get(M);Pt.value=void 0,$&&e("dragEnd",A,$.treeNodeData)},onDragOver(M,A){const $=H.value.get(M);$&&e("dragOver",A,$.treeNodeData)},onDragLeave(M,A){const $=H.value.get(M);$&&e("dragLeave",A,$.treeNodeData)},onDrop(M,A,$){const F=H.value.get(M);Pt.value&&F&&!(F.key===Pt.value.key||F.pathParentKeys.includes(Pt.value.key||""))&&(An.allowDrop(M,A)||A!==0)&&e("drop",{e:$,dragNode:Pt.value.treeNodeData,dropNode:F.treeNodeData,dropPosition:A})},onNodeContextmenu(M,A){const $=H.value.get(M);$&&e("nodeContextmenu",A,$)},onNodeDbclick(M,A){const $=H.value.get(M);$&&e("nodeDbclick",A,$)}});return De(Ao,An),{classNames:k,visibleTreeNodeList:Uo,treeContext:An,virtualListRef:I(),computedSelectedKeys:Ft,computedExpandedKeys:Vt,computedCheckedKeys:Me,computedIndeterminateKeys:tt,getPublicCheckedKeys:vs,getNodes:Kt,internalCheckNodes:qo,internalSetCheckedKeys:Go,internalSelectNodes:Jo,internalSetSelectedKeys:Yo,internalExpandNodes:Zo,internalSetExpandedKeys:Xo,updateTreeView:()=>Ws(ue)}},methods:{toggleCheck(n,e){const{key2TreeNode:t,onCheck:s,checkedKeys:o}=this.treeContext,a=!o.includes(n),i=t.get(n);i&&Rt(i)&&s(a,n,e)},scrollIntoView(n){this.virtualListRef&&this.virtualListRef.scrollTo(n)},getSelectedNodes(){return this.getNodes(this.computedSelectedKeys)},getCheckedNodes(n={}){const{checkedStrategy:e,includeHalfChecked:t}=n,s=this.getPublicCheckedKeys(this.computedCheckedKeys,e);return[...this.getNodes(s),...t?this.getHalfCheckedNodes():[]]},getHalfCheckedNodes(){return this.getNodes(this.computedIndeterminateKeys)},getExpandedNodes(){return this.getNodes(this.computedExpandedKeys)},checkAll(n=!0){const{key2TreeNode:e}=this.treeContext,t=n?[...e.keys()].filter(s=>{const o=e.get(s);return o&&Rt(o)}):[];this.internalSetCheckedKeys(t)},checkNode(n,e=!0,t=!1){const{checkStrictly:s,treeContext:o}=this,{key2TreeNode:a}=o,i=Pn(n),r=(i?n:[n]).filter(l=>{const u=a.get(l);return u&&Rt(u)&&(s||!t||rl(u))});this.internalCheckNodes(r,e,i?void 0:n)},selectAll(n=!0){const{key2TreeNode:e}=this.treeContext,t=n?[...e.keys()].filter(s=>{const o=e.get(s);return o&&$s(o)}):[];this.internalSetSelectedKeys(t)},selectNode(n,e=!0){const{key2TreeNode:t}=this.treeContext,s=Pn(n),o=(s?n:[n]).filter(a=>{const i=t.get(a);return i&&$s(i)});this.internalSelectNodes(o,e,s?void 0:n)},expandAll(n=!0){const{key2TreeNode:e}=this.treeContext,t=n?[...e.keys()].filter(s=>{const o=e.get(s);return o&&Ts(o)}):[];this.internalSetExpandedKeys(t)},expandNode(n,e=!0){const{key2TreeNode:t}=this.treeContext,s=Pn(n),o=(s?n:[n]).filter(a=>{const i=t.get(a);return i&&Ts(i)});this.internalExpandNodes(o,e,s?void 0:n)}}});function Pl(n,e,t,s,o,a){const i=xe("TreeNode"),r=xe("VirtualList");return g(),T("div",{class:ve(n.classNames)},[n.virtualListProps?(g(),O(r,oe({key:0,ref:"virtualListRef"},n.virtualListProps,{data:n.visibleTreeNodeList}),{item:y(({item:l})=>[(g(),O(i,oe({key:l.key},l.treeNodeProps),null,16))]),_:1},16,["data"])):(g(!0),T(he,{key:1},ze(n.visibleTreeNodeList,l=>(g(),O(i,oe({key:l.key},l.treeNodeProps),null,16))),128))],2)}const In=le(Al,[["render",Pl]]),To=Object.assign(In,{install:(n,e)=>{Ei(n,e);const t=Ri(e);n.component(t+In.name,In)}});function Eo(n,e){const{canvas:t}=ye();t.on(n,e);const s=()=>{t.off(n,e)};return ns(s),s}const Il={class:"h-full flex flex-col overflow-hidden"},$l={class:"bg-$color-bg-4 h28px px0.5 flex justify-between items-center"},Tl={class:"pl3 color-$color-text-2"},El=B({__name:"workspaces",setup(n){const e=I(0),{canvas:t,event:s,workspaces:o}=ye(),a=I([]),i=I([]),r=()=>{a.value=o.all().map(d=>({key:d.id,title:d.name})),i.value=[o.getCurrentId()],e.value=o.size()};r(),s.on("workspaceChangeAfter",r),s.on("workspaceAddAfter",r),s.on("workspaceRemoveAfter",r),eo(()=>{s.off("workspaceChangeAfter",r),s.off("workspaceAddAfter",r),s.off("workspaceRemoveAfter",r)});const l=d=>{o.setCurrentId(d[0].toString())},u=()=>{o.setCurrentId(o.add("页面")),t.setViewportTransform(ts)},c=(d,p)=>{Bt.showContextMenu({x:d.clientX,y:d.clientY,preserveIconWidth:!1,items:[{label:"复制",onClick:async()=>{if(!p.key)return;const h=o.get(p.key.toString());if(!h)return;const v=t.toObject(),w=o.add(h.name+" 拷贝");o.setCurrentId(w),await t.loadFromJSON(v),t.renderAll()}},{label:"删除",hidden:o.size()<=1,onClick:()=>{p.key&&o.remove(p.key.toString())},divided:!0},{label:"重命名",onClick:()=>{}}]})};return(d,p)=>{const h=to,v=we,w=no;return g(),T("div",Il,[N("div",$l,[N("span",Tl,"页面 ("+Be(m(e))+")",1),N("div",null,[f(v,{class:"icon-btn",size:"mini",onClick:u},{icon:y(()=>[f(h)]),_:1})])]),f(w,{class:"overflow-y-auto h-full","outer-class":"flex-1 min-h-0"},{default:y(()=>[f(m(To),{class:"",blockNode:"","selected-keys":m(i),onSelect:l,data:m(a),size:"small",onNodeContextmenu:c},null,8,["selected-keys","data"])]),_:1})])}}}),Rl=le(El,[["__scopeId","data-v-7c0e02cf"]]),Dl=`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='var(--color-text-2)' width='14' height='14'><path d="M20 5h-8.586L9.707 3.293A.997.997 0 0 0 9 3H4c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h16c1.103 0 2-.897 2-2V7c0-1.103-.897-2-2-2zM4 19V7h16l.002 12H4z"></path></svg>`,jl='<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="-1 -1 16 16" fill="var(--color-text-2)"><path d="M3,9.67v-5.34h-1.33c-0.24,0 -0.46,-0.12 -0.58,-0.33c-0.12,-0.21 -0.12,-0.46 0,-0.67c0.12,-0.2 0.34,-0.33 0.58,-0.33h1.33v-1.33c0,-0.24 0.13,-0.46 0.33,-0.58c0.21,-0.12 0.46,-0.12 0.67,0c0.21,0.12 0.33,0.34 0.33,0.58v1.33h5.34v-1.33c0,-0.37 0.3,-0.67 0.66,-0.67c0.37,0 0.67,0.3 0.67,0.67v1.33h1.33c0.37,0 0.67,0.3 0.67,0.67c0,0.36 -0.3,0.66 -0.67,0.66h-1.33v5.34h1.33c0.37,0 0.67,0.3 0.67,0.66c0,0.37 -0.3,0.67 -0.67,0.67h-1.33v1.33c0,0.37 -0.3,0.67 -0.67,0.67c-0.36,0 -0.66,-0.3 -0.66,-0.67v-1.33h-5.34v1.33c0,0.37 -0.3,0.67 -0.66,0.67c-0.37,0 -0.67,-0.3 -0.67,-0.67v-1.33h-1.33c-0.37,0 -0.67,-0.3 -0.67,-0.67c0,-0.36 0.3,-0.66 0.67,-0.66zM9.67,9.67v-5.34h-5.34v5.34z"></path></svg>',Ll=`<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill='var(--color-text-2)'><path d="M853.333333 170.666667H170.666667a42.666667 42.666667 0 0 0-42.666667 42.666666v128a42.666667 42.666667 0 0 0 85.333333 0V256h256v554.666667H384a42.666667 42.666667 0 0 0 0 85.333333h256a42.666667 42.666667 0 0 0 0-85.333333h-85.333333V256h256v85.333333a42.666667 42.666667 0 0 0 85.333333 0V213.333333a42.666667 42.666667 0 0 0-42.666667-42.666666z"></path></svg>`,Bl=`<svg xmlns='http://www.w3.org/2000/svg' viewBox='2 2 20 20' fill='var(--color-text-2)' width='14' height='14'><path d="M19 3H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2V5c0-1.103-.897-2-2-2zM5 19V5h14l.002 14H5z"></path><path d="m10 14-1-1-3 4h12l-5-7z"></path></svg>`,zl={class:"flex items-center"},Nl=["innerHTML"],Hl=B({__name:"layerCatalogue",setup(n){const{canvas:e,event:t,undoRedo:s}=ye(),o=I(""),a=I(void 0),i=I([]),r=I(),l=new Map,u=P=>{if(P.isType("Textbox","IText","Text"))return Ll;if(P.isType("Group"))return Dl;if(P.isType("Board","Textbox"))return jl;if(P.isType("Image")||L.isPattern(P.fill))return Bl;if(l.has(P.id))return l.get(P.id);const{tl:k,tr:D,br:E,bl:Y}=P._getCoords(!0,!0);let{left:X,top:Q,height:x,width:R}=L.makeBoundingBoxFromPoints([k,D,E,Y]),ue=Math.max(x,R);R>x?Q+=(x-ue)/2:X+=(R-ue)/2;const H=P._createBaseSVGMarkup(P._toSVG(),{noStyle:!0}),tt=`<svg style="width:12px;height:12px" viewBox="${`${X-4} ${Q-4} ${ue+8} ${ue+8}`}" fill="transparent" stroke="var(--color-text-2)">${H}</svg>`;return l.set(P.id,tt),tt},c=(P,k,D=!0)=>{const E=[];if(!P)return E;for(const Y of P){const X=L.isCollection(Y),Q=X?c(Y._objects,k,D&&Y.visible):[];if(Y.hideOnLayer)continue;const x={visible:D&&Y.visible,objectRef:Y.ref,isCollection:X,title:Y.name||Y.constructor.name,key:Y.id,setDirty:()=>{var R;return(R=Y.group)==null?void 0:R.setDirty()},children:Q,draggable:a.value!==Y.id,getSvg:u.bind(this,Y)};(!k||p(x,k))&&E.unshift(x)}return E},d=I([]);Ge(()=>{d.value=c(e.ref.objects.value,o.value)});const p=(P,k)=>{var X;const D=k.toLowerCase(),E=new Xt;E.push(P);let Y=!1;for(;!E.isEmpty();){const Q=E.shift(),x=(X=Q.title)==null?void 0:X.toLowerCase();if(x!=null&&x.includes(D)&&(Y=!0),Q.children)for(const R of Q.children)E.push(R);if(Y)return!0}return!1},h=({dropNode:P})=>P.isCollection,v=P=>{const{dragObject:k,dropObject:D,dropPosition:E,excludeGroupObject:Y}=P;if(Y&&k.getAncestors(!0).some(H=>C.value.includes(H.id)))return;L.isActiveSelection(k.group)&&k.group.remove(k);const X=k.getParent();let Q=D.getParent(),x=Q._objects.indexOf(D);if((X!==Q||E===0)&&k instanceof Ce)return!1;X===Q&&X._objects.indexOf(k)<x&&x--,E===-1&&x++;const[R]=X.remove(k);L.isCollection(D)&&E===0?D.add(R):Q.insertAt(x,R),e.getActiveObject()===e.getActiveSelection()?e.getActiveSelection().multiSelectAdd(R):e.setActiveObject(R)},w=P=>{const{e:k,dragNode:D,dropNode:E,dropPosition:Y}=P;if(!(!D.key||!E.key))if(C.value.includes(D.key)){let X=e.findObjectsByIds([E.key,...C.value]);const Q=X.shift();if(!U(Q))return;Y===-1&&(X=X.reverse());for(let x=X.length-1;x>=0;x--){const R=X[x];if(!U(R))return;v({e:k,dragObject:R,dropObject:Q,dropPosition:Y,excludeGroupObject:!0})}}else{const[X,Q]=e.findObjectsByIds([E.key,D.key]);if(!U(X)||!U(Q))return;v({e:k,dragObject:Q,dropObject:X,dropPosition:Y,excludeGroupObject:!1})}},b=(P,k)=>{P.stopPropagation(),k.objectRef.evented=!k.objectRef.evented,k.objectRef.hasControls=k.objectRef.evented,k.objectRef.selectable=k.objectRef.evented,e.requestRenderAll()},S=(P,k)=>{P.stopPropagation(),k.objectRef.visible=!k.objectRef.visible,k.setDirty(),e.requestRenderAll()},C=I([]),z=(P=C.value)=>{const k=[];e.forEachObject(function D(E){L.isCollection(E)&&E.forEachObject(D),P.includes(E.id)&&k.unshift(E)}),k.length?e.setActiveObjects(k):e.discardActiveObject(),e.requestRenderAll()},J=async()=>{var Y,X,Q;const P=e.activeObject.value;if(!P||P.hideOnLayer){C.value=[];return}let k=new Set;if(L.isActiveSelection(P)){const x=[];P.forEachObject(R=>{R.group&&k.add(R.group.id),x.push(R.id)}),C.value=x}else P.group&&k.add(P.group.id),C.value=[P.id];k&&(i.value.push(...k),await pn());const D=(Y=r.value)==null?void 0:Y.virtualListRef.containerRef.getBoundingClientRect(),E=(X=document.querySelector(`.arco-tree-node[data-key='${C.value[0]}']`))==null?void 0:X.getBoundingClientRect();(!E||D.top-E.top>E.height||E.top-D.top>G.value)&&((Q=r.value)==null||Q.scrollIntoView({key:C.value[0],align:"auto"}))};Eo({"selection:created":J,"selection:updated":J,"selection:cleared":J,"object:modified":P=>{var k;l.has(P.target.id)&&(l.delete(P.target.id),l.size>128&&l.clear(),(k=r.value)==null||k.updateTreeView())}});const K=I(),G=I(0);Qe(()=>{var P,k,D;d.value.forEach(E=>{E.children&&E.key&&i.value.push(E.key)}),qs((D=(k=(P=K.value)==null?void 0:P.wrapperRef)==null?void 0:k.childNodes)==null?void 0:D[2],E=>{const[Y]=E,{height:X}=Y.contentRect;G.value=X-32})});const ie=I(!1),{meta:te,ctrl:ee}=gn();Ge(()=>{te.value||ee.value?ie.value=!0:ie.value=!1});const ce=(P,k)=>{P.preventDefault(),P.stopImmediatePropagation(),k.key&&(C.value.includes(k.key)||(C.value=[k.key],z()),Bt.showContextMenu({x:P.clientX,y:P.clientY,preserveIconWidth:!1,items:Mo()}))};t.on("layerRename",P=>{a.value=P.id});const Se=(P,k)=>{P.preventDefault(),k.key&&(a.value=k.key)},Ee=P=>{const k=P.el;if(!k)return;const D=k.querySelector("input");D&&(D.focus(),D.select())},Re=(P,k)=>{var X;const D=a.value,E=k.target;if(E==null||E.blur(),!D||!P)return;const Y=e.findObjectById(D);Y&&(Y.name=P,(X=r.value)==null||X.updateTreeView(),s.saveState())};return(P,k)=>{const D=Di,E=Ht,Y=ji,X=Li,Q=we,x=so,R=oo,ue=Bi;return g(),O(ue,{ref_key:"splitRef",ref:K,class:"h-[calc(100vh-90px)]",direction:"vertical",min:"40px","default-size":.2},{first:y(()=>[f(Rl)]),second:y(()=>[f(E,{modelValue:m(o),"onUpdate:modelValue":k[0]||(k[0]=H=>rt(o)?o.value=H:null),placeholder:"Search...",class:"bg-transparent! border-none!"},{prefix:y(()=>[f(D)]),_:1},8,["modelValue"]),f(m(To),{ref_key:"treeRef",ref:r,size:"small",blockNode:"",draggable:"","selected-keys":m(C),"expanded-keys":m(i),"onUpdate:expandedKeys":k[3]||(k[3]=H=>rt(i)?i.value=H:null),animation:!1,multiple:m(ie),data:m(d),allowDrop:h,virtualListProps:{height:m(G),fixedSize:!0},onDrop:w,onSelect:z,onNodeContextmenu:ce,onNodeDbclick:Se},{title:y(H=>[N("div",zl,[N("div",{innerHTML:H.getSvg(),class:"mr2"},null,8,Nl),m(U)(H.key)&&m(a)===H.key?(g(),O(E,{key:0,class:"bg-transparent! border-none! px0!",size:"mini","default-value":H.title,onBlur:k[1]||(k[1]=Me=>a.value=void 0),onVnodeMounted:Ee,onChange:Re,onPressEnter:k[2]||(k[2]=Me=>a.value=void 0)},null,8,["default-value"])):(g(),T("span",{key:1,class:ve({"op-50":!H.visible})},Be(H.title),3))])]),extra:y(H=>[m(a)!==H.key?(g(),T("div",{key:0,class:ve(["extra pr4px",{show:!H.objectRef.evented||!H.objectRef.visible}])},[f(Q,{class:ve([{show:H.objectRef.evented},"icon-btn"]),size:"mini",onClick:Me=>b(Me,H)},{icon:y(()=>[H.objectRef.evented?(g(),O(Y,{key:0})):(g(),O(X,{key:1}))]),_:2},1032,["class","onClick"]),f(Q,{class:ve([{show:H.objectRef.visible},"icon-btn"]),size:"mini",onClick:Me=>S(Me,H)},{icon:y(()=>[H.objectRef.visible?(g(),O(x,{key:0})):(g(),O(R,{key:1}))]),_:2},1032,["class","onClick"])],2)):Z("",!0)]),_:1},8,["selected-keys","expanded-keys","multiple","data","virtualListProps"])]),_:1},512)}}}),Fl=le(Hl,[["__scopeId","data-v-99b369d3"]]),Vl=n=>(io("data-v-1fcc3e53"),n=n(),ao(),n),Kl=Vl(()=>N("div",{class:"p2"},"资源",-1)),Wl=B({__name:"leftPanel",setup(n){return(e,t)=>{const s=zi,o=Ni;return g(),O(o,{"default-active-key":"1",class:"leftPanel flex flex-col"},{default:y(()=>[f(s,{key:"1",title:"图层"},{default:y(()=>[f(Fl)]),_:1}),f(s,{key:"2",title:"资源"},{default:y(()=>[Kl]),_:1})]),_:1})}}}),Ul=le(Wl,[["__scopeId","data-v-1fcc3e53"]]),Gl={class:"p2"},Yl=["onClick"],Xl=B({__name:"panel",props:{title:{},hiddenAdd:{type:Boolean,default:!1},disableAdd:{type:Boolean,default:!1}},emits:["clickAdd"],setup(n,{emit:e}){const t=n,s=o=>{t.disableAdd||e("clickAdd",o)};return(o,a)=>{const i=to,r=we;return g(),T("div",Gl,[N("div",{class:ve(["h28px font-bold text-xs flex justify-between items-center",[!o.disableAdd&&!o.hiddenAdd?"gray":"mb2px"]]),onClick:ro(s,["self"])},[N("span",null,Be(o.title),1),N("div",null,[se(o.$slots,"actions",{},void 0,!0),o.hiddenAdd?Z("",!0):(g(),O(r,{key:0,disabled:o.disableAdd,size:"small",class:"icon-btn",onClick:s},{icon:y(()=>[f(i)]),_:1},8,["disabled"]))])],10,Yl),o.disableAdd||o.hiddenAdd?se(o.$slots,"default",{key:0},void 0,!0):Z("",!0)])}}}),Qt=le(Xl,[["__scopeId","data-v-0a3e0013"]]),ql={class:"dialog-container"},Jl={class:"truncate flex-1 pl3"},Zl={key:0},Ql={class:"flex-shrink-0"},Ro=B({__name:"dialog",props:{hideClose:{type:Boolean},onClose:{type:Function},top:{},left:{},width:{},height:{}},emits:["close"],setup(n,{expose:e,emit:t}){var p,h;const s=n,o=Hi(),a=I(),i=I(),r=Fi(),l=({x:v,y:w})=>{var b,S,C,z;return{x:ht(v,0,r.width.value-((S=(b=a.value)==null?void 0:b.clientWidth)!=null?S:0)),y:ht(w,0,r.height.value-((z=(C=a.value)==null?void 0:C.clientHeight)!=null?z:0))}},{style:u,position:c}=Vi(a,{initialValue:{x:(p=s.left)!=null?p:0,y:(h=s.top)!=null?h:0},handle:i,onMove(v){const{x:w,y:b}=l(v);v.x=w,v.y=b}});Fe([r.height,r.width],()=>{const{x:v,y:w}=l(c.value);c.value.x=v,c.value.y=w});const d=()=>{t("close")};return e({handleClose:d}),(v,w)=>{const b=Ki,S=we;return g(),T("div",ql,[m(o)?(g(),T("div",{key:0,ref_key:"el",ref:a,class:"absolute flex flex-col bg-$color-bg-4 border border-$color-border-2 rounded-md z1000 shadow-lg",style:He([{width:v.width?`${v.width}px`:void 0,height:v.height?`${v.height}px`:void 0},m(u)])},[N("div",{ref_key:"handle",ref:i,class:"flex items-center p1 border-b border-$color-border-2"},[N("div",Jl,[se(v.$slots,"title")]),v.hideClose?Z("",!0):(g(),T("div",Zl,[f(S,{size:"mini",class:"icon-btn",onClick:d},{icon:y(()=>[f(b)]),_:1})]))],512),N("div",Ql,[se(v.$slots,"default")])],4)):Z("",!0)])}}}),ec=()=>{const n=document.createElement("div");return n.setAttribute("class","overlay-dialog"),n},Ds=n=>{if(n)return V.isFunction(n)?n:()=>n},tc=(n,e)=>{var u;let t=ec();const{hideClose:s,top:o,left:a,width:i,height:r}=n,l=Pe(Ro,{hideClose:s,onClose:()=>{t&&(jt(null,t),document.body.removeChild(t)),t=null,n.onClose&&n.onClose()},top:o,left:a,width:i,height:r},{title:Ds(n.title),default:Ds(n.body)});return l.appContext=(u=e!=null?e:hs._context)!=null?u:null,jt(l,t),document.body.appendChild(t),{close:()=>{var c;l.component&&((c=l.component.exposed)==null||c.handleClose())}}},hs=Object.assign(Ro,{open:tc,_context:void 0}),nc={class:"gradient-controls"},sc=B({__name:"index",props:{type:{},changeGradientControl:{type:Function}},setup(n){return(e,t)=>{const s=Ui,o=Wi;return g(),T("div",nc,[f(o,{size:"small","model-value":e.type,type:"button",onChange:t[0]||(t[0]=a=>e.changeGradientControl(a))},{default:y(()=>[f(s,{value:"color"},{default:y(()=>[me("纯色")]),_:1}),f(s,{value:"linear"},{default:y(()=>[me("线性")]),_:1}),f(s,{value:"radial"},{default:y(()=>[me("径向")]),_:1}),f(s,{value:"pattern"},{default:y(()=>[me("图案")]),_:1})]),_:1},8,["model-value"])])}}}),oc=le(sc,[["__scopeId","data-v-9038e18a"]]);var ae=(n=>(n[n.Null=0]="Null",n[n.Backspace=8]="Backspace",n[n.Tab=9]="Tab",n[n.LineFeed=10]="LineFeed",n[n.CarriageReturn=13]="CarriageReturn",n[n.Space=32]="Space",n[n.ExclamationMark=33]="ExclamationMark",n[n.DoubleQuote=34]="DoubleQuote",n[n.Hash=35]="Hash",n[n.DollarSign=36]="DollarSign",n[n.PercentSign=37]="PercentSign",n[n.Ampersand=38]="Ampersand",n[n.SingleQuote=39]="SingleQuote",n[n.OpenParen=40]="OpenParen",n[n.CloseParen=41]="CloseParen",n[n.Asterisk=42]="Asterisk",n[n.Plus=43]="Plus",n[n.Comma=44]="Comma",n[n.Dash=45]="Dash",n[n.Period=46]="Period",n[n.Slash=47]="Slash",n[n.Digit0=48]="Digit0",n[n.Digit1=49]="Digit1",n[n.Digit2=50]="Digit2",n[n.Digit3=51]="Digit3",n[n.Digit4=52]="Digit4",n[n.Digit5=53]="Digit5",n[n.Digit6=54]="Digit6",n[n.Digit7=55]="Digit7",n[n.Digit8=56]="Digit8",n[n.Digit9=57]="Digit9",n[n.Colon=58]="Colon",n[n.Semicolon=59]="Semicolon",n[n.LessThan=60]="LessThan",n[n.Equals=61]="Equals",n[n.GreaterThan=62]="GreaterThan",n[n.QuestionMark=63]="QuestionMark",n[n.AtSign=64]="AtSign",n[n.A=65]="A",n[n.B=66]="B",n[n.C=67]="C",n[n.D=68]="D",n[n.E=69]="E",n[n.F=70]="F",n[n.G=71]="G",n[n.H=72]="H",n[n.I=73]="I",n[n.J=74]="J",n[n.K=75]="K",n[n.L=76]="L",n[n.M=77]="M",n[n.N=78]="N",n[n.O=79]="O",n[n.P=80]="P",n[n.Q=81]="Q",n[n.R=82]="R",n[n.S=83]="S",n[n.T=84]="T",n[n.U=85]="U",n[n.V=86]="V",n[n.W=87]="W",n[n.X=88]="X",n[n.Y=89]="Y",n[n.Z=90]="Z",n[n.OpenSquareBracket=91]="OpenSquareBracket",n[n.Backslash=92]="Backslash",n[n.CloseSquareBracket=93]="CloseSquareBracket",n[n.Caret=94]="Caret",n[n.Underline=95]="Underline",n[n.BackTick=96]="BackTick",n[n.a=97]="a",n[n.b=98]="b",n[n.c=99]="c",n[n.d=100]="d",n[n.e=101]="e",n[n.f=102]="f",n[n.g=103]="g",n[n.h=104]="h",n[n.i=105]="i",n[n.j=106]="j",n[n.k=107]="k",n[n.l=108]="l",n[n.m=109]="m",n[n.n=110]="n",n[n.o=111]="o",n[n.p=112]="p",n[n.q=113]="q",n[n.r=114]="r",n[n.s=115]="s",n[n.t=116]="t",n[n.u=117]="u",n[n.v=118]="v",n[n.w=119]="w",n[n.x=120]="x",n[n.y=121]="y",n[n.z=122]="z",n))(ae||{});function ut(n,e){return _e.round(n,e)}class re{constructor(e,t,s,o=1){_(this,"_rgbaBrand");_(this,"r");_(this,"g");_(this,"b");_(this,"a");this.r=Math.min(255,Math.max(0,e))|0,this.g=Math.min(255,Math.max(0,t))|0,this.b=Math.min(255,Math.max(0,s))|0,this.a=ut(Math.max(Math.min(1,o),0),3)}static equals(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}}class We{constructor(e,t,s,o){_(this,"_hslaBrand");_(this,"h");_(this,"s");_(this,"l");_(this,"a");this.h=Math.max(Math.min(360,e),0)|0,this.s=ut(Math.max(Math.min(1,t),0),3),this.l=ut(Math.max(Math.min(1,s),0),3),this.a=ut(Math.max(Math.min(1,o),0),3)}static equals(e,t){return e.h===t.h&&e.s===t.s&&e.l===t.l&&e.a===t.a}static fromRGBA(e){const t=e.r/255,s=e.g/255,o=e.b/255,a=e.a,i=Math.max(t,s,o),r=Math.min(t,s,o);let l=0,u=0;const c=(r+i)/2,d=i-r;if(d>0){switch(u=Math.min(c<=.5?d/(2*c):d/(2-2*c),1),i){case t:l=(s-o)/d+(s<o?6:0);break;case s:l=(o-t)/d+2;break;case o:l=(t-s)/d+4;break}l*=60,l=Math.round(l)}return new We(l,u,c,a)}static _hue2rgb(e,t,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+(t-e)*6*s:s<1/2?t:s<2/3?e+(t-e)*(2/3-s)*6:e}static toRGBA(e){const t=e.h/360,{s,l:o,a}=e;let i,r,l;if(s===0)i=r=l=o;else{const u=o<.5?o*(1+s):o+s-o*s,c=2*o-u;i=We._hue2rgb(c,u,t+1/3),r=We._hue2rgb(c,u,t),l=We._hue2rgb(c,u,t-1/3)}return new re(Math.round(i*255),Math.round(r*255),Math.round(l*255),a)}}class Je{constructor(e,t,s,o){_(this,"_hsvaBrand");_(this,"h");_(this,"s");_(this,"v");_(this,"a");this.h=Math.max(Math.min(360,e),0)|0,this.s=ut(Math.max(Math.min(1,t),0),3),this.v=ut(Math.max(Math.min(1,s),0),3),this.a=ut(Math.max(Math.min(1,o),0),3)}static equals(e,t){return e.h===t.h&&e.s===t.s&&e.v===t.v&&e.a===t.a}static fromRGBA(e){const t=e.r/255,s=e.g/255,o=e.b/255,a=Math.max(t,s,o),i=Math.min(t,s,o),r=a-i,l=a===0?0:r/a;let u;return r===0?u=0:a===t?u=((s-o)/r%6+6)%6:a===s?u=(o-t)/r+2:u=(t-s)/r+4,new Je(Math.round(u*60),l,a,e.a)}static toRGBA(e){const{h:t,s,v:o,a}=e,i=o*s,r=i*(1-Math.abs(t/60%2-1)),l=o-i;let[u,c,d]=[0,0,0];return t<60?(u=i,c=r):t<120?(u=r,c=i):t<180?(c=i,d=r):t<240?(c=r,d=i):t<300?(u=r,d=i):t<=360&&(u=i,d=r),u=Math.round((u+l)*255),c=Math.round((c+l)*255),d=Math.round((d+l)*255),new re(u,c,d,a)}}const ne=class{constructor(e){_(this,"rgba");_(this,"_hsla");_(this,"_hsva");_(this,"_toString");if(e)if(e instanceof re)this.rgba=e;else if(e instanceof We)this._hsla=e,this.rgba=We.toRGBA(e);else if(e instanceof Je)this._hsva=e,this.rgba=Je.toRGBA(e);else throw new Error("Invalid color ctor argument");else throw new Error("Color needs a value")}static fromHex(e){return ne.Format.CSS.parseHex(e)||ne.red}static equals(e,t){return!e&&!t?!0:!e||!t?!1:e.equals(t)}get hsla(){return this._hsla?this._hsla:We.fromRGBA(this.rgba)}get hsva(){return this._hsva?this._hsva:Je.fromRGBA(this.rgba)}equals(e){return!!e&&re.equals(this.rgba,e.rgba)&&We.equals(this.hsla,e.hsla)&&Je.equals(this.hsva,e.hsva)}getRelativeLuminance(){const e=ne._relativeLuminanceForComponent(this.rgba.r),t=ne._relativeLuminanceForComponent(this.rgba.g),s=ne._relativeLuminanceForComponent(this.rgba.b),o=.2126*e+.7152*t+.0722*s;return ut(o,4)}static _relativeLuminanceForComponent(e){const t=e/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}getContrastRatio(e){const t=this.getRelativeLuminance(),s=e.getRelativeLuminance();return t>s?(t+.05)/(s+.05):(s+.05)/(t+.05)}isDarker(){return(this.rgba.r*299+this.rgba.g*587+this.rgba.b*114)/1e3<128}isLighter(){return(this.rgba.r*299+this.rgba.g*587+this.rgba.b*114)/1e3>=128}isLighterThan(e){const t=this.getRelativeLuminance(),s=e.getRelativeLuminance();return t>s}isDarkerThan(e){const t=this.getRelativeLuminance(),s=e.getRelativeLuminance();return t<s}lighten(e){return new ne(new We(this.hsla.h,this.hsla.s,this.hsla.l+this.hsla.l*e,this.hsla.a))}darken(e){return new ne(new We(this.hsla.h,this.hsla.s,this.hsla.l-this.hsla.l*e,this.hsla.a))}transparent(e){const{r:t,g:s,b:o,a}=this.rgba;return new ne(new re(t,s,o,a*e))}isTransparent(){return this.rgba.a===0}isOpaque(){return this.rgba.a===1}opposite(){return new ne(new re(255-this.rgba.r,255-this.rgba.g,255-this.rgba.b,this.rgba.a))}blend(e){const t=e.rgba,s=this.rgba.a,o=t.a,a=s+o*(1-s);if(a<1e-6)return ne.transparent;const i=this.rgba.r*s/a+t.r*o*(1-s)/a,r=this.rgba.g*s/a+t.g*o*(1-s)/a,l=this.rgba.b*s/a+t.b*o*(1-s)/a;return new ne(new re(i,r,l,a))}makeOpaque(e){if(this.isOpaque()||e.rgba.a!==1)return this;const{r:t,g:s,b:o,a}=this.rgba;return new ne(new re(e.rgba.r-a*(e.rgba.r-t),e.rgba.g-a*(e.rgba.g-s),e.rgba.b-a*(e.rgba.b-o),1))}flatten(...e){const t=e.reduceRight((s,o)=>ne._flatten(o,s));return ne._flatten(this,t)}static _flatten(e,t){const s=1-e.rgba.a;return new ne(new re(s*t.rgba.r+e.rgba.a*e.rgba.r,s*t.rgba.g+e.rgba.a*e.rgba.g,s*t.rgba.b+e.rgba.a*e.rgba.b))}toString(){return this._toString||(this._toString=ne.Format.CSS.format(this)),this._toString}static getLighterColor(e,t,s){if(e.isLighterThan(t))return e;s=s||.5;const o=e.getRelativeLuminance(),a=t.getRelativeLuminance();return s=s*(a-o)/a,e.lighten(s)}static getDarkerColor(e,t,s){if(e.isDarkerThan(t))return e;s=s||.5;const o=e.getRelativeLuminance(),a=t.getRelativeLuminance();return s=s*(o-a)/o,e.darken(s)}};let fe=ne;_(fe,"white",new ne(new re(255,255,255,1))),_(fe,"black",new ne(new re(0,0,0,1))),_(fe,"red",new ne(new re(255,0,0,1))),_(fe,"blue",new ne(new re(0,0,255,1))),_(fe,"green",new ne(new re(0,255,0,1))),_(fe,"cyan",new ne(new re(0,255,255,1))),_(fe,"lightgrey",new ne(new re(211,211,211,1))),_(fe,"transparent",new ne(new re(0,0,0,0)));(n=>{(e=>{(t=>{function s(h){return h.rgba.a===1?`rgb(${h.rgba.r}, ${h.rgba.g}, ${h.rgba.b})`:n.Format.CSS.formatRGBA(h)}t.formatRGB=s;function o(h){return`rgba(${h.rgba.r}, ${h.rgba.g}, ${h.rgba.b}, ${+h.rgba.a.toFixed(2)})`}t.formatRGBA=o;function a(h){return h.hsla.a===1?`hsl(${h.hsla.h}, ${(h.hsla.s*100).toFixed(2)}%, ${(h.hsla.l*100).toFixed(2)}%)`:n.Format.CSS.formatHSLA(h)}t.formatHSL=a;function i(h){return`hsla(${h.hsla.h}, ${(h.hsla.s*100).toFixed(2)}%, ${(h.hsla.l*100).toFixed(2)}%, ${h.hsla.a.toFixed(2)})`}t.formatHSLA=i;function r(h){const v=h.toString(16);return v.length!==2?"0"+v:v}function l(h){return`#${r(h.rgba.r)}${r(h.rgba.g)}${r(h.rgba.b)}`}t.formatHex=l;function u(h,v=!1){return v&&h.rgba.a===1?n.Format.CSS.formatHex(h):`#${r(h.rgba.r)}${r(h.rgba.g)}${r(h.rgba.b)}${r(Math.round(h.rgba.a*255))}`}t.formatHexA=u;function c(h){return h.isOpaque()?n.Format.CSS.formatHex(h):n.Format.CSS.formatRGBA(h)}t.format=c;function d(h){const v=h.length;if(v===0||h.charCodeAt(0)!==ae.Hash)return null;if(v===7){const w=16*p(h.charCodeAt(1))+p(h.charCodeAt(2)),b=16*p(h.charCodeAt(3))+p(h.charCodeAt(4)),S=16*p(h.charCodeAt(5))+p(h.charCodeAt(6));return new n(new re(w,b,S,1))}if(v===9){const w=16*p(h.charCodeAt(1))+p(h.charCodeAt(2)),b=16*p(h.charCodeAt(3))+p(h.charCodeAt(4)),S=16*p(h.charCodeAt(5))+p(h.charCodeAt(6)),C=16*p(h.charCodeAt(7))+p(h.charCodeAt(8));return new n(new re(w,b,S,C/255))}if(v===4){const w=p(h.charCodeAt(1)),b=p(h.charCodeAt(2)),S=p(h.charCodeAt(3));return new n(new re(16*w+w,16*b+b,16*S+S))}if(v===5){const w=p(h.charCodeAt(1)),b=p(h.charCodeAt(2)),S=p(h.charCodeAt(3)),C=p(h.charCodeAt(4));return new n(new re(16*w+w,16*b+b,16*S+S,(16*C+C)/255))}return null}t.parseHex=d;function p(h){switch(h){case ae.Digit0:return 0;case ae.Digit1:return 1;case ae.Digit2:return 2;case ae.Digit3:return 3;case ae.Digit4:return 4;case ae.Digit5:return 5;case ae.Digit6:return 6;case ae.Digit7:return 7;case ae.Digit8:return 8;case ae.Digit9:return 9;case ae.a:return 10;case ae.A:return 10;case ae.b:return 11;case ae.B:return 11;case ae.c:return 12;case ae.C:return 12;case ae.d:return 13;case ae.D:return 13;case ae.e:return 14;case ae.E:return 14;case ae.f:return 15;case ae.F:return 15}return 0}})(e.CSS||(e.CSS={}))})(n.Format||(n.Format={}))})(fe||(fe={}));const ic=B({__name:"index",props:{red:{},green:{},blue:{},alpha:{},updateColor:{type:Function}},setup(n){const e=n,{red:t,green:s,blue:o}=Te(e),a=I(),i=I();Ge(()=>{const u=new fe(new re(t.value,s.value,o.value));a.value=fe.Format.CSS.formatHex(u).replace("#","").toLocaleUpperCase(),i.value=pe(e.alpha*100)});const r=u=>{const c=fe.fromHex(`#${u.replace("#","")}`),{h:d,s:p,v:h}=c.hsva;e.updateColor({...c.rgba,hue:d,saturation:p,value:h})},l=u=>{U(u)&&e.updateColor({a:u/100})};return(u,c)=>{const d=Ht,p=pt,h=mn,v=ft;return g(),O(v,{wrap:!1,gutter:4},{default:y(()=>[f(p,{span:13},{default:y(()=>[f(d,{size:"small",modelValue:m(a),"onUpdate:modelValue":c[0]||(c[0]=w=>rt(a)?a.value=w:null),onChange:r},null,8,["modelValue"])]),_:1}),f(p,{span:11},{default:y(()=>[f(h,{size:"small",modelValue:m(i),"onUpdate:modelValue":c[1]||(c[1]=w=>rt(i)?i.value=w:null),"hide-button":"",min:0,max:100,onChange:l},{suffix:y(()=>[me("%")]),_:1},8,["modelValue"])]),_:1})]),_:1})}}}),nn=B({__name:"index",props:{value:{},type:{default:"text"},label:{default:""},onChange:{type:Function,default:n=>!1}},setup(n){const e=n;Zs();const t=ge({inputValue:e.value||0,inProgress:!1}),s=()=>{e.value!==+t.inputValue&&t.inputValue!==""&&(t.inputValue=e.value)};return Fe(()=>e.value,()=>s()),(o,a)=>(g(),T("div"))}}),ac=B({__name:"index",props:{red:{default:0},green:{default:0},blue:{default:0},alpha:{default:0},updateColor:{type:Function,default:()=>!1}},setup(n){const e=n,t=(s,o)=>{};return(s,o)=>(g(),T(he,null,[f(nn,{value:e.red,type:"number",label:"R","on-change":a=>t()},null,8,["value","on-change"]),f(nn,{value:e.green,type:"number",label:"G","on-change":a=>t()},null,8,["value","on-change"]),f(nn,{value:e.blue,type:"number",label:"B","on-change":a=>t()},null,8,["value","on-change"]),f(nn,{value:e.alpha*100,type:"number",label:"Alpha","on-change":a=>t()},null,8,["value","on-change"])],64))}}),rc={class:"color-preview-area"},lc=B({__name:"index",props:{mode:{},red:{},green:{},blue:{},alpha:{},updateColor:{type:Function}},setup(n){const e=n;return(t,s)=>{const o=Ys,a=we,i=Gs,r=Us,l=Nt;return g(),T("div",rc,[f(l,null,{default:y(()=>[t.mode==="hex"?(g(),O(ic,{key:0,red:e.red,green:e.green,blue:e.blue,alpha:e.alpha,"update-color":e.updateColor},null,8,["red","green","blue","alpha","update-color"])):t.mode==="rgb"?(g(),O(ac,{key:1,red:e.red,green:e.green,blue:e.blue,alpha:e.alpha,"update-color":e.updateColor},null,8,["red","green","blue","alpha","update-color"])):Z("",!0),f(r,{"popup-max-height":!1},{content:y(()=>[f(i,null,{default:y(()=>[me("HEX")]),_:1}),f(i,{disabled:""},{default:y(()=>[me("RGB")]),_:1})]),default:y(()=>[f(a,{class:"px1! icon-btn",size:"small"},{default:y(()=>[f(o)]),_:1})]),_:1})]),_:1})])}}}),cc=N("div",{class:"spectrum"},null,-1),uc=B({__name:"index",props:{red:{},green:{},blue:{},alpha:{},hue:{},saturation:{},value:{},updateColor:{type:Function}},setup(n){const e=n,t=I(),s=ge({width:0,height:0}),o=j(()=>Math.round(e.saturation*s.width-8)),a=j(()=>Math.max(Math.round(s.height-e.value*s.height-14),-6)),i=j(()=>({backgroundColor:`rgb(${e.red}, ${e.green}, ${e.blue})`,left:`${o.value}px`,top:`${a.value}px`})),r=j(()=>{const d=new fe(new Je(e.hue,1,1,1)),{r:p,g:h,b:v}=d.rgba;return{backgroundColor:`rgb(${p}, ${h}, ${v})`}});Qe(()=>{U(t)&&(s.width=t.value.clientWidth,s.height=t.value.clientHeight)});let l;const u=()=>{if(!U(l))return;let d=ht(c.x-l.x,0,s.width),p=ht(c.y-l.y,0,s.height);const h=d/s.width,v=1-p/s.height;return{...new fe(new Je(e.hue,h,v,e.alpha)).rgba,saturation:h,value:v}},{posEnd:c}=Jt(t,{threshold:0,onSwipeStart(){var d;l=(d=t.value)==null?void 0:d.getBoundingClientRect(),e.updateColor(u(),"onStartChange")},onSwipe(){e.updateColor(u(),"onChange")},onSwipeEnd(){e.updateColor(u(),"onEndChange")}});return(d,p)=>(g(),T("div",{ref_key:"pickerAreaRef",ref:t,class:"spectrum-map",style:He(r.value)},[cc,N("div",{class:"picker-cursor",style:He(i.value)},null,4)],4))}});function dc(n,e,t,s){return`rgba(${n}, ${e}, ${t}, ${s})`}function Do(n,e){let t="";const s=n.slice();return s.sort((o,a)=>o.left-a.left),e==="linear"?t="linear-gradient(90deg,":t="radial-gradient(",s.forEach((o,a)=>{t+=`rgba(${o.red}, ${o.green}, ${o.blue}, ${o.alpha}) ${o.left}%`,a!==s.length-1&&(t+=",")}),t+=")",t}const hc={class:"preview-area"},pc=B({__name:"index",props:{isGradient:{type:Boolean,default:!1},red:{default:255},green:{default:0},blue:{default:0},alpha:{default:1},points:{default:()=>[{left:0,red:0,green:0,blue:0,alpha:1},{left:100,red:255,green:0,blue:0,alpha:1}]},gradientType:{default:""}},setup(n){const e=n,t=j(()=>{let s="";return["linear","radial"].includes(e.gradientType)?(s=Do(e.points,e.gradientType),{background:s}):(s=dc(e.red,e.green,e.blue,e.alpha),{backgroundColor:s})});return(s,o)=>(g(),T("div",hc,[N("div",{class:"preview-box",style:He(t.value)},null,4)]))}}),fc={class:"hue"},vc=B({__name:"index",props:{hue:{},saturation:{},value:{},updateColor:{type:Function}},setup(n){const e=n,t=I(),s=ge({width:0}),o=j(()=>{const{r:l,g:u,b:c}=new fe(new Je(e.hue,1,1,1)).rgba;return{left:`${(e.hue*s.width/360|0)-8}px`,background:`rgb(${l}, ${u}, ${c})`}});Qe(()=>{U(t)&&(s.width=t.value.clientWidth)});let a;const i=()=>{if(!U(a))return;const l=r.x-a.x,u=new Je(360*l/s.width,e.saturation,e.value,1),{r:c,g:d,b:p}=new fe(u).rgba;return{r:c,g:d,b:p,hue:u.h}},{posEnd:r}=Jt(t,{threshold:0,onSwipeStart(){var l;a=(l=t.value)==null?void 0:l.getBoundingClientRect(),e.updateColor(i(),"onStartChange")},onSwipe(){U(a)&&e.updateColor(i(),"onChange")},onSwipeEnd(){U(a)&&e.updateColor(i(),"onEndChange")}});return(l,u)=>(g(),T("div",fc,[N("div",{ref_key:"hueRef",ref:t,class:"hue-area"},[N("div",{class:"picker-cursor",style:He(o.value)},null,4)],512)]))}}),gc={class:"alpha"},mc={class:"alpha-area"},bc=B({__name:"index",props:{red:{},green:{},blue:{},alpha:{},updateColor:{type:Function}},setup(n){const e=n,t=I(),s=ge({width:0}),o=j(()=>Math.round(e.alpha*s.width)-8),a=j(()=>({left:`${o.value}px`})),i=j(()=>({background:`linear-gradient(to right, rgba(0, 0, 0, 0), rgb(${e.red}, ${e.green}, ${e.blue}))`}));Qe(()=>{U(t)&&(s.width=t.value.clientWidth)});let r;const l=()=>{if(U(r))return{a:ht(Number(((u.x-r.x)/s.width).toFixed(2)),0,1)}},{posEnd:u}=Jt(t,{threshold:0,onSwipeStart(){var c;r=(c=t.value)==null?void 0:c.getBoundingClientRect(),e.updateColor(l(),"onStartChange")},onSwipe(){U(r)&&e.updateColor(l(),"onChange")},onSwipeEnd(){U(r)&&e.updateColor(l(),"onEndChange")}});return(c,d)=>(g(),T("div",gc,[N("div",{class:"gradient",style:He(i.value)},null,4),N("div",mc,[N("div",{ref_key:"alphaMaskRef",ref:t,class:"alpha-mask"},[N("div",{class:"picker-cursor",style:He(a.value)},null,4)],512)])]))}}),yc=B({__name:"index",props:{point:{},active:{type:Boolean},width:{},index:{},removePoint:{type:Function}},setup(n){const e=n,t=j(()=>{const{red:s,green:o,blue:a,alpha:i,left:r}=e.point;return{left:`${r*(e.width/100)}px`,background:`rgba(${s}, ${o}, ${a}, ${i})`}});return(s,o)=>(g(),T("div",{class:ve(["picker-cursor",{active:s.active}]),style:He(t.value),onDblclick:o[0]||(o[0]=()=>e.removePoint(s.index))},null,38))}}),_c=B({__name:"index",props:{points:Array,activePointIndex:Number,changeActivePointIndex:Function,updateGradientLeft:Function,addPoint:Function,removePoint:Function},setup(n){const e=n,t=I(),s=I(0),o=j(()=>({background:Do(e.points,"linear")}));let a=0;const i=u=>{if(!U(t))return;const c=t.value.getBoundingClientRect();a=u.clientX-c.x;const d=a*100/s.value;e.addPoint(d)},r=(u,c)=>{e.changeActivePointIndex(c),u.target instanceof HTMLDivElement&&(a=u.target.offsetLeft)};Qe(()=>{U(t)&&(s.value=t.value.clientWidth)});const{distanceX:l}=Jt(t,{threshold:0,onSwipeStart(){e.updateGradientLeft(e.points[e.activePointIndex].left,e.activePointIndex,"onStartChange")},onSwipe(){e.updateGradientLeft((a-l.value)*100/s.value,e.activePointIndex,"onChange")},onSwipeEnd(){e.updateGradientLeft(e.points[e.activePointIndex].left,e.activePointIndex,"onEndChange")}});return(u,c)=>(g(),T("div",{class:"gradient",onMousedown:i},[N("div",{class:"gradient-points-bg",style:He(m(o))},null,4),N("div",{ref_key:"pointsContainerRef",ref:t,class:"gradient-slider-container"},[(g(!0),T(he,null,ze(e.points,(d,p)=>(g(),O(yc,{key:p,index:p,point:d,width:m(s),"remove-point":e.removePoint,active:e.activePointIndex===p,onMousedown:ro(h=>r(h,p),["stop"])},null,8,["index","point","width","remove-point","active","onMousedown"]))),128))],512)],32))}}),wc={class:"picker-area"},kc={key:0,class:"px10px py8px"},Sc={class:"preview"},xc={class:"color-hue-alpha"},Cc=B({__name:"index",props:{isGradient:{type:Boolean},red:{},green:{},blue:{},alpha:{},hue:{},saturation:{},value:{},updateColor:{type:Function},points:{},type:{},activePointIndex:{},changeGradientControl:{type:Function},changeActivePointIndex:{type:Function},updateGradientLeft:{type:Function},addPoint:{type:Function},removePoint:{type:Function}},setup(n){return(e,t)=>(g(),T("div",wc,[["linear","radial"].includes(e.type)?(g(),T("div",kc,[e.isGradient?(g(),O(_c,{key:0,type:e.type,points:e.points,"active-point-index":e.activePointIndex,"change-active-point-index":e.changeActivePointIndex,"update-gradient-left":e.updateGradientLeft,"add-point":e.addPoint,"remove-point":e.removePoint},null,8,["type","points","active-point-index","change-active-point-index","update-gradient-left","add-point","remove-point"])):Z("",!0)])):Z("",!0),f(uc,{red:e.red,green:e.green,blue:e.blue,hue:e.hue,alpha:e.alpha,saturation:e.saturation,value:e.value,"update-color":e.updateColor},null,8,["red","green","blue","hue","alpha","saturation","value","update-color"]),N("div",Sc,[f(pc,{red:e.red,green:e.green,blue:e.blue,alpha:e.alpha,"is-gradient":e.isGradient,points:e.points,"gradient-type":e.type},null,8,["red","green","blue","alpha","is-gradient","points","gradient-type"]),N("div",xc,[f(vc,{hue:e.hue,saturation:e.saturation,value:e.value,"update-color":e.updateColor},null,8,["hue","saturation","value","update-color"]),f(bc,{alpha:e.alpha,red:e.red,green:e.green,blue:e.blue,"update-color":e.updateColor},null,8,["alpha","red","green","blue","update-color"])])])]))}}),be=n=>{const{canvas:e}=ye(),t=I();let s=!1;Ge(()=>{if(!U(e.activeObject)){t.value=void 0;return}const i=e.activeObject.value;s=!0;let r;switch(n){case"width":r=i.getWidth();break;case"height":r=i.getHeight();break;case"opacity":r=_e.times(i.opacity,100);break;case"angle":r=mo(i.angle);break;case"left":i.getParent(!0)?r=i.getLeftTop().x:r=i.left;break;case"top":i.getParent(!0)?r=i.getLeftTop().y:r=i.top;break;case"fontSize":if(L.isTextObject(i)){let l=i.getStyleAtPosition(0).fontSize,u=!0;for(let c=1;c<i.text.length;c++){const d=i.getStyleAtPosition(c).fontSize;if(!V.isEqual(d,l)){u=!1;break}l=d}u?r=i.fontSize:r="多个值"}else r=i[n];break;default:r=i[n];break}t.value=V.isNumber(r)?pe(r):r,requestAnimationFrame(()=>s=!1)});const o=(i,r)=>{n==="opacity"&&(r=_e.divide(r,100)),i.get(n)!==r&&i.set(n,r)},a=(i,r)=>{var u;const l=e.activeObject.value;s||!U(l)||(["width","height","left","top","angle"].includes(n)?(l[n==="width"?"setWidth":n==="height"?"setHeight":n==="left"?"setLeft":n==="top"?"setTop":"setAngle"](Number(i)),r==="change"&&((u=l.group)!=null&&u.updateLayout)&&l.group.updateLayout()):l.isType("Text","Textbox")&&["fontSize"].includes(n)&&l.selectionEnd-l.selectionStart>0?l.setSelectionStyles({fontSize:i}):L.isBoard(l)&&["fill"].includes(n)?o(l,i):L.isCollection(l)&&!["left","top","visible","globalCompositeOperation","opacity"].includes(n)?l.forEachObject(c=>{o(c,i)}):o(l,i),e.requestRenderAll())};return j(()=>({disabled:!U(e.activeObject.value),modelValue:t.value,onSwipe:i=>{a(i,"swipe")},onChange:i=>{a(i,"change"),U(e.activeObject)&&e.fire("object:modified",{target:e.activeObject.value})}}))},Mc={key:1},Oc=B({__name:"index",props:{solidColor:{type:Boolean},mode:{},gradient:{},onChange:{type:Function},onStartChange:{type:Function},onEndChange:{type:Function}},setup(n){const e=n,{canvas:t,undoRedo:s}=ye(),o=be("fill"),a=j({get(){if(L.isPattern(o.value.modelValue))return o.value.modelValue.fit},set(b){var S;L.isPattern(o.value.modelValue)&&b&&(o.value.modelValue.fit=b,(S=t.activeObject.value)==null||S._set("dirty",!0),t.requestRenderAll(),s.saveState())}}),i=ge({activePointIndex:0,gradientPoints:e.gradient.points,activePoint:e.gradient.points[0],colorRed:e.gradient.points[0].red,colorGreen:e.gradient.points[0].green,colorBlue:e.gradient.points[0].blue,colorAlpha:e.gradient.points[0].alpha,colorHue:0,colorSaturation:1,colorValue:1,gradientType:e.gradient.type}),r=()=>({points:i.gradientType==="color"?[i.gradientPoints[i.activePointIndex]]:i.gradientPoints,type:i.gradientType}),l=()=>{e.onChange&&e.onChange(r())},u=(b=i.activePointIndex)=>{i.gradientPoints.length<=2||(i.gradientPoints.splice(b,1),b>0&&(i.activePointIndex=b-1),l())},c=b=>{(b.keyCode===46||b.keyCode===8)&&u(i.activePointIndex)},d=b=>{i.activePointIndex=b,i.activePoint=i.gradientPoints[b];const{red:S,green:C,blue:z,alpha:J}=i.activePoint;i.colorRed=S,i.colorGreen=C,i.colorBlue=z,i.colorAlpha=J;const K=new fe(new re(S,C,z,1)),{h:G,s:ie,v:te}=K.hsva;i.colorHue=G,i.colorSaturation=ie,i.colorValue=te},p=b=>{b=b!=null?b:i.gradientType,i.gradientType=b,l()},h=({r:b,g:S,b:C,a:z,hue:J,saturation:K,value:G},ie="onChange")=>{b=b!=null?b:i.colorRed,S=S!=null?S:i.colorGreen,C=C!=null?C:i.colorBlue,z=z!=null?z:i.colorAlpha,J=J!=null?J:i.colorHue,K=K!=null?K:i.colorSaturation,G=G!=null?G:i.colorValue;const te=i.gradientPoints.slice();te[i.activePointIndex]={...te[i.activePointIndex],red:b,green:S,blue:C,alpha:z},i.colorRed=b,i.colorGreen=S,i.colorBlue=C,i.colorAlpha=z,i.colorHue=J,i.colorSaturation=K,i.colorValue=G,i.gradientPoints=te;const ee=e[ie];ee&&ee(r())},v=(b,S,C="onChange")=>{i.gradientPoints[S].left=ht(b,0,100);const z=e[C];z&&z(r())},w=b=>{b=ht(b,0,100),i.gradientPoints.push({...i.gradientPoints[i.activePointIndex],left:b,alpha:1}),i.activePointIndex=i.gradientPoints.length-1,l()};return Qe(()=>{const b=new fe(new re(i.colorRed,i.colorGreen,i.colorBlue,1)),{h:S,s:C,v:z}=b.hsva;i.colorHue=S,i.colorSaturation=C,i.colorValue=z,document.addEventListener("keyup",c)}),fn(()=>{document.removeEventListener("keyup",c)}),(b,S)=>{const C=Gi,z=bn;return g(),T(he,null,[b.solidColor?Z("",!0):(g(),O(oc,{key:0,type:i.gradientType,"change-gradient-control":p},null,8,["type"])),i.gradientType==="pattern"?(g(),T("div",Mc,[f(z,{modelValue:m(a),"onUpdate:modelValue":S[0]||(S[0]=J=>rt(a)?a.value=J:null)},{default:y(()=>[f(C,{value:"fill"},{default:y(()=>[me("填充")]),_:1}),f(C,{value:"padding"},{default:y(()=>[me("适应")]),_:1}),f(C,{value:"clip"},{default:y(()=>[me("裁剪")]),_:1})]),_:1},8,["modelValue"])])):(g(),T(he,{key:2},[f(Cc,{red:i.colorRed,green:i.colorGreen,blue:i.colorBlue,alpha:i.colorAlpha,hue:i.colorHue,saturation:i.colorSaturation,value:i.colorValue,"update-color":h,"is-gradient":!0,type:i.gradientType,points:i.gradientPoints,"active-point-index":i.activePointIndex,"change-gradient-control":p,"change-active-point-index":d,"update-gradient-left":v,"add-point":w,"remove-point":u},null,8,["red","green","blue","alpha","hue","saturation","value","type","points","active-point-index"]),f(lc,{red:i.colorRed,green:i.colorGreen,blue:i.colorBlue,alpha:i.colorAlpha,"update-color":h,mode:b.mode},null,8,["red","green","blue","alpha","mode"])],64))],64)}}}),Ac={class:"ui-color-picker"},jo=B({__name:"colorPicker",props:{solidColor:{type:Boolean,default:!1},mode:{default:"hex"},gradient:{default:()=>({type:"color",points:[{left:0,red:255,green:0,blue:0,alpha:1},{left:100,red:255,green:255,blue:255,alpha:0}]})},onChange:{type:Function,default:Le},onStartChange:{type:Function,default:Le},onEndChange:{type:Function,default:Le}},setup(n){const e=n;return(t,s)=>(g(),T("div",Ac,[f(Oc,Yt(ss(e)),null,16)]))}});function Pc(n,e){const t=Ic(n,e),s=$c(t),o=Tc(n,e),a=n.x+o*Math.cos(s*Math.PI/180),i=n.y+o*Math.sin(s*Math.PI/180);return{x:a,y:i}}function Ic(n,e){return Math.atan2(n.y-e.y,n.x-e.x)}function $c(n){return 180/Math.PI*n}function Tc(n,e){const t=Math.abs(n.x-e.x),s=Math.abs(n.y-e.y);return Math.sqrt(Math.pow(t,2)+Math.pow(s,2))}const Ec=n=>{const e=-parseInt(n+"",10)*ct;return{x1:Math.round(50+Math.sin(e)*50)/100,y1:Math.round(50+Math.cos(e)*50)/100,x2:Math.round(50+Math.sin(e+Math.PI)*50)/100,y2:Math.round(50+Math.cos(e+Math.PI)*50)/100}},Rc=n=>n.map(e=>({offset:e.left/100,color:`rgba(${e.red}, ${e.green}, ${e.blue}, ${e.alpha})`})),Dc=n=>n.colorStops.map(e=>{const t=new kt(e.color),[s,o,a,i]=t.getSource();return{left:e.offset*100,red:s,green:o,blue:a,alpha:i}}),Lo=n=>n.padEnd(6,n);let Dt;const Bo=()=>{Dt&&Dt.close(),Dt=void 0},jc=(n,{object:e,attr:t,dialogOption:s,initialColor:o,...a})=>{const i=n.get(Ie),r=n.get(Mt);let l,u="color";const c=e&&t?e[t]:o;if(c instanceof Gt)l=Dc(c),u=c.type;else if(c instanceof Ot)l=[{left:0,red:255,green:255,blue:255,alpha:1},{left:100,red:255,green:255,blue:255,alpha:0}],u=c.type;else if(c){const d=new kt(c),[p,h,v,w]=d.getSource();l=[{left:0,red:p,green:h,blue:v,alpha:w},{left:100,red:255,green:255,blue:255,alpha:0}]}return hs.open({width:240,top:window.innerHeight/2-202,left:window.innerWidth-240-240,title:"颜色",...s,body:()=>Pe(jo,{onChange(d){if(!(!U(e)||!U(t))){if(d.type==="color"){if(d.points.length<1)return;const[{red:p,green:h,blue:v,alpha:w}]=d.points;e.set(t,`rgba(${p}, ${h}, ${v}, ${w})`)}else if(d.type==="linear"||d.type==="radial"){const p=Rc(d.points),h=180;let v;const w=e[t];if(w instanceof Gt&&(v=w.coords),!v){const b=Ec(h);v={x1:b.x1*e.width,y1:b.y1*e.height,x2:b.x2*e.width,y2:b.y2*e.height}}e.set(t,new Gt({type:"linear",coords:v,colorStops:p}))}i.requestRenderAll()}},onEndChange(){r.saveState()},...a,gradient:{type:u,points:l}}),onClose(){var d;Dt=void 0,(d=s==null?void 0:s.onClose)==null||d.call(s)}})},Lc=n=>(Dt||(Dt=Ne.editor.service.invokeFunction(jc,n)),Bo),Nn=Object.assign(jo,{open:Lc,close:Bo}),Bc=B({__name:"backgroundColorAttr",setup(n){const{canvas:e}=ye();let t;const s=()=>{t&&t(),t=void 0},o=r=>{r=r.replace(/^#/,""),r.length<6&&(r=Lo(r));const l=new kt(r);i.backgroundColor=l.toRgba()};Fe(e.activeObject,()=>s());const a=()=>{t=Nn.open({initialColor:e.backgroundColor,solidColor:!0,onChange:r=>{if(r.points.length<1)return;const[{red:l,green:u,blue:c,alpha:d}]=r.points;i.backgroundColor=`rgba(${l}, ${u}, ${c}, ${d})`}})};eo(()=>{s()});const i=ge({backgroundColor:e.backgroundColor,inputValue:""});return Fe(()=>i.backgroundColor,r=>{V.isString(r)?i.inputValue=new kt(r).toHex().toUpperCase():i.inputValue="",e.set("backgroundColor",r),e.requestRenderAll()},{immediate:!0}),(r,l)=>{const u=we,c=Ht,d=pt,p=os,h=ft;return g(),O(Qt,{title:"画布背景色","disable-add":!!m(i).backgroundColor,onClickAdd:l[2]||(l[2]=v=>m(i).backgroundColor="#F4F4F4")},{default:y(()=>[f(h,{gutter:[4,4],align:"center"},{default:y(()=>[f(d,{span:10},{default:y(()=>[f(c,{size:"mini",modelValue:m(i).inputValue,"onUpdate:modelValue":l[0]||(l[0]=v=>m(i).inputValue=v),onChange:o,class:"pl0!"},{prefix:y(()=>[f(u,{size:"mini",class:"icon-btn",onClick:a},{icon:y(()=>[N("div",{class:"w18px h18px rd-4px",style:He({background:m(i).backgroundColor,border:"1px solid #cccccc90"})},null,4)]),_:1})]),_:1},8,["modelValue"])]),_:1}),f(d,{span:3.5,class:"mlauto"},{default:y(()=>[f(u,{size:"small",class:"icon-btn",onClick:l[1]||(l[1]=v=>m(i).backgroundColor="")},{icon:y(()=>[f(p)]),_:1})]),_:1})]),_:1})]),_:1},8,["disable-add"])}}}),zc={},Nc={class:"key"};function Hc(n,e){return g(),T("div",Nc,[se(n.$slots,"default",{},void 0,!0)])}const Fc=le(zc,[["render",Hc],["__scopeId","data-v-778c73e1"]]),Vc=B({__name:"key",props:{keys:{}},setup(n){return(e,t)=>{const s=Nt;return g(),O(s,{size:"mini"},{default:y(()=>[(g(!0),T(he,null,ze(e.keys,(o,a)=>(g(),O(Fc,{key:a},{default:y(()=>[me(Be(o),1)]),_:2},1024))),128))]),_:1})}}}),Kc={class:"flex-shrink-0"},Wc=B({__name:"tipContentKey",props:{keys:{},content:{}},setup(n){return(e,t)=>{const s=Nt;return g(),O(s,null,{default:y(()=>[N("div",Kc,Be(e.content),1),e.keys?(g(),O(m(Vc),{key:0,keys:e.keys},null,8,["keys"])):Z("",!0)]),_:1})}}}),Hn=le(Wc,[["__scopeId","data-v-ef96d75d"]]),Uc=B({__name:"layoutAlign",setup(n){const e=[{name:"HorizontalLeft",icon:"bxs-objects-horizontal-left",tip:"左对齐",onClick:()=>s.trigger("alt+a"),key:["Alt","A"]},{name:"HorizontalCenter",icon:"bxs-objects-horizontal-center",tip:"水平居中对齐",onClick:()=>s.trigger("alt+h"),key:["Alt","H"]},{name:"HorizontalRight",icon:"bxs-objects-horizontal-right",tip:"右对齐",onClick:()=>s.trigger("alt+d"),key:["Alt","D"]},{name:"VerticalTop",icon:"bxs-objects-vertical-top",tip:"顶对齐",onClick:()=>s.trigger("alt+w"),key:["Alt","W"]},{name:"VerticalCenter",icon:"bxs-objects-vertical-center",tip:"垂直居中对齐",onClick:()=>s.trigger("alt+v"),key:["Alt","V"]},{name:"VerticalBottom",icon:"bxs-objects-vertical-bottom",tip:"底对齐",onClick:()=>s.trigger("alt+s"),key:["Alt","S"]}],{canvas:t,keybinding:s}=ye(),o=j(()=>!(t.activeObject.value instanceof at));return(a,i)=>{const r=we,l=lo,u=pt,c=ft;return g(),O(c,{wrap:!1,class:"p2",justify:"space-between",align:"center"},{default:y(()=>[(g(),T(he,null,ze(e,d=>f(u,{flex:"none",key:d.name},{default:y(()=>[f(l,{mini:"",position:"bottom",popupVisible:d.tip?void 0:!1},qt({default:y(()=>[f(r,{class:"button",size:"small",disabled:m(o),onClick:d.onClick},{icon:y(()=>[f(qe,{name:d.icon},null,8,["name"])]),_:2},1032,["disabled","onClick"])]),_:2},[d.tip?{name:"content",fn:y(()=>[f(Hn,{content:d.tip,keys:d.key},null,8,["content","keys"])]),key:"0"}:void 0]),1032,["popupVisible"])]),_:2},1024)),64))]),_:1})}}}),Gc=B({__name:"swipeNumber",props:{label:{},modelValue:{},modelEvent:{default:"change"},step:{default:1},max:{},min:{}},emits:["update:modelValue","change","swipe"],setup(n,{emit:e}){const t=n,s=Yi(),o=Xi(t,"modelValue",e);Fe(o,h=>{h&&(o.value=pe(h))},{immediate:!0});const a=(h,v)=>{e("change",h,v)},{shift:i,alt:r}=gn(),l=I(),u=I(),{posStart:c,posEnd:d}=Jt(l,{threshold:0,onSwipeStart:()=>{u.value=o.value},onSwipe:h=>{if(!V.isNumber(u.value))return;let v=t.step;i.value&&(v*=10),r.value&&(v/=10),v=Math.max(v,.01);let w=u.value+Math.round(d.x-c.x)*v;U(t.min)&&w<t.min&&(w=t.min),U(t.max)&&w>t.max&&(w=t.max),w=pe(w),o.value=w,e("swipe",w,h)},onSwipeEnd:h=>{e("change",o.value,h),u.value=void 0}}),p=j(()=>!!t.label||!!s.label);return(h,v)=>{const w=mn;return g(),O(w,{modelValue:m(o),"onUpdate:modelValue":v[0]||(v[0]=b=>rt(o)?o.value=b:null),modelEvent:h.modelEvent,step:h.step,max:h.max,min:h.min,"hide-button":m(p),class:ve({hasLabel:m(p)}),onChange:a},qt({_:2},[m(p)?{name:"prefix",fn:y(()=>[N("div",{ref_key:"labelRef",ref:l,class:"w26px text-center cursor-ew-resize"},[h.$slots.label?se(h.$slots,"label",{key:0},void 0,!0):(g(),T(he,{key:1},[me(Be(h.label),1)],64))],512)]),key:"0"}:void 0,ze(m(s),(b,S)=>({name:S,fn:y(()=>[se(h.$slots,S,{},void 0,!0)])}))]),1032,["modelValue","modelEvent","step","max","min","hide-button","class"])}}}),bt=le(Gc,[["__scopeId","data-v-5f5ef608"]]),Yc=n=>(io("data-v-0d66fab4"),n=n(),ao(),n),Xc={class:"p2"},qc=Yc(()=>N("div",{class:"absolute top-1 right-1"},"°",-1)),Jc=B({__name:"baseAttr",setup(n){const{keybinding:e,canvas:t,undoRedo:s}=ye(),o=be("left"),a=be("top"),i=be("angle"),r=be("width"),l=be("height"),u=be("rx"),c=be("ry");return(d,p)=>{const h=pt,v=we,w=lo,b=Nt,S=ft;return g(),T("div",Xc,[f(S,{gutter:[4,4],align:"center"},{default:y(()=>[f(h,{span:10},{default:y(()=>[f(m(bt),oe({size:"small",label:"X"},m(o)),null,16)]),_:1}),f(h,{span:10},{default:y(()=>[f(m(bt),oe({size:"small",label:"Y"},m(a)),null,16)]),_:1}),f(h,{span:10},{default:y(()=>[f(m(bt),oe({size:"small",min:.5,label:"W"},m(r)),null,16)]),_:1}),f(h,{span:10},{default:y(()=>[f(m(bt),oe({size:"small",min:.5,label:"H"},m(l)),null,16)]),_:1}),f(h,{span:10},{default:y(()=>[f(m(bt),oe({size:"small"},m(i)),{label:y(()=>[f(m(qe),{name:"bx-revision"})]),suffix:y(()=>[qc]),_:1},16)]),_:1}),f(h,{span:8},{default:y(()=>[f(b,{size:"mini"},{default:y(()=>[f(w,{mini:"",position:"bottom"},{content:y(()=>[f(Hn,{content:"水平翻转",keys:["Shift","H"]})]),default:y(()=>[f(v,{size:"small",disabled:!m(U)(m(t).activeObject),onClick:p[0]||(p[0]=C=>m(e).trigger("shift+h"))},{icon:y(()=>[f(m(qe),{name:"bx-reflect-vertical"})]),_:1},8,["disabled"])]),_:1}),f(w,{mini:"",position:"bottom"},{content:y(()=>[f(Hn,{content:"垂直翻转",keys:["Shift","V"]})]),default:y(()=>[f(v,{size:"small",disabled:!m(U)(m(t).activeObject),onClick:p[1]||(p[1]=C=>m(e).trigger("shift+v"))},{icon:y(()=>[f(m(qe),{name:"bx-reflect-horizontal"})]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),m(U)(m(t).activeObject)&&"rx"in m(t).activeObject.value.ref&&"ry"in m(t).activeObject.value.ref?(g(),O(h,{key:0,span:10},{default:y(()=>[f(m(bt),{size:"small",min:0,max:Math.min(m(t).activeObject.value.width,m(t).activeObject.value.height)/2,modelValue:m(u).modelValue,"onUpdate:modelValue":p[2]||(p[2]=C=>m(u).modelValue=C),onSwipe:p[3]||(p[3]=C=>{m(u).onSwipe(C),m(c).onSwipe(C)}),onChange:p[4]||(p[4]=C=>{m(u).onSwipe(C),m(c).onSwipe(C),m(s).saveState()})},{label:y(()=>[f(m(qe),{name:"round"})]),_:1},8,["max","modelValue"])]),_:1})):Z("",!0)]),_:1})])}}}),Zc=le(Jc,[["__scopeId","data-v-0d66fab4"]]),Fn=()=>{const n=`a${yn()}`;return{triggerProps:{contentClass:n},onPopupVisibleChange:t=>{t&&pn(()=>{const s=document.querySelector(`.${n} .arco-select-dropdown-list-wrapper`);s&&(s.style.maxHeight=`${window.innerHeight-s.getBoundingClientRect().top-8}px`)})}}},Qc=n=>{qi._context=n._context,Ji._context=n._context,Zi._context=n._context,hs._context=n._context},eu=B({__name:"layerAttr",setup(n){const e=be("opacity"),t=be("globalCompositeOperation"),s=be("visible"),o=ge([{value:"source-over",label:"正常"},{isGroup:!0,label:"暗色",options:[{value:"darken",label:"变暗"},{value:"multiply",label:"正片叠底"},{value:"color-burn",label:"颜色加深"}]},{isGroup:!0,label:"亮色",options:[{value:"lighten",label:"变亮"},{value:"screen",label:"滤色"},{value:"color-dodge",label:"颜色减淡"},{value:"lighter",label:"提亮"}]},{isGroup:!0,label:"对比",options:[{value:"overlay",label:"叠加"},{value:"soft-light",label:"柔光"},{value:"hard-light",label:"强光"}]},{isGroup:!0,label:"比较",options:[{value:"difference",label:"差集"},{value:"exclusion",label:"排除"}]},{isGroup:!0,label:"颜色",options:[{value:"hue",label:"色相"},{value:"saturation",label:"饱和度"},{value:"color",label:"颜色"},{value:"luminosity",label:"明度"}]}]);return(a,i)=>{const r=bn,l=pt,u=mn,c=so,d=oo,p=we,h=ft;return g(),O(Qt,{title:"图层","hidden-add":""},{default:y(()=>[f(h,{gutter:[4,4],align:"center"},{default:y(()=>[f(l,{span:10},{default:y(()=>[f(r,oe({size:"small"},{...m(t),...m(Fn)()},{options:m(o)}),null,16,["options"])]),_:1}),f(l,{span:7},{default:y(()=>[f(u,oe({size:"small"},m(e),{"hide-button":"",min:0,max:100}),{suffix:y(()=>[me("%")]),_:1},16)]),_:1}),f(l,{span:3.5,class:"mlauto"},{default:y(()=>[f(p,{size:"small",class:"icon-btn",onClick:i[0]||(i[0]=v=>m(s).onChange(!m(s).modelValue))},{icon:y(()=>[m(s).modelValue===!0?(g(),O(c,{key:0})):(g(),O(d,{key:1}))]),_:1})]),_:1})]),_:1})]),_:1})}}}),tu=B({__name:"textAttr",setup(n){const e=ge([{value:"arial",label:"Arial"},{value:"Times New Roman",label:"Times New Roman"},{value:"Microsoft Yahei",label:"微软雅黑"}]),t=ge([{value:"normal",label:"常规体"},{value:"lighter",label:"细体"},{value:"bold",label:"粗体"},{value:"italic",label:"斜体"}]),s=ge([8,9,10,11,12,14,16,18,21,24,36,48,60,72].map(u=>({value:u,label:u.toString()}))),o=be("fontFamily"),a=be("fontSize");be("lineHeight"),be("charSpacing"),be("textAlign");const i=I(),{canvas:r}=ye();Ge(()=>{const u=Ss(r.activeObject);U(u)&&(u.value.get("fontStyle")==="italic"?i.value=u.value.get("fontStyle"):["bold","lighter","normal"].includes(u.value.get("fontWeight"))&&(i.value=u.value.get("fontWeight")))});const l=u=>{const c=Ss(r.activeObject);U(c)&&(c.value.set("fontStyle","normal"),c.value.set("fontWeight","normal"),["bold","lighter","normal"].includes(u.toString())?c.value.set("fontWeight",u):u==="italic"&&c.value.set("fontStyle",u),r.requestRenderAll())};return(u,c)=>{const d=bn,p=pt,h=ft;return g(),O(Qt,{title:"文本","hidden-add":""},{default:y(()=>[f(h,{gutter:[4,4]},{default:y(()=>[f(p,null,{default:y(()=>[f(d,oe({size:"small",class:"mb1"},{...m(o),...m(Fn)()},{options:m(e)}),null,16,["options"])]),_:1}),f(p,{span:14},{default:y(()=>[f(d,{size:"small","model-value":m(i),options:m(t),onChange:l},null,8,["model-value","options"])]),_:1}),f(p,{span:10},{default:y(()=>[f(d,oe({...m(a),...m(Fn)()},{size:"small",options:m(s)}),null,16,["options"])]),_:1})]),_:1})]),_:1})}}}),nu=({x1:n,y1:e,x2:t,y2:s})=>Math.atan2(s-e,t-n)*180/Math.PI+90;function zo(n,e){const t=j(()=>{let l="";return V.isString(n.value)?l+=n.value:L.isPattern(n.value)?n.value.isImageSource()&&(l+=`url(${n.value.source.src}) center center / 14px no-repeat`):L.isGradient(n.value)&&(n.value.type==="linear"?l+=`linear-gradient(${nu(n.value.coords)}deg`:l+="radial-gradient(8px 8px at 8px 8px",l+=`,${n.value.colorStops.map(u=>`${u.color} ${u.offset*100}%`).join(",")})`),{class:"w18px h18px rd-4px",style:{border:"1px solid #cccccc90",background:l||"#fff"}}}),s=I(),o=I();Fe(n,l=>{if(V.isString(l)){const u=new kt(l);o.value=u.toHex().toUpperCase(),s.value=_e.times(u.getAlpha(),100);return}else if(L.isGradient(l)){o.value=l.type==="linear"?"线性渐变":"径向渐变",s.value=void 0;return}else if(L.isPattern(l)){o.value="图案填充",s.value=void 0;return}o.value="",s.value=void 0},{immediate:!0});let a;const i=()=>{a&&a()},r=()=>{a||Nn.close(),Ne.editor.service.invokeFunction(l=>{const u=l.get(Ie);U(u.activeObject)&&(a=Nn.open({object:u.activeObject.value,attr:e.attr,dialogOption:{onClose(){a=void 0}}}))})};return ns(()=>{i()}),{formatValue:o,colorBlock:t,opacity:s,openColorPicker:r,closeColorPicker:i,readonly:j(()=>!V.isString(n.value)),changeOpacity(l){if(!V.isString(n.value)||!U(l))return;const u=new kt(n.value).setAlpha(_e.divide(l,100));e.onChange(u.toRgba())},changeColor(l){l=l.replace(/^#/,""),l.length<6&&(l=Lo(l));const u=new kt(l).setAlpha(_e.divide(s.value||100,100));e.onChange(u.toRgba())}}}const su=B({__name:"fillAttr",setup(n){const{canvas:e}=ye(),t=be("fill"),{formatValue:s,colorBlock:o,changeColor:a,changeOpacity:i,opacity:r,closeColorPicker:l,openColorPicker:u,readonly:c}=zo(j(()=>t.value.modelValue),{attr:"fill",onChange(d){t.value.onChange(d)}});return Fe(e.activeObject,()=>l()),(d,p)=>{const h=we,v=Ht,w=pt,b=mn,S=os,C=ft;return g(),O(Qt,{title:"填充","disable-add":!!m(t).modelValue,onClickAdd:p[3]||(p[3]=z=>m(t).onChange("#cccccc"))},{default:y(()=>[f(C,{gutter:[4,4],align:"center"},{default:y(()=>[f(w,{span:10},{default:y(()=>[f(v,{size:"mini",modelValue:m(s),"onUpdate:modelValue":p[0]||(p[0]=z=>rt(s)?s.value=z:null),readonly:m(c),onChange:m(a),class:"pl0!"},{prefix:y(()=>[f(h,{size:"mini",class:"icon-btn",onClick:m(u)},{icon:y(()=>[N("div",Yt(ss(m(o))),null,16)]),_:1},8,["onClick"])]),_:1},8,["modelValue","readonly","onChange"])]),_:1}),m(V.isNumber)(m(r))?(g(),O(w,{key:0,span:7},{default:y(()=>[f(b,{size:"small",modelValue:m(r),"onUpdate:modelValue":p[1]||(p[1]=z=>rt(r)?r.value=z:null),"hide-button":"",min:0,max:100,onChange:m(i)},{suffix:y(()=>[me("%")]),_:1},8,["modelValue","onChange"])]),_:1})):Z("",!0),f(w,{span:3.5,class:"mlauto"},{default:y(()=>[f(h,{size:"small",class:"icon-btn",onClick:p[2]||(p[2]=z=>m(t).onChange(null))},{icon:y(()=>[f(S)]),_:1})]),_:1})]),_:1})]),_:1},8,["disable-add"])}}}),ou=B({__name:"strokeAttr",setup(n){const{canvas:e}=ye(),t=be("stroke"),s=be("strokeWidth"),o=be("paintFirst"),{formatValue:a,colorBlock:i,changeColor:r,closeColorPicker:l,openColorPicker:u,readonly:c}=zo(j(()=>t.value.modelValue),{attr:"stroke",onChange(p){t.value.onChange(p)}});Fe(e.activeObject,()=>l());const d=ge([{value:"fill",label:"内部"},{value:"stroke",label:"外部"}]);return(p,h)=>{const v=we,w=Ht,b=pt,S=os,C=bn,z=ft;return g(),O(Qt,{title:"边框","disable-add":!!m(s).modelValue,onClickAdd:h[2]||(h[2]=()=>{m(t).modelValue===null&&m(t).onChange("#979797"),m(s).onChange(1)})},{default:y(()=>[f(z,{gutter:[4,4],align:"center"},{default:y(()=>[f(b,{span:10},{default:y(()=>[f(w,{size:"mini",modelValue:m(a),"onUpdate:modelValue":h[0]||(h[0]=J=>rt(a)?a.value=J:null),readonly:m(c),onChange:m(r),class:"pl0!"},{prefix:y(()=>[f(v,{size:"mini",class:"icon-btn",onClick:m(u)},{icon:y(()=>[N("div",Yt(ss(m(i))),null,16)]),_:1},8,["onClick"])]),_:1},8,["modelValue","readonly","onChange"])]),_:1}),f(b,{span:10},{default:y(()=>[f(m(bt),oe({size:"small",min:1,label:"W"},m(s),{"hide-button":!1}),null,16)]),_:1}),f(b,{span:3.5,class:"mlauto"},{default:y(()=>[f(v,{size:"small",class:"icon-btn",onClick:h[1]||(h[1]=J=>m(s).onChange(0))},{icon:y(()=>[f(S)]),_:1})]),_:1}),f(b,{span:10},{default:y(()=>[f(C,oe({size:"small"},m(o),{options:m(d)}),null,16,["options"])]),_:1})]),_:1})]),_:1},8,["disable-add"])}}}),iu={class:"pb2"},au=B({__name:"rightPanel",setup(n){const{canvas:e}=ye(),t=j(()=>{const o=e.activeObject.value;return[{name:"LayoutAlign",component:Uc,visual:!0},{name:"BaseAttr",component:Zc,visual:!0},{name:"BackgroundColor",component:Bc,visual:!U(o)},{name:"LayerAttr",component:eu,visual:U(o)&&!L.isActiveSelection(o)},{name:"TextAttr",component:tu,visual:U(o)&&o.isType("IText","Textbox")},{name:"FillAttr",component:su,visual:U(o)&&(L.isBoard(o)||!L.isCollection(o))},{name:"StrokeAttr",component:ou,visual:U(o)&&!L.isCollection(o)}]}),s=Ne.editor.getPluginSlots("rightPanel");return(o,a)=>{const i=Xs,r=no;return g(),O(r,{style:{height:"100%",overflow:"auto"},"outer-style":{height:"100%"}},{default:y(()=>[N("div",iu,[(g(!0),T(he,null,ze(m(t),(l,u)=>(g(),T(he,{key:l.name},[l.visual?(g(),T(he,{key:0},[u!==0?(g(),O(i,{key:0,margin:0})):Z("",!0),(g(),O(Tt(l.component)))],64)):Z("",!0)],64))),128)),(g(!0),T(he,null,ze(m(s),(l,u)=>(g(),T(he,{key:u},[u!==l.length-1?(g(),O(i,{key:0,margin:0})):Z("",!0),(g(),O(Tt(l)))],64))),128))])]),_:1})}}}),ru=le(au,[["__scopeId","data-v-f4b2aeb5"]]);let No;const lu=n=>No=n,Ho=()=>No;class cu{constructor(e,t){_(this,"incoming",new Map);_(this,"outgoing",new Map);this.key=e,this.data=t}}class js{constructor(e){_(this,"_nodes",new Map);this._hashFn=e}roots(){const e=[];for(const t of this._nodes.values())t.outgoing.size===0&&e.push(t);return e}insertEdge(e,t){const s=this.lookupOrInsertNode(e),o=this.lookupOrInsertNode(t);s.outgoing.set(o.key,o),o.incoming.set(s.key,s)}removeNode(e){const t=this._hashFn(e);this._nodes.delete(t);for(const s of this._nodes.values())s.outgoing.delete(t),s.incoming.delete(t)}lookupOrInsertNode(e){const t=this._hashFn(e);let s=this._nodes.get(t);return s||(s=new cu(t,e),this._nodes.set(t,s)),s}lookup(e){return this._nodes.get(this._hashFn(e))}isEmpty(){return this._nodes.size===0}toString(){const e=[];for(const[t,s]of this._nodes)e.push(`${t}
	(-> incoming)[${[...s.incoming.keys()].join(", ")}]
	(outgoing ->)[${[...s.outgoing.keys()].join(",")}]
`);return e.join(`
`)}findCycleSlow(){for(const[e,t]of this._nodes){const s=new Set([e]),o=this._findCycle(t,s);if(o)return o}}_findCycle(e,t){for(const[s,o]of e.outgoing){if(t.has(s))return[...t,s].join(" -> ");t.add(s);const a=this._findCycle(o,t);if(a)return a;t.delete(s)}}}class ps{constructor(...e){_(this,"_entries",new Map);for(const[t,s]of e)this.set(t,s)}set(e,t){const s=this._entries.get(e);return this._entries.set(e,t),s}has(e){return this._entries.has(e)}get(e){return this._entries.get(e)}}const uu=!1;class Ls extends Error{constructor(e){var t;super("cyclic dependency between services"),this.message=(t=e.findCycleSlow())!=null?t:`UNABLE to detect cycle, dumping graph: 
${e.toString()}`}}class dn{constructor(e=new ps,t=!1,s,o=uu){_(this,"_globalGraph");_(this,"_globalGraphImplicitDependency");_(this,"_activeInstantiations",new Set);var a;this._services=e,this._strict=t,this._parent=s,this._enableTracing=o,this._services.set(po,this),this._globalGraph=o?(a=s==null?void 0:s._globalGraph)!=null?a:new js(i=>i):void 0}createChild(e){return new dn(e,this._strict,this,this._enableTracing)}invokeFunction(e,...t){const s=Xe.traceInvocation(this._enableTracing,e);let o=!1;try{return e({get:i=>{if(o)throw new Error("service accessor is only valid during the invocation of its target method");const r=this._getOrCreateServiceInstance(i,s);if(!r)throw new Error(`[invokeFunction] unknown service '${i}'`);return r}},...t)}finally{o=!0,s.stop()}}createInstance(e,...t){let s,o;return e instanceof st?(s=Xe.traceCreation(this._enableTracing,e.ctor),o=this._createInstance(e.ctor,e.staticArguments.concat(t),s)):(s=Xe.traceCreation(this._enableTracing,e),o=this._createInstance(e,t,s)),s.stop(),o}_createInstance(e,t=[],s){const o=it.getServiceDependencies(e).sort((r,l)=>r.index-l.index),a=[];for(const r of o){const l=this._getOrCreateServiceInstance(r.id,s);l||this._throwIfStrict(`[createInstance] ${e.name} depends on UNKNOWN service ${r.id}.`,!1),a.push(l)}const i=o.length>0?o[0].index:t.length;if(t.length!==i){console.trace(`[createInstance] First service dependency of ${e.name} at position ${i+1} conflicts with ${t.length} static arguments`);const r=i-t.length;r>0?t=t.concat(new Array(r)):t=t.slice(0,i)}return Reflect.construct(e,t.concat(a))}_setServiceInstance(e,t){if(this._services.get(e)instanceof st)this._services.set(e,t);else if(this._parent)this._parent._setServiceInstance(e,t);else throw new Error("illegalState - setting UNKNOWN service instance")}_getServiceInstanceOrDescriptor(e){const t=this._services.get(e);return!t&&this._parent?this._parent._getServiceInstanceOrDescriptor(e):t}_getOrCreateServiceInstance(e,t){this._globalGraph&&this._globalGraphImplicitDependency&&this._globalGraph.insertEdge(this._globalGraphImplicitDependency,String(e));const s=this._getServiceInstanceOrDescriptor(e);return s instanceof st?this._safeCreateAndCacheServiceInstance(e,s,t.branch(e,!0)):(t.branch(e,!1),s)}_safeCreateAndCacheServiceInstance(e,t,s){if(this._activeInstantiations.has(e))throw new Error(`illegal state - RECURSIVELY instantiating service '${e}'`);this._activeInstantiations.add(e);try{return this._createAndCacheServiceInstance(e,t,s)}finally{this._activeInstantiations.delete(e)}}_createAndCacheServiceInstance(e,t,s){var r;const o=new js(l=>l.id.toString());let a=0;const i=[{id:e,desc:t,_trace:s}];for(;i.length;){const l=i.pop();if(o.lookupOrInsertNode(l),a++>1e3)throw new Ls(o);for(const u of it.getServiceDependencies(l.desc.ctor)){const c=this._getServiceInstanceOrDescriptor(u.id);if(c||this._throwIfStrict(`[createInstance] ${e} depends on ${u.id} which is NOT registered.`,!0),(r=this._globalGraph)==null||r.insertEdge(String(l.id),String(u.id)),c instanceof st){const d={id:u.id,desc:c,_trace:l._trace.branch(u.id,!0)};o.insertEdge(l,d),i.push(d)}}}for(;;){const l=o.roots();if(l.length===0){if(!o.isEmpty())throw new Ls(o);break}for(const{data:u}of l){if(this._getServiceInstanceOrDescriptor(u.id)instanceof st){const d=this._createServiceInstanceWithOwner(u.id,u.desc.ctor,u.desc.staticArguments,u.desc.supportsDelayedInstantiation,u._trace);this._setServiceInstance(u.id,d)}o.removeNode(u)}}return this._getServiceInstanceOrDescriptor(e)}_createServiceInstanceWithOwner(e,t,s=[],o,a){if(this._services.get(e)instanceof st)return this._createServiceInstance(e,t,s,o,a);if(this._parent)return this._parent._createServiceInstanceWithOwner(e,t,s,o,a);throw new Error(`illegalState - creating UNKNOWN service instance ${t.name}`)}_createServiceInstance(e,t,s=[],o,a){if(o){const i=new dn(void 0,this._strict,this,this._enableTracing);i._globalGraphImplicitDependency=String(e);const r=new Map,l=new Ha(()=>{const u=i._createInstance(t,s,a);for(const[c,d]of r){const p=u[c];if(typeof p=="function")for(const h of d)p.apply(u,h)}return r.clear(),u});return new Proxy(Object.create(null),{get(u,c){if(!l.isInitialized&&typeof c=="string"&&(c.startsWith("onDid")||c.startsWith("onWill"))){let h=r.get(c);return h||(h=new Xt,r.set(c,h)),(w,b,S)=>{const C=h.push([w,b,S]);return is(C)}}if(c in u)return u[c];const d=l.value;let p=d[c];return typeof p!="function"||(p=p.bind(d),u[c]=p),p},set(u,c,d){return l.value[c]=d,!0},getPrototypeOf(u){return t.prototype}})}else return this._createInstance(t,s,a)}_throwIfStrict(e,t){if(t&&console.warn(e),this._strict)throw new Error(e)}}const Ke=class{constructor(e,t){_(this,"_start",Date.now());_(this,"_dep",[]);this.type=e,this.name=t}static traceInvocation(e,t){return e?new Ke(2,t.name||new Error().stack.split(`
`).slice(3,4).join(`
`)):Ke._None}static traceCreation(e,t){return e?new Ke(1,t.name):Ke._None}branch(e,t){const s=new Ke(3,e.toString());return this._dep.push([e,t,s]),s}stop(){const e=Date.now()-this._start;Ke._totals+=e;let t=!1;function s(a,i){const r=[],l=new Array(a+1).join("	");for(const[u,c,d]of i._dep)if(c&&d){t=!0,r.push(`${l}CREATES -> ${u}`);const p=s(a+1,d);p&&r.push(p)}else r.push(`${l}uses -> ${u}`);return r.join(`
`)}const o=[`${this.type===1?"CREATE":"CALL"} ${this.name}`,`${s(1,this)}`,`DONE, took ${e.toFixed(2)}ms (grand total ${Ke._totals.toFixed(2)}ms)`];(e>2||t)&&Ke.all.add(o.join(`
`))}};let Xe=Ke;_(Xe,"all",new Set),_(Xe,"_None",new class extends Ke{constructor(){super(0,null)}stop(){}branch(){return this}}),_(Xe,"_totals",0);const du=()=>{const n=new ps;for(const[e,t]of Ta())n.set(e,t);return new dn(n,!0)},hu=()=>{const n=du(),e=Qi({install(t){this._a=t,lu(e)},use(t){var s;return this._p.push(t),(s=Ne.editor)==null||s.use(t),this},service:n,_p:[],_a:null});return e},pu=n=>n;function an(n={}){const{onSwipe:e,onSwipeEnd:t,onSwipeStart:s}=n,o=ge({x:0,y:0}),a=ge({x:0,y:0}),i=I(!1),r=I(!1),l=j(()=>a.x-o.x),u=j(()=>a.y-o.y),c=b=>{o.x=b.x,o.y=b.y},d=b=>{a.x=b.x,a.y=b.y},w=Eo({"mouse:down":b=>{b.e instanceof TouchEvent&&b.e.touches.length!==1||(r.value=!0,c(b.absolutePointer),d(b.absolutePointer),s==null||s(b))},"mouse:move":b=>{r.value&&(b.e instanceof TouchEvent&&b.e.touches.length!==1||(d(b.absolutePointer),i.value=!0,e==null||e(b)))},"mouse:up":b=>{i.value&&(t==null||t(b)),r.value=!1,i.value=!1}});return ns(w),{isSwiping:i,coordsStart:o,coordsEnd:a,lengthX:l,lengthY:u,stop:w}}var fu=Object.defineProperty,vu=Object.getOwnPropertyDescriptor,gu=(n,e,t,s)=>{for(var o=s>1?void 0:s?vu(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(o=(s?i(e,t,o):i(o))||o);return s&&o&&fu(e,t,o),o},$n=(n,e)=>(t,s)=>e(t,s,n);let Vn=class extends Ve{constructor(e,t,s){super();_(this,"space",gn().space);_(this,"options",{move:{defaultCursor:"default",skipTargetFind:!1,selection:!0},handMove:{defaultCursor:"grab",skipTargetFind:!0,selection:!1},shape:{defaultCursor:"crosshair",skipTargetFind:!0,selection:!1}});_(this,"toolStop");_(this,"_handMoveActivate",!1);this.canvas=e,this.keybinding=t,this.eventbus=s,ot().activeTool="move",this.initWatch(),this.initHandMove(),this.initKeybinding()}applyOption(e){var a;e=e!=null?e:_t(ot()).activeTool.value;const{defaultCursor:t,skipTargetFind:s,selection:o}=(a=this.options[e])!=null?a:this.options.shape;this.canvas.defaultCursor=t,this.canvas.setCursor(t),this.canvas.skipTargetFind=s,this.canvas.selection=o}initWatch(){const{activeTool:e}=_t(ot());Fe(e,(t,s)=>{this.toolStop&&(this.toolStop(),this.toolStop=void 0),s==="handMove"&&(this.handMoveActivate=!1),this.applyOption(),t==="handMove"?this.handMoveActivate=!0:["board","rect","ellipse","triangle","text"].includes(t)?this.switchShape(t):t==="vector"&&this.switchVector()})}switchShape(e){const{canvas:t}=this;let s,o;const{stop:a,isSwiping:i}=an({onSwipeStart:r=>{if(r.button!==1||this.space.value)return;switch(i.value=!0,s=r.pointer,e){case"board":o=new Ce([],{fill:""});break;case"rect":o=new Ue({});break;case"ellipse":o=new Tn({rx:50,ry:50});break;case"triangle":o=new es({});break;case"text":o=new xt("",{});break}o.set({left:s.x,top:s.y,width:100,height:100,scaleX:.01,scaleY:.01,hideOnLayer:!0}),o.noEventObjectAdded=!0,(this.canvas._searchPossibleTargets(this.canvas.getObjects("Board"),r.absolutePointer)||t).add(o),o.noEventObjectAdded=!1,t.setActiveObject(o),o.__corner="br",t._setupCurrentTransform(r.e,o,!0)},onSwipeEnd:r=>{o&&(o.scaleX<=.01&&o.scaleY<=.01&&o.set({left:o.left-50,top:o.top-50,scaleX:1,scaleY:1}),o.set({width:o.getScaledWidth(),height:o.getScaledHeight(),scaleX:1,scaleY:1,hideOnLayer:!1}),o instanceof Ce?o.set({fill:"#ffffff"}):o instanceof Tn?o.set({rx:o.width/2,ry:o.height/2}):o instanceof xt&&(o.set({text:"输入文本"}),t.defaultCursor="default",o.enterEditing(r.e),o.selectAll()),o.group||t._onObjectAdded(o),t.fire("selection:updated"),t.requestRenderAll(),o=void 0,ot().activeTool="move")}});this.toolStop=a}switchVector(){const e=new Ks([],{fill:"",stroke:"#979797",strokeWidth:1,padding:2});let t=!1,s,o,a=!1;const{stop:i,lengthX:r,lengthY:l}=an({onSwipeStart:u=>{if(o=u.button,o!==1)return;const{pointer:c}=u;if(!t){t=!0,e.path.push(["M",c.x,c.y]),e.setBoundingBox(!0),this.canvas.add(e),e.setCoords();return}const d=e.path[e.path.length-1];if(a&&d[0]==="C"){const p=Pc(new ke(d[5],d[6]),new ke(d[1],d[2]));s=["C",p.x,p.y,c.x,c.y,c.x,c.y]}else s=["L",c.x,c.y];e.path.push(s),e.setBoundingBox(!0),e.setCoords(),e._set("dirty",!0),this.canvas.requestRenderAll(),a=!1},onSwipe:()=>{o!==1||!s||s[0]==="M"||(e.path.pop(),s[0]==="L"?e.path.push(["C",s[1]-r.value,s[2]-l.value,s[1],s[2],s[1],s[2]]):e.path.push(["C",s[1]-r.value,s[2]-l.value,s[3]-r.value,s[4]-l.value,s[5],s[6]]),e.setBoundingBox(!0),e._set("dirty",!0),this.canvas.requestRenderAll(),a=!0)},onSwipeEnd:()=>{s=void 0,o=void 0}});this.toolStop=()=>{e.setCoords(),i()}}get handMoveActivate(){return this._handMoveActivate}set handMoveActivate(e){this._handMoveActivate=e,this.eventbus.emit("setEdgeMoveStatus",!e)}initHandMove(){const e=this.canvas,{activeTool:t}=_t(ot());let s=!1,o=e.viewportTransform;const{lengthX:a,lengthY:i,isSwiping:r}=an({onSwipeStart:c=>{(c.button===2||this.space.value&&c.button===1||t.value==="handMove")&&(r.value=!0,o=e.viewportTransform,this.handMoveActivate=!0,this.applyOption("handMove"),e.setCursor("grabbing"))},onSwipe:()=>{this.handMoveActivate&&(e.setCursor("grabbing"),requestAnimationFrame(()=>{const c=new ke(a.value,i.value).scalarDivide(e.getZoom()).transform(o).scalarMultiply(-1);e.absolutePan(c,!0),s=!0}))},onSwipeEnd:()=>{this.handMoveActivate&&(this.space.value?this.applyOption("handMove"):this.applyOption(),t.value!=="handMove"&&!this.space.value&&(this.handMoveActivate=!1),s&&(e.setViewportTransform(e.viewportTransform),s=!1))}}),l=ea(),u=j(()=>{var c,d;return((c=l.value)==null?void 0:c.tagName)!=="INPUT"&&((d=l.value)==null?void 0:d.tagName)!=="TEXTAREA"});Fe(j(()=>[this.space.value,u.value].every(c=>ta(c))),c=>{r.value||(this.handMoveActivate=c,c?this.applyOption("handMove"):this.applyOption())})}initKeybinding(){const{activeTool:e}=_t(ot());this.keybinding.bind({v:()=>e.value="move",h:()=>e.value="handMove",r:()=>e.value="rect",o:()=>e.value="ellipse",t:()=>e.value="text",esc:()=>{e.value!=="move"?e.value="move":(this.canvas.discardActiveObject(),this.canvas.requestRenderAll())}})}};Vn=gu([$n(0,Ie),$n(1,Ye),$n(2,Ze)],Vn);class mu{constructor(e,t,s,o){_(this,"_handler");_(this,"_node");_(this,"_type");_(this,"_options");this._node=e,this._type=t,this._handler=s,this._options=o||!1,this._node.addEventListener(this._type,this._handler,this._options)}dispose(){this._handler&&(this._node.removeEventListener(this._type,this._handler,this._options),this._node=null,this._handler=null)}}function bu(n,e,t,s){return new mu(n,e,t,s)}var yu=Object.defineProperty,_u=Object.getOwnPropertyDescriptor,wu=(n,e,t,s)=>{for(var o=s>1?void 0:s?_u(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(o=(s?i(e,t,o):i(o))||o);return s&&o&&yu(e,t,o),o},ku=(n,e)=>(t,s)=>e(t,s,n);let Kn=class extends Ve{constructor(e){super();_(this,"canvasEvents");_(this,"lineWidth",2);_(this,"hoveredTarget");this.canvas=e,this.canvasEvents={"mouse:out":this.drawBorder.bind(this),"mouse:over":this.clearBorder.bind(this)},e.on(this.canvasEvents),this._register(bu(this.canvas.upperCanvasEl,"mouseout",()=>{this.canvas.contextTopDirty&&this.hoveredTarget&&(this.clearContextTop(this.hoveredTarget.group||this.hoveredTarget),this.hoveredTarget=void 0)}))}clearContextTop(e,t=!1){const s=this.canvas.contextTop;s.save(),s.transform(...this.canvas.viewportTransform),e.transform(s);const{strokeWidth:o,scaleX:a,scaleY:i,strokeUniform:r}=e,l=this.canvas.getZoom(),u=e.width+4/l+(r?o/a:o),c=e.height+4/l+(r?o/i:o);return s.clearRect(-u/2,-c/2,u,c),t||s.restore(),s}clearBorder(e){const t=e.target;this.hoveredTarget=void 0,!(!t||t===this.canvas._activeObject)&&this.canvas.contextTopDirty&&this.clearContextTop(t)}drawBorder(e){const t=e.target;if(!t||L.isBoard(t)||t===this.canvas._activeObject)return;this.hoveredTarget=t;const s=this.clearContextTop(t,!0);if(!s)return;const o=V.clone(t);if(o instanceof xt){o.underline=!0,o.fill="rgb(60,126,255)",o._renderTextDecoration(s,"underline"),o._drawClipPath(s,o.clipPath),s.restore(),this.canvas.contextTopDirty=!0;return}L.isCollection(o)&&(o._render=Ue.prototype._render);const{strokeWidth:a,strokeUniform:i}=o;let{width:r,height:l}=o;r+=i?a/o.scaleX:a,l+=i?a/o.scaleY:a;const u=o.getTotalObjectScaling(),c=Math.min(this.lineWidth,r*u.x,l*u.y);r-=c/u.x,l-=c/u.y,o.set({width:r,height:l,stroke:"rgb(60,126,255)",strokeWidth:c,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4}),o._renderPaintInOrder=()=>{s.save();const d=o.getTotalObjectScaling();s.scale(1/d.x,1/d.y),o._setLineDash(s,o.strokeDashArray),o._setStrokeStyles(s,o),s.stroke(),s.restore()},o._render(s),s.restore(),this.canvas.contextTopDirty=!0}dispose(){super.dispose(),this.canvas.off(this.canvasEvents)}};Kn=wu([ku(0,Ie)],Kn);var Su=Object.defineProperty,xu=Object.getOwnPropertyDescriptor,Cu=(n,e,t,s)=>{for(var o=s>1?void 0:s?xu(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(o=(s?i(e,t,o):i(o))||o);return s&&o&&Su(e,t,o),o},Bs=(n,e)=>(t,s)=>e(t,s,n);let Wn=class extends Ve{constructor(e,t){super();_(this,"edgeMoveStatus",!0);_(this,"setCoords",V.debounce(()=>{const{renderOnAddRemove:e}=this.canvas;this.canvas.renderOnAddRemove=!1,this.canvas.setViewportTransform(this.canvas.viewportTransform),this.canvas.renderOnAddRemove=e},150));this.canvas=e,this.eventbus=t,this.initWhellScroll(),this.initEdgeMove()}initWhellScroll(){const{ctrl:e,cmd:t,shift:s}=gn(),o=a=>{a.e.preventDefault(),a.e.stopPropagation();const{deltaX:i,deltaY:r,offsetX:l,offsetY:u}=a.e;if(e.value||t.value){const d=Math.abs(r)<10?r*2:r/3;let h=this.canvas.getZoom()*(1-d/200);h>.97&&h<1.03&&(h=1),this.canvas.zoomToPoint(new ke(l,u),h,!0),this.setCoords();return}const c=new ke;s.value?c.x=i>0?-20:20:c.y=r>0?-20:20,this.canvas.relativePan(c,!0),this.setCoords()};this.canvas.on("mouse:wheel",o),this._register(is(()=>{this.canvas.off("mouse:wheel",o)}))}initEdgeMove(){let e,t=!1;const{pause:s,resume:o}=na(()=>{if(!e)return;const i=new ke(24,24),r=new ke(this.canvas.width,this.canvas.height).subtract(i),[l,u]=this.judgePosition(e.absolutePointer,i,r);if(l===0)return;let c=new ke;const d=Math.min(u,20);l&1&&(c.x=d),l&2&&(c.x=-d),l&4&&(c.y=d),l&8&&(c.y=-d),c.x!==0&&c.y!==0&&(c=c.scalarDivide(1.5)),this.canvas.relativePan(c,!0),this.canvas._onMouseMove(e.e),t=!0},16,{immediate:!1}),{isSwiping:a}=an({onSwipeStart:()=>{this.edgeMoveStatus&&(a.value=!0,o())},onSwipe:i=>{this.edgeMoveStatus&&(e=i)},onSwipeEnd:()=>{s(),e=void 0,t&&(this.setCoords(),t=!1)}});this.eventbus.on("setEdgeMoveStatus",i=>{this.edgeMoveStatus=i})}judgePosition(e,t,s){let o=0,a=0;return e.x<t.x?(o|=1,a+=t.x-e.x):e.x>s.x&&(o|=2,a+=e.x-s.x),e.y<t.y?(o|=4,a+=t.y-e.y):e.y>s.y&&(o|=8,a+=e.y-s.y),[o,a]}};Wn=Cu([Bs(0,Ie),Bs(1,Ze)],Wn);const Fo=vt("clipboardService");class Mu{constructor(){_(this,"memoryBlob")}async readMemoryBlob(){return this.memoryBlob}async writeMemoryBlob(e){this.memoryBlob=e}async writeBlob(e){try{return this.writeMemoryBlob([e]),await navigator.clipboard.write([new ClipboardItem({[e.type]:e})])}catch(t){console.error(t)}}async readBlob(){try{const e=await navigator.clipboard.read(),t=[];for(const s of e)for(const o of s.types)t.push(await s.getType(o));return t}catch(e){return console.error(e),await this.readMemoryBlob()}}async writeText(e){try{return await navigator.clipboard.writeText(e)}catch(a){console.error(a)}const t=document.activeElement,s=document.createElement("textarea");s.setAttribute("aria-hidden","true");const o=document.body.appendChild(s);o.style.height="1px",o.style.width="1px",o.style.position="absolute",o.value=e,o.focus(),o.select(),document.execCommand("copy"),t instanceof HTMLElement&&t.focus(),document.body.removeChild(o)}async readText(){try{return await navigator.clipboard.readText()}catch(e){return console.error(e),""}}}_n(Fo,Mu,Zt.Eager);const Vo=async n=>{if(n instanceof Blob){const e=new Image;return new Promise((t,s)=>{e.onload=()=>{const o=document.createElement("canvas"),a=o.getContext("2d");if(!a){s();return}o.width=e.width,o.height=e.height,a.drawImage(e,0,0,o.width,o.height),t(a)},e.onerror=()=>{s()},e.src=URL.createObjectURL(n)})}else{if(n instanceof CanvasRenderingContext2D)return n;if(n instanceof HTMLCanvasElement)return n.getContext("2d")}throw Error("toContext: bad img type")},Ou=n=>{if(n instanceof Uint8Array||n instanceof Uint8ClampedArray)return n;if(V.isNumber(n)||V.isString(n))return V.isNumber(n)&&(n=String.fromCharCode(n)),new TextEncoder().encode(n);throw Error("toUint8Array: bad msg type")},Au=n=>[n>>je[0].shift,n>>je[1].shift&je[1].msgMask,n&je[2].msgMask],je=[{shift:5,msgMask:7,dataMask:248},{shift:3,msgMask:3,dataMask:252},{shift:0,msgMask:7,dataMask:248}],Pu=(n,e,t)=>{const s=e*t;if(s<n.length)throw Error(`encode: image size < msg.length: ${s} ${n.length}`)},Iu=n=>{for(let e=3;e<n.length;e=e+4)if(n[e]===254)return(e-3)/4;throw Error(`decode: no message terminator in image data, length = ${n.length}`)};async function $u(n,e){try{const t=await Vo(n);if(!t)return;const{width:s,height:o}=t.canvas;Pu(e,s,o);const a=Ou(e),i=t.getImageData(0,0,s,o),r=i.data;let l;return a.forEach((u,c)=>{const[d,p,h]=Au(u);l=c*4,r[l]=(r[l++]&je[0].dataMask)+d,r[l]=(r[l++]&je[1].dataMask)+p,r[l]=(r[l++]&je[2].dataMask)+h,r[l]=255}),l&&(r[l+4]=254),t.putImageData(i,0,0),t}catch(t){return}}async function Tu(n,e){try{const t=await Vo(n);if(!t)return;const{width:s,height:o}=t.canvas,a=t.getImageData(0,0,s,o).data,i=Iu(a),r=new Uint8Array(i);return r.forEach((l,u)=>{let c=u*4;const d=(je[0].msgMask&a[c++])<<je[0].shift,p=(je[1].msgMask&a[c++])<<je[1].shift,h=(je[2].msgMask&a[c++])<<je[2].shift;r[u]=d+p+h}),e?r:new TextDecoder().decode(r)}catch(t){return}}var Eu=Object.defineProperty,Ru=Object.getOwnPropertyDescriptor,Du=(n,e,t,s)=>{for(var o=s>1?void 0:s?Ru(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(o=(s?i(e,t,o):i(o))||o);return s&&o&&Eu(e,t,o),o},sn=(n,e)=>(t,s)=>e(t,s,n);let Un=class extends Ve{constructor(e,t,s,o){super();_(this,"canvasEvents");_(this,"pointer",new ke);this.canvas=e,this.keybinding=t,this.clipboard=s,this.undoRedo=o,t.bind({"mod+x":this.clip.bind(this),"mod+c":this.copy.bind(this),"mod+v":this.paste.bind(this,!1),"mod+shift+v":this.paste.bind(this,!0)}),this.canvasEvents={"mouse:move":this.updatePointer.bind(this)},e.on(this.canvasEvents)}updatePointer(e){this.pointer=e.pointer}async copy(){const e=this.canvas.getActiveObject();if(!e)return;const t=V.clone(e),s=t.toCanvasElement(),o=t.getParent(!0);o&&(o==null||o.exitGroup(t));const a=JSON.stringify(t.toObject()),i=await $u(s,a);if(!i)return;const r=this.dataURLtoBlob(i.canvas.toDataURL());r&&this.clipboard.writeBlob(r)}async readText(e){const t=await e.text();if(!t)return;const s=this.canvas.getVpCenter(),o=new xt(t,{width:550});o.width=V.clamp(o.calcTextWidth(),50,500),o.height=o.calcTextHeight(),o.left=s.x-o.width/2,o.top=s.y-o.height/2,this.canvas.add(o)}async readImage(e){const t=this.canvas.getVpCenter();L.loadImage(URL.createObjectURL(e)).then(s=>{this.canvas.add(new Ue({width:s.width,height:s.height,left:t.x-s.width/2,top:t.y-s.height/2,fill:new Ot({source:s})}))})}paste(e=!1){this.clipboard.readBlob().then(t=>{t&&t.forEach(async s=>{if(s.type==="text/plain"){this.readText(s);return}const o=await Tu(s);let a;if(o)try{a=JSON.parse(o)}catch(u){}if(!a){["image/png","image/jpeg"].includes(s.type)&&this.readImage(s);return}let i=!0;const r=u=>{u.forEach(c=>{i&&(c.set("canvas",this.canvas),c.isOnScreen()&&(i=!1),c.set("canvas",void 0)),c.id=yn(),L.isCollection(c)&&r(c._objects)})},l=u=>{const c=this.canvas.getActiveObject();(L.isCollection(c)&&!(c instanceof at)?c:this.canvas).add(...u)};L.enlivenObjects([a],{reviver:(u,c)=>{L.isCollection(c)&&r(c._objects),r([c])}}).then(u=>{const c=u.flatMap(d=>{var p;if(e){const{x:h,y:v}=((p=Ne.editor.contextMenu)==null?void 0:p.pointer)||this.pointer;d.left=h,d.top=v}else if(i){const{x:h,y:v}=d.translateToOriginPoint(this.canvas.getVpCenter(),"left","top");d.left=h,d.top=v}return d instanceof at?d.removeAll().reverse():[d]});e&&(Ne.editor.contextMenu.pointer=void 0),l(c),this.canvas.setActiveObjects(c),this.canvas.requestRenderAll(),this.undoRedo.saveState()})})})}clip(){this.copy(),this.keybinding.trigger("del")}dataURLtoBlob(e){const t=e.split(",");if(!t||t.length<1)return;const s=t[0].match(/:(.*?);/);if(!s||s.length<2)return;const o=s[1],a=window.atob(t[1]);let i=a.length;const r=new Uint8Array(i);for(;i--;)r[i]=a.charCodeAt(i);return new Blob([r],{type:o})}dispose(){super.dispose(),this.keybinding.unbind(["mod+x","mod+c","mod+v","mod+shift+v"]),this.canvas.off(this.canvasEvents)}};Un=Du([sn(0,Ie),sn(1,Ye),sn(2,Fo),sn(3,Mt)],Un);var ju=Object.defineProperty,Lu=Object.getOwnPropertyDescriptor,Bu=(n,e,t,s)=>{for(var o=s>1?void 0:s?Lu(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(o=(s?i(e,t,o):i(o))||o);return s&&o&&ju(e,t,o),o},on=(n,e)=>(t,s)=>e(t,s,n);let Gn=class extends Ve{constructor(n,e,t,s){super(),this.canvas=n,this.keybinding=e,this.eventbus=t,this.undoRedo=s,this.keybinding.bind(["del","backspace"],()=>{const a=n.getActiveObjects();if(a.length!==0)return this.deleteLayer(a),n.discardActiveObject(),n.requestRenderAll(),this.undoRedo.saveState(),!1}),this.keybinding.bind("[",()=>{if(n.getActiveObject())return this.objForEach(i=>{i.getParent().sendObjectToBack(i)},!0),n.requestRenderAll(),this.undoRedo.saveState(),!1}),this.keybinding.bind("]",()=>{if(n.getActiveObjects())return this.objForEach(i=>{i.getParent().bringObjectToFront(i)}),n.requestRenderAll(),this.undoRedo.saveState(),!1}),this.keybinding.bind("mod+[",()=>{const a=n.getActiveObject();if(!a)return;const i=L.isActiveSelection(a);return this.objForEach(r=>{const l=r.getParent();i&&l._objects.indexOf(r)===a._objects.indexOf(r)||l.sendObjectBackwards(r)}),n.requestRenderAll(),this.undoRedo.saveState(),!1}),this.keybinding.bind("mod+]",()=>{const a=n.getActiveObject();if(!a)return;const i=L.isActiveSelection(a);return this.objForEach(r=>{const l=r.getParent();i&&l._objects.indexOf(r)+a._objects.length===a._objects.indexOf(r)+l._objects.length||l.bringObjectForward(r)},!0),n.requestRenderAll(),this.undoRedo.saveState(),!1}),this.keybinding.bind(Lt.group,()=>{const a=n.getActiveObjects();if(a.length===0)return;const i=a[0].getParent(),r=i._objects.indexOf(a[0]);n.discardActiveObject();const l=new et(this.deleteLayer(a.filter((u,c,d)=>{if(u instanceof Ce)return!1;const p=u.getParent(!0);return!p||!d.includes(p)}).reverse()));return i.insertAt(r,l),n.setActiveObject(l),this.undoRedo.saveState(),!1}),this.keybinding.bind(Lt.ungroup,()=>{const a=n.getActiveObject();if(!a||!L.isCollection(a))return;const i=a.getParent(),r=i._objects.indexOf(a),l=a.removeAll();return i.insertAt(r,...l),n.setActiveObjects(l.reverse()),this.undoRedo.saveState(),!1}),this.keybinding.bind("mod+a",()=>{const a=n.getActiveObject(),i=(a==null?void 0:a.getParent())||n;return n.setActiveObjects(i.getObjects().reverse()),n.requestRenderAll(),!1}),this.keybinding.bind("mod+shift+h",()=>(this.objForEach(a=>{var i;a.visible=!a.visible,(i=a.getParent(!0))==null||i.setDirty()}),n.requestRenderAll(),this.undoRedo.saveState(),!1)),this.keybinding.bind("mod+shift+l",()=>(this.objForEach(a=>{a.evented=!a.evented,a.hasControls=a.evented,a.selectable=a.evented}),n.requestRenderAll(),this.undoRedo.saveState(),!1));const o=a=>{const i=n.getActiveObject();if(i)return i.set("opacity",a),n.requestRenderAll(),this.undoRedo.saveState(),!1};this.keybinding.bind({0:o.bind(this,1),1:o.bind(this,.1),2:o.bind(this,.2),3:o.bind(this,.3),4:o.bind(this,.4),5:o.bind(this,.5),6:o.bind(this,.6),7:o.bind(this,.7),8:o.bind(this,.8),9:o.bind(this,.9)}),this.keybinding.bind("mod+r",()=>{const a=n.getActiveObject();if(a)return t.emit("layerRename",{id:a.id}),!1}),this.keybinding.bind("shift+h",()=>{const a=n.getActiveObjects();if(a.length!==0)return a.forEach(i=>{i.flipX=!i.flipX}),n.requestRenderAll(),this.undoRedo.saveState(),!1}),this.keybinding.bind("shift+v",()=>{const a=n.getActiveObjects();if(a.length!==0)return a.forEach(i=>{i.flipY=!i.flipY}),n.requestRenderAll(),this.undoRedo.saveState(),!1}),this.bindAlign(),this.bindArrow()}bindArrow(){const n=t=>{const s=this.canvas.getActiveObject();if(!s)return;const o=t.shiftKey?10:1,{top:a,left:i}=s;switch(t.key){case"ArrowUp":s.top=a-o;break;case"ArrowRight":s.left=i+o;break;case"ArrowDown":s.top=a+o;break;case"ArrowLeft":s.left=i-o;break}return this.canvas.requestRenderAll(),!1},e=t=>{const s=this.canvas.getActiveObject();if(!s)return;const o=t.shiftKey?10:1;switch(t.key){case"ArrowUp":s.setHeight(s.getHeight()-o);break;case"ArrowRight":s.setWidth(s.getWidth()+o);break;case"ArrowDown":s.setHeight(s.getHeight()+o);break;case"ArrowLeft":s.setWidth(s.getWidth()-o);break}return this.canvas.requestRenderAll(),!1};this.keybinding.bind({up:n,right:n,down:n,left:n,"shift+up":n,"shift+right":n,"shift+down":n,"shift+left":n,"mod+up":e,"mod+right":e,"mod+down":e,"mod+left":e,"shift+mod+up":e,"shift+mod+right":e,"shift+mod+down":e,"shift+mod+left":e})}bindAlign(){const n=e=>{const t=this.canvas.getActiveObject();if(t)return t[e](),this.undoRedo.saveState(),!1};this.keybinding.bind({"alt+a":n.bind(this,"alignLeft"),"alt+d":n.bind(this,"alignRight"),"alt+h":n.bind(this,"alignCenter"),"alt+w":n.bind(this,"verticalTop"),"alt+s":n.bind(this,"verticalBottom"),"alt+v":n.bind(this,"verticalMiddle")})}objForEach(n,e=!1){const t=this.canvas.getActiveObjects();e&&t.reverse();const s=t.length-1;for(let o=s;o>=0;o--)n(t[s-o])}deleteLayer(n){return n.flatMap(t=>t.getParent().remove(t))}};Gn=Bu([on(0,Ie),on(1,Ye),on(2,Ze),on(3,Mt)],Gn);var zu=Object.defineProperty,Nu=Object.getOwnPropertyDescriptor,Hu=(n,e,t,s)=>{for(var o=s>1?void 0:s?Nu(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(o=(s?i(e,t,o):i(o))||o);return s&&o&&zu(e,t,o),o},zs=(n,e)=>(t,s)=>e(t,s,n);let Yn=class extends Ve{constructor(e,t){super();_(this,"canvasEvents");_(this,"options");_(this,"objectRect");this.canvas=e,this.keybinding=t,this.options=Object.assign({ruleSize:24,fontSize:10,enabled:!0});const{isDark:s}=us();Ge(()=>{this.options={...this.options,...s.value?{backgroundColor:"#242424",borderColor:"#555",highlightColor:"#165dff3b",textColor:"#ddd"}:{backgroundColor:"#fff",borderColor:"#ccc",highlightColor:"#165dff3b",textColor:"#444"}},this.render({ctx:this.canvas.contextContainer})}),this.canvasEvents={"after:render":this.render.bind(this)},this.keybinding.bind("shift+r",()=>{this.enabled=!this.enabled}),this.enabled=this.options.enabled}get enabled(){return this.options.enabled}set enabled(e){this.options.enabled=e,e?(this.canvas.on(this.canvasEvents),this.render({ctx:this.canvas.contextContainer})):(this.canvas.off(this.canvasEvents),this.canvas.requestRenderAll())}getSize(){return{width:this.canvas.width,height:this.canvas.height}}render({ctx:e}){if(e!==this.canvas.contextContainer)return;const{viewportTransform:t}=this.canvas;this.calcObjectRect(),this.draw({ctx:e,isHorizontal:!0,rulerLength:this.getSize().width,startCalibration:-(t[4]/t[0])}),this.draw({ctx:e,isHorizontal:!1,rulerLength:this.getSize().height,startCalibration:-(t[5]/t[3])});const{borderColor:s,backgroundColor:o,ruleSize:a,textColor:i}=this.options;this.darwRect(e,{left:0,top:0,width:a,height:a,fill:o,stroke:s}),this.darwText(e,{text:"px",left:a/2,top:a/2,align:"center",baseline:"middle",fill:i})}draw(e){const{ctx:t,isHorizontal:s,rulerLength:o,startCalibration:a}=e,i=this.canvas.getZoom(),r=this.getGap(i),l=Math.ceil(o/i),u=Math.floor(a/r)*r,c=u-a,d=this.getSize(),{textColor:p,borderColor:h,ruleSize:v,highlightColor:w}=this.options,b=2.5;this.darwRect(t,{left:0,top:0,width:s?d.width:v,height:s?v:d.height,fill:this.options.backgroundColor,stroke:this.options.borderColor});for(let S=0;S+c<=l;S+=r)for(let C=0;C<10;C++){const z=Math.round((c+S+r*C/10)*i),J=C===0,[K,G]=s?[z,J?0:v-8]:[J?0:v-8,z],[ie,te]=s?[0,v-G]:[v-K,0];this.darwLine(t,{left:K,top:G,width:ie,height:te,stroke:h})}if(this.objectRect){const S=s?"x":"y";this.objectRect[S].forEach(C=>{if(C.skip===S)return;const[z,J,K,G]=s?[(C.left-a)*i,0,C.width*i,v]:[0,(C.top-a)*i,v,C.height*i];this.darwRect(t,{left:z,top:J,width:K,height:G,fill:w})})}for(let S=0;S+c<=l;S+=r){const C=(c+S)*i,z=(u+S).toString(),[J,K,G]=s?[C+6,b,0]:[b,C-6,-90];this.darwText(t,{text:z,left:J,top:K,fill:p,angle:G})}}getGap(e){const t=[.02,.03,.05,.1,.2,.5,1,2,5],s=[5e3,2500,1e3,500,200,100,50,20,10];let o=0;for(;o<t.length&&t[o]<e;)o++;return s[o-1]||1e4}darwRect(e,{left:t,top:s,width:o,height:a,fill:i,stroke:r,strokeWidth:l}){e.save(),e.beginPath(),i&&(e.fillStyle=i),e.rect(t,s,o,a),e.fill(),r&&(e.strokeStyle=r,e.lineWidth=l!=null?l:1,e.stroke()),e.restore()}darwText(e,{left:t,top:s,text:o,fill:a,align:i,angle:r,fontSize:l,baseline:u}){e.save(),a&&(e.fillStyle=a),e.textAlign=i!=null?i:"left",e.textBaseline=u!=null?u:"top",e.font=`${l!=null?l:12}px Helvetica`,r&&(e.translate(t,s),e.rotate(ct*r),e.translate(-t,-s)),e.fillText(o,t,s),e.restore()}darwLine(e,{left:t,top:s,width:o,height:a,stroke:i,lineWidth:r}){e.save(),e.beginPath(),i&&(e.strokeStyle=i),e.lineWidth=r!=null?r:1,e.moveTo(t,s),e.lineTo(t+o,s+a),e.stroke(),e.restore()}calcObjectRect(){const e=this.canvas.getActiveObjects();if(e.length===0){this.objectRect=void 0;return}const t=e.reduce((s,o)=>{const a=o.getBoundingRect(!0);return s.push(a),s},[]);t.length!==0&&(this.objectRect={x:this.mergeLines(t,!0),y:this.mergeLines(t,!1)})}mergeLines(e,t){const s=t?"left":"top",o=t?"width":"height";e.sort((r,l)=>r[s]-l[s]);const a=[];let i=Object.assign({},e[0]);for(let r=1;r<e.length;r++){const l=Object.assign({},e[r]);i[s]+i[o]>=l[s]?i[o]=Math.max(i[s]+i[o],l[s]+l[o])-i[s]:(a.push(i),i=Object.assign({},l))}return a.push(i),a}dispose(){super.dispose(),this.enabled=!1}};Yn=Hu([zs(0,Ie),zs(1,Ye)],Yn);var Fu=Object.defineProperty,Vu=Object.getOwnPropertyDescriptor,Ku=(n,e,t,s)=>{for(var o=s>1?void 0:s?Vu(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(o=(s?i(e,t,o):i(o))||o);return s&&o&&Fu(e,t,o),o},Ns=(n,e)=>(t,s)=>e(t,s,n);let Xn=class extends Ve{constructor(e,t){super();_(this,"pointer");this.canvas=e,this.keybindingService=t,e.on("contextmenu",this.showLayerContextMenu.bind(this))}showBlankContextMenu(e){const t=e.e;this.pointer=this.canvas.getPointer(t);const{mod:s}=this.keybindingService;Bt.showContextMenu({x:t.clientX,y:t.clientY,preserveIconWidth:!1,items:[{label:"选择全部",onClick:()=>{this.keybindingService.trigger("mod+a")},shortcut:`${s} A`},{label:"粘贴到当前位置",onClick:()=>{this.keybindingService.trigger("mod+shift+v")},shortcut:`${s} ⇧ V`},...Oo()]})}showLayerContextMenu(e){if(e.target&&this.canvas.setActiveObject(e.target),!(e.target||this.canvas.getActiveObject())){this.showBlankContextMenu(e);return}const s=e.e;Bt.showContextMenu({x:s.clientX,y:s.clientY,preserveIconWidth:!1,items:Mo()}),this.canvas.requestRenderAll()}};Xn=Ku([Ns(0,Ie),Ns(1,Ye)],Xn);var Wu=Object.defineProperty,Uu=Object.getOwnPropertyDescriptor,Gu=(n,e,t,s)=>{for(var o=s>1?void 0:s?Uu(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(o=(s?i(e,t,o):i(o))||o);return s&&o&&Wu(e,t,o),o},Hs=(n,e)=>(t,s)=>e(t,s,n);let qn=class extends Ve{constructor(e,t){super();_(this,"scalePadding",.9);this.canvas=e,this.keybindingService=t,t.bind("+",()=>{let o=e.getZoom();o=o<1&&o*2>1?1:o*2,this.zoomToPoint(o)}),t.bind("-",()=>{let o=e.getZoom();o=o>1&&o/2<1?1:o/2,this.zoomToPoint(o)}),t.bind("mod+0",()=>(this.zoomToPoint(1),!1)),t.bind("mod+1",()=>(this.showAllContent(),!1)),t.bind("mod+2",()=>(this.showSelectedContent(),!1));const{zoom:s}=_t(ot());Ge(()=>{s.value=e.ref.zoom.value})}zoomToPoint(e){this.canvas.zoomToPoint(this.canvas.getCenterPoint(),e)}showAllContent(){const e=this.canvas.getObjects();if(e.length===0){this.canvas.setViewportTransform(ts);return}const t=et.prototype.getObjectsBoundingBox(e);if(!t)return;const s=Math.min(this.canvas.getWidth()/t.width,this.canvas.getHeight()/t.height)*this.scalePadding;this.canvas.setZoom(s),this.canvas.absolutePan(new ke(t.centerX,t.centerY).scalarMultiply(s).subtract(this.canvas.getCenterPoint()))}showSelectedContent(){const e=this.canvas.getActiveObject();if(!e)return;const t=Math.min(this.canvas.getWidth()/e.getWidth(),this.canvas.getHeight()/e.getHeight())*this.scalePadding;this.canvas.setZoom(t),this.canvas.absolutePan(e.getCenterPoint().scalarMultiply(t).subtract(this.canvas.getCenterPoint()))}};qn=Gu([Hs(0,Ie),Hs(1,Ye)],qn);var Yu=Object.defineProperty,Xu=Object.getOwnPropertyDescriptor,qu=(n,e,t,s)=>{for(var o=s>1?void 0:s?Xu(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(o=(s?i(e,t,o):i(o))||o);return s&&o&&Yu(e,t,o),o},Ju=(n,e)=>(t,s)=>e(t,s,n);const $t=n=>Object.keys(n);let Jn=class extends Ve{constructor(e){super();_(this,"canvasEvents");_(this,"aligningLineMargin",10);_(this,"aligningLineWidth",1);_(this,"aligningLineColor","#F68066");_(this,"verticalLines",[]);_(this,"horizontalLines",[]);_(this,"activeObj");_(this,"ignoreObjTypes",[]);_(this,"pickObjTypes",[]);_(this,"dirty",!1);this.canvas=e;const t=()=>{(this.horizontalLines.length||this.verticalLines.length)&&(this.clearGuideline(),this.clearLinesMeta())};this.canvasEvents={"before:render":this.clearGuideline.bind(this),"after:render":this.drawGuideLines.bind(this),"object:moving":this.objectMoving.bind(this),"mouse:up":t},e.on(this.canvasEvents)}objectMoving({target:e}){if(this.clearLinesMeta(),!this.canvas._currentTransform)return;this.activeObj=e;const s=this.canvas.getActiveObjects(),o=[],a=i=>{const r=i.getObjects().filter(l=>this.ignoreObjTypes.length?!this.ignoreObjTypes.some(u=>l.get(u.key)===u.value):this.pickObjTypes.length?this.pickObjTypes.some(u=>l.get(u.key)===u.value):s.includes(l)?!1:L.isActiveSelection(l)||L.isCollection(l)&&e.group&&l===e.group?(a(l),!1):!0);o.push(...r)};if(L.isActiveSelection(e)){const i=new Set;e.forEachObject(r=>{const l=r.getParent();i.add(l)}),i.forEach(r=>{L.isNativeGroup(r)&&o.push(r),a(r)})}else{const i=e.getParent();L.isNativeGroup(i)&&o.push(i),a(i)}this.traversAllObjects(e,o)}clearLinesMeta(){this.verticalLines.length=this.horizontalLines.length=0}getObjDraggingObjCoords(e){const t=this.getCoords(e),s=this.calcCenterPointByACoords(t).subtract(e.getCenterPoint()),o=$t(t).map(a=>t[a].subtract(s));return{tl:o[0],tr:o[1],br:o[2],bl:o[3],c:e.getCenterPoint()}}getObjMaxWidthHeightByCoords(e){const{c:t,tl:s,tr:o}=e,a=Math.max(Math.abs(t.y-s.y),Math.abs(t.y-o.y))*2,i=Math.max(Math.abs(t.x-s.x),Math.abs(t.x-o.x))*2;return{objHeight:a,objWidth:i}}omitCoords(e,t){const s=e,o=t==="vertical"?"x":"y";return $t(e).forEach(a=>{e[a][o]<s.tl[o]&&(s[a]=e[a]),e[a][o]>s.tl[o]&&(s[a]=e[a])}),s}isInRange(e,t){return Math.abs(Math.round(e)-Math.round(t))<=this.aligningLineMargin/this.canvas.getZoom()}getCoords(e){const[t,s,o,a]=e.getCoords(!0);return{tl:t,tr:s,br:o,bl:a}}calcCenterPointByACoords(e){return new ke((e.tl.x+e.br.x)/2,(e.tl.y+e.br.y)/2)}traversAllObjects(e,t){const s=this.getObjDraggingObjCoords(e),o=new Set,a=new Set;for(let i=t.length;i--;){const r={...this.getCoords(t[i]),c:t[i].getCenterPoint()},{objHeight:l,objWidth:u}=this.getObjMaxWidthHeightByCoords(r);$t(s).forEach(c=>{const d=t[i].angle!==0?this.omitCoords(r,"horizontal"):r;function p(h,v){let w,b;return h==="c"?(w=Math.min(r.c.x-u/2,v[c].x),b=Math.max(r.c.x+u/2,v[c].x)):(w=Math.min(r[h].x,v[c].x),b=Math.max(r[h].x,v[c].x)),{x1:w,x2:b}}$t(d).forEach(h=>{if(this.isInRange(s[c].y,r[h].y)){const v=r[h].y,w=s[c].y-v;a.add(s.c.y-w);const b=this.getCoords(e),{x1:S,x2:C}=p(h,{...b,c:this.calcCenterPointByACoords(b)});this.horizontalLines.push({y:v,x1:S,x2:C})}})}),$t(s).forEach(c=>{const d=t[i].angle!==0?this.omitCoords(r,"vertical"):r;function p(h,v){let w,b;return h==="c"?(w=Math.min(d.c.y-l/2,v[c].y),b=Math.max(d.c.y+l/2,v[c].y)):(w=Math.min(r[h].y,v[c].y),b=Math.max(r[h].y,v[c].y)),{y1:w,y2:b}}$t(d).forEach(h=>{if(this.isInRange(s[c].x,r[h].x)){const v=r[h].x,w=s[c].x-v;o.add(s.c.x-w);const b=this.getCoords(e),{y1:S,y2:C}=p(h,{...b,c:this.calcCenterPointByACoords(b)});this.verticalLines.push({x:v,y1:S,y2:C})}})})}this.snap({activeObject:e,draggingObjCoords:s,snapXPoints:o,snapYPoints:a})}snap({activeObject:e,draggingObjCoords:t,snapXPoints:s,snapYPoints:o}){if(s.size===0&&o.size===0)return;const a=(i,r)=>i.size===0?r:[...i].sort((u,c)=>Math.abs(r-u)-Math.abs(r-c))[0];e.setXY(new ke(a(s,t.c.x),a(o,t.c.y)),"center","center")}drawSign(e,t){const s=this.canvas.getTopContext();s.strokeStyle=this.aligningLineColor,s.beginPath();const o=3;s.moveTo(e-o,t-o),s.lineTo(e+o,t+o),s.moveTo(e+o,t-o),s.lineTo(e-o,t+o),s.stroke()}drawLine(e,t,s,o){const a=this.canvas.getTopContext(),i=L.transformPoint(new ke(e,t),this.canvas.viewportTransform),r=L.transformPoint(new ke(s,o),this.canvas.viewportTransform);a.save(),a.lineWidth=this.aligningLineWidth,a.strokeStyle=this.aligningLineColor,a.beginPath(),a.moveTo(i.x,i.y),a.lineTo(r.x,r.y),a.stroke(),this.drawSign(i.x,i.y),this.drawSign(r.x,r.y),a.restore(),this.dirty=!0}drawVerticalLine(e,t){Object.values(t).some(s=>Math.abs(s.x-e.x)<1e-4)&&this.drawLine(e.x,Math.min(e.y1,e.y2),e.x,Math.max(e.y1,e.y2))}drawHorizontalLine(e,t){Object.values(t).some(s=>Math.abs(s.y-e.y)<1e-4)&&this.drawLine(Math.min(e.x1,e.x2),e.y,Math.max(e.x1,e.x2),e.y)}drawGuideLines(e){if(!e.ctx||!this.verticalLines.length&&!this.horizontalLines.length||!this.activeObj)return;const t=this.getObjDraggingObjCoords(this.activeObj);for(let s=this.verticalLines.length;s--;)this.drawVerticalLine(this.verticalLines[s],t);for(let s=this.horizontalLines.length;s--;)this.drawHorizontalLine(this.horizontalLines[s],t)}clearGuideline(){this.dirty&&(this.dirty=!1,this.canvas.clearContext(this.canvas.getTopContext()))}dispose(){super.dispose(),this.canvas.off(this.canvasEvents)}};Jn=qu([Ju(0,Ie)],Jn);class Zu extends Ve{constructor(){super();_(this,"scope");this.scope=sa()}scopeRun(t){this.scope.run(t)}dispose(){var t;super.dispose(),(t=this.scope)==null||t.stop()}}var Qu=Object.defineProperty,ed=Object.getOwnPropertyDescriptor,td=(n,e,t,s)=>{for(var o=s>1?void 0:s?ed(e,t):e,a=n.length-1,i;a>=0;a--)(i=n[a])&&(o=(s?i(e,t,o):i(o))||o);return s&&o&&Qu(e,t,o),o},nd=(n,e)=>(t,s)=>e(t,s,n);let Zn=class extends Zu{constructor(e){super();_(this,"service");_(this,"pluginInstance",new Map);_(this,"contextMenu");this.instantiationService=e}startup(){super.scopeRun(()=>{this.service=this.initServices(),this.service.invokeFunction(s=>{const o=s.get(Et);o.size()===0&&o.setCurrentId(o.add("页面 1"))}),[this.service.createInstance(Yn),this.service.createInstance(Gn),this.service.createInstance(Vn),this.service.createInstance(Kn),this.service.createInstance(Wn),this.service.createInstance(Jn),this.service.createInstance(qn),this.contextMenu=this.service.createInstance(Xn),this.service.createInstance(Un)].forEach(s=>{this._register(s)}),De("useEditor",ye),Ho()._p.forEach(s=>{this.use(s)})})}use(e){const t=e({service:this.service,use:this.use});t._id=Symbol(),this.pluginInstance.set(t._id,t),Ct(()=>{var s;(s=t.setup)==null||s.call(t),this._register(is(()=>{var o;(o=t.dispose)==null||o.call(t),this.pluginInstance.delete(t._id)}))})}initServices(){const e=new ps,t=(s,o)=>{e.has(s)||e.set(s,new st(o))};return t(Ze,Ea),t(Et,En),t(Ie,Rn),t(Mt,Dn),t(Ye,yo),this.instantiationService.createChild(e)}dispose(){try{De("useEditor",void 0),super.dispose(),this.service.invokeFunction(e=>{e.get(Ye).reset(),e.get(Mt).reset(),e.get(as).clear(),e.get(Ie).dispose(),e.get(Et).dispose(),e.get(Ze).all.clear()}),this.service=void 0}catch(e){console.error(e)}}getPluginSlots(e){const t=[];return this.pluginInstance.forEach(s=>{if(!s.slots)return;const o=s.slots[e];o&&t.push(...o)}),t}};Zn=td([nd(0,po)],Zn);const sd=B({__name:"editor",setup(n){const e=t=>{const s=t.target||t.srcElement,o=s&&["INPUT","TEXTAREA","TEXT"].includes(s.tagName),a=o&&s.disabled;(!s||!o||a)&&t.preventDefault()};return oa(()=>{const{service:t}=Ho();Ne.editor=t.createInstance(Zn),Ne.editor.startup()}),fn(()=>{Ne.editor.dispose(),Ne.editor=null}),(t,s)=>{const o=aa,a=ra,i=la,r=ia;return g(),T("div",{onContextmenu:e},[f(r,{class:"h-screen"},{default:y(()=>[f(o,{class:"bg-$color-bg-4! b-solid b-b b-$color-neutral-3"},{default:y(()=>[f(m(sl))]),_:1}),f(r,{class:"flex-1 min-h-0"},{default:y(()=>[f(a,{class:"bg-$color-bg-4! z1",width:240},{default:y(()=>[f(m(Ul))]),_:1}),f(i,null,{default:y(()=>[f(m(ol))]),_:1}),f(a,{class:"bg-$color-bg-4!",width:240},{default:y(()=>[f(m(ru))]),_:1})]),_:1})]),_:1})],32)}}}),od=le(sd,[["__scopeId","data-v-737f3112"]]),id={};function ad(n,e){const t=we;return g(),O(t,{onClick:e[0]||(e[0]=s=>n.$router.push({name:"Editor"}))},{default:y(()=>[me(" 进入编辑器 ")]),_:1})}const rd=le(id,[["render",ad]]),ld=ca({history:ua(),routes:[{path:"/",name:"Home",component:rd},{path:"/editor",name:"Editor",component:od}]});if(typeof window<"u"){let n=function(){var e=document.body,t=document.getElementById("__svg__icons__dom__");t||(t=document.createElementNS("http://www.w3.org/2000/svg","svg"),t.style.position="absolute",t.style.width="0",t.style.height="0",t.id="__svg__icons__dom__",t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("xmlns:link","http://www.w3.org/1999/xlink")),t.innerHTML='<symbol  viewBox="0 0 14 14" id="icon-artboard"><path d="M3 9.67V4.33H1.67c-.24 0-.46-.12-.58-.33a.668.668 0 0 1 0-.67c.12-.2.34-.33.58-.33H3V1.67c0-.24.13-.46.33-.58.21-.12.46-.12.67 0 .21.12.33.34.33.58V3h5.34V1.67c0-.37.3-.67.66-.67.37 0 .67.3.67.67V3h1.33c.37 0 .67.3.67.67 0 .36-.3.66-.67.66H11v5.34h1.33c.37 0 .67.3.67.66 0 .37-.3.67-.67.67H11v1.33c0 .37-.3.67-.67.67-.36 0-.66-.3-.66-.67V11H4.33v1.33c0 .37-.3.67-.66.67a.67.67 0 0 1-.67-.67V11H1.67a.67.67 0 0 1-.67-.67c0-.36.3-.66.67-.66zm6.67 0V4.33H4.33v5.34z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bx-circle"><path d="M12 2C6.486 2 2 6.486 2 12c.001 5.515 4.487 10.001 10 10.001 5.514 0 10-4.486 10.001-10.001 0-5.514-4.486-10-10.001-10zm0 18.001c-4.41 0-7.999-3.589-8-8.001 0-4.411 3.589-8 8-8 4.412 0 8.001 3.589 8.001 8-.001 4.412-3.59 8.001-8.001 8.001z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bx-horizontal-center"><path d="m5.005 15.995 4-4-4-4v3h-3v2h3zm14-5v-3l-4 4 4 4v-3h3v-2h-2.072zm-8 7h2v3h-2zm0-5h2v3h-2zm0-5h2v3h-2zm0-5h2v3h-2z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bx-pen"><path d="M18.404 2.998c-.757-.754-2.077-.751-2.828.005l-1.784 1.791L11.586 7H7a.998.998 0 0 0-.939.658l-4 11c-.133.365-.042.774.232 1.049l2 2a.997.997 0 0 0 1.049.232l11-4A.998.998 0 0 0 17 17v-4.586l2.207-2.207v-.001h.001L21 8.409c.378-.378.586-.881.585-1.415 0-.535-.209-1.038-.588-1.415l-2.593-2.581zm-3.111 8.295A.996.996 0 0 0 15 12v4.3l-9.249 3.363 4.671-4.671c.026.001.052.008.078.008A1.5 1.5 0 1 0 9 13.5c0 .026.007.052.008.078l-4.671 4.671L7.7 9H12c.266 0 .52-.105.707-.293L14.5 6.914 17.086 9.5l-1.793 1.793zm3.206-3.208-2.586-2.586 1.079-1.084 2.593 2.581-1.086 1.089z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bx-polygon"><path d="M16.707 2.293A.996.996 0 0 0 16 2H8a.996.996 0 0 0-.707.293l-5 5A.996.996 0 0 0 2 8v8c0 .266.105.52.293.707l5 5A.996.996 0 0 0 8 22h8c.266 0 .52-.105.707-.293l5-5A.996.996 0 0 0 22 16V8a.996.996 0 0 0-.293-.707l-5-5zM20 15.586 15.586 20H8.414L4 15.586V8.414L8.414 4h7.172L20 8.414v7.172z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bx-reflect-horizontal"><path d="M6 21h12l-6-6-6 6zM18 3H6l6 6 6-6zM3 11h3v2H3zm5 0h3v2H8zm5 0h3v2h-3zm5 0h3v2h-3z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bx-reflect-vertical"><path d="m3 18 6-6-6-6v12zm12-6 6 6V6l-6 6zm-4-9h2v3h-2zm0 5h2v3h-2zm0 5h2v3h-2zm0 5h2v3h-2z" /></symbol><symbol viewBox="0 0 1024 1024"  id="icon-bx-revision"><path d="M634.88 512a87.04 87.04 0 1 1-174.08 0 87.04 87.04 0 0 1 174.08 0zm-87.04 394.24A393.728 393.728 0 0 1 222.4 734.464l62.368-32.576A324.64 324.64 0 0 0 550.4 839.68c179.552 0 325.12-145.568 325.12-325.12S729.952 189.44 550.4 189.44c-159.424 0-291.968 114.784-319.68 266.208h76.448L191.936 645.12 76.704 455.648h80.96c27.36-191.04 191.584-337.888 390.176-337.888 217.728 0 394.24 176.512 394.24 394.24S765.568 906.24 547.84 906.24z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bx-square"><path d="M20 3H4a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V4a1 1 0 0 0-1-1zm-1 16H5V5h14v14z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bx-star"><path d="m6.516 14.323-1.49 6.452a.998.998 0 0 0 1.529 1.057L12 18.202l5.445 3.63a1.001 1.001 0 0 0 1.517-1.106l-1.829-6.4 4.536-4.082a1 1 0 0 0-.59-1.74l-5.701-.454-2.467-5.461a.998.998 0 0 0-1.822 0L8.622 8.05l-5.701.453a1 1 0 0 0-.619 1.713l4.214 4.107zm2.853-4.326a.998.998 0 0 0 .832-.586L12 5.43l1.799 3.981a.998.998 0 0 0 .832.586l3.972.315-3.271 2.944c-.284.256-.397.65-.293 1.018l1.253 4.385-3.736-2.491a.995.995 0 0 0-1.109 0l-3.904 2.603 1.05-4.546a1 1 0 0 0-.276-.94l-3.038-2.962 4.09-.326z" /></symbol><symbol viewBox="0 0 1024 1024"  id="icon-bx-text"><path d="M853.333 170.667H170.667A42.667 42.667 0 0 0 128 213.333v128a42.667 42.667 0 0 0 85.333 0V256h256v554.667H384A42.667 42.667 0 0 0 384 896h256a42.667 42.667 0 0 0 0-85.333h-85.333V256h256v85.333a42.667 42.667 0 0 0 85.333 0v-128a42.667 42.667 0 0 0-42.667-42.666z" /></symbol><symbol  viewBox="0 0 1024 1024" id="icon-bx-triangle"><path d="M934.4 942.08H89.6a46.72 46.72 0 0 1-40.64-23.488 49.92 49.92 0 0 1 0-46.912l422.4-732.16a46.72 46.72 0 0 1 40.704-23.488 46.72 46.72 0 0 1 40.64 23.488l422.4 732.16a49.92 49.92 0 0 1 0 46.912 46.72 46.72 0 0 1-40.64 23.488zm-763.328-93.888H853.12l-340.992-591.36-341.12 591.36z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bx-vertical-center"><path d="M13 5V2h-2v3H8l4 4 4-4zm0 17v-3h3l-4-4-4 4h3v3zM3 11h3v2H3zm5 0h3v2H8zm5 0h3v2h-3zm5 0h3v2h-3z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bxs-grid"><path d="M4 4h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4zM4 10h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4zM4 16h4v4H4zm6 0h4v4h-4zm6 0h4v4h-4z" /></symbol><symbol  fill="none" viewBox="0 0 24 24" id="icon-bxs-hand"><path stroke-width="2" stroke="currentColor" d="M20.5 5A1.5 1.5 0 0 0 19 6.5V11h-1V4.5a1.5 1.5 0 0 0-3 0V11h-1V3.5a1.5 1.5 0 0 0-3 0V11h-1V5.5a1.5 1.5 0 0 0-3 0v10.81l-2.22-3.6a1.5 1.5 0 0 0-2.56 1.58l3.31 5.34A5 5 0 0 0 9.78 22H17a5 5 0 0 0 5-5V6.5A1.5 1.5 0 0 0 20.5 5z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bxs-objects-horizontal-center"><path d="M19 13h-6v-2h4a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-4V2h-2v3H7a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h4v2H5a1 1 0 0 0-1 1v4a1 1 0 0 0 1 1h6v3h2v-3h6a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bxs-objects-horizontal-left"><path d="M2 2h2v20H2z" /><rect x="6" y="13" width="16" height="6" rx="1" /><rect x="6" y="5" width="12" height="6" rx="1" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bxs-objects-horizontal-right"><path d="M20 2h2v20h-2z" /><rect x="2" y="13" width="16" height="6" rx="1" /><rect x="6" y="5" width="12" height="6" rx="1" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bxs-objects-vertical-bottom"><path d="M2 20h20v2H2z" /><rect x="5" y="2" width="6" height="16" rx="1" /><rect x="13" y="6" width="6" height="12" rx="1" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bxs-objects-vertical-center"><path d="M19 7a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v4h-2V5a1 1 0 0 0-1-1H6a1 1 0 0 0-1 1v6H2v2h3v6a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-6h2v4a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-4h3v-2h-3z" /></symbol><symbol  viewBox="0 0 24 24" id="icon-bxs-objects-vertical-top"><path d="M2 2h20v2H2z" /><rect x="5" y="6" width="6" height="16" rx="1" /><rect x="13" y="6" width="6" height="12" rx="1" /></symbol><symbol  fill="none" viewBox="0 0 24 24" id="icon-bxs-pointer"><path d="M20.978 13.21a1 1 0 0 0-.396-1.024l-14-10a.999.999 0 0 0-1.575.931l2 17a1 1 0 0 0 1.767.516l3.612-4.416c.505-.558.967-.86 1.721-1.02l6.089-1.218a.995.995 0 0 0 .782-.769z" stroke-width="2" stroke="currentColor" /></symbol><symbol viewBox="0 0 1024 1024"  id="icon-dropdown-more"><path d="M686.113 297.628 685.99 670.3l-371.457-.122 371.579-372.551zm0 0" /></symbol><symbol  viewBox="0 0 1024 1024" id="icon-object-group"><path d="M160 160v128h32v448h-32v128h128v-32h448v32h128V736h-32V288h32V160H736v32H288v-32zm128 96h448v32h32v448h-32v32H288v-32h-32V288h32zm32 64v256h128v128h256V448H576V320zm64 64h128v128H384zm192 128h64v128H512v-64h64z" /></symbol><symbol  viewBox="0 0 1024 1024" id="icon-object-ungroup"><path d="M160 160v128h32v320h-32v128h128v-32h64v64h-32v128h128v-32h320v32h128V768h-32V448h32V320H768v32h-64v-64h32V160H608v32H288v-32zm128 96h320v32h32v320h-32v32H288v-32h-32V288h32zm416 160h64v32h32v320h-32v32H448v-32h-32v-64h192v32h128V608h-32z" /></symbol><symbol viewBox="0 0 1024 1024"  id="icon-round"><path d="M245 855h-76V556.4c0-52.3 10.2-103 30.5-150.8 19.5-46.1 47.4-87.6 83-123.1s77-63.5 123.1-83c47.8-20.2 98.5-30.5 150.8-30.5H855v76H556.4c-83.2 0-161.4 32.4-220.2 91.2S245 473.2 245 556.4V855z" /></symbol>',e.insertBefore(t,e.lastChild)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n()}const cd={class:"p2"},ud=N("div",null,"测试插件插槽",-1),dd=B({__name:"testSlot",setup(n){const{canvas:e}=Ae("useEditor")(),t=()=>{if(Xe.all.size===0){console.log("Enable via `instantiationService.ts#_enableAllTracing`");return}for(const s of Xe.all)console.log(s)};return(s,o)=>{var i;const a=we;return g(),T("div",cd,[ud,f(a,{onClick:t,hidden:""},{default:y(()=>[me("打印Trace")]),_:1}),(g(!0),T(he,null,ze((i=m(e).activeObject.value)==null?void 0:i.ref,(r,l)=>(g(),T("div",{key:l},Be(l)+": "+Be(r),1))),128))])}}}),hd=pu(n=>{const[e,t]=n.service.invokeFunction(s=>[s.get(Ie),s.get(Mt)]);return{setup(){console.log("myPlugin setup"),console.log(n);function s(){return"#"+Math.random().toString(16).substring(2,8)}const o=new Ce([],{top:50,left:50,width:300,height:300}),a=new Ce([],{top:400,left:50,width:800,height:800,fill:"#f2b8ca",name:"画板 1000个元素"}),i=new et([new Ue({top:V.random(400,500),left:V.random(300,400),width:V.random(50,100),height:V.random(50,100),fill:s(),strokeWidth:V.random(0,10),stroke:s()}),new Ue({top:V.random(400,500),left:V.random(400,500),width:V.random(50,100),height:V.random(50,100),fill:s(),strokeWidth:V.random(0,10),stroke:s()})],{});e.add(i);const r=[],l=new es({top:10,left:10,width:200,height:200,fill:""});e.add(l),L.loadImage("https://img.js.design/assets/img/6486fff21a74fef8078bf782.jpg#4d6a3f65b147c75a22effca8347bc5ce",{crossOrigin:"anonymous"}).then(u=>{l.fill=new Ot({crossOrigin:"anonymous",source:u,fit:"fill"}),l.set("dirty",!0),e.requestRenderAll()});for(let u=0;u<50;u++)r.push(new Ue({top:V.random(100,300),left:V.random(400,800),width:V.random(50,100),height:V.random(50,100),fill:new Gt({type:"linear",coords:{x1:0,y1:0,x2:100,y2:100},colorStops:[{color:s(),offset:0},{color:s(),offset:1}]})}));for(let u=0;u<1e3;u++)a.add(new Ue({top:V.random(400,1100),left:V.random(50,750),width:V.random(50,100),height:V.random(50,100),fill:s()}));e.add(...r),e.add(o,a),t.saveState()},dispose(){console.log("myPlugin dispose")},slots:{rightPanel:[dd]}}}),Ko=hu();Ko.use(hd);_e.enableBoundaryChecking(!1);da(fa).use(Wr).use(ld).use(Ko).use(Qc).mount("#app");export{fd as __vite_legacy_guard,yd as c,_d as g};
