!function(){function t(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */t=function(){return e};var e={},r=Object.prototype,i=r.hasOwnProperty,n=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",h=s.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(M){c=function(t,e,r){return t[e]=r}}function l(t,e,r,i){var s=e&&e.prototype instanceof d?e:d,o=Object.create(s.prototype),a=new O(i||[]);return n(o,"_invoke",{value:w(t,r,a)}),o}function u(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(M){return{type:"throw",arg:M}}}e.wrap=l;var f={};function d(){}function g(){}function p(){}var v={};c(v,o,(function(){return this}));var m=Object.getPrototypeOf,_=m&&m(m(k([])));_&&_!==r&&i.call(_,o)&&(v=_);var y=p.prototype=d.prototype=Object.create(v);function x(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(n,s,o,a){var h=u(t[n],t,s);if("throw"!==h.type){var c=h.arg,l=c.value;return l&&"object"==typeof l&&i.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,o,a)}),(function(t){r("throw",t,o,a)})):e.resolve(l).then((function(t){c.value=t,o(c)}),(function(t){return r("throw",t,o,a)}))}a(h.arg)}var s;n(this,"_invoke",{value:function(t,i){function n(){return new e((function(e,n){r(t,i,e,n)}))}return s=s?s.then(n,n):n()}})}function w(t,e,r){var i="suspendedStart";return function(n,s){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===n)throw s;return D()}for(r.method=n,r.arg=s;;){var o=r.delegate;if(o){var a=C(o,r);if(a){if(a===f)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===i)throw i="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i="executing";var h=u(t,e,r);if("normal"===h.type){if(i=r.done?"completed":"suspendedYield",h.arg===f)continue;return{value:h.arg,done:r.done}}"throw"===h.type&&(i="completed",r.method="throw",r.arg=h.arg)}}}function C(t,e){var r=e.method,i=t.iterator[r];if(void 0===i)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,C(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var n=u(i,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,f;var s=n.arg;return s?s.done?(e[t.resultName]=s.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):s:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function k(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,n=function e(){for(;++r<t.length;)if(i.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return n.next=n}}return{next:D}}function D(){return{value:void 0,done:!0}}return g.prototype=p,n(y,"constructor",{value:p,configurable:!0}),n(p,"constructor",{value:g,configurable:!0}),g.displayName=c(p,h,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,h,"GeneratorFunction")),t.prototype=Object.create(y),t},e.awrap=function(t){return{__await:t}},x(b.prototype),c(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,i,n,s){void 0===s&&(s=Promise);var o=new b(l(t,r,i,n),s);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},x(y),c(y,h,"Generator"),c(y,o,(function(){return this})),c(y,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var i in e)r.push(i);return r.reverse(),function t(){for(;r.length;){var i=r.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},e.values=k,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,i){return o.type="throw",o.arg=t,e.next=r,i&&(e.method="next",e.arg=void 0),!!i}for(var n=this.tryEntries.length-1;n>=0;--n){var s=this.tryEntries[n],o=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var a=i.call(s,"catchLoc"),h=i.call(s,"finallyLoc");if(a&&h){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(a){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,f):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),T(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var n=i.arg;T(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),f}},e}function e(t,e,r,i,n,s,o){try{var a=t[s](o),h=a.value}catch(c){return void r(c)}a.done?e(h):Promise.resolve(h).then(i,n)}function r(t){return function(){var r=this,i=arguments;return new Promise((function(n,s){var o=t.apply(r,i);function a(t){e(o,n,s,a,h,"next",t)}function h(t){e(o,n,s,a,h,"throw",t)}a(void 0)}))}}function i(t){return c(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||a(t)||o()}function n(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=a(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,h=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){h=!0,s=t},f:function(){try{o||null==r.return||r.return()}finally{if(h)throw s}}}}function s(t,e){return c(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var i,n,s,o,a=[],h=!0,c=!1;try{if(s=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;h=!1}else for(;!(h=(i=s.call(r)).done)&&(a.push(i.value),a.length!==e);h=!0);}catch(l){c=!0,n=l}finally{try{if(!h&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(c)throw n}}return a}}(t,e)||a(t,e)||o()}function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function a(t,e){if(t){if("string"==typeof t)return h(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(t,e):void 0}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function c(t){if(Array.isArray(t))return t}System.register(["./index-legacy.9dad35e3.js"],(function(e,o){"use strict";var a,h;return{setters:[t=>{a=t.c,h=t.g}],execute:function(){var o=function(){if("undefined"!=typeof Map)return Map;function t(t,e){var r=-1;return t.some((function(t,i){return t[0]===e&&(r=i,!0)})),r}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var r=t(this.__entries__,e),i=this.__entries__[r];return i&&i[1]},e.prototype.set=function(e,r){var i=t(this.__entries__,e);~i?this.__entries__[i][1]=r:this.__entries__.push([e,r])},e.prototype.delete=function(e){var r=this.__entries__,i=t(r,e);~i&&r.splice(i,1)},e.prototype.has=function(e){return!!~t(this.__entries__,e)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var r=0,i=this.__entries__;r<i.length;r++){var n=i[r];t.call(e,n[1],n[0])}},e}()}(),c="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,l="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),u="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(l):function(t){return setTimeout((function(){return t(Date.now())}),1e3/60)};var f=["top","right","bottom","left","width","height","size","weight"],d="undefined"!=typeof MutationObserver,g=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(t,e){var r=!1,i=!1,n=0;function s(){r&&(r=!1,t()),i&&a()}function o(){u(s)}function a(){var t=Date.now();if(r){if(t-n<2)return;i=!0}else r=!0,i=!1,setTimeout(o,e);n=t}return a}(this.refresh.bind(this),20)}return t.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},t.prototype.removeObserver=function(t){var e=this.observers_,r=e.indexOf(t);~r&&e.splice(r,1),!e.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},t.prototype.updateObservers_=function(){var t=this.observers_.filter((function(t){return t.gatherActive(),t.hasActive()}));return t.forEach((function(t){return t.broadcastActive()})),t.length>0},t.prototype.connect_=function(){c&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),d?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){c&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(t){var e=t.propertyName,r=void 0===e?"":e;f.some((function(t){return!!~r.indexOf(t)}))&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),p=function(t,e){for(var r=0,i=Object.keys(e);r<i.length;r++){var n=i[r];Object.defineProperty(t,n,{value:e[n],enumerable:!1,writable:!1,configurable:!0})}return t},v=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||l},m=C(0,0,0,0);function _(t){return parseFloat(t)||0}function y(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return e.reduce((function(e,r){return e+_(t["border-"+r+"-width"])}),0)}function x(t){var e=t.clientWidth,r=t.clientHeight;if(!e&&!r)return m;var i=v(t).getComputedStyle(t),n=function(t){for(var e={},r=0,i=["top","right","bottom","left"];r<i.length;r++){var n=i[r],s=t["padding-"+n];e[n]=_(s)}return e}(i),s=n.left+n.right,o=n.top+n.bottom,a=_(i.width),h=_(i.height);if("border-box"===i.boxSizing&&(Math.round(a+s)!==e&&(a-=y(i,"left","right")+s),Math.round(h+o)!==r&&(h-=y(i,"top","bottom")+o)),!function(t){return t===v(t).document.documentElement}(t)){var c=Math.round(a+s)-e,l=Math.round(h+o)-r;1!==Math.abs(c)&&(a-=c),1!==Math.abs(l)&&(h-=l)}return C(n.left,n.top,a,h)}var b="undefined"!=typeof SVGGraphicsElement?function(t){return t instanceof v(t).SVGGraphicsElement}:function(t){return t instanceof v(t).SVGElement&&"function"==typeof t.getBBox};function w(t){return c?b(t)?function(t){var e=t.getBBox();return C(0,0,e.width,e.height)}(t):x(t):m}function C(t,e,r,i){return{x:t,y:e,width:r,height:i}}var S=function(){function t(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=C(0,0,0,0),this.target=t}return t.prototype.isActive=function(){var t=w(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},t}(),T=function(t,e){var r,i,n,s,o,a,h,c=(i=(r=e).x,n=r.y,s=r.width,o=r.height,a="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,h=Object.create(a.prototype),p(h,{x:i,y:n,width:s,height:o,top:n,right:i+s,bottom:o+n,left:i}),h);p(this,{target:t,contentRect:c})},O=function(){function t(t,e,r){if(this.activeObservations_=[],this.observations_=new o,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=e,this.callbackCtx_=r}return t.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof v(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new S(t)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof v(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach((function(e){e.isActive()&&t.activeObservations_.push(e)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map((function(t){return new T(t.target,t.broadcastRect())}));this.callback_.call(t,e,t),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),k="undefined"!=typeof WeakMap?new WeakMap:new o,D=function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var r=g.getInstance(),i=new O(e,r,this);k.set(this,i)};["observe","unobserve","disconnect"].forEach((function(t){D.prototype[t]=function(){var e;return(e=k.get(this))[t].apply(e,arguments)}}));e("q",void 0!==l.ResizeObserver?l.ResizeObserver:D);function M(t,e){return void 0===e&&(e=15),+parseFloat(Number(t).toPrecision(e))}function E(t){var e=t.toString().split(/[eE]/),r=(e[0].split(".")[1]||"").length-+(e[1]||0);return r>0?r:0}function A(t){if(-1===t.toString().indexOf("e"))return Number(t.toString().replace(".",""));var e=E(t);return e>0?M(Number(t)*Math.pow(10,e)):Number(t)}function P(t){X&&(t>Number.MAX_SAFE_INTEGER||t<Number.MIN_SAFE_INTEGER)&&console.warn(t+" is beyond boundary when transfer to integer, the results may not be accurate")}function F(t){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var i=e[0];return e.slice(1).reduce((function(e,r){return t(e,r)}),i)}}var L=F((function(t,e){var r=A(t),i=A(e),n=E(t)+E(e),s=r*i;return P(s),s/Math.pow(10,n)})),R=F((function(t,e){var r=Math.pow(10,Math.max(E(t),E(e)));return(L(t,r)+L(e,r))/r})),I=F((function(t,e){var r=Math.pow(10,Math.max(E(t),E(e)));return(L(t,r)-L(e,r))/r})),B=F((function(t,e){var r=A(t),i=A(e);return P(r),P(i),L(r/i,M(Math.pow(10,E(e)-E(t))))}));var X=!0;e("e",{strip:M,plus:R,minus:I,times:L,divide:B,round:function(t,e){var r=Math.pow(10,e),i=B(Math.round(Math.abs(L(t,r))),r);return t<0&&0!==i&&(i=L(i,-1)),i},digitLength:E,float2Fixed:A,enableBoundaryChecking:function(t){void 0===t&&(t=!0),X=t}});function Y(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,i)}return r}function W(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Y(Object(r),!0).forEach((function(e){z(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Y(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function z(t,e,r){return(e=H(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function V(){return V=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},V.apply(this,arguments)}function G(t,e){if(null==t)return{};var r,i,n=function(t,e){if(null==t)return{};var r,i,n={},s=Object.keys(t);for(i=0;i<s.length;i++)r=s[i],e.indexOf(r)>=0||(n[r]=t[r]);return n}(t,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(i=0;i<s.length;i++)r=s[i],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function U(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function H(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}class N{constructor(){z(this,"browserShadowBlurConstant",1),z(this,"DPI",96),z(this,"devicePixelRatio",1),z(this,"perfLimitSizeTotal",2097152),z(this,"maxCacheSideLimit",4096),z(this,"minCacheSideLimit",256),z(this,"disableStyleCopyPaste",!1),z(this,"enableGLFiltering",!0),z(this,"textureSize",4096),z(this,"forceGLPutImageData",!1),z(this,"cachesBoundsOfCurve",!0),z(this,"fontPaths",{}),z(this,"NUM_FRACTION_DIGITS",4)}}var q=e("k",new class extends N{constructor(t){super(),this.configure(t)}configure(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.assign(this,t)}addFonts(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.fontPaths=W(W({},this.fontPaths),t)}removeFonts(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((t=>{delete this.fontPaths[t]}))}clearFonts(){this.fontPaths={}}restoreDefaults(t){var e=new N,r=(null==t?void 0:t.reduce(((t,r)=>(t[r]=e[r],t)),{}))||e;this.configure(r)}});class K{}class $ extends K{testPrecision(t,e){var r="precision ".concat(e," float;\nvoid main(){}"),i=t.createShader(t.FRAGMENT_SHADER);return!!i&&(t.shaderSource(i,r),t.compileShader(i),!!t.getShaderParameter(i,t.COMPILE_STATUS))}queryWebGL(t){var e=t.getContext("webgl");e&&(this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find((t=>this.testPrecision(e,t))),console.log("fabric: max texture size ".concat(this.maxTextureSize)))}isSupported(t){return!!this.maxTextureSize&&this.maxTextureSize>=t}}var Z,J={},Q=!1,tt=()=>(Q||(q.configure({devicePixelRatio:window.devicePixelRatio||1}),Z="ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,Q=!0),{document:document,window:window,isTouchSupported:Z,WebGLProbe:new $,dispose(){},copyPasteData:J}),et=()=>tt().document,rt=()=>tt().window;var it=new class{constructor(){z(this,"charWidthsCache",{}),z(this,"boundsOfCurveCache",{})}getFontCache(t){var e=t.fontFamily,r=t.fontStyle,i=t.fontWeight;e=e.toLowerCase(),this.charWidthsCache[e]||(this.charWidthsCache[e]={});var n=this.charWidthsCache[e],s="".concat(r.toLowerCase(),"_").concat((i+"").toLowerCase());return n[s]||(n[s]={}),n[s]}clearFontCache(t){(t=(t||"").toLowerCase())?this.charWidthsCache[t]&&delete this.charWidthsCache[t]:this.charWidthsCache={}}limitDimsByArea(t){var e=q.perfLimitSizeTotal,r=Math.sqrt(e*t);return[Math.floor(r),Math.floor(e/r)]}},nt="6.0.0-beta9";function st(){}var ot=Math.PI/2,at=2*Math.PI,ht=Math.PI/180,ct=e("m",Object.freeze([1,0,0,1,0,0])),lt=.4477152502,ut="center",ft="left",dt="top",gt="bottom",pt="right",vt="none",mt=/\r?\n/,_t="json",yt="svg";var xt=e("c",new class{constructor(){this[_t]=new Map,this[yt]=new Map}getClass(t){var e=this[_t].get(t);if(!e)throw new Error("No class registered for ".concat(t));return e}setClass(t,e){e?this[_t].set(e,t):(this[_t].set(t.type,t),this[_t].set(t.type.toLowerCase(),t))}getSVGClass(t){return this[yt].get(t)}setSVGClass(t,e){this[yt].set(null!=e?e:t.type.toLowerCase(),t)}});var bt=new class extends Array{remove(t){var e=this.indexOf(t);e>-1&&this.splice(e,1)}cancelAll(){var t=this.splice(0);return t.forEach((t=>t.abort())),t}cancelByCanvas(t){if(!t)return[];var e=this.filter((e=>{var r;return"object"==typeof e.target&&(null===(r=e.target)||void 0===r?void 0:r.canvas)===t}));return e.forEach((t=>t.abort())),e}cancelByTarget(t){if(!t)return[];var e=this.filter((e=>e.target===t));return e.forEach((t=>t.abort())),e}};class wt{constructor(){z(this,"__eventListeners",{})}on(t,e){if(this.__eventListeners||(this.__eventListeners={}),"object"==typeof t){for(var r in t)this.on(r,t[r]);return()=>this.off(t)}if(e){var i=t;return this.__eventListeners[i]||(this.__eventListeners[i]=[]),this.__eventListeners[i].push(e),()=>this.off(i,e)}return()=>!1}once(t,e){if("object"==typeof t){var r=[];for(var i in t)r.push(this.once(i,t[i]));return()=>r.forEach((t=>t()))}if(e){var n=this.on(t,(function(){e(...arguments),n()}));return n}return()=>!1}_removeEventListener(t,e){if(this.__eventListeners[t])if(e){var r=this.__eventListeners[t],i=r.indexOf(e);i>-1&&r.splice(i,1)}else this.__eventListeners[t]=[]}off(t,e){if(this.__eventListeners)if(void 0===t)for(var r in this.__eventListeners)this._removeEventListener(r);else if("object"==typeof t)for(var i in t)this._removeEventListener(i,t[i]);else this._removeEventListener(t,e)}fire(t,e){var r;if(this.__eventListeners){var i=null===(r=this.__eventListeners[t])||void 0===r?void 0:r.concat();if(i)for(var n=0;n<i.length;n++)i[n].call(this,e||{})}}}var Ct=(t,e)=>isNaN(t)&&"number"==typeof e?e:t,St=(t,e)=>{var r=t.indexOf(e);return-1!==r&&t.splice(r,1),t},Tt=t=>{if(0===t)return 1;switch(Math.abs(t)/ot){case 1:case 3:return 0;case 2:return-1}return Math.cos(t)},Ot=t=>{if(0===t)return 0;var e=t/ot,r=Math.sign(t);switch(e){case 1:return r;case 2:return 0;case 3:return-r}return Math.sin(t)};class kt{constructor(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}add(t){return new kt(this.x+t.x,this.y+t.y)}addEquals(t){return this.x+=t.x,this.y+=t.y,this}scalarAdd(t){return new kt(this.x+t,this.y+t)}scalarAddEquals(t){return this.x+=t,this.y+=t,this}subtract(t){return new kt(this.x-t.x,this.y-t.y)}subtractEquals(t){return this.x-=t.x,this.y-=t.y,this}scalarSubtract(t){return new kt(this.x-t,this.y-t)}scalarSubtractEquals(t){return this.x-=t,this.y-=t,this}multiply(t){return new kt(this.x*t.x,this.y*t.y)}scalarMultiply(t){return new kt(this.x*t,this.y*t)}scalarMultiplyEquals(t){return this.x*=t,this.y*=t,this}divide(t){return new kt(this.x/t.x,this.y/t.y)}scalarDivide(t){return new kt(this.x/t,this.y/t)}scalarDivideEquals(t){return this.x/=t,this.y/=t,this}eq(t){return this.x===t.x&&this.y===t.y}lt(t){return this.x<t.x&&this.y<t.y}lte(t){return this.x<=t.x&&this.y<=t.y}gt(t){return this.x>t.x&&this.y>t.y}gte(t){return this.x>=t.x&&this.y>=t.y}lerp(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return e=Math.max(Math.min(1,e),0),new kt(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)}distanceFrom(t){var e=this.x-t.x,r=this.y-t.y;return Math.sqrt(e*e+r*r)}midPointFrom(t){return this.lerp(t)}min(t){return new kt(Math.min(this.x,t.x),Math.min(this.y,t.y))}max(t){return new kt(Math.max(this.x,t.x),Math.max(this.y,t.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(t,e){return this.x=t,this.y=e,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setFromPoint(t){return this.x=t.x,this.y=t.y,this}swap(t){var e=this.x,r=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=r}clone(){return new kt(this.x,this.y)}rotate(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Dt,r=Ot(t),i=Tt(t),n=this.subtract(e);return new kt(n.x*i-n.y*r,n.x*r+n.y*i).add(e)}transform(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new kt(t[0]*this.x+t[2]*this.y+(e?0:t[4]),t[1]*this.x+t[3]*this.y+(e?0:t[5]))}}e("d",kt);var Dt=new kt(0,0);function Mt(t){class e extends t{constructor(){super(...arguments),z(this,"_objects",[])}_onObjectAdded(t){}_onObjectRemoved(t){}_onStackOrderChanged(t){}add(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var i=this._objects.push(...e);return e.forEach((t=>this._onObjectAdded(t))),i}insertAt(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return this._objects.splice(t,0,...r),r.forEach((t=>this._onObjectAdded(t))),this._objects.length}remove(){for(var t=this._objects,e=[],r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return i.forEach((r=>{var i=t.indexOf(r);-1!==i&&(t.splice(i,1),e.push(r),this._onObjectRemoved(r))})),e}forEachObject(t){this.getObjects().forEach(((e,r,i)=>t(e,r,i)))}getObjects(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return 0===e.length?[...this._objects]:this._objects.filter((t=>t.isType(...e)))}item(t){return this._objects[t]}isEmpty(){return 0===this._objects.length}size(){return this._objects.length}contains(t,r){return!!this._objects.includes(t)||!!r&&this._objects.some((r=>r instanceof e&&r.contains(t,!0)))}complexity(){return this._objects.reduce(((t,e)=>t+=e.complexity?e.complexity():0),0)}sendObjectToBack(t){return!(!t||t===this._objects[0])&&(St(this._objects,t),this._objects.unshift(t),this._onStackOrderChanged(t),!0)}bringObjectToFront(t){return!(!t||t===this._objects[this._objects.length-1])&&(St(this._objects,t),this._objects.push(t),this._onStackOrderChanged(t),!0)}sendObjectBackwards(t,e){if(!t)return!1;var r=this._objects.indexOf(t);if(0!==r){var i=this.findNewLowerIndex(t,r,e);return St(this._objects,t),this._objects.splice(i,0,t),this._onStackOrderChanged(t),!0}return!1}bringObjectForward(t,e){if(!t)return!1;var r=this._objects.indexOf(t);if(r!==this._objects.length-1){var i=this.findNewUpperIndex(t,r,e);return St(this._objects,t),this._objects.splice(i,0,t),this._onStackOrderChanged(t),!0}return!1}moveObjectTo(t,e){return t!==this._objects[e]&&(St(this._objects,t),this._objects.splice(e,0,t),this._onStackOrderChanged(t),!0)}findNewLowerIndex(t,e,r){var i;if(r){i=e;for(var n=e-1;n>=0;--n)if(t.isOverlapping(this._objects[n])){i=n;break}}else i=e-1;return i}findNewUpperIndex(t,e,r){var i;if(r){i=e;for(var n=e+1;n<this._objects.length;++n)if(t.isOverlapping(this._objects[n])){i=n;break}}else i=e+1;return i}collectObjects(t){for(var e=t.left,r=t.top,i=t.width,n=t.height,s=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).includeIntersecting,o=void 0===s||s,a=[],h=new kt(e,r),c=h.add(new kt(i,n)),l=this._objects.length-1;l>=0;l--){var u=this._objects[l];u.selectable&&u.visible&&(o&&u.intersectsWithRect(h,c,!0)||u.isContainedWithinRect(h,c,!0)||o&&u.containsPoint(h,void 0,!0)||o&&u.containsPoint(c,void 0,!0))&&a.push(u)}return a}}return e}class Et extends wt{_setOptions(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var e in t)this.set(e,t[e])}_setObject(t){for(var e in t)this._set(e,t[e])}set(t,e){return"object"==typeof t?this._setObject(t):this._set(t,e),this}_set(t,e){this[t]=e}toggle(t){var e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this}get(t){return this[t]}}function At(t){return rt().requestAnimationFrame(t)}function Pt(t){return rt().cancelAnimationFrame(t)}var jt=0,Ft=()=>jt++,Lt=()=>{var t=et().createElement("canvas");if(!t||void 0===t.getContext)throw new Error("Failed to create `canvas` element");return t},Rt=()=>et().createElement("img"),It=(t,e,r)=>t.toDataURL("image/".concat(e),r),Bt=t=>t*ht,Xt=t=>t/ht,Yt=["translateX","translateY","angle"],Wt=(t,e,r)=>new kt(t).transform(e,r),zt=t=>{var e=1/(t[0]*t[3]-t[1]*t[2]),r=[e*t[3],-e*t[1],-e*t[2],e*t[0],0,0],i=new kt(t[4],t[5]).transform(r,!0),n=i.x,s=i.y;return r[4]=-n,r[5]=-s,r},Vt=(t,e,r)=>[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],r?0:t[0]*e[4]+t[2]*e[5]+t[4],r?0:t[1]*e[4]+t[3]*e[5]+t[5]],Gt=(t,e)=>t.reduceRight(((t,r)=>r?Vt(r,t,e):t),ct),Ut=t=>{var e=Math.atan2(t[1],t[0]),r=Math.pow(t[0],2)+Math.pow(t[1],2),i=Math.sqrt(r),n=(t[0]*t[3]-t[2]*t[1])/i,s=Math.atan2(t[0]*t[2]+t[1]*t[3],r);return{angle:Xt(e),scaleX:i,scaleY:n,skewX:Xt(s),skewY:0,translateX:t[4]||0,translateY:t[5]||0}},Ht=function(t){return[1,0,0,1,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0]};function Nt(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).angle,e=void 0===t?0:t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.x,n=void 0===i?0:i,s=r.y,o=void 0===s?0:s,a=Bt(e),h=Tt(a),c=Ot(a);return[h,c,-c,h,n?n-(h*n-c*o):0,o?o-(c*n+h*o):0]}var qt=function(t){return[t,0,0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,0,0]},Kt=t=>Math.tan(Bt(t)),$t=t=>[1,0,Kt(t),1,0,0],Zt=t=>[1,Kt(t),0,1,0,0],Jt=t=>{var e=t.scaleX,r=void 0===e?1:e,i=t.scaleY,n=void 0===i?1:i,s=t.flipX,o=void 0!==s&&s,a=t.flipY,h=void 0!==a&&a,c=t.skewX,l=void 0===c?0:c,u=t.skewY,f=void 0===u?0:u;return Gt([qt(o?-r:r,h?-n:n),l&&$t(l),f&&Zt(f)],!0)},Qt=t=>{var e=t.translateX,r=void 0===e?0:e,i=t.translateY,n=void 0===i?0:i,s=t.angle,o=void 0===s?0:s,a=G(t,Yt);return Gt([Ht(r,n),o&&Nt({angle:o}),Jt(a)])},te=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.signal,i=e.crossOrigin,n=void 0===i?null:i;return new Promise((function(e,i){if(r&&r.aborted)return i(new Error("`options.signal` is in `aborted` state"));var s,o=Rt();r&&(s=function(t){o.src="",i(t)},r.addEventListener("abort",s,{once:!0}));var a=function(){o.onload=o.onerror=null,s&&(null==r||r.removeEventListener("abort",s)),e(o)};t?(o.onload=a,o.onerror=function(){s&&(null==r||r.removeEventListener("abort",s)),i(new Error("Error loading "+o.src))},n&&(o.crossOrigin=n),o.src=t):a()}))},ee=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.signal,i=e.reviver,n=void 0===i?st:i;return new Promise(((e,i)=>{var s=[];r&&r.addEventListener("abort",i,{once:!0}),Promise.all(t.map((t=>xt.getClass(t.type).fromObject(t,{signal:r,reviver:n}).then((e=>(n(t,e),s.push(e),e)))))).then(e).catch((t=>{s.forEach((function(t){t.dispose&&t.dispose()})),i(t)})).finally((()=>{r&&r.removeEventListener("abort",i)}))}))},re=function(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).signal;return new Promise(((r,i)=>{var n=[];e&&e.addEventListener("abort",i,{once:!0});var o=Object.values(t).map((t=>t?t.colorStops?new(xt.getClass("gradient"))(t):t.type?ee([t],{signal:e}).then((t=>{var e=s(t,1)[0];return n.push(e),e})):t.source?xt.getClass("pattern").fromObject(t,{signal:e}).then((t=>(n.push(t),t))):t:t)),a=Object.keys(t);Promise.all(o).then((t=>t.reduce(((t,e,r)=>(t[a[r]]=e,t)),{}))).then(r).catch((t=>{n.forEach((t=>{t.dispose&&t.dispose()})),i(t)})).finally((()=>{e&&e.removeEventListener("abort",i)}))}))},ie=function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).reduce(((e,r)=>(r in t&&(e[r]=t[r]),e)),{})},ne=(t,e)=>Object.keys(t).reduce(((r,i)=>(e(t[i],i,t)&&(r[i]=t[i]),r)),{}),se={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},oe=(t,e,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+(e-t)*(2/3-r)*6:t),ae=(t,e,r,i)=>{t/=255,e/=255,r/=255;var n,s,o=Math.max(t,e,r),a=Math.min(t,e,r),h=(o+a)/2;if(o===a)n=s=0;else{var c=o-a;switch(s=h>.5?c/(2-o-a):c/(o+a),o){case t:n=(e-r)/c+(e<r?6:0);break;case e:n=(r-t)/c+2;break;case r:n=(t-e)/c+4}n/=6}return[Math.round(360*n),Math.round(100*s),Math.round(100*h),i]},he=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1";return parseFloat(t)/(t.endsWith("%")?100:1)},ce=t=>Math.min(Math.round(t),255).toString(16).toUpperCase().padStart(2,"0"),le=t=>{var e=s(t,4),r=e[0],i=e[1],n=e[2],o=e[3],a=void 0===o?1:o,h=Math.round(.3*r+.59*i+.11*n);return[h,h,h,a]};class ue{constructor(t){if(t)if(t instanceof ue)this.setSource([...t._source]);else if(Array.isArray(t)){var e=s(t,4),r=e[0],i=e[1],n=e[2],o=e[3],a=void 0===o?1:o;this.setSource([r,i,n,a])}else this.setSource(this._tryParsingColor(t));else this.setSource([0,0,0,1])}_tryParsingColor(t){return t in se&&(t=se[t]),"transparent"===t?[255,255,255,0]:ue.sourceFromHex(t)||ue.sourceFromRgb(t)||ue.sourceFromHsl(t)||[0,0,0,1]}getSource(){return this._source}setSource(t){this._source=t}toRgb(){var t=s(this.getSource(),3),e=t[0],r=t[1],i=t[2];return"rgb(".concat(e,",").concat(r,",").concat(i,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){var t=s(ae(...this.getSource()),3),e=t[0],r=t[1],i=t[2];return"hsl(".concat(e,",").concat(r,"%,").concat(i,"%)")}toHsla(){var t=s(ae(...this.getSource()),4),e=t[0],r=t[1],i=t[2],n=t[3];return"hsla(".concat(e,",").concat(r,"%,").concat(i,"%,").concat(n,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){var t=s(this.getSource(),4),e=t[0],r=t[1],i=t[2],n=t[3];return"".concat(ce(e)).concat(ce(r)).concat(ce(i)).concat(ce(Math.round(255*n)))}getAlpha(){return this.getSource()[3]}setAlpha(t){return this._source[3]=t,this}toGrayscale(){return this.setSource(le(this.getSource())),this}toBlackWhite(t){var e=s(le(this.getSource()),4),r=e[0],i=e[3],n=r<(t||127)?0:255;return this.setSource([n,n,n,i]),this}overlayWith(t){t instanceof ue||(t=new ue(t));var e=this.getSource(),r=t.getSource(),i=e.map(((t,e)=>Math.round(.5*t+.5*r[e]))),n=s(i,3),o=n[0],a=n[1],h=n[2];return this.setSource([o,a,h,e[3]]),this}static fromRgb(t){return ue.fromRgba(t)}static fromRgba(t){return new ue(ue.sourceFromRgb(t))}static sourceFromRgb(t){var e=t.match(/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i);if(e){var r=s(e.slice(1,4).map((t=>{var e=parseFloat(t);return t.endsWith("%")?Math.round(2.55*e):e})),3);return[r[0],r[1],r[2],he(e[4])]}}static fromHsl(t){return ue.fromHsla(t)}static fromHsla(t){return new ue(ue.sourceFromHsl(t))}static sourceFromHsl(t){var e=t.match(/^hsla?\(\s*([+-]?\d{1,3})\s*[\s|,]\s*(\d{1,3}%)\s*[\s|,]\s*(\d{1,3}%)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i);if(e){var r,i,n,s=(parseFloat(e[1])%360+360)%360/360,o=parseFloat(e[2])/100,a=parseFloat(e[3])/100;if(0===o)r=i=n=a;else{var h=a<=.5?a*(o+1):a+o-a*o,c=2*a-h;r=oe(c,h,s+1/3),i=oe(c,h,s),n=oe(c,h,s-1/3)}return[Math.round(255*r),Math.round(255*i),Math.round(255*n),he(e[4])]}}static fromHex(t){return new ue(ue.sourceFromHex(t))}static sourceFromHex(t){if(t.match(/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i)){var e=t.slice(t.indexOf("#")+1),r=s((e.length<=4?e.split("").map((t=>t+t)):e.match(/.{2}/g)).map((t=>parseInt(t,16))),4),i=r[0],n=r[1],o=r[2],a=r[3];return[i,n,o,(void 0===a?255:a)/255]}}}e("p",ue);var fe=(t,e)=>parseFloat(Number(t).toFixed(e)),de=(t,e)=>{var r=/\D{0,2}$/.exec(t),i=parseFloat(t);e||(e=16);var n=q.DPI;switch(null==r?void 0:r[0]){case"mm":return i*n/25.4;case"cm":return i*n/2.54;case"in":return i*n;case"pt":return i*n/72;case"pc":return i*n/72*12;case"em":return i*e;default:return i}},ge=t=>{var e,r=s(t.trim().split(" "),2),i=r[0],n=r[1],o=s((e=i)&&e!==vt?[e.slice(1,4),e.slice(5,8)]:e===vt?[e,e]:["Mid","Mid"],2);return{meetOrSlice:n||"meet",alignX:o[0],alignY:o[1]}},pe=t=>"matrix("+t.map((t=>fe(t,q.NUM_FRACTION_DIGITS))).join(" ")+")",ve=(t,e)=>{if(e){if(e.toLive)return"".concat(t,": url(#SVGID_").concat(e.id,"); ");var r=new ue(e),i=r.getAlpha(),n="".concat(t,": ").concat(r.toRgb(),"; ");return 1!==i&&(n+="".concat(t,"-opacity: ").concat(i.toString(),"; ")),n}return"".concat(t,": none; ")},me=t=>!!t&&void 0!==t.toLive,_e=t=>!!t&&"function"==typeof t.toObject,ye=t=>!!t&&void 0!==t.offsetX&&void 0!==t.source,xe=t=>!!t&&Array.isArray(t._objects),be=t=>!!t&&t.isType("Text","IText","Textbox"),we=t=>!!t&&t.isType("IText","Textbox"),Ce=t=>!!t&&"function"==typeof t.onDragStart&&"function"==typeof t.shouldStartDragging;function Se(t){for(var e=0,r=0,i=Te(t),n=i.documentElement,s=i.body||{scrollLeft:0,scrollTop:0};t&&(t.parentNode||t.host)&&((t=t.parentNode||t.host)===i?(e=s.scrollLeft||n.scrollLeft||0,r=s.scrollTop||n.scrollTop||0):(e+=t.scrollLeft||0,r+=t.scrollTop||0),1!==t.nodeType||"fixed"!==t.style.position););return{left:e,top:r}}var Te=t=>t.ownerDocument||null,Oe=t=>{var e;return(null===(e=t.ownerDocument)||void 0===e?void 0:e.defaultView)||null};function ke(t,e){var r=t.style;r&&("string"==typeof e?t.style.cssText+=";"+e:Object.entries(e).forEach((t=>{var e=s(t,2),i=e[0],n=e[1];return r.setProperty(i,n)})))}var De=function(t,e,r){var i=r.width,n=r.height,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t.width=i,t.height=n,s>1&&(t.setAttribute("width",(i*s).toString()),t.setAttribute("height",(n*s).toString()),e.scale(s,s))};var Me=(t,e)=>{var r=e.width,i=e.height;r&&(t.style.width="number"==typeof r?"".concat(r,"px"):r),i&&(t.style.height="number"==typeof i?"".concat(i,"px"):i)};function Ee(t){return void 0!==t.onselectstart&&(t.onselectstart=()=>!1),t.style.userSelect=vt,t}class Ae{constructor(t){z(this,"_originalCanvasStyle",void 0),z(this,"lower",void 0);var e=this.createLowerCanvas(t);this.lower={el:e,ctx:e.getContext("2d")}}createLowerCanvas(t){var e,r=(e=t)&&void 0!==e.getContext?t:et().getElementById(t)||Lt();if(r.hasAttribute("data-fabric"))throw new Error("fabric.js: trying to initialize a canvas that has already been initialized");return this._originalCanvasStyle=r.style.cssText,r.setAttribute("data-fabric","main"),r.classList.add("lower-canvas"),r}cleanupDOM(t){var e=t.width,r=t.height,i=this.lower.el;i.classList.remove("lower-canvas"),i.removeAttribute("data-fabric"),i.setAttribute("width","".concat(e)),i.setAttribute("height","".concat(r)),i.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(t,e){var r=this.lower,i=r.el,n=r.ctx;De(i,n,t,e)}setCSSDimensions(t){Me(this.lower.el,t)}calcOffset(){return function(t){var e,r={left:0,top:0},i=t&&Te(t),n={left:0,top:0},s={borderLeftWidth:ft,borderTopWidth:dt,paddingLeft:ft,paddingTop:dt};if(!i)return n;var o=(null===(e=Oe(t))||void 0===e?void 0:e.getComputedStyle(t,null))||{};for(var a in s)n[s[a]]+=parseInt(o[a],10)||0;var h=i.documentElement;void 0!==t.getBoundingClientRect&&(r=t.getBoundingClientRect());var c=Se(t);return{left:r.left+c.left-(h.clientLeft||0)+n.left,top:r.top+c.top-(h.clientTop||0)+n.top}}(this.lower.el)}dispose(){tt().dispose(this.lower.el),delete this.lower}}var Pe={backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:ct.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,svgViewportTransformation:!0,skipOffscreen:!0,clipPath:void 0};class je extends(Mt(Et)){get lowerCanvasEl(){var t;return null===(t=this.elements.lower)||void 0===t?void 0:t.el}get contextContainer(){var t;return null===(t=this.elements.lower)||void 0===t?void 0:t.ctx}static getDefaults(){return je.ownDefaults}constructor(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(e),this.initElements(t),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(t){this.elements=new Ae(t)}add(){var t=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}insertAt(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];var n=super.insertAt(t,...r);return r.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),n}remove(){var t=super.remove(...arguments);return t.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}_onObjectAdded(t){t.canvas&&t.canvas!==this&&(console.warn("fabric.Canvas: trying to add an object that belongs to a different canvas.\nResulting to default behavior: removing object from previous canvas and adding to new canvas"),t.canvas.remove(t)),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t){t._set("canvas",void 0),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}_isRetinaScaling(){return q.devicePixelRatio>1&&this.enableRetinaScaling}getRetinaScaling(){return this._isRetinaScaling()?Math.max(1,q.devicePixelRatio):1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(t,e){return this.setDimensions({width:t},e)}setHeight(t,e){return this.setDimensions({height:t},e)}_setDimensionsImpl(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.cssOnly,i=void 0!==r&&r,n=e.backstoreOnly,s=void 0!==n&&n;if(!i){var o=W({width:this.width,height:this.height},t);this.elements.setDimensions(o,this.getRetinaScaling()),this.hasLostContext=!0,this.width=o.width,this.height=o.height}s||this.elements.setCSSDimensions(t),this.calcOffset()}setDimensions(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.cssOnly,i=void 0!==r&&r,n=e.backstoreOnly,s=void 0!==n&&n;this._setDimensionsImpl(t,{cssOnly:i,backstoreOnly:s}),i||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(t){var e=this.backgroundImage,r=this.overlayImage,i=this._objects.length;this.viewportTransform=t;for(var n=0;n<i;n++){var s=this._objects[n];s.group||s.setCoords()}e&&e.setCoords(),r&&r.setCoords(),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(t,e){var r=t,i=[...this.viewportTransform],n=Wt(t,zt(i));i[0]=e,i[3]=e;var s=Wt(n,i);i[4]+=r.x-s.x,i[5]+=r.y-s.y,this.setViewportTransform(i)}setZoom(t){this.zoomToPoint(new kt(0,0),t)}absolutePan(t){var e=[...this.viewportTransform];return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)}relativePan(t){return this.absolutePan(new kt(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(t){t.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),this.destroyed||this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){this.nextRenderHandle||this.disposed||this.destroyed||(this.nextRenderHandle=At((()=>this.renderAndReset())))}calcViewportBoundaries(){var t=this.width,e=this.height,r=zt(this.viewportTransform),i=Wt({x:0,y:0},r),n=Wt({x:t,y:e},r),s=i.min(n),o=i.max(n);return this.vptCoords={tl:s,tr:new kt(o.x,s.y),bl:new kt(s.x,o.y),br:o}}cancelRequestedRender(){this.nextRenderHandle&&(Pt(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(t){}renderCanvas(t,e){if(!this.destroyed){var r=this.viewportTransform,i=this.clipPath;this.calcViewportBoundaries(),this.clearContext(t),t.imageSmoothingEnabled=this.imageSmoothingEnabled,t.patternQuality="best",this.fire("before:render",{ctx:t}),this._renderBackground(t),t.save(),t.transform(r[0],r[1],r[2],r[3],r[4],r[5]),this._renderObjects(t,e),t.restore(),this.controlsAboveOverlay||this.drawControls(t),i&&(i._set("canvas",this),i.shouldCache(),i._transformDone=!0,i.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t,i)),this._renderOverlay(t),this.controlsAboveOverlay&&this.drawControls(t),this.fire("after:render",{ctx:t}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}}drawClipPathOnCanvas(t,e){var r=this.viewportTransform;t.save(),t.transform(...r),t.globalCompositeOperation="destination-in",e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}_renderObjects(t,e){for(var r=0,i=e.length;r<i;++r)e[r]&&e[r].render(t)}_renderBackgroundOrOverlay(t,e){var r=this["".concat(e,"Color")],i=this["".concat(e,"Image")],n=this.viewportTransform,s=this["".concat(e,"Vpt")];if(r||i){var o=me(r);if(r){if(t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.fillStyle=o?r.toLive(t):r,s&&t.transform(...n),o){t.transform(1,0,0,1,r.offsetX||0,r.offsetY||0);var a=r.gradientTransform||r.patternTransform;a&&t.transform(...a)}t.fill(),t.restore()}if(i){t.save();var h=this.skipOffscreen;this.skipOffscreen=s,s&&t.transform(...n),i.render(t),this.skipOffscreen=h,t.restore()}}}_renderBackground(t){this._renderBackgroundOrOverlay(t,"background")}_renderOverlay(t){this._renderBackgroundOrOverlay(t,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new kt(this.width/2,this.height/2)}centerObjectH(t){return this._centerObject(t,new kt(this.getCenterPoint().x,t.getCenterPoint().y))}centerObjectV(t){return this._centerObject(t,new kt(t.getCenterPoint().x,this.getCenterPoint().y))}centerObject(t){return this._centerObject(t,this.getCenterPoint())}viewportCenterObject(t){return this._centerObject(t,this.getVpCenter())}viewportCenterObjectH(t){return this._centerObject(t,new kt(this.getVpCenter().x,t.getCenterPoint().y))}viewportCenterObjectV(t){return this._centerObject(t,new kt(t.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return Wt(this.getCenterPoint(),zt(this.viewportTransform))}_centerObject(t,e){t.setXY(e,ut,ut),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(t){return this.toDatalessObject(t)}toObject(t){return this._toObjectMethod("toObject",t)}toJSON(){return this.toObject()}toDatalessObject(t){return this._toObjectMethod("toDatalessObject",t)}_toObjectMethod(t,e){var r=this.clipPath,i=r&&!r.excludeFromExport?this._toObject(r,t,e):null;return W(W(W({version:nt},ie(this,e)),{},{objects:this._objects.filter((t=>!t.excludeFromExport)).map((r=>this._toObject(r,t,e)))},this.__serializeBgOverlay(t,e)),i?{clipPath:i}:null)}_toObject(t,e,r){var i;this.includeDefaultValues||(i=t.includeDefaultValues,t.includeDefaultValues=!1);var n=t[e](r);return this.includeDefaultValues||(t.includeDefaultValues=!!i),n}__serializeBgOverlay(t,e){var r={},i=this.backgroundImage,n=this.overlayImage,s=this.backgroundColor,o=this.overlayColor;return me(s)?s.excludeFromExport||(r.background=s.toObject(e)):s&&(r.background=s),me(o)?o.excludeFromExport||(r.overlay=o.toObject(e)):o&&(r.overlay=o),i&&!i.excludeFromExport&&(r.backgroundImage=this._toObject(i,t,e)),n&&!n.excludeFromExport&&(r.overlayImage=this._toObject(n,t,e)),r}toSVG(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;t.reviver=e;var r=[];return this._setSVGPreamble(r,t),this._setSVGHeader(r,t),this.clipPath&&r.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,')" >\n')),this._setSVGBgOverlayColor(r,"background"),this._setSVGBgOverlayImage(r,"backgroundImage",e),this._setSVGObjects(r,e),this.clipPath&&r.push("</g>\n"),this._setSVGBgOverlayColor(r,"overlay"),this._setSVGBgOverlayImage(r,"overlayImage",e),r.push("</svg>"),r.join("")}_setSVGPreamble(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')}_setSVGHeader(t,e){var r,i=e.width||"".concat(this.width),n=e.height||"".concat(this.height),s=q.NUM_FRACTION_DIGITS,o=e.viewBox;if(o)r='viewBox="'.concat(o.x," ").concat(o.y," ").concat(o.width," ").concat(o.height,'" ');else if(this.svgViewportTransformation){var a=this.viewportTransform;r='viewBox="'.concat(fe(-a[4]/a[0],s)," ").concat(fe(-a[5]/a[3],s)," ").concat(fe(this.width/a[0],s)," ").concat(fe(this.height/a[3],s),'" ')}else r='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',i,'" ','height="',n,'" ',r,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",nt,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(e),"</defs>\n")}createSVGClipPathMarkup(t){var e=this.clipPath;return e?(e.clipPathId="CLIPPATH_".concat(Ft()),'<clipPath id="'+e.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(t.reviver)+"</clipPath>\n"):""}createSVGRefElementsMarkup(){return["background","overlay"].map((t=>{var e=this["".concat(t,"Color")];if(me(e)){var r=this["".concat(t,"Vpt")],i=this.viewportTransform,n={width:this.width/(r?i[0]:1),height:this.height/(r?i[3]:1)};return e.toSVG(n,{additionalTransform:r?pe(i):""})}})).join("")}createSVGFontFacesMarkup(){var t=[],e={},r=q.fontPaths;this._objects.forEach((function e(r){t.push(r),xe(r)&&r._objects.forEach(e)})),t.forEach((t=>{if(be(t)){var i=t.styles,n=t.fontFamily;!e[n]&&r[n]&&(e[n]=!0,i&&Object.values(i).forEach((t=>{Object.values(t).forEach((t=>{var i=t.fontFamily,n=void 0===i?"":i;!e[n]&&r[n]&&(e[n]=!0)}))})))}}));var i=Object.keys(e).map((t=>"\t\t@font-face {\n\t\t\tfont-family: '".concat(t,"';\n\t\t\tsrc: url('").concat(r[t],"');\n\t\t}\n"))).join("");return i?'\t<style type="text/css"><![CDATA[\n'.concat(i,"]]></style>\n"):""}_setSVGObjects(t,e){this.forEachObject((r=>{r.excludeFromExport||this._setSVGObject(t,r,e)}))}_setSVGObject(t,e,r){t.push(e.toSVG(r))}_setSVGBgOverlayImage(t,e,r){var i=this[e];i&&!i.excludeFromExport&&i.toSVG&&t.push(i.toSVG(r))}_setSVGBgOverlayColor(t,e){var r=this["".concat(e,"Color")];if(r)if(me(r)){var i=r.repeat||"",n=this.width,s=this.height,o=this["".concat(e,"Vpt")]?pe(zt(this.viewportTransform)):"";t.push('<rect transform="'.concat(o," translate(").concat(n/2,",").concat(s/2,')" x="').concat(r.offsetX-n/2,'" y="').concat(r.offsetY-s/2,'" width="').concat("repeat-y"!==i&&"no-repeat"!==i||!ye(r)?n:r.source.width,'" height="').concat("repeat-x"!==i&&"no-repeat"!==i||!ye(r)?s:r.source.height,'" fill="url(#SVGID_').concat(r.id,')"></rect>\n'))}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',r,'"',"></rect>\n")}loadFromJSON(t,e){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).signal;if(!t)return Promise.reject(new Error("fabric.js: `json` is undefined"));var i="string"==typeof t?JSON.parse(t):t,n=i.objects,o=void 0===n?[]:n,a=i.backgroundImage,h=i.background,c=i.overlayImage,l=i.overlay,u=i.clipPath,f=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([ee(o,{reviver:e,signal:r}),re({backgroundImage:a,backgroundColor:h,overlayImage:c,overlayColor:l,clipPath:u},{signal:r})]).then((t=>{var e=s(t,2),r=e[0],n=e[1];return this.clear(),this.add(...r),this.set(i),this.set(n),this.renderOnAddRemove=f,this}))}clone(t){var e=this.toObject(t);return this.cloneWithoutData().loadFromJSON(e)}cloneWithoutData(){var t=Lt();return t.width=this.width,t.height=this.height,new this.constructor(t)}toDataURL(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.format,r=void 0===e?"png":e,i=t.quality,n=void 0===i?1:i,s=t.multiplier,o=void 0===s?1:s,a=t.enableRetinaScaling,h=o*(void 0!==a&&a?this.getRetinaScaling():1);return It(this.toCanvasElement(h,t),r,n)}toCanvasElement(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.width,i=e.height,n=e.left,s=e.top,o=e.filter,a=(r||this.width)*t,h=(i||this.height)*t,c=this.getZoom(),l=this.width,u=this.height,f=c*t,d=this.viewportTransform,g=[f,0,0,f,(d[4]-(n||0))*t,(d[5]-(s||0))*t],p=this.enableRetinaScaling,v=Lt(),m=o?this._objects.filter((t=>o(t))):this._objects;return v.width=a,v.height=h,this.enableRetinaScaling=!1,this.viewportTransform=g,this.width=a,this.height=h,this.calcViewportBoundaries(),this.renderCanvas(v.getContext("2d"),m),this.viewportTransform=d,this.width=l,this.height=u,this.calcViewportBoundaries(),this.enableRetinaScaling=p,v}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),this.disposed=!0,new Promise(((t,e)=>{var r=()=>{this.destroy(),t(!0)};r.kill=e,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?t(!1):this.nextRenderHandle?this.__cleanupTask=r:r()}))}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject((t=>t.dispose())),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=null,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}}e("S",je),z(je,"ownDefaults",Pe);var Fe=["touchstart","touchmove","touchend"];var Le=t=>{var e=Se(t.target),r=function(t){var e=t.changedTouches;return e&&e[0]?e[0]:t}(t);return new kt(r.clientX+e.left,r.clientY+e.top)},Re=t=>Fe.indexOf(t.type)>-1||"touch"===t.pointerType,Ie=t=>{t.preventDefault(),t.stopPropagation()},Be=t=>{if(0===t.length)return{left:0,top:0,width:0,height:0};var e=t.reduce(((t,e)=>{var r=t.min,i=t.max;return{min:r.min(e),max:i.max(e)}}),{min:new kt(t[0]),max:new kt(t[0])}),r=e.min,i=e.max.subtract(r);return{left:r.x,top:r.y,width:i.x,height:i.y}},Xe=["translateX","translateY","scaleX","scaleY"],Ye=(t,e)=>We(t,Vt(e,t.calcOwnMatrix())),We=(t,e)=>{var r=Ut(e),i=r.translateX,n=r.translateY,s=r.scaleX,o=r.scaleY,a=G(r,Xe),h=new kt(i,n);t.flipX=!1,t.flipY=!1,Object.assign(t,a),t.set({scaleX:s,scaleY:o}),t.setPositionByOrigin(h,ut,ut)},ze=t=>{t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.rotate(0)},Ve=t=>({scaleX:t.scaleX,scaleY:t.scaleY,skewX:t.skewX,skewY:t.skewY,angle:t.angle,left:t.left,flipX:t.flipX,flipY:t.flipY,top:t.top}),Ge=(t,e,r)=>{var i=t/2,n=e/2,s=Jt(r),o=[new kt(-i,-n),new kt(i,-n),new kt(-i,n),new kt(i,n)].map((t=>t.transform(s))),a=Be(o);return new kt(a.width,a.height)},Ue=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ct;return Vt(zt(arguments.length>1&&void 0!==arguments[1]?arguments[1]:ct),t)},He=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ct,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ct;return t.transform(Ue(e,r))},Ne=(t,e,r)=>{var i=Ue(e,r);return We(t,Vt(i,t.calcOwnMatrix())),i},qe=(t,e)=>{var r,i=e.transform.target;null===(r=i.canvas)||void 0===r||r.fire("object:".concat(t),W(W({},e),{},{target:i})),i.fire(t,e)},Ke={left:-.5,top:-.5,center:0,bottom:.5,right:.5},$e=t=>"string"==typeof t?Ke[t]:t-.5,Ze="not-allowed";function Je(t){return t.originX===ut&&t.originY===ut}function Qe(t){return.5-$e(t)}var tr=(t,e)=>t[e],er=(t,e,r,i)=>({e:t,transform:e,pointer:new kt(r,i)});function rr(t,e){var r=t.getTotalAngle()+Xt(Math.atan2(e.y,e.x))+360;return Math.round(r%360/45)}function ir(t,e,r,i,n){var s,o=t.target,a=t.corner,h=o.controls[a],c=(null===(s=o.canvas)||void 0===s?void 0:s.getZoom())||1,l=o.padding/c,u=function(t,e,r,i){var n=t.getRelativeCenterPoint(),s=void 0!==r&&void 0!==i?t.translateToGivenOrigin(n,ut,ut,r,i):new kt(t.left,t.top);return(t.angle?e.rotate(-Bt(t.angle),n):e).subtract(s)}(o,new kt(i,n),e,r);return u.x>=l&&(u.x-=l),u.x<=-l&&(u.x+=l),u.y>=l&&(u.y-=l),u.y<=l&&(u.y+=l),u.x-=h.offsetX,u.y-=h.offsetY,u}var nr=(t,e,r,i)=>{var n=e.target,s=r-e.offsetX,o=i-e.offsetY,a=!tr(n,"lockMovementX")&&n.left!==s,h=!tr(n,"lockMovementY")&&n.top!==o;return a&&n.set(ft,s),h&&n.set(dt,o),(a||h)&&qe("moving",er(t,e,r,i)),a||h};class sr{getSvgStyles(t){var e=this.fillRule?this.fillRule:"nonzero",r=this.strokeWidth?this.strokeWidth:"0",i=this.strokeDashArray?this.strokeDashArray.join(" "):vt,n=this.strokeDashOffset?this.strokeDashOffset:"0",s=this.strokeLineCap?this.strokeLineCap:"butt",o=this.strokeLineJoin?this.strokeLineJoin:"miter",a=this.strokeMiterLimit?this.strokeMiterLimit:"4",h=void 0!==this.opacity?this.opacity:"1",c=this.visible?"":" visibility: hidden;",l=t?"":this.getSvgFilter(),u=ve("fill",this.fill);return[ve("stroke",this.stroke),"stroke-width: ",r,"; ","stroke-dasharray: ",i,"; ","stroke-linecap: ",s,"; ","stroke-dashoffset: ",n,"; ","stroke-linejoin: ",o,"; ","stroke-miterlimit: ",a,"; ",u,"fill-rule: ",e,"; ","opacity: ",h,";",l,c].join("")}getSvgSpanStyles(t,e){var r="; ",i=t.fontFamily?"font-family: ".concat(-1===t.fontFamily.indexOf("'")&&-1===t.fontFamily.indexOf('"')?"'".concat(t.fontFamily,"'"):t.fontFamily).concat(r):"",n=t.strokeWidth?"stroke-width: ".concat(t.strokeWidth).concat(r):"",s=t.fontSize?"font-size: ".concat(t.fontSize,"px").concat(r):"",o=t.fontStyle?"font-style: ".concat(t.fontStyle).concat(r):"",a=t.fontWeight?"font-weight: ".concat(t.fontWeight).concat(r):"",h=t.fill?ve("fill",t.fill):"",c=t.stroke?ve("stroke",t.stroke):"",l=this.getSvgTextDecoration(t),u=t.deltaY?"baseline-shift: ".concat(-t.deltaY,"; "):"";return[c,n,i,s,o,a,l?"text-decoration: ".concat(l).concat(r):l,h,u,e?"white-space: pre; ":""].join("")}getSvgTextDecoration(t){return["overline","underline","line-through"].filter((e=>t[e.replace("-","")])).join(" ")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=t?this.calcTransformMatrix():this.calcOwnMatrix(),i='transform="'.concat(pe(r));return"".concat(i).concat(e,'" ')}toSVG(t){return this._createBaseSVGMarkup(this._toSVG(t),{reviver:t})}toClipPathSVG(t){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(t),{reviver:t})}_createBaseClipPathSVGMarkup(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.reviver,i=e.additionalTransform,n=void 0===i?"":i,s=[this.getSvgTransform(!0,n),this.getSvgCommons()].join(""),o=t.indexOf("COMMON_PARTS");return t[o]=s,r?r(t.join("")):t.join("")}_createBaseSVGMarkup(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.noStyle,n=r.reviver,s=r.withShadow,o=r.additionalTransform,a=i?"":'style="'.concat(this.getSvgStyles(),'" '),h=s?'style="'.concat(this.getSvgFilter(),'" '):"",c=this.clipPath,l=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",u=c&&c.absolutePositioned,f=this.stroke,d=this.fill,g=this.shadow,p=[],v=t.indexOf("COMMON_PARTS");c&&(c.clipPathId="CLIPPATH_".concat(Ft()),e='<clipPath id="'.concat(c.clipPathId,'" >\n').concat(c.toClipPathSVG(n),"</clipPath>\n")),u&&p.push("<g ",h,this.getSvgCommons()," >\n"),p.push("<g ",this.getSvgTransform(!1),u?"":h+this.getSvgCommons()," >\n");var m=[a,l,i?"":this.addPaintOrder()," ",o?'transform="'.concat(o,'" '):""].join("");return t[v]=m,d&&d.toLive&&p.push(d.toSVG(this)),f&&f.toLive&&p.push(f.toSVG(this)),g&&p.push(g.toSVG(this)),c&&p.push(e),p.push(t.join("")),p.push("</g>\n"),u&&p.push("</g>\n"),n?n(p.join("")):p.join("")}addPaintOrder(){return"fill"!==this.paintFirst?' paint-order="'.concat(this.paintFirst,'" '):""}}var or=(t,e,r,i)=>(t<Math.abs(e)?(t=e,i=r/4):i=0===e&&0===t?r/at*Math.asin(1):r/at*Math.asin(e/t),{a:t,c:e,p:r,s:i}),ar=(t,e,r,i,n)=>t*Math.pow(2,10*(i-=1))*Math.sin((i*n-e)*at/r),hr=(t,e,r,i)=>-r*Math.cos(t/i*ot)+r+e,cr=(t,e,r,i)=>(t/=i)<1/2.75?r*(7.5625*t*t)+e:t<2/2.75?r*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?r*(7.5625*(t-=2.25/2.75)*t+.9375)+e:r*(7.5625*(t-=2.625/2.75)*t+.984375)+e,lr=(t,e,r,i)=>r-cr(i-t,0,r,i)+e,ur=Object.freeze({__proto__:null,defaultEasing:hr,easeInBack:function(t,e,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return r*(t/=i)*t*((n+1)*t-n)+e},easeInBounce:lr,easeInCirc:(t,e,r,i)=>-r*(Math.sqrt(1-(t/=i)*t)-1)+e,easeInCubic:(t,e,r,i)=>r*Math.pow(t/i,3)+e,easeInElastic:(t,e,r,i)=>{var n=0;if(0===t)return e;if(1===(t/=i))return e+r;n||(n=.3*i);var s=or(r,r,n,1.70158),o=s.a,a=s.s,h=s.p;return-ar(o,a,h,t,i)+e},easeInExpo:(t,e,r,i)=>0===t?e:r*Math.pow(2,10*(t/i-1))+e,easeInOutBack:function(t,e,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return(t/=i/2)<1?r/2*(t*t*((1+(n*=1.525))*t-n))+e:r/2*((t-=2)*t*((1+(n*=1.525))*t+n)+2)+e},easeInOutBounce:(t,e,r,i)=>t<i/2?.5*lr(2*t,0,r,i)+e:.5*cr(2*t-i,0,r,i)+.5*r+e,easeInOutCirc:(t,e,r,i)=>(t/=i/2)<1?-r/2*(Math.sqrt(1-Math.pow(t,2))-1)+e:r/2*(Math.sqrt(1-(t-=2)*t)+1)+e,easeInOutCubic:(t,e,r,i)=>(t/=i/2)<1?r/2*Math.pow(t,3)+e:r/2*(Math.pow(t-2,3)+2)+e,easeInOutElastic:(t,e,r,i)=>{var n=0;if(0===t)return e;if(2===(t/=i/2))return e+r;n||(n=i*(.3*1.5));var s=or(r,r,n,1.70158),o=s.a,a=s.s,h=s.p,c=s.c;return t<1?-.5*ar(o,a,h,t,i)+e:o*Math.pow(2,-10*(t-=1))*Math.sin((t*i-a)*at/h)*.5+c+e},easeInOutExpo:(t,e,r,i)=>0===t?e:t===i?e+r:(t/=i/2)<1?r/2*Math.pow(2,10*(t-1))+e:r/2*-(Math.pow(2,-10*--t)+2)+e,easeInOutQuad:(t,e,r,i)=>(t/=i/2)<1?r/2*Math.pow(t,2)+e:-r/2*(--t*(t-2)-1)+e,easeInOutQuart:(t,e,r,i)=>(t/=i/2)<1?r/2*Math.pow(t,4)+e:-r/2*((t-=2)*Math.pow(t,3)-2)+e,easeInOutQuint:(t,e,r,i)=>(t/=i/2)<1?r/2*Math.pow(t,5)+e:r/2*(Math.pow(t-2,5)+2)+e,easeInOutSine:(t,e,r,i)=>-r/2*(Math.cos(Math.PI*t/i)-1)+e,easeInQuad:(t,e,r,i)=>r*(t/=i)*t+e,easeInQuart:(t,e,r,i)=>r*(t/=i)*Math.pow(t,3)+e,easeInQuint:(t,e,r,i)=>r*Math.pow(t/i,5)+e,easeInSine:(t,e,r,i)=>-r*Math.cos(t/i*ot)+r+e,easeOutBack:function(t,e,r,i){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1.70158;return r*((t=t/i-1)*t*((n+1)*t+n)+1)+e},easeOutBounce:cr,easeOutCirc:(t,e,r,i)=>r*Math.sqrt(1-(t=t/i-1)*t)+e,easeOutCubic:(t,e,r,i)=>r*(Math.pow(t/i-1,3)+1)+e,easeOutElastic:(t,e,r,i)=>{var n=0;if(0===t)return e;if(1===(t/=i))return e+r;n||(n=.3*i);var s=or(r,r,n,1.70158),o=s.a,a=s.s,h=s.p,c=s.c;return o*Math.pow(2,-10*t)*Math.sin((t*i-a)*at/h)+c+e},easeOutExpo:(t,e,r,i)=>t===i?e+r:r*-(Math.pow(2,-10*t/i)+1)+e,easeOutQuad:(t,e,r,i)=>-r*(t/=i)*(t-2)+e,easeOutQuart:(t,e,r,i)=>-r*((t=t/i-1)*Math.pow(t,3)-1)+e,easeOutQuint:(t,e,r,i)=>r*(Math.pow(t/i-1,5)+1)+e,easeOutSine:(t,e,r,i)=>r*Math.sin(t/i*ot)+e}),fr=()=>!1;class dr{constructor(t){var e=t.startValue,r=t.byValue,i=t.duration,n=void 0===i?500:i,s=t.delay,o=void 0===s?0:s,a=t.easing,h=void 0===a?hr:a,c=t.onStart,l=void 0===c?st:c,u=t.onChange,f=void 0===u?st:u,d=t.onComplete,g=void 0===d?st:d,p=t.abort,v=void 0===p?fr:p,m=t.target;z(this,"_state","pending"),z(this,"durationProgress",0),z(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=n,this.delay=o,this.easing=h,this._onStart=l,this._onChange=f,this._onComplete=g,this._abort=v,this.target=m,this.startValue=e,this.byValue=r,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return"aborted"===this._state||"completed"===this._state}start(){var t=t=>{"pending"===this._state&&(this.startTime=t||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout((()=>At(t)),this.delay):At(t)}tick(t){var e=(t||+new Date)-this.startTime,r=Math.min(e,this.duration);this.durationProgress=r/this.duration;var i=this.calculate(r),n=i.value,s=i.valueProgress;this.value=Object.freeze(n),this.valueProgress=s,"aborted"!==this._state&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):e>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),At(this.tick)))}register(){bt.push(this)}unregister(){bt.remove(this)}abort(){this._state="aborted",this.unregister()}}var gr=["startValue","endValue"];class pr extends dr{constructor(t){var e=t.startValue,r=void 0===e?0:e,i=t.endValue,n=void 0===i?100:i;super(W(W({},G(t,gr)),{},{startValue:r,byValue:n-r}))}calculate(t){var e=this.easing(t,this.startValue,this.byValue,this.duration);return{value:e,valueProgress:Math.abs((e-this.startValue)/this.byValue)}}}var vr=["startValue","endValue"];class mr extends dr{constructor(t){var e=t.startValue,r=void 0===e?[0]:e,i=t.endValue,n=void 0===i?[100]:i;super(W(W({},G(t,vr)),{},{startValue:r,byValue:n.map(((t,e)=>t-r[e]))}))}calculate(t){var e=this.startValue.map(((e,r)=>this.easing(t,e,this.byValue[r],this.duration,r)));return{value:e,valueProgress:Math.abs((e[0]-this.startValue[0])/this.byValue[0])}}}var _r=(t,e,r)=>Math.max(t,Math.min(e,r)),yr=["startValue","endValue","easing","onChange","onComplete","abort"],xr=(t,e,r,i)=>e+r*(1-Math.cos(t/i*ot)),br=t=>t&&((e,r,i)=>t(new ue(e).toRgba(),r,i));class wr extends dr{constructor(t){var e=t.startValue,r=t.endValue,i=t.easing,n=void 0===i?xr:i,s=t.onChange,o=t.onComplete,a=t.abort,h=G(t,yr),c=new ue(e).getSource(),l=new ue(r).getSource();super(W(W({},h),{},{startValue:c,byValue:l.map(((t,e)=>t-c[e])),easing:n,onChange:br(s),onComplete:br(o),abort:br(a)}))}calculate(t){var e=this.startValue.map(((e,r)=>this.easing(t,e,this.byValue[r],this.duration,r))),r=s(e,4),i=r[0],n=r[1],o=r[2],a=r[3],h=[...[i,n,o].map(Math.round),_r(0,a,1)];return{value:h,valueProgress:h.map(((t,e)=>0!==this.byValue[e]?Math.abs((t-this.startValue[e])/this.byValue[e]):0)).find((t=>0!==t))||0}}}function Cr(t){var e=(t=>Array.isArray(t.startValue)||Array.isArray(t.endValue))(t)?new mr(t):new pr(t);return e.start(),e}function Sr(t){var e=new wr(t);return e.start(),e}var Tr=new kt(1,0),Or=(t,e)=>t.rotate(e),kr=(t,e)=>new kt(e).subtract(t),Dr=t=>t.distanceFrom(new kt),Mr=(t,e)=>{var r=t.x*e.x+t.y*e.y,i=t.x*e.y-t.y*e.x;return Math.atan2(i,r)},Er=t=>t.scalarDivide(Dr(t)),Ar=(t,e,r)=>{var i=kr(t,e),n=kr(t,r),s=Mr(i,n);return{vector:Er(Or(i,s/2)),angle:s}},Pr=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return Er(new kt(-t.y,t.x).scalarMultiply(e?1:-1))};class jr{constructor(t){this.status=t,this.points=[]}includes(t){return this.points.some((e=>e.eq(t)))}append(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return this.points=this.points.concat(e.filter((t=>!this.includes(t)))),this}static isPointContained(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.eq(r))return t.eq(e);if(e.x===r.x)return t.x===e.x&&(i||t.y>=Math.min(e.y,r.y)&&t.y<=Math.max(e.y,r.y));if(e.y===r.y)return t.y===e.y&&(i||t.x>=Math.min(e.x,r.x)&&t.x<=Math.max(e.x,r.x));var n=kr(e,r),s=kr(e,t).divide(n);return i?Math.abs(s.x)===Math.abs(s.y):s.x===s.y&&s.x>=0&&s.x<=1}static intersectLineLine(t,e,r,i){var n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=e.x-t.x,a=e.y-t.y,h=i.x-r.x,c=i.y-r.y,l=t.x-r.x,u=t.y-r.y,f=h*u-c*l,d=o*u-a*l,g=c*o-h*a;if(0!==g){var p=f/g,v=d/g;return(n||0<=p&&p<=1)&&(s||0<=v&&v<=1)?new jr("Intersection").append(new kt(t.x+p*o,t.y+p*a)):new jr}if(0===f||0===d){var m=n||s||jr.isPointContained(t,r,i)||jr.isPointContained(e,r,i)||jr.isPointContained(r,t,e)||jr.isPointContained(i,t,e);return new jr(m?"Coincident":void 0)}return new jr("Parallel")}static intersectSegmentLine(t,e,r,i){return jr.intersectLineLine(t,e,r,i,!1,!0)}static intersectSegmentSegment(t,e,r,i){return jr.intersectLineLine(t,e,r,i,!1,!1)}static intersectLinePolygon(t,e,r){for(var i,n,s,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=new jr,h=r.length,c=0;c<h;c++){if(i=r[c],n=r[(c+1)%h],"Coincident"===(s=jr.intersectLineLine(t,e,i,n,o,!1)).status)return s;a.append(...s.points)}return a.points.length>0&&(a.status="Intersection"),a}static intersectSegmentPolygon(t,e,r){return jr.intersectLinePolygon(t,e,r,!1)}static intersectPolygonPolygon(t,e){for(var r=new jr,i=t.length,n=[],s=0;s<i;s++){var o=t[s],a=t[(s+1)%i],h=jr.intersectSegmentPolygon(o,a,e);"Coincident"===h.status?(n.push(h),r.append(o,a)):r.append(...h.points)}return n.length>0&&n.length===t.length?new jr("Coincident"):(r.points.length>0&&(r.status="Intersection"),r)}static intersectPolygonRectangle(t,e,r){var i=e.min(r),n=e.max(r),s=new kt(n.x,i.y),o=new kt(i.x,n.y);return jr.intersectPolygonPolygon(t,[i,s,n,o])}}class Fr extends Et{_getTransformedDimensions(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=W({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},t),r=e.strokeWidth,i=r,n=0;this.strokeUniform&&(i=0,n=r);var s=e.width+i,o=e.height+i;return(0===e.skewX&&0===e.skewY?new kt(s*e.scaleX,o*e.scaleY):Ge(s,o,e)).scalarAdd(n)}translateToGivenOrigin(t,e,r,i,n){var s=t.x,o=t.y,a=$e(i)-$e(e),h=$e(n)-$e(r);if(a||h){var c=this._getTransformedDimensions();s+=a*c.x,o+=h*c.y}return new kt(s,o)}translateToCenterPoint(t,e,r){var i=this.translateToGivenOrigin(t,e,r,ut,ut);return this.angle?i.rotate(Bt(this.angle),t):i}translateToOriginPoint(t,e,r){var i=this.translateToGivenOrigin(t,ut,ut,e,r);return this.angle?i.rotate(Bt(this.angle),t):i}getCenterPoint(){var t=this.getRelativeCenterPoint();return this.group?Wt(t,this.group.calcTransformMatrix()):t}getRelativeCenterPoint(){return this.translateToCenterPoint(new kt(this.left,this.top),this.originX,this.originY)}getPointByOrigin(t,e){return this.translateToOriginPoint(this.getRelativeCenterPoint(),t,e)}setPositionByOrigin(t,e,r){var i=this.translateToCenterPoint(t,e,r),n=this.translateToOriginPoint(i,this.originX,this.originY);this.set({left:n.x,top:n.y})}_setOriginToCenter(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var t=this.getRelativeCenterPoint();this.originX=ut,this.originY=ut,this.left=t.x,this.top=t.y}_resetOrigin(){if(void 0!==this._originalOriginX&&void 0!==this._originalOriginY){var t=this.translateToOriginPoint(this.getRelativeCenterPoint(),this._originalOriginX,this._originalOriginY);this.left=t.x,this.top=t.y,this.originX=this._originalOriginX,this.originY=this._originalOriginY,this._originalOriginX=void 0,this._originalOriginY=void 0}}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),ft,dt)}}class Lr extends Fr{getX(){return this.getXY().x}setX(t){this.setXY(this.getXY().setX(t))}getY(){return this.getXY().y}setY(t){this.setXY(this.getXY().setY(t))}getRelativeX(){return this.left}setRelativeX(t){this.left=t}getRelativeY(){return this.top}setRelativeY(t){this.top=t}getXY(){var t=this.getRelativeXY();return this.group?Wt(t,this.group.calcTransformMatrix()):t}setXY(t,e,r){this.group&&(t=Wt(t,zt(this.group.calcTransformMatrix()))),this.setRelativeXY(t,e,r)}getRelativeXY(){return new kt(this.left,this.top)}setRelativeXY(t,e,r){this.setPositionByOrigin(t,e||this.originX,r||this.originY)}_getCoords(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?t?this.calcACoords():this.calcLineCoords():(this.aCoords||(this.aCoords=this.calcACoords()),this.lineCoords||(this.lineCoords=this.calcLineCoords()),t?this.aCoords:this.lineCoords)}getCoords(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this._getCoords(t,e),i=[r.tl,r.tr,r.br,r.bl];if(this.group){var n=this.group.calcTransformMatrix();return i.map((t=>Wt(t,n)))}return i}intersectsWithRect(t,e,r,i){var n=this.getCoords(r,i);return"Intersection"===jr.intersectPolygonRectangle(n,t,e).status}intersectsWithObject(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=jr.intersectPolygonPolygon(this.getCoords(e,r),t.getCoords(e,r));return"Intersection"===i.status||"Coincident"===i.status||t.isContainedWithinObject(this,e,r)||this.isContainedWithinObject(t,e,r)}isContainedWithinObject(t){for(var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.getCoords(e,r),n=e?t.aCoords:t.lineCoords,s=t._getImageLines(n),o=0;o<4;o++)if(!t.containsPoint(i[o],s))return!1;return!0}isContainedWithinRect(t,e,r,i){var n=this.getBoundingRect(r,i);return n.left>=t.x&&n.left+n.width<=e.x&&n.top>=t.y&&n.top+n.height<=e.y}isOverlapping(t){return this.intersectsWithObject(t)||this.isContainedWithinObject(t)||t.isContainedWithinObject(this)}containsPoint(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=this._getCoords(r,i),s=e||this._getImageLines(n),o=this._findCrossPoints(t,s);return 0!==o&&o%2==1}isOnScreen(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.canvas)return!1;var e=this.canvas.vptCoords,r=e.tl,i=e.br;return!!this.getCoords(!0,t).some((t=>t.x<=i.x&&t.x>=r.x&&t.y<=i.y&&t.y>=r.y))||(!!this.intersectsWithRect(r,i,!0,t)||this._containsCenterOfCanvas(r,i,t))}_containsCenterOfCanvas(t,e,r){var i=t.midPointFrom(e);return this.containsPoint(i,void 0,!0,r)}isPartiallyOnScreen(t){if(!this.canvas)return!1;var e=this.canvas.vptCoords,r=e.tl,i=e.br;return!!this.intersectsWithRect(r,i,!0,t)||this.getCoords(!0,t).every((t=>(t.x>=i.x||t.x<=r.x)&&(t.y>=i.y||t.y<=r.y)))&&this._containsCenterOfCanvas(r,i,t)}_getImageLines(t){var e=t.tl,r=t.tr,i=t.bl,n=t.br;return{topline:{o:e,d:r},rightline:{o:r,d:n},bottomline:{o:n,d:i},leftline:{o:i,d:e}}}_findCrossPoints(t,e){var r=0;for(var i in e){var n=void 0,s=e[i];if(!(s.o.y<t.y&&s.d.y<t.y)&&!(s.o.y>=t.y&&s.d.y>=t.y)){if(s.o.x===s.d.x&&s.o.x>=t.x)n=s.o.x;else{var o=(s.d.y-s.o.y)/(s.d.x-s.o.x);n=-(t.y-0*t.x-(s.o.y-o*s.o.x))/(0-o)}if(n>=t.x&&(r+=1),2===r)break}}return r}getBoundingRect(t,e){return Be(this.getCoords(t,e))}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(t){this._set("scaleX",t),this._set("scaleY",t),this.setCoords()}scaleToWidth(t,e){var r=this.getBoundingRect(e).width/this.getScaledWidth();return this.scale(t/this.width/r)}scaleToHeight(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.getBoundingRect(e).height/this.getScaledHeight();return this.scale(t/this.height/r)}getCanvasRetinaScaling(){var t;return(null===(t=this.canvas)||void 0===t?void 0:t.getRetinaScaling())||1}getTotalAngle(){return this.group?Ut(this.calcTransformMatrix()).angle:this.angle}calcLineCoords(){var t=this.getViewportTransform(),e=this.padding,r=Bt(this.getTotalAngle()),i=Tt(r)*e,n=Ot(r)*e,s=i+n,o=i-n,a=this.calcACoords(),h=a.tl,c=a.tr,l=a.bl,u=a.br,f={tl:Wt(h,t),tr:Wt(c,t),bl:Wt(l,t),br:Wt(u,t)};return e&&(f.tl.x-=o,f.tl.y-=s,f.tr.x+=s,f.tr.y-=o,f.bl.x-=s,f.bl.y+=o,f.br.x+=o,f.br.y+=s),f}getViewportTransform(){var t;return(null===(t=this.canvas)||void 0===t?void 0:t.viewportTransform)||ct.concat()}calcACoords(){var t=Nt({angle:this.angle}),e=this.getRelativeCenterPoint(),r=e.x,i=e.y,n=Ht(r,i),s=Vt(n,t),o=this._getTransformedDimensions(),a=o.x/2,h=o.y/2;return{tl:Wt({x:-a,y:-h},s),tr:Wt({x:a,y:-h},s),bl:Wt({x:-a,y:h},s),br:Wt({x:a,y:h},s)}}setCoords(){this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords()}transformMatrixKey(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e="_",r="";return!t&&this.group&&(r=this.group.transformMatrixKey(t)+e),r+this.top+e+this.left+e+this.scaleX+e+this.scaleY+e+this.skewX+e+this.skewY+e+this.angle+e+this.originX+e+this.originY+e+this.width+e+this.height+e+this.strokeWidth+this.flipX+this.flipY}calcTransformMatrix(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.calcOwnMatrix();if(t||!this.group)return e;var r=this.transformMatrixKey(t),i=this.matrixCache;return i&&i.key===r?i.value:(this.group&&(e=Vt(this.group.calcTransformMatrix(!1),e)),this.matrixCache={key:r,value:e},e)}calcOwnMatrix(){var t=this.transformMatrixKey(!0),e=this.ownMatrixCache;if(e&&e.key===t)return e.value;var r=this.getRelativeCenterPoint(),i={angle:this.angle,translateX:r.x,translateY:r.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},n=Qt(i);return this.ownMatrixCache={key:t,value:n},n}_getNonTransformedDimensions(){return new kt(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(t){return this._getTransformedDimensions(t).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}}class Rr extends Lr{getParent(t){return((e=this.group)&&e.isType("ActiveSelection")?this.__owningGroup:this.group)||(t?void 0:this.canvas);var e}isDescendantOf(t){return this.__owningGroup===t||this.group===t||this.canvas===t||!!this.__owningGroup&&this.__owningGroup.isDescendantOf(t)||!!this.group&&this.group.isDescendantOf(t)}getAncestors(t){var e=[],r=this;do{(r=r instanceof Rr?r.getParent(t):void 0)&&e.push(r)}while(r);return e}findCommonAncestors(t,e){if(this===t)return{fork:[],otherFork:[],common:[this,...this.getAncestors(e)]};var r=this.getAncestors(e),i=t.getAncestors(e);if(0===r.length&&i.length>0&&this===i[i.length-1])return{fork:[],otherFork:[t,...i.slice(0,i.length-1)],common:[this]};for(var n,s=0;s<r.length;s++){if((n=r[s])===t)return{fork:[this,...r.slice(0,s)],otherFork:[],common:r.slice(s)};for(var o=0;o<i.length;o++){if(this===i[o])return{fork:[],otherFork:[t,...i.slice(0,o)],common:[this,...r]};if(n===i[o])return{fork:[this,...r.slice(0,s)],otherFork:[t,...i.slice(0,o)],common:r.slice(s)}}}return{fork:[this,...r],otherFork:[t,...i],common:[]}}hasCommonAncestors(t,e){var r=this.findCommonAncestors(t,e);return r&&!!r.common.length}isInFrontOf(t){if(this!==t){var e=this.findCommonAncestors(t);if(e){if(e.fork.includes(t))return!0;if(e.otherFork.includes(this))return!1;var r=e.common[0];if(r){var i=e.fork.pop(),n=e.otherFork.pop(),s=r._objects.indexOf(i),o=r._objects.indexOf(n);return s>-1&&s>o}}}}}class Ir extends Rr{animate(t,e){return Object.entries(t).reduce(((t,r)=>{var i=s(r,2),n=i[0],o=i[1];return t[n]=this._animate(n,o,e),t}),{})}_animate(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t.split("."),n=this.colorProperties.includes(i[i.length-1]),s=r.easing,o=r.duration,a=r.abort,h=r.startValue,c=r.onChange,l=r.onComplete,u={target:this,startValue:null!=h?h:i.reduce(((t,e)=>t[e]),this),endValue:e,easing:s,duration:o,abort:null==a?void 0:a.bind(this),onChange:(t,e,r)=>{i.reduce(((e,r,n)=>(n===i.length-1&&(e[r]=t),e[r])),this),c&&c(t,e,r)},onComplete:(t,e,r)=>{this.setCoords(),l&&l(t,e,r)}};return n?Sr(u):Cr(u)}}class Br{constructor(t){var e="string"==typeof t?Br.parseShadow(t):t;for(var r in Object.assign(this,this.constructor.ownDefaults),e)this[r]=e[r];this.id=Ft()}static parseShadow(t){var e=t.trim(),r=(Br.reOffsetsAndBlur.exec(e)||[]).map((t=>parseFloat(t)||0)),i=s(r,4),n=(i[0],i[1]),o=void 0===n?0:n,a=i[2],h=void 0===a?0:a,c=i[3],l=void 0===c?0:c;return{color:(e.replace(Br.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:o,offsetY:h,blur:l}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(t){var e=Or(new kt(this.offsetX,this.offsetY),Bt(-t.angle)),r=new ue(this.color),i=40,n=40;return t.width&&t.height&&(i=100*fe((Math.abs(e.x)+this.blur)/t.width,q.NUM_FRACTION_DIGITS)+20,n=100*fe((Math.abs(e.y)+this.blur)/t.height,q.NUM_FRACTION_DIGITS)+20),t.flipX&&(e.x*=-1),t.flipY&&(e.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(n,'%" height="').concat(100+2*n,'%" x="-').concat(i,'%" width="').concat(100+2*i,'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="').concat(fe(this.blur?this.blur/2:0,q.NUM_FRACTION_DIGITS),'"></feGaussianBlur>\n\t<feOffset dx="').concat(fe(e.x,q.NUM_FRACTION_DIGITS),'" dy="').concat(fe(e.y,q.NUM_FRACTION_DIGITS),'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="').concat(r.toRgb(),'" flood-opacity="').concat(r.getAlpha(),'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n')}toObject(){var t={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling},e=Br.ownDefaults;return this.includeDefaultValues?t:ne(t,((t,r)=>t!==e[r]))}}z(Br,"ownDefaults",{color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1}),z(Br,"reOffsetsAndBlur",/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/);var Xr=t=>JSON.parse(JSON.stringify(t)),Yr=[dt,ft,"scaleX","scaleY","flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible","skewX","skewY"],Wr=["fill","stroke","strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],zr={originX:ft,originY:dt,top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!0,noScaleCache:!0,strokeUniform:!1,dirty:!0,paintFirst:"fill",activeOn:"down",colorProperties:["fill","stroke","backgroundColor"],clipPath:void 0,inverted:!1,absolutePositioned:!1,FX_DURATION:500},Vr=["extraParam"],Gr=class t extends Ir{static getDefaults(){return W({},t.ownDefaults)}get type(){var t=this.constructor.type;return"FabricObject"===t?"object":t.toLowerCase()}set type(t){console.warn("Setting type has no effect",t)}constructor(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),z(this,"_cacheContext",null),Object.assign(this,this.constructor.getDefaults()),this.setOptions(t)}_createCacheCanvas(){this._cacheCanvas=Lt(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(t){var e=t.width,r=t.height,i=q.maxCacheSideLimit,n=q.minCacheSideLimit;if(e<=i&&r<=i&&e*r<=q.perfLimitSizeTotal)return e<n&&(t.width=n),r<n&&(t.height=n),t;var o=e/r,a=s(it.limitDimsByArea(o),2),h=a[0],c=a[1],l=_r(n,h,i),u=_r(n,c,i);return e>l&&(t.zoomX/=e/l,t.width=l,t.capped=!0),r>u&&(t.zoomY/=r/u,t.height=u,t.capped=!0),t}_getCacheCanvasDimensions(){var t=this.getTotalObjectScaling(),e=this._getTransformedDimensions({skewX:0,skewY:0}),r=e.x*t.x/this.scaleX,i=e.y*t.y/this.scaleY;return{width:r+2,height:i+2,zoomX:t.x,zoomY:t.y,x:r,y:i}}_updateCacheCanvas(){var t=this._cacheCanvas,e=this._cacheContext,r=this._limitCacheSize(this._getCacheCanvasDimensions()),i=q.minCacheSideLimit,n=r.width,s=r.height,o=r.zoomX,a=r.zoomY,h=n!==this.cacheWidth||s!==this.cacheHeight,c=this.zoomX!==o||this.zoomY!==a;if(!t||!e)return!1;var l,u,f=h||c,d=0,g=0,p=!1;if(h){var v=this._cacheCanvas.width,m=this._cacheCanvas.height,_=n>v||s>m;p=_||(n<.9*v||s<.9*m)&&v>i&&m>i,_&&!r.capped&&(n>i||s>i)&&(d=.1*n,g=.1*s)}return be(this)&&this.path&&(f=!0,p=!0,d+=this.getHeightOfLine(0)*this.zoomX,g+=this.getHeightOfLine(0)*this.zoomY),!!f&&(p?(t.width=Math.ceil(n+d),t.height=Math.ceil(s+g)):(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height)),l=r.x/2,u=r.y/2,this.cacheTranslationX=Math.round(t.width/2-l)+l,this.cacheTranslationY=Math.round(t.height/2-u)+u,this.cacheWidth=n,this.cacheHeight=s,e.translate(this.cacheTranslationX,this.cacheTranslationY),e.scale(o,a),this.zoomX=o,this.zoomY=a,!0)}setOptions(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._setOptions(t)}transform(t){var e=this.group&&!this.group._transformDone||this.group&&this.canvas&&t===this.canvas.contextTop,r=this.calcTransformMatrix(!e);t.transform(r[0],r[1],r[2],r[3],r[4],r[5])}toObject(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=q.NUM_FRACTION_DIGITS,r=this.clipPath&&!this.clipPath.excludeFromExport?W(W({},this.clipPath.toObject(t)),{},{inverted:this.clipPath.inverted,absolutePositioned:this.clipPath.absolutePositioned}):null,i=W(W({},ie(this,t)),{},{type:this.constructor.type,version:nt,originX:this.originX,originY:this.originY,left:fe(this.left,e),top:fe(this.top,e),width:fe(this.width,e),height:fe(this.height,e),fill:_e(this.fill)?this.fill.toObject():this.fill,stroke:_e(this.stroke)?this.stroke.toObject():this.stroke,strokeWidth:fe(this.strokeWidth,e),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:fe(this.strokeMiterLimit,e),scaleX:fe(this.scaleX,e),scaleY:fe(this.scaleY,e),angle:fe(this.angle,e),flipX:this.flipX,flipY:this.flipY,opacity:fe(this.opacity,e),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:fe(this.skewX,e),skewY:fe(this.skewY,e)},r?{clipPath:r}:null);return this.includeDefaultValues?i:this._removeDefaultValues(i)}toDatalessObject(t){return this.toObject(t)}_removeDefaultValues(t){var e=this.constructor.getDefaults(),r=Object.keys(e).length>0?e:Object.getPrototypeOf(this);return ne(t,((t,e)=>{if(e===ft||e===dt||"type"===e)return!0;var i=r[e];return t!==i&&!(Array.isArray(t)&&Array.isArray(i)&&0===t.length&&0===i.length)}))}toString(){return"#<".concat(this.constructor.type,">")}getObjectScaling(){if(!this.group)return new kt(Math.abs(this.scaleX),Math.abs(this.scaleY));var t=Ut(this.calcTransformMatrix());return new kt(Math.abs(t.scaleX),Math.abs(t.scaleY))}getTotalObjectScaling(){var t=this.getObjectScaling();if(this.canvas){var e=this.canvas.getZoom(),r=this.getCanvasRetinaScaling();return t.scalarMultiply(e*r)}return t}getObjectOpacity(){var t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t}_constrainScale(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:0===t?1e-4:t}_set(t,e){var r=this[t]!==e;if("scaleX"!==t&&"scaleY"!==t||(e=this._constrainScale(e)),"scaleX"===t&&e<0?(this.flipX=!this.flipX,e*=-1):"scaleY"===t&&e<0?(this.flipY=!this.flipY,e*=-1):"shadow"!==t||!e||e instanceof Br?"dirty"===t&&this.group&&this.group.set("dirty",e):e=new Br(e),this[t]=e,r){var i=this.group&&this.group.isOnACache();this.constructor.cacheProperties.includes(t)?(this.dirty=!0,i&&this.group.set("dirty",!0)):i&&this.constructor.stateProperties.includes(t)&&this.group.set("dirty",!0)}return this}isNotVisible(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible}render(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.drawObject(t),this.dirty=!1),t.restore())}drawSelectionBackground(t){}renderCache(t){t=t||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext&&(this.drawObject(this._cacheContext,t.forClipping),this.dirty=!1)}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0}hasStroke(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth}hasFill(){return this.fill&&"transparent"!==this.fill}needsItsOwnCache(){return!("stroke"!==this.paintFirst||!this.hasFill()||!this.hasStroke()||"object"!=typeof this.shadow)||!!this.clipPath}shouldCache(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching}willDrawShadow(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)}drawClipPathOnCache(t,e){if(t.save(),e.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",e.absolutePositioned){var r=zt(this.calcTransformMatrix());t.transform(r[0],r[1],r[2],r[3],r[4],r[5])}e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}drawObject(t,e){var r=this.fill,i=this.stroke;e?(this.fill="black",this.stroke="",this._setClippingProperties(t)):this._renderBackground(t),this._render(t),this._drawClipPath(t,this.clipPath),this.fill=r,this.stroke=i}_drawClipPath(t,e){e&&(e._set("canvas",this.canvas),e.shouldCache(),e._transformDone=!0,e.renderCache({forClipping:!0}),this.drawClipPathOnCache(t,e))}drawCacheOnCanvas(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!t&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned){if(this._cacheCanvas&&this._cacheContext&&!t){var e=this.cacheWidth/this.zoomX,r=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-e/2,-r/2,e,r)}return!0}return!1}_renderBackground(t){if(this.backgroundColor){var e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}}_setOpacity(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity}_setStrokeStyles(t,e){var r=e.stroke;r&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineDashOffset=e.strokeDashOffset,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,me(r)?"percentage"===r.gradientUnits||r.gradientTransform||r.patternTransform?this._applyPatternForTransformedGradient(t,r):(t.strokeStyle=r.toLive(t),this._applyPatternGradientTransform(t,r)):t.strokeStyle=e.stroke)}_setFillStyles(t,e){var r=e.fill;r&&(me(r)?(t.fillStyle=r.toLive(t),this._applyPatternGradientTransform(t,r)):t.fillStyle=r)}_setClippingProperties(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000"}_setLineDash(t,e){e&&0!==e.length&&(1&e.length&&e.push(...e),t.setLineDash(e))}_setShadow(t){if(this.shadow){var e=this.shadow,r=this.canvas,i=this.getCanvasRetinaScaling(),n=s((null==r?void 0:r.viewportTransform)||ct,4),o=n[0]*i,a=n[3]*i,h=e.nonScaling?new kt(1,1):this.getObjectScaling();t.shadowColor=e.color,t.shadowBlur=e.blur*q.browserShadowBlurConstant*(o+a)*(h.x+h.y)/4,t.shadowOffsetX=e.offsetX*o*h.x,t.shadowOffsetY=e.offsetY*a*h.y}}_removeShadow(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)}_applyPatternGradientTransform(t,e){if(!me(e))return{offsetX:0,offsetY:0};var r=e.gradientTransform||e.patternTransform,i=-this.width/2+e.offsetX||0,n=-this.height/2+e.offsetY||0;return"percentage"===e.gradientUnits?t.transform(this.width,0,0,this.height,i,n):t.transform(1,0,0,1,i,n),r&&t.transform(r[0],r[1],r[2],r[3],r[4],r[5]),{offsetX:i,offsetY:n}}_renderPaintInOrder(t){"stroke"===this.paintFirst?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))}_render(t){}_renderFill(t){this.fill&&(t.save(),this._setFillStyles(t,this),"evenodd"===this.fillRule?t.fill("evenodd"):t.fill(),t.restore())}_renderStroke(t){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this.strokeUniform){var e=this.getObjectScaling();t.scale(1/e.x,1/e.y)}this._setLineDash(t,this.strokeDashArray),this._setStrokeStyles(t,this),t.stroke(),t.restore()}}_applyPatternForTransformedGradient(t,e){var r,i=this._limitCacheSize(this._getCacheCanvasDimensions()),n=Lt(),s=this.getCanvasRetinaScaling(),o=i.x/this.scaleX/s,a=i.y/this.scaleY/s;n.width=Math.ceil(o),n.height=Math.ceil(a);var h=n.getContext("2d");h&&(h.beginPath(),h.moveTo(0,0),h.lineTo(o,0),h.lineTo(o,a),h.lineTo(0,a),h.closePath(),h.translate(o/2,a/2),h.scale(i.zoomX/this.scaleX/s,i.zoomY/this.scaleY/s),this._applyPatternGradientTransform(h,e),h.fillStyle=e.toLive(t),h.fill(),t.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),t.scale(s*this.scaleX/i.zoomX,s*this.scaleY/i.zoomY),t.strokeStyle=null!==(r=h.createPattern(n,"no-repeat"))&&void 0!==r?r:"")}_findCenterFromElement(){return new kt(this.left+this.width/2,this.top+this.height/2)}clone(t){var e=this.toObject(t);return this.constructor.fromObject(e)}cloneAsImage(t){var e=this.toCanvasElement(t);return new(xt.getClass("image"))(e)}toCanvasElement(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=Ve(this),r=this.group,i=this.shadow,n=Math.abs,s=t.enableRetinaScaling?Math.max(q.devicePixelRatio,1):1,o=(t.multiplier||1)*s;delete this.group,t.withoutTransform&&ze(this),t.withoutShadow&&(this.shadow=null),t.viewportTransform&&Ne(this,this.getViewportTransform());var a=Lt(),h=this.getBoundingRect(!0,!0),c=this.shadow,l=new kt;if(c){var u=c.blur,f=c.nonScaling?new kt(1,1):this.getObjectScaling();l.x=2*Math.round(n(c.offsetX)+u)*n(f.x),l.y=2*Math.round(n(c.offsetY)+u)*n(f.y)}var d=h.width+l.x,g=h.height+l.y;a.width=Math.ceil(d),a.height=Math.ceil(g);var p=new je(a,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===t.format&&(p.backgroundColor="#fff"),this.setPositionByOrigin(new kt(p.width/2,p.height/2),ut,ut);var v=this.canvas;p._objects=[this],this.set("canvas",p),this.setCoords();var m=p.toCanvasElement(o||1,t);return this.set("canvas",v),this.shadow=i,r&&(this.group=r),this.set(e),this.setCoords(),p._objects=[],p.destroy(),m}toDataURL(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return It(this.toCanvasElement(t),t.format||"png",t.quality||1)}isType(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.includes(this.constructor.type)||e.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(t){var e=(this.originX!==ut||this.originY!==ut)&&this.centeredRotation;e&&this._setOriginToCenter(),this.set("angle",t),e&&this._resetOrigin()}setOnGroup(){}_setupCompositeOperation(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}dispose(){bt.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&tt().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}static _fromObject(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.extraParam,i=G(e,Vr);return re(Xr(t),i).then((t=>{var e=W(W({},i),t);if(r){var n=e[r];e.type;return new this(n,G(e,[r,"type"].map(H)))}return new this(e)}))}static fromObject(t,e){return this._fromObject(t,e)}};z(Gr,"stateProperties",Yr),z(Gr,"cacheProperties",Wr),z(Gr,"ownDefaults",zr),z(Gr,"type","FabricObject"),xt.setClass(Gr),xt.setClass(Gr,"object");var Ur=(t,e)=>(r,i,n,s)=>{var o=e(r,i,n,s);return o&&qe(t,er(r,i,n,s)),o};function Hr(t){return(e,r,i,n)=>{var s=r.target,o=r.originX,a=r.originY,h=s.getRelativeCenterPoint(),c=s.translateToOriginPoint(h,o,a),l=t(e,r,i,n);return s.setPositionByOrigin(c,o,a),l}}var Nr=Ur("resizing",Hr(((t,e,r,i)=>{var n=ir(e,e.originX,e.originY,r,i);if(e.originX===ut||e.originX===pt&&n.x<0||e.originX===ft&&n.x>0){var s=e.target,o=s.strokeWidth/(s.strokeUniform?s.scaleX:1),a=Je(e)?2:1,h=s.width,c=Math.ceil(Math.abs(n.x*a/s.scaleX)-o);return s.set("width",Math.max(c,0)),h!==s.width}return!1})));function qr(t,e,r,i,n){i=i||{};var s,o=this.sizeX||i.cornerSize||n.cornerSize,a=this.sizeY||i.cornerSize||n.cornerSize,h=void 0!==i.transparentCorners?i.transparentCorners:n.transparentCorners,c=h?"stroke":"fill",l=!h&&(i.cornerStrokeColor||n.cornerStrokeColor),u=e,f=r;t.save(),t.fillStyle=i.cornerColor||n.cornerColor||"",t.strokeStyle=i.cornerStrokeColor||n.cornerStrokeColor||"",o>a?(s=o,t.scale(1,a/o),f=r*o/a):a>o?(s=a,t.scale(o/a,1),u=e*a/o):s=o,t.lineWidth=1,t.beginPath(),t.arc(u,f,s/2,0,at,!1),t[c](),l&&t.stroke(),t.restore()}function Kr(t,e,r,i,n){i=i||{};var s=this.sizeX||i.cornerSize||n.cornerSize,o=this.sizeY||i.cornerSize||n.cornerSize,a=void 0!==i.transparentCorners?i.transparentCorners:n.transparentCorners,h=a?"stroke":"fill",c=!a&&(i.cornerStrokeColor||n.cornerStrokeColor),l=s/2,u=o/2;t.save(),t.fillStyle=i.cornerColor||n.cornerColor||"",t.strokeStyle=i.cornerStrokeColor||n.cornerStrokeColor||"",t.lineWidth=1,t.translate(e,r);var f=n.getTotalAngle();t.rotate(Bt(f)),t["".concat(h,"Rect")](-l,-u,s,o),c&&t.strokeRect(-l,-u,s,o),t.restore()}class $r{constructor(t){z(this,"visible",!0),z(this,"actionName","scale"),z(this,"angle",0),z(this,"x",0),z(this,"y",0),z(this,"offsetX",0),z(this,"offsetY",0),z(this,"sizeX",null),z(this,"sizeY",null),z(this,"touchSizeX",null),z(this,"touchSizeY",null),z(this,"cursorStyle","crosshair"),z(this,"withConnection",!1),Object.assign(this,t)}shouldActivate(t,e){var r;return(null===(r=e.canvas)||void 0===r?void 0:r.getActiveObject())===e&&e.isControlVisible(t)}getActionHandler(t,e,r){return this.actionHandler}getMouseDownHandler(t,e,r){return this.mouseDownHandler}getMouseUpHandler(t,e,r){return this.mouseUpHandler}cursorStyleHandler(t,e,r){return e.cursorStyle}getActionName(t,e,r){return e.actionName}getVisibility(t,e){var r,i;return null!==(r=null===(i=t._controlsVisibility)||void 0===i?void 0:i[e])&&void 0!==r?r:this.visible}setVisibility(t,e,r){this.visible=t}positionHandler(t,e,r,i){return new kt(this.x*t.x+this.offsetX,this.y*t.y+this.offsetY).transform(e)}calcCornerCoords(t,e,r,i,n){var s,o,a,h,c=n?this.touchSizeX:this.sizeX,l=n?this.touchSizeY:this.sizeY;if(c&&l&&c!==l){var u=Math.atan2(l,c),f=Math.sqrt(c*c+l*l)/2,d=u-Bt(t),g=ot-u-Bt(t);s=f*Tt(d),o=f*Ot(d),a=f*Tt(g),h=f*Ot(g)}else{var p=(c&&l?c:e)*Math.SQRT1_2,v=Bt(45-t);s=a=p*Tt(v),o=h=p*Ot(v)}return{tl:new kt(r-h,i-a),tr:new kt(r+s,i-o),bl:new kt(r-s,i+o),br:new kt(r+h,i+a)}}render(t,e,r,i,n){if("circle"===((i=i||{}).cornerStyle||n.cornerStyle))qr.call(this,t,e,r,i,n);else Kr.call(this,t,e,r,i,n)}}e("C",$r);var Zr=(t,e,r)=>r.lockRotation?Ze:e.cursorStyle,Jr=Ur("rotating",Hr(((t,e,r,i)=>{var n=e.target,s=e.ex,o=e.ey,a=e.theta,h=e.originX,c=e.originY,l=n.translateToOriginPoint(n.getRelativeCenterPoint(),h,c);if(tr(n,"lockRotation"))return!1;var u=Math.atan2(o-l.y,s-l.x),f=Math.atan2(i-l.y,r-l.x),d=Xt(f-u+a);if(n.snapAngle&&n.snapAngle>0){var g=n.snapAngle,p=n.snapThreshold||g,v=Math.ceil(d/g)*g,m=Math.floor(d/g)*g;Math.abs(d-m)<p?d=m:Math.abs(d-v)<p&&(d=v)}d<0&&(d=360+d),d%=360;var _=n.angle!==d;return n.angle=d,_})));function Qr(t,e){var r=e.canvas,i=t[r.uniScaleKey];return r.uniformScaling&&!i||!r.uniformScaling&&i}function ti(t,e,r){var i=tr(t,"lockScalingX"),n=tr(t,"lockScalingY");return!(!i||!n)||(!(e||!i&&!n||!r)||(!(!i||"x"!==e)||!(!n||"y"!==e)))}var ei=["e","se","s","sw","w","nw","n","ne","e"],ri=(t,e,r)=>{var i=Qr(t,r);if(ti(r,0!==e.x&&0===e.y?"x":0===e.x&&0!==e.y?"y":"",i))return Ze;var n=rr(r,e);return"".concat(ei[n],"-resize")};function ii(t,e,r,i){var n,s,o,a,h,c,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},u=e.target,f=l.by,d=Qr(t,u);if(ti(u,f,d))return!1;if(e.gestureScale)s=e.scaleX*e.gestureScale,o=e.scaleY*e.gestureScale;else{if(n=ir(e,e.originX,e.originY,r,i),h="y"!==f?Math.sign(n.x||e.signX||1):1,c="x"!==f?Math.sign(n.y||e.signY||1):1,e.signX||(e.signX=h),e.signY||(e.signY=c),tr(u,"lockScalingFlip")&&(e.signX!==h||e.signY!==c))return!1;if(a=u._getTransformedDimensions(),d&&!f){var g=Math.abs(n.x)+Math.abs(n.y),p=e.original,v=g/(Math.abs(a.x*p.scaleX/u.scaleX)+Math.abs(a.y*p.scaleY/u.scaleY));s=p.scaleX*v,o=p.scaleY*v}else s=Math.abs(n.x*u.scaleX/a.x),o=Math.abs(n.y*u.scaleY/a.y);Je(e)&&(s*=2,o*=2),e.signX!==h&&"y"!==f&&(e.originX=Qe(e.originX),s*=-1,e.signX=h),e.signY!==c&&"x"!==f&&(e.originY=Qe(e.originY),o*=-1,e.signY=c)}var m=u.scaleX,_=u.scaleY;return f?("x"===f&&u.set("scaleX",s),"y"===f&&u.set("scaleY",o)):(!tr(u,"lockScalingX")&&u.set("scaleX",s),!tr(u,"lockScalingY")&&u.set("scaleY",o)),m!==u.scaleX||_!==u.scaleY}var ni=Ur("scaling",Hr(((t,e,r,i)=>ii(t,e,r,i)))),si=Ur("scaling",Hr(((t,e,r,i)=>ii(t,e,r,i,{by:"x"})))),oi=Ur("scaling",Hr(((t,e,r,i)=>ii(t,e,r,i,{by:"y"})))),ai=["target","ex","ey","skewingSide"],hi={x:{counterAxis:"y",scale:"scaleX",skew:"skewX",lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:"scaleY",skew:"skewY",lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},ci=["ns","nesw","ew","nwse"],li=(t,e,r)=>{if(0!==e.x&&tr(r,"lockSkewingY"))return Ze;if(0!==e.y&&tr(r,"lockSkewingX"))return Ze;var i=rr(r,e)%4;return"".concat(ci[i],"-resize")};function ui(t,e,r,i,n){var s=r.target,o=hi[t],a=o.counterAxis,h=o.origin,c=o.lockSkewing,l=o.skew,u=o.flip;if(tr(s,c))return!1;var f=hi[a],d=f.origin,g=f.flip,p=$e(r[d])*(s[g]?-1:1),v=-Math.sign(p)*(s[u]?-1:1),m=.5*-((0===s[l]&&ir(r,ut,ut,i,n)[t]>0||s[l]>0?1:-1)*v)+.5,_=Ur("skewing",Hr(((e,r,i,n)=>function(t,e,r){var i=e.target,n=e.ex,s=e.ey,o=e.skewingSide,a=G(e,ai),h=hi[t].skew,c=r.subtract(new kt(n,s)).divide(new kt(i.scaleX,i.scaleY))[t],l=i[h],u=a[h],f=Math.tan(Bt(u)),d="y"===t?i._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:i._getTransformedDimensions({scaleX:1,scaleY:1}).y,g=2*c*o/Math.max(d,1)+f,p=Xt(Math.atan(g));i.set(h,p);var v=l!==i[h];if(v&&"y"===t){var m=i.skewX,_=i.scaleX,y=i._getTransformedDimensions({skewY:l}),x=i._getTransformedDimensions(),b=0!==m?y.x/x.x:1;1!==b&&i.set("scaleX",b*_)}return v}(t,r,new kt(i,n)))));return _(e,W(W({},r),{},{[h]:m,skewingSide:v}),i,n)}var fi=(t,e,r,i)=>ui("x",t,e,r,i),di=(t,e,r,i)=>ui("y",t,e,r,i);function gi(t,e){return t[e.canvas.altActionKey]}var pi=(t,e,r)=>{var i=gi(t,r);return 0===e.x?i?"skewX":"scaleY":0===e.y?i?"skewY":"scaleX":""},vi=(t,e,r)=>gi(t,r)?li(0,e,r):ri(t,e,r),mi=(t,e,r,i)=>gi(t,e.target)?di(t,e,r,i):si(t,e,r,i),_i=(t,e,r,i)=>gi(t,e.target)?fi(t,e,r,i):oi(t,e,r,i),yi=()=>({ml:new $r({x:-.5,y:0,cursorStyleHandler:vi,actionHandler:mi,getActionName:pi}),mr:new $r({x:.5,y:0,cursorStyleHandler:vi,actionHandler:mi,getActionName:pi}),mb:new $r({x:0,y:.5,cursorStyleHandler:vi,actionHandler:_i,getActionName:pi}),mt:new $r({x:0,y:-.5,cursorStyleHandler:vi,actionHandler:_i,getActionName:pi}),tl:new $r({x:-.5,y:-.5,cursorStyleHandler:ri,actionHandler:ni}),tr:new $r({x:.5,y:-.5,cursorStyleHandler:ri,actionHandler:ni}),bl:new $r({x:-.5,y:.5,cursorStyleHandler:ri,actionHandler:ni}),br:new $r({x:.5,y:.5,cursorStyleHandler:ri,actionHandler:ni}),mtr:new $r({x:0,y:-.5,actionHandler:Jr,cursorStyleHandler:Zr,offsetY:-40,withConnection:!0,actionName:"rotate"})}),xi=()=>({mr:new $r({x:.5,y:0,actionHandler:Nr,cursorStyleHandler:vi,actionName:"resizing"}),ml:new $r({x:-.5,y:0,actionHandler:Nr,cursorStyleHandler:vi,actionName:"resizing"})}),bi=()=>W(W({},yi()),xi());class wi extends Gr{static getDefaults(){return W(W({},super.getDefaults()),{},{controls:yi()},wi.ownDefaults)}_updateCacheCanvas(){var t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){var e=t._currentTransform.target,r=t._currentTransform.action;if(this===e&&r.startsWith("scale"))return!1}return super._updateCacheCanvas()}_findTargetCorner(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.hasControls||!this.canvas)return"";this.__corner=void 0;for(var r=Object.entries(this.oCoords),i=r.length-1;i>=0;i--){var n=s(r[i],2),o=n[0],a=n[1];if(this.controls[o].shouldActivate(o,this)){var h=this._getImageLines(e?a.touchCorner:a.corner),c=this._findCrossPoints(t,h);if(0!==c&&c%2==1)return this.__corner=o,o}}return""}calcOCoords(){var t=this.getViewportTransform(),e=this.getCenterPoint(),r=Ht(e.x,e.y),i=Nt({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),n=Vt(r,i),s=Vt(t,n),o=Vt(s,[1/t[0],0,0,1/t[3],0,0]),a=this.group?Ut(this.calcTransformMatrix()):void 0,h=this._calculateCurrentDimensions(a),c={};return this.forEachControl(((t,e)=>{var r=t.positionHandler(h,o,this,t);c[e]=Object.assign(r,this._calcCornerCoords(t,r))})),c}_calcCornerCoords(t,e){return{corner:t.calcCornerCoords(this.angle,this.cornerSize,e.x,e.y,!1),touchCorner:t.calcCornerCoords(this.angle,this.touchCornerSize,e.x,e.y,!0)}}setCoords(){super.setCoords(),this.oCoords=this.calcOCoords()}forEachControl(t){for(var e in this.controls)t(this.controls[e],e,this)}drawSelectionBackground(t){if(!(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)){t.save();var e=this.getRelativeCenterPoint(),r=this._calculateCurrentDimensions(),i=this.getViewportTransform();t.translate(e.x,e.y),t.scale(1/i[0],1/i[3]),t.rotate(Bt(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-r.x/2,-r.y/2,r.x,r.y),t.restore()}}strokeBorders(t,e){t.strokeRect(-e.x/2,-e.y/2,e.x,e.y)}_drawBorders(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=W({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},r);t.save(),t.strokeStyle=i.borderColor,this._setLineDash(t,i.borderDashArray),this.strokeBorders(t,e),i.hasControls&&this.drawControlsConnectingLines(t,e),t.restore()}_renderControls(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=W({hasBorders:this.hasBorders,hasControls:this.hasControls},e),i=this.getViewportTransform(),n=r.hasBorders,s=r.hasControls,o=Vt(i,this.calcTransformMatrix()),a=Ut(o);t.save(),t.translate(a.translateX,a.translateY),t.lineWidth=1*this.borderScaleFactor,this.group||(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(a.angle-=180),t.rotate(Bt(this.group?a.angle:this.angle)),n&&this.drawBorders(t,a,e),s&&this.drawControls(t,e),t.restore()}drawBorders(t,e,r){var i;if(r&&r.forActiveSelection||this.group){var n=Ge(this.width,this.height,e),s=(this.strokeUniform?(new kt).scalarAdd(this.canvas?this.canvas.getZoom():1):new kt(e.scaleX,e.scaleY)).scalarMultiply(this.strokeWidth);i=n.add(s).scalarAdd(this.borderScaleFactor)}else i=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(t,i,r)}drawControlsConnectingLines(t,e){var r=!1;t.beginPath(),this.forEachControl(((i,n)=>{i.withConnection&&i.getVisibility(this,n)&&(r=!0,t.moveTo(i.x*e.x,i.y*e.y),t.lineTo(i.x*e.x+i.offsetX,i.y*e.y+i.offsetY))})),r&&t.stroke()}drawControls(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.save();var r=this.getCanvasRetinaScaling(),i=W({cornerStrokeColor:this.cornerStrokeColor,cornerDashArray:this.cornerDashArray,cornerColor:this.cornerColor},e);t.setTransform(r,0,0,r,0,0),t.strokeStyle=t.fillStyle=i.cornerColor,this.transparentCorners||(t.strokeStyle=i.cornerStrokeColor),this._setLineDash(t,i.cornerDashArray),this.setCoords(),this.forEachControl(((e,r)=>{if(e.getVisibility(this,r)){var n=this.oCoords[r];e.render(t,n.x,n.y,i,this)}})),t.restore()}isControlVisible(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)}setControlVisible(t,e){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=e}setControlsVisibility(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.entries(t).forEach((t=>{var e=s(t,2),r=e[0],i=e[1];return this.setControlVisible(r,i)}))}clearContextTop(t){if(this.canvas){var e=this.canvas.contextTop;if(e){var r=this.canvas.viewportTransform;e.save(),e.transform(r[0],r[1],r[2],r[3],r[4],r[5]),this.transform(e);var i=this.width+4,n=this.height+4;return e.clearRect(-i/2,-n/2,i,n),t||e.restore(),e}}}onDeselect(t){return!1}onSelect(t){return!1}canDrop(t){return!1}renderDragSourceEffect(t){}renderDropTargetEffect(t){}}function Ci(t,e){return e.forEach((e=>{Object.getOwnPropertyNames(e.prototype).forEach((r=>{"constructor"!==r&&Object.defineProperty(t.prototype,r,Object.getOwnPropertyDescriptor(e.prototype,r)||Object.create(null))}))})),t}z(wi,"ownDefaults",{});class Si extends wi{}e("F",Si),Ci(Si,[sr]),xt.setClass(Si),xt.setClass(Si,"object");var Ti,Oi,ki=(t,e,r,i)=>{for(var n=2*(i=Math.round(i))+1,s=t.getImageData(e-i,r-i,n,n).data,o=3;o<s.length;o+=4){if(s[o]>0)return!1}return!0},Di=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function Mi(t){return new RegExp("^("+t.join("|")+")\\b","i")}var Ei={},Ai={cssRules:Ei,gradientDefs:{},clipPaths:{}},Pi=String.raw(Ti||(Ti=U(["(?:[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?)"],["(?:[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?)"])));String.raw(Oi||(Oi=U(["(?:s+,?s*|,s*|$)"],["(?:\\s+,?\\s*|,\\s*|$)"])));var ji=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+Pi+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+Pi+"))?\\s+(.*)"),Fi={cx:ft,x:ft,r:"radius",cy:dt,y:dt,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},Li={stroke:"strokeOpacity",fill:"fillOpacity"},Ri="font-size",Ii="clip-path";Mi(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),Mi(["symbol","image","marker","pattern","view","svg"]),Mi(["pattern","defs","symbol","metadata","clipPath","mask","desc"]);var Bi=Mi(["symbol","g","a","svg","clipPath","defs"]);function Xi(t,e){var r,i=t.nodeName,n=t.getAttribute("class"),s=t.getAttribute("id");if(r=new RegExp("^"+i,"i"),e=e.replace(r,""),s&&e.length&&(r=new RegExp("#"+s+"(?![a-zA-Z\\-]+)","i"),e=e.replace(r,"")),n&&e.length)for(var o=n.split(" "),a=o.length;a--;)r=new RegExp("\\."+o[a]+"(?![a-zA-Z\\-]+)","i"),e=e.replace(r,"");return 0===e.length}function Yi(t,e){var r=!0,i=Xi(t,e.pop());return i&&e.length&&(r=function(t,e){for(var r,i=!0;t.parentNode&&1===t.parentNode.nodeType&&e.length;)i&&(r=e.pop()),i=Xi(t=t.parentNode,r);return 0===e.length}(t,e)),i&&r&&0===e.length}function Wi(t){return t in Fi?Fi[t]:t}var zi,Vi,Gi,Ui,Hi,Ni,qi,Ki=t=>t.replace(new RegExp("(".concat(Pi,")"),"gi")," $1 ").replace(/,/gi," ").replace(/\s+/gi," "),$i="(".concat(Pi,")"),Zi=String.raw(zi||(zi=U(["(skewX)(",")"],["(skewX)\\(","\\)"])),$i),Ji=String.raw(Vi||(Vi=U(["(skewY)(",")"],["(skewY)\\(","\\)"])),$i),Qi=String.raw(Gi||(Gi=U(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),$i,$i,$i),tn=String.raw(Ui||(Ui=U(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),$i,$i),en=String.raw(Hi||(Hi=U(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),$i,$i),rn=String.raw(Ni||(Ni=U(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),$i,$i,$i,$i,$i,$i),nn="(?:".concat(rn,"|").concat(en,"|").concat(Qi,"|").concat(tn,"|").concat(Zi,"|").concat(Ji,")"),sn="(?:".concat(nn,"*)"),on=String.raw(qi||(qi=U(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),sn),an=new RegExp(on),hn=new RegExp(nn,"g");function cn(t){var e=[];if(!(t=Ki(t).replace(/\s*([()])\s*/gi,"$1"))||t&&!an.test(t))return[...ct];var r,o=n(t.matchAll(hn));try{for(o.s();!(r=o.n()).done;){var a=r.value,h=new RegExp(nn).exec(a[0]);if(h){var c=ct,l=i(h.filter((t=>!!t))),u=l[1],f=s(l.slice(2).map((t=>parseFloat(t))),6),d=f[0],g=f[1],p=f[2],v=f[3],m=f[4],_=f[5];switch(u){case"translate":c=Ht(d,g);break;case"rotate":c=Nt({angle:d},{x:g,y:p});break;case"scale":c=qt(d,g);break;case"skewX":c=$t(d);break;case"skewY":c=Zt(d);break;case"matrix":c=[d,g,p,v,m,_]}e.push(c)}}}catch(y){o.e(y)}finally{o.f()}return Gt(e)}function ln(t,e,r,i){var n,s=Array.isArray(e);if("fill"!==t&&"stroke"!==t||e!==vt){if("strokeUniform"===t)return"non-scaling-stroke"===e;if("strokeDashArray"===t)e=e===vt?null:e.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===t)e=r&&r.transformMatrix?Vt(r.transformMatrix,cn(e)):cn(e);else if("visible"===t)e=e!==vt&&"hidden"!==e,r&&!1===r.visible&&(e=!1);else if("opacity"===t)e=parseFloat(e),r&&void 0!==r.opacity&&(e*=r.opacity);else if("textAnchor"===t)e="start"===e?ft:"end"===e?pt:ut;else if("charSpacing"===t)n=de(e,i)/i*1e3;else if("paintFirst"===t){var o=e.indexOf("fill"),a=e.indexOf("stroke");e="fill",(o>-1&&a>-1&&a<o||-1===o&&a>-1)&&(e="stroke")}else{if("href"===t||"xlink:href"===t||"font"===t)return e;if("imageSmoothing"===t)return"optimizeQuality"===e;n=s?e.map(de):de(e,i)}}else e="";return!s&&isNaN(n)?e:n}function un(t,e,r){if(!t)return{};var i,n,s,o={};void 0===r&&(r=t.getAttribute("svgUid")),t.parentNode&&Bi.test(t.parentNode.nodeName)&&(o=un(t.parentNode,e,r));var a=e.reduce((function(e,r){return(i=t.getAttribute(r))&&(e[r]=i),e}),{}),h=Object.assign(function(t,e){var r={};for(var i in Ei[e])if(Yi(t,i.split(" ")))for(var n in Ei[e][i])r[n]=Ei[e][i][n];return r}(t,r),function(t){var e={},r=t.getAttribute("style");return r?("string"==typeof r?function(t,e){var r,i;t.replace(/;\s*$/,"").split(";").forEach((function(t){var n=t.split(":");r=n[0].trim().toLowerCase(),i=n[1].trim(),e[r]=i}))}(r,e):function(t,e){var r,i;for(var n in t)void 0!==t[n]&&(r=n.toLowerCase(),i=t[n],e[r]=i)}(r,e),e):e}(t));a=Object.assign(a,h),h[Ii]&&t.setAttribute(Ii,h[Ii]),n=s=o.fontSize||16,a[Ri]&&(a[Ri]=n=de(a[Ri],s));var c={};for(var l in a){var u=Wi(l),f=ln(u,a[l],o,n);c[u]=f}c&&c.font&&function(t,e){var r=t.match(ji);if(r){var i=r[1],n=r[3],s=r[4],o=r[5],a=r[6];i&&(e.fontStyle=i),n&&(e.fontWeight=isNaN(parseFloat(n))?n:parseFloat(n)),s&&(e.fontSize=de(s)),a&&(e.fontFamily=a),o&&(e.lineHeight="normal"===o?1:o)}}(c.font,c);var d=W(W({},o),c);return Bi.test(t.nodeName)?d:function(t){for(var e in Li)if(void 0!==t[Li[e]]&&""!==t[e]){var r=Si.getDefaults();if(void 0===t[e]){if(!r[e])continue;t[e]=r[e]}if(0!==t[e].indexOf("url(")){var i=new ue(t[e]);t[e]=i.setAlpha(fe(i.getAlpha()*t[Li[e]],2)).toRgba()}}return t}(d)}var fn=["left","top","width","height","visible"],dn=["rx","ry"];class gn extends Si{static getDefaults(){return W(W({},super.getDefaults()),gn.ownDefaults)}constructor(t){super(t),this._initRxRy()}_initRxRy(){var t=this.rx,e=this.ry;t&&!e?this.ry=t:e&&!t&&(this.rx=e)}_render(t){var e=this.width,r=this.height,i=-e/2,n=-r/2,s=this.rx?Math.min(this.rx,e/2):0,o=this.ry?Math.min(this.ry,r/2):0,a=0!==s||0!==o;t.beginPath(),t.moveTo(i+s,n),t.lineTo(i+e-s,n),a&&t.bezierCurveTo(i+e-lt*s,n,i+e,n+lt*o,i+e,n+o),t.lineTo(i+e,n+r-o),a&&t.bezierCurveTo(i+e,n+r-lt*o,i+e-lt*s,n+r,i+e-s,n+r),t.lineTo(i+s,n+r),a&&t.bezierCurveTo(i+lt*s,n+r,i,n+r-lt*o,i,n+r-o),t.lineTo(i,n+o),a&&t.bezierCurveTo(i,n+lt*o,i+lt*s,n,i+s,n),t.closePath(),this._renderPaintInOrder(t)}toObject(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...dn,...t])}_toSVG(){var t=this.width,e=this.height,r=this.rx,i=this.ry;return["<rect ","COMMON_PARTS",'x="'.concat(-t/2,'" y="').concat(-e/2,'" rx="').concat(r,'" ry="').concat(i,'" width="').concat(t,'" height="').concat(e,'" />\n')]}static fromElement(e,i){var n=arguments,s=this;return r(t().mark((function r(){var i,o,a,h,c,l,u,f,d,g,p,v,m;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=n.length>2&&void 0!==n[2]?n[2]:{},o=un(e,s.ATTRIBUTE_NAMES),a=o.left,h=void 0===a?0:a,c=o.top,l=void 0===c?0:c,u=o.width,f=void 0===u?0:u,d=o.height,g=void 0===d?0:d,p=o.visible,v=void 0===p||p,m=G(o,fn),t.abrupt("return",new s(W(W(W({},i),m),{},{left:h,top:l,width:f,height:g,visible:Boolean(v&&f&&g)})));case 3:case"end":return t.stop()}}),r)})))()}}e("R",gn),z(gn,"type","Rect"),z(gn,"cacheProperties",[...Wr,...dn]),z(gn,"ownDefaults",{rx:0,ry:0}),z(gn,"ATTRIBUTE_NAMES",[...Di,"x","y","rx","ry","width","height"]),xt.setClass(gn),xt.setSVGClass(gn);var pn=["objects"];class vn extends(Mt(Si)){static getDefaults(){return W(W({},super.getDefaults()),vn.ownDefaults)}constructor(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;super(),z(this,"_activeObjects",[]),z(this,"__objectSelectionTracker",void 0),z(this,"__objectSelectionDisposer",void 0),z(this,"_firstLayoutDone",!1),this._objects=t,this.__objectMonitor=this.__objectMonitor.bind(this),this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.set(W(W({},e),{},{angle:0,skewX:0,skewY:0})),this.forEachObject((t=>{this.enterGroup(t,!1)})),this._applyLayoutStrategy({type:"initialization",options:e,objectsRelativeToGroup:r})}canEnterGroup(t){return t===this||this.isDescendantOf(t)?(console.error("fabric.Group: circular object trees are not supported, this call has no effect"),!1):-1===this._objects.indexOf(t)||(console.error("fabric.Group: duplicate objects are not supported inside group, this call has no effect"),!1)}_filterObjectsBeforeEnteringGroup(t){return t.filter(((t,e,r)=>this.canEnterGroup(t)&&r.indexOf(t)===e))}add(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var i=this._filterObjectsBeforeEnteringGroup(e),n=super.add(...i);return this._onAfterObjectsChange("added",i),n}insertAt(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];var n=this._filterObjectsBeforeEnteringGroup(r),s=super.insertAt(t,...n);return this._onAfterObjectsChange("added",n),s}remove(){var t=super.remove(...arguments);return this._onAfterObjectsChange("removed",t),t}_onObjectAdded(t){this.enterGroup(t,!0),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onRelativeObjectAdded(t){this.enterGroup(t,!1),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t,e){this.exitGroup(t,e),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onAfterObjectsChange(t,e){this._applyLayoutStrategy({type:t,targets:e}),this._set("dirty",!0)}_onStackOrderChanged(){this._set("dirty",!0)}_set(t,e){var r=this[t];return super._set(t,e),"canvas"===t&&r!==e&&this.forEachObject((r=>{r._set(t,e)})),"layout"===t&&r!==e&&this._applyLayoutStrategy({type:"layout_change",layout:e,prevLayout:r}),"interactive"===t&&this.forEachObject((t=>this._watchObject(e,t))),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectMonitor(t){this._applyLayoutStrategy(W(W({},t),{},{type:"object_modified"})),this._set("dirty",!0)}__objectSelectionMonitor(t,e){var r=e.target;if(t)this._activeObjects.push(r),this._set("dirty",!0);else if(this._activeObjects.length>0){var i=this._activeObjects.indexOf(r);i>-1&&(this._activeObjects.splice(i,1),this._set("dirty",!0))}}_watchObject(t,e){var r=t?"on":"off";t&&this._watchObject(!1,e),e[r]("changed",this.__objectMonitor),e[r]("modified",this.__objectMonitor),e[r]("selected",this.__objectSelectionTracker),e[r]("deselected",this.__objectSelectionDisposer)}enterGroup(t,e){return t.group&&t.group.remove(t),this._enterGroup(t,e),!0}_enterGroup(t,e){e&&We(t,Vt(zt(this.calcTransformMatrix()),t.calcTransformMatrix())),this._shouldSetNestedCoords()&&t.setCoords(),t._set("group",this),t._set("canvas",this.canvas),this.interactive&&this._watchObject(!0,t);var r=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();r&&(r===t||t.isDescendantOf(r))&&this._activeObjects.push(t)}exitGroup(t,e){this._exitGroup(t,e),t._set("canvas",void 0)}_exitGroup(t,e){t._set("group",void 0),e||(We(t,Vt(this.calcTransformMatrix(),t.calcTransformMatrix())),t.setCoords()),this._watchObject(!1,t);var r=this._activeObjects.length>0?this._activeObjects.indexOf(t):-1;r>-1&&this._activeObjects.splice(r,1)}shouldCache(){var t=Si.prototype.shouldCache.call(this);if(t)for(var e=0;e<this._objects.length;e++)if(this._objects[e].willDrawShadow())return this.ownCaching=!1,!1;return t}willDrawShadow(){if(Si.prototype.willDrawShadow.call(this))return!0;for(var t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.group&&this.group.isOnACache()}drawObject(t){this._renderBackground(t);for(var e=0;e<this._objects.length;e++){var r;null!==(r=this.canvas)&&void 0!==r&&r.preserveObjectStacking&&this._objects[e].group!==this?(t.save(),t.transform(...zt(this.calcTransformMatrix())),this._objects[e].render(t),t.restore()):this._objects[e].group===this&&this._objects[e].render(t)}this._drawClipPath(t,this.clipPath)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject((t=>t.setCoords()))}render(t){this._transformDone=!0,super.render(t),this._transformDone=!1}triggerLayout(t){t&&t.layout&&(t.prevLayout=this.layout,this.layout=t.layout),this._applyLayoutStrategy({type:"imperative",context:t})}_adjustObjectPosition(t,e){t.set({left:t.left+e.x,top:t.top+e.y})}_applyLayoutStrategy(t){var e="initialization"===t.type;if(e||this._firstLayoutDone){var r,i=e&&t.options,n=i&&{angle:i.angle||0,skewX:i.skewX||0,skewY:i.skewY||0},s=this.getRelativeCenterPoint(),o=this.getLayoutStrategyResult(this.layout,[...this._objects],t);if(o){var a=new kt(o.centerX,o.centerY),h=s.subtract(a).add(new kt(o.correctionX||0,o.correctionY||0));r=h.transform(zt(this.calcOwnMatrix()),!0),this.set({width:o.width,height:o.height}),!t.objectsRelativeToGroup&&this.forEachObject((t=>{t.group===this&&this._adjustObjectPosition(t,r)})),!e&&"clip-path"!==this.layout&&this.clipPath&&!this.clipPath.absolutePositioned&&this._adjustObjectPosition(this.clipPath,r),a.eq(s)&&!n||(this.setPositionByOrigin(a,ut,ut),n&&this.set(n),this.setCoords())}else{if(!e)return;o={centerX:s.x,centerY:s.y,width:this.width,height:this.height},n&&this.set(n),r=new kt}this._firstLayoutDone=!0,this.onLayout(t,o),this.fire("layout",{context:t,result:o,diff:r}),this.group&&this.group._applyLayoutStrategy&&(t.path||(t.path=[]),t.path.push(this),this.group._applyLayoutStrategy(t))}}getLayoutStrategyResult(t,e,r){if("fit-content-lazy"===t&&"added"===r.type&&e.length>r.targets.length){var i=r.targets.concat(this);return this.prepareBoundingBox(t,i,r)}if("fit-content"===t||"fit-content-lazy"===t||"fixed"===t&&("initialization"===r.type||"imperative"===r.type))return this.prepareBoundingBox(t,e,r);if("clip-path"===t&&this.clipPath){var n=this.clipPath,s=n._getTransformedDimensions();if(n.absolutePositioned&&("initialization"===r.type||"layout_change"===r.type)){var o=n.getCenterPoint();if(this.group){var a=zt(this.group.calcTransformMatrix());o=Wt(o,a)}return{centerX:o.x,centerY:o.y,width:s.x,height:s.y}}if(!n.absolutePositioned){var h,c=n.getRelativeCenterPoint(),l=Wt(c,this.calcOwnMatrix(),!0);if("initialization"===r.type||"layout_change"===r.type){var u=this.prepareBoundingBox(t,e,r)||{};return{centerX:(h=new kt(u.centerX||0,u.centerY||0)).x+l.x,centerY:h.y+l.y,correctionX:u.correctionX-l.x,correctionY:u.correctionY-l.y,width:n.width,height:n.height}}return{centerX:(h=this.getRelativeCenterPoint()).x+l.x,centerY:h.y+l.y,width:s.x,height:s.y}}}}prepareBoundingBox(t,e,r){return"initialization"===r.type?this.prepareInitialBoundingBox(t,e,r):"imperative"===r.type&&r.context?W(W({},this.getObjectsBoundingBox(e)||{}),r.context):this.getObjectsBoundingBox(e)}prepareInitialBoundingBox(t,e,r){var i=r.options||{},n="number"==typeof i.left,s="number"==typeof i.top,o="number"==typeof i.width,a="number"==typeof i.height;if(!(n&&s&&o&&a&&r.objectsRelativeToGroup||0===e.length)){var h=this.getObjectsBoundingBox(e)||{},c=h.centerX,l=void 0===c?0:c,u=h.centerY,f=void 0===u?0:u,d=h.width,g=void 0===d?0:d,p=h.height,v=void 0===p?0:p,m=o?this.width:g,_=a?this.height:v,y=new kt(l,f),x=new kt($e(this.originX),$e(this.originY)),b=new kt(m,_),w=this._getTransformedDimensions({width:0,height:0}),C=this._getTransformedDimensions({width:m,height:_,strokeWidth:0}),S=this._getTransformedDimensions({width:h.width,height:h.height,strokeWidth:0}),T=new kt(0,0),O=x.scalarAdd(.5),k=C.multiply(O),D=new kt(o?S.x/2:k.x,a?S.y/2:k.y),M=new kt(n?this.left-(C.x+w.x)*x.x:y.x-D.x,s?this.top-(C.y+w.y)*x.y:y.y-D.y),E=new kt(n?M.x-y.x+S.x*(o?.5:0):-(o?.5*(C.x-w.x):C.x*O.x),s?M.y-y.y+S.y*(a?.5:0):-(a?.5*(C.y-w.y):C.y*O.y)).add(T),A=new kt(o?-C.x/2:0,a?-C.y/2:0).add(E);return{centerX:M.x,centerY:M.y,correctionX:A.x,correctionY:A.y,width:b.x,height:b.y}}}getObjectsBoundingBox(t,e){if(0===t.length)return null;var r=[];t.forEach((t=>{var e=t.getRelativeCenterPoint(),i=t._getTransformedDimensions().scalarDivide(2);if(t.angle){var n=Bt(t.angle),s=Math.abs(Ot(n)),o=Math.abs(Tt(n)),a=i.x*o+i.y*s,h=i.x*s+i.y*o;i=new kt(a,h)}r.push(e.subtract(i),e.add(i))}));var i=Be(r),n=i.left,s=i.top,o=i.width,a=i.height,h=new kt(o,a),c=(e?new kt:new kt(n,s)).add(h.scalarDivide(2)).transform(this.calcOwnMatrix());return{centerX:c.x,centerY:c.y,width:h.x,height:h.y}}onLayout(t,e){}__serializeObjects(t,e){var r=this.includeDefaultValues;return this._objects.filter((function(t){return!t.excludeFromExport})).map((function(i){var n=i.includeDefaultValues;i.includeDefaultValues=r;var s=i[t||"toObject"](e);return i.includeDefaultValues=n,s}))}toObject(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return W(W({},super.toObject(["layout","subTargetCheck","interactive",...t])),{},{objects:this.__serializeObjects("toObject",t)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this._activeObjects=[],this.forEachObject((t=>{this._watchObject(!1,t),t.dispose()})),super.dispose()}_createSVGBgRect(t){if(!this.backgroundColor)return"";var e=gn.prototype._toSVG.call(this),r=e.indexOf("COMMON_PARTS");e[r]='for="group" ';var i=e.join("");return t?t(i):i}_toSVG(t){var e=["<g ","COMMON_PARTS"," >\n"],r=this._createSVGBgRect(t);r&&e.push("\t\t",r);for(var i=0;i<this._objects.length;i++)e.push("\t\t",this._objects[i].toSVG(t));return e.push("</g>\n"),e}getSvgStyles(){var t=void 0!==this.opacity&&1!==this.opacity?"opacity: ".concat(this.opacity,";"):"",e=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),e].join("")}toClipPathSVG(t){var e=[],r=this._createSVGBgRect(t);r&&e.push("\t",r);for(var i=0;i<this._objects.length;i++)e.push("\t",this._objects[i].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(e,{reviver:t})}static fromObject(t){var e=t.objects,r=void 0===e?[]:e,i=G(t,pn);return Promise.all([ee(r),re(i)]).then((t=>{var e=s(t,2),r=e[0],n=e[1];return new this(r,W(W({},i),n),!0)}))}}e("G",vn),z(vn,"stateProperties",[...Si.stateProperties,"layout"]),z(vn,"type","Group"),z(vn,"ownDefaults",{layout:"fit-content",strokeWidth:0,subTargetCheck:!1,interactive:!1}),xt.setClass(vn);class mn extends vn{constructor(t,e,r){super(t,e,r),z(this,"multiSelectionStacking","canvas-stacking"),this.setCoords()}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];"selection-order"===this.multiSelectionStacking?this.add(...e):e.forEach((t=>{var e=this._objects.findIndex((e=>e.isInFrontOf(t))),r=-1===e?this.size():e;this.insertAt(r,t)}))}enterGroup(t,e){if(t.group){var r=t.group;r._exitGroup(t),t.__owningGroup=r}return this._enterGroup(t,e),!0}exitGroup(t,e){this._exitGroup(t,e);var r=t.__owningGroup;r&&(r._enterGroup(t,!0),delete t.__owningGroup)}_onAfterObjectsChange(t,e){super._onAfterObjectsChange(t,e);var r=[];e.forEach((t=>{t.group&&!r.includes(t.group)&&r.push(t.group)})),"removed"===t?r.forEach((t=>{t._onAfterObjectsChange("added",e)})):r.forEach((t=>{t._set("dirty",!0)}))}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(t,e,r){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,super._renderControls(t,e);for(var i=W(W({hasControls:!1},r),{},{forActiveSelection:!0}),n=0;n<this._objects.length;n++)this._objects[n]._renderControls(t,i);t.restore()}}e("A",mn),z(mn,"type","ActiveSelection"),xt.setClass(mn),xt.setClass(mn,"activeSelection");class _n{static getAcuteAngleFactor(t,e){var r=e?Mr(t,e):Mr(Tr,t);return Math.abs(r)<ot?-1:1}constructor(t){this.options=t,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new kt(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new kt(1/this.options.scaleX,1/this.options.scaleY):new kt(1,1)}createSideVector(t,e){var r=kr(t,e);return this.options.strokeUniform?r.multiply(this.scale):r}projectOrthogonally(t,e,r){return this.applySkew(t.add(this.calcOrthogonalProjection(t,e,r)))}isSkewed(){return 0!==this.options.skewX||0!==this.options.skewY}applySkew(t){var e=new kt(t);return e.y+=e.x*Math.tan(Bt(this.options.skewY)),e.x+=e.y*Math.tan(Bt(this.options.skewX)),e}scaleUnitVector(t,e){return t.multiply(this.strokeUniformScalar).scalarMultiply(e)}}class yn extends _n{constructor(t,e,r,i){super(i),this.A=new kt(t),this.B=new kt(e),this.C=new kt(r),this.bisector=this.options.strokeUniform?Ar(this.A.multiply(this.scale),this.B.multiply(this.scale),this.C.multiply(this.scale)):Ar(this.A,this.B,this.C)}get bisectorVector(){return this.bisector.vector}get bisectorAngle(){return this.bisector.angle}calcOrthogonalProjection(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude,i=this.createSideVector(t,e),n=Pr(i),s=_n.getAcuteAngleFactor(n,this.bisectorVector);return this.scaleUnitVector(n,r*s)}projectBevel(){return[this.B,this.C].map((t=>this.projectOrthogonally(this.A,t)))}projectMiter(){var t=Math.abs(this.bisectorAngle),e=1/Math.sin(t/2),r=this.scaleUnitVector(this.bisectorVector,-this.strokeProjectionMagnitude*e),i=this.options.strokeUniform?e:this.options.strokeMiterLimit;return Dr(r)/this.strokeProjectionMagnitude<=i?[this.applySkew(this.A.add(r))]:this.projectBevel()}projectRoundNoSkew(){var t=new kt(_n.getAcuteAngleFactor(this.bisectorVector),_n.getAcuteAngleFactor(new kt(this.bisectorVector.y,this.bisectorVector.x))),e=new kt(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(t),r=new kt(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(t);return[this.A.add(e),this.A.add(r)]}projectRoundWithSkew(){var t=[];[this.B,this.C].forEach((e=>t.push(this.projectOrthogonally(this.A,e))));var e=this.options,r=e.skewX,i=e.skewY,n=(new kt).scalarAdd(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar),s=n.y/Math.sqrt(1+Math.pow(Math.tan(Bt(i)),2)),o=new kt(Math.sqrt(Math.pow(n.x,2)-Math.pow(s*n.x/n.y,2)),s),a=n.x/Math.sqrt(1+Math.pow(Math.tan(Bt(r)),2));return[new kt(a,Math.sqrt(Math.pow(s,2)-Math.pow(a*s/n.x,2))),o].forEach((e=>{t.push(this.applySkew(this.A.add(e)),this.applySkew(this.A.subtract(e)))})),t}projectRound(){return this.isSkewed()?this.projectRoundWithSkew():this.projectRoundNoSkew()}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map((t=>({originPoint:this.A,projectedPoint:t,bisector:this.bisector})))}}class xn extends _n{constructor(t,e,r){super(r),this.A=new kt(t),this.T=new kt(e)}calcOrthogonalProjection(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.strokeProjectionMagnitude,i=this.createSideVector(t,e);return this.scaleUnitVector(Pr(i),r)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){return new yn(this.A,this.T,this.T,this.options).projectRound()}projectSquare(){var t=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),e=this.scaleUnitVector(Er(kr(this.A,this.T)),-this.strokeProjectionMagnitude),r=this.A.add(e);return[r.add(t),r.subtract(t)].map((t=>this.applySkew(t)))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map((t=>({originPoint:this.A,projectedPoint:t})))}}var bn,wn=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=[];return t.length<=1||t.forEach(((n,s)=>{var o,a;0===s?(a=t[1],o=r?n:t[t.length-1]):s===t.length-1?(o=t[s-1],a=r?n:t[0]):(o=t[s-1],a=t[s+1]),!r||0!==s&&s!==t.length-1?i.push(...new yn(n,o,a,e).project()):i.push(...new xn(n,0===s?a:o,e).project())})),i},Cn=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t.fill!==e.fill||t.stroke!==e.stroke||t.strokeWidth!==e.strokeWidth||t.fontSize!==e.fontSize||t.fontFamily!==e.fontFamily||t.fontWeight!==e.fontWeight||t.fontStyle!==e.fontStyle||t.textBackgroundColor!==e.textBackgroundColor||t.deltaY!==e.deltaY||r&&(t.overline!==e.overline||t.underline!==e.underline||t.linethrough!==e.linethrough)},Sn=(t,e)=>{var r=e.split("\n"),i=[],n=-1,s={};t=Xr(t);for(var o=0;o<r.length;o++)if(t[o])for(var a=0;a<r[o].length;a++){n++;var h=t[o][a];h&&Object.keys(h).length>0&&(Cn(s,h,!0)?i.push({start:n,end:n+1,style:h}):i[i.length-1].end++),s=h||{}}else n+=r[o].length,s={};return i},Tn=(t,e)=>{if(!Array.isArray(t))return Xr(t);for(var r=e.split(mt),i={},n=-1,s=0,o=0;o<r.length;o++)for(var a=0;a<r[o].length;a++)n++,t[s]&&t[s].start<=n&&n<t[s].end&&(i[o]=i[o]||{},i[o][a]=W({},t[s].style),n===t[s].end-1&&s++);return i},On=(t,e)=>Math.min(e.width/t.width,e.height/t.height),kn=(t,e)=>Math.max(e.width/t.width,e.height/t.height),Dn=t=>t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),Mn=t=>{for(var e,r=[],i=0;i<t.length;i++)!1!==(e=En(t,i))&&r.push(e);return r},En=(t,e)=>{var r=t.charCodeAt(e);if(isNaN(r))return"";if(r<55296||r>57343)return t.charAt(e);if(55296<=r&&r<=56319){if(t.length<=e+1)throw"High surrogate without following low surrogate";var i=t.charCodeAt(e+1);if(56320>i||i>57343)throw"High surrogate without following low surrogate";return t.charAt(e)+t.charAt(e+1)}if(0===e)throw"Low surrogate without preceding high surrogate";var n=t.charCodeAt(e-1);if(55296>n||n>56319)throw"Low surrogate without preceding high surrogate";return!1},An=Object.freeze({__proto__:null,capitalize:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"".concat(t.charAt(0).toUpperCase()).concat(e?t.slice(1):t.slice(1).toLowerCase())},escapeXml:Dn,graphemeSplit:Mn}),Pn="(".concat(Pi,")"),jn="(M) (?:".concat(Pn," ").concat(Pn," ?)+"),Fn="(L) (?:".concat(Pn," ").concat(Pn," ?)+"),Ln="(H) (?:".concat(Pn," ?)+"),Rn="(V) (?:".concat(Pn," ?)+"),In=String.raw(bn||(bn=U(["(Z)s*"],["(Z)\\s*"]))),Bn="(C) (?:".concat(Pn," ").concat(Pn," ").concat(Pn," ").concat(Pn," ").concat(Pn," ").concat(Pn," ?)+"),Xn="(S) (?:".concat(Pn," ").concat(Pn," ").concat(Pn," ").concat(Pn," ?)+"),Yn="(Q) (?:".concat(Pn," ").concat(Pn," ").concat(Pn," ").concat(Pn," ?)+"),Wn="(T) (?:".concat(Pn," ").concat(Pn," ?)+"),zn="(A) (?:".concat(Pn," ").concat(Pn," ").concat(Pn," ([01]) ?([01]) ").concat(Pn," ").concat(Pn," ?)+"),Vn="(?:(?:".concat(jn,")")+"|(?:".concat(Fn,")")+"|(?:".concat(Ln,")")+"|(?:".concat(Rn,")")+"|(?:".concat(In,")")+"|(?:".concat(Bn,")")+"|(?:".concat(Xn,")")+"|(?:".concat(Yn,")")+"|(?:".concat(Wn,")")+"|(?:".concat(zn,"))"),Gn={m:"l",M:"L"},Un=(t,e,r,i,n,s,o,a,h,c,l)=>{var u=Tt(t),f=Ot(t),d=Tt(e),g=Ot(e),p=r*n*d-i*s*g+o,v=i*n*d+r*s*g+a;return["C",c+h*(-r*n*f-i*s*u),l+h*(-i*n*f+r*s*u),p+h*(r*n*g+i*s*d),v+h*(i*n*g-r*s*d),p,v]},Hn=(t,e,r,i)=>{var n=Math.atan2(e,t),s=Math.atan2(i,r);return s>=n?s-n:2*Math.PI-(n-s)};function Nn(t,e,r,i,n,s,o,a){var h;if(q.cachesBoundsOfCurve&&(h=[...arguments].join(),it.boundsOfCurveCache[h]))return it.boundsOfCurveCache[h];for(var c=Math.sqrt,l=Math.abs,u=[],f=[[0,0],[0,0]],d=6*t-12*r+6*n,g=-3*t+9*r-9*n+3*o,p=3*r-3*t,v=0;v<2;++v)if(v>0&&(d=6*e-12*i+6*s,g=-3*e+9*i-9*s+3*a,p=3*i-3*e),l(g)<1e-12){if(l(d)<1e-12)continue;var m=-p/d;0<m&&m<1&&u.push(m)}else{var _=d*d-4*p*g;if(!(_<0)){var y=c(_),x=(-d+y)/(2*g);0<x&&x<1&&u.push(x);var b=(-d-y)/(2*g);0<b&&b<1&&u.push(b)}}for(var w=u.length,C=w,S=Zn(t,e,r,i,n,s,o,a);w--;){var T=S(u[w]),O=T.x,k=T.y;f[0][w]=O,f[1][w]=k}f[0][C]=t,f[1][C]=e,f[0][C+1]=o,f[1][C+1]=a;var D=[new kt(Math.min(...f[0]),Math.min(...f[1])),new kt(Math.max(...f[0]),Math.max(...f[1]))];return q.cachesBoundsOfCurve&&(it.boundsOfCurveCache[h]=D),D}var qn=(t,e,r)=>{for(var i=s(r,8),n=(i[0],i[1]),o=i[2],a=i[3],h=i[4],c=i[5],l=((t,e,r,i,n,s,o)=>{if(0===r||0===i)return[];var a=0,h=0,c=0,l=Math.PI,u=o*ht,f=Ot(u),d=Tt(u),g=.5*(-d*t-f*e),p=.5*(-d*e+f*t),v=Math.pow(r,2),m=Math.pow(i,2),_=Math.pow(p,2),y=Math.pow(g,2),x=v*m-v*_-m*y,b=Math.abs(r),w=Math.abs(i);if(x<0){var C=Math.sqrt(1-x/(v*m));b*=C,w*=C}else c=(n===s?-1:1)*Math.sqrt(x/(v*_+m*y));var S=c*b*p/w,T=-c*w*g/b,O=d*S-f*T+.5*t,k=f*S+d*T+.5*e,D=Hn(1,0,(g-S)/b,(p-T)/w),M=Hn((g-S)/b,(p-T)/w,(-g-S)/b,(-p-T)/w);0===s&&M>0?M-=2*l:1===s&&M<0&&(M+=2*l);for(var E=Math.ceil(Math.abs(M/l*2)),A=new Array(E),P=M/E,j=8/3*Math.sin(P/4)*Math.sin(P/4)/Math.sin(P/2),F=D+P,L=0;L<E;L++)A[L]=Un(D,F,d,f,b,w,O,k,j,a,h),a=A[L][5],h=A[L][6],D=F,F+=P;return A})(i[6]-t,i[7]-e,n,o,h,c,a),u=0,f=l.length;u<f;u++)l[u][1]+=t,l[u][2]+=e,l[u][3]+=t,l[u][4]+=e,l[u][5]+=t,l[u][6]+=e;return l},Kn=t=>{var e,r,i=0,s=0,o=0,a=0,h=[],c=0,l=0,u=n(t);try{for(u.s();!(r=u.n()).done;){var f=[...r.value],d=void 0;switch(f[0]){case"l":f[1]+=i,f[2]+=s;case"L":d=["L",i=f[1],s=f[2]];break;case"h":f[1]+=i;case"H":d=["L",i=f[1],s];break;case"v":f[1]+=s;case"V":d=["L",i,s=f[1]];break;case"m":f[1]+=i,f[2]+=s;case"M":i=f[1],s=f[2],o=f[1],a=f[2],d=["M",i,s];break;case"c":f[1]+=i,f[2]+=s,f[3]+=i,f[4]+=s,f[5]+=i,f[6]+=s;case"C":c=f[3],l=f[4],i=f[5],s=f[6],d=["C",f[1],f[2],c,l,i,s];break;case"s":f[1]+=i,f[2]+=s,f[3]+=i,f[4]+=s;case"S":"C"===e?(c=2*i-c,l=2*s-l):(c=i,l=s),i=f[3],s=f[4],c=(d=["C",c,l,f[1],f[2],i,s])[3],l=d[4];break;case"q":f[1]+=i,f[2]+=s,f[3]+=i,f[4]+=s;case"Q":d=["Q",c=f[1],l=f[2],i=f[3],s=f[4]];break;case"t":f[1]+=i,f[2]+=s;case"T":"Q"===e?(c=2*i-c,l=2*s-l):(c=i,l=s),d=["Q",c,l,i=f[1],s=f[2]];break;case"a":f[6]+=i,f[7]+=s;case"A":qn(i,s,f).forEach((t=>h.push(t))),i=f[6],s=f[7];break;case"z":case"Z":i=o,s=a,d=["Z"]}d?(h.push(d),e=d[0]):e=""}}catch(g){u.e(g)}finally{u.f()}return h},$n=(t,e,r,i)=>Math.sqrt(Math.pow(r-t,2)+Math.pow(i-e,2)),Zn=(t,e,r,i,n,s,o,a)=>h=>{var c,l=(c=h,Math.pow(c,3)),u=(t=>3*Math.pow(t,2)*(1-t))(h),f=(t=>3*t*Math.pow(1-t,2))(h),d=(t=>Math.pow(1-t,3))(h);return new kt(o*l+n*u+r*f+t*d,a*l+s*u+i*f+e*d)},Jn=t=>Math.pow(t,2),Qn=t=>2*t*(1-t),ts=t=>Math.pow(1-t,2),es=(t,e,r,i,n,s,o,a)=>h=>{var c=Jn(h),l=Qn(h),u=ts(h),f=3*(u*(r-t)+l*(n-r)+c*(o-n)),d=3*(u*(i-e)+l*(s-i)+c*(a-s));return Math.atan2(d,f)},rs=(t,e,r,i,n,s)=>o=>{var a=Jn(o),h=Qn(o),c=ts(o);return new kt(n*a+r*h+t*c,s*a+i*h+e*c)},is=(t,e,r,i,n,s)=>o=>{var a=1-o,h=2*(a*(r-t)+o*(n-r)),c=2*(a*(i-e)+o*(s-i));return Math.atan2(c,h)},ns=(t,e,r)=>{for(var i=new kt(e,r),n=0,s=1;s<=100;s+=1){var o=t(s/100);n+=$n(i.x,i.y,o.x,o.y),i=o}return n},ss=(t,e)=>{for(var r,i=0,n=0,s={x:t.x,y:t.y},o=W({},s),a=.01,h=0,c=t.iterator,l=t.angleFinder;n<e&&a>1e-4;)o=c(i),h=i,(r=$n(s.x,s.y,o.x,o.y))+n>e?(i-=a,a/=2):(s=o,i+=a,n+=r);return W(W({},o),{},{angle:l(h)})},os=t=>{var e,r,i,s=0,o=0,a=0,h=0,c=0,l=[],u=n(t);try{for(u.s();!(i=u.n()).done;){var f=i.value,d={x:o,y:a,command:f[0],length:0};switch(f[0]){case"M":r=d,h=o=f[1],c=a=f[2];break;case"L":(r=d).length=$n(o,a,f[1],f[2]),o=f[1],a=f[2];break;case"C":e=Zn(o,a,f[1],f[2],f[3],f[4],f[5],f[6]),(r=d).iterator=e,r.angleFinder=es(o,a,f[1],f[2],f[3],f[4],f[5],f[6]),r.length=ns(e,o,a),o=f[5],a=f[6];break;case"Q":e=rs(o,a,f[1],f[2],f[3],f[4]),(r=d).iterator=e,r.angleFinder=is(o,a,f[1],f[2],f[3],f[4]),r.length=ns(e,o,a),o=f[3],a=f[4];break;case"Z":(r=d).destX=h,r.destY=c,r.length=$n(o,a,h,c),o=h,a=c}s+=r.length,l.push(r)}}catch(g){u.e(g)}finally{u.f()}return l.push({length:s,x:o,y:a}),l},as=function(t,e){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:os(t),i=0;e-r[i].length>0&&i<r.length-2;)e-=r[i].length,i++;var n=r[i],s=e/n.length,o=t[i];switch(n.command){case"M":return{x:n.x,y:n.y,angle:0};case"Z":return W(W({},new kt(n.x,n.y).lerp(new kt(n.destX,n.destY),s)),{},{angle:Math.atan2(n.destY-n.y,n.destX-n.x)});case"L":return W(W({},new kt(n.x,n.y).lerp(new kt(o[1],o[2]),s)),{},{angle:Math.atan2(o[2]-n.y,o[1]-n.x)});case"C":case"Q":return ss(n,e)}},hs=t=>{t=Ki(t);var e,r=[],i=n(t.matchAll(new RegExp(Vn,"gi")));try{for(i.s();!(e=i.n()).done;){var s=e.value[0],o=[],a=void 0;do{if(!(a=new RegExp(Vn,"i").exec(s)))break;var h=a.filter((t=>t));h.shift();var c=h.map((t=>{var e=Number.parseFloat(t);return Number.isNaN(e)?t:e}));if(o.push(c),h.length<=1)break;h.shift(),s=s.replace(new RegExp("".concat(h.join(" ?")," ?$")),"")}while(a);o.reverse().forEach(((t,e)=>{var i=Gn[t[0]];e>0&&("l"==i||"L"==i)&&(t[0]=i),r.push(t)}))}}catch(l){i.e(l)}finally{i.f()}return r},cs=(t,e)=>t.map((t=>t.map(((t,r)=>0===r||void 0===e?t:fe(t,e))).join(" "))).join(" ");var ls=(t,e)=>{var r=t._findCenterFromElement();t.transformMatrix&&((t=>{if(t.transformMatrix){var e=Ut(t.transformMatrix),r=e.scaleX,i=e.scaleY,n=e.angle,s=e.skewX;t.flipX=!1,t.flipY=!1,t.set("scaleX",r),t.set("scaleY",i),t.angle=n,t.skewX=s,t.skewY=0}})(t),r=r.transform(t.transformMatrix)),delete t.transformMatrix,e&&(t.scaleX*=e.scaleX,t.scaleY*=e.scaleY,t.cropX=e.cropX,t.cropY=e.cropY,r.x+=e.offsetLeft,r.y+=e.offsetTop,t.width=e.width,t.height=e.height),t.setPositionByOrigin(r,ut,ut)};e("i",Object.freeze({__proto__:null,addTransformToObject:Ye,animate:Cr,animateColor:Sr,applyTransformToObject:We,calcAngleBetweenVectors:Mr,calcDimensionsMatrix:Jt,calcPlaneChangeMatrix:Ue,cancelAnimFrame:Pt,capValue:_r,composeMatrix:Qt,copyCanvasElement:t=>{var e,r=Lt();return r.width=t.width,r.height=t.height,null===(e=r.getContext("2d"))||void 0===e||e.drawImage(t,0,0),r},cos:Tt,createCanvasElement:Lt,createImage:Rt,createRotateMatrix:Nt,createScaleMatrix:qt,createSkewXMatrix:$t,createSkewYMatrix:Zt,createTranslateMatrix:Ht,createVector:kr,degreesToRadians:Bt,ease:ur,enlivenObjectEnlivables:re,enlivenObjects:ee,findScaleToCover:kn,findScaleToFit:On,getBisector:Ar,getBoundsOfCurve:Nn,getPathSegmentsInfo:os,getPointOnPath:as,getPointer:Le,getRandomInt:(t,e)=>Math.floor(Math.random()*(e-t+1))+t,getRegularPolygonPath:(t,e)=>{var r=2*Math.PI/t,i=-ot;t%2==0&&(i+=r/2);for(var n=new Array(t+1),s=0;s<t;s++){var o=s*r+i,a=new kt(Tt(o),Ot(o)).scalarMultiply(e),h=a.x,c=a.y;n[s]=[0===s?"M":"L",h,c]}return n[t]=["Z"],n},getSmoothPathFromPoints:function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=new kt(t[0]),n=new kt(t[1]),s=1,o=0,a=[],h=t.length,c=h>2;for(c&&(s=t[2].x<n.x?-1:t[2].x===n.x?0:1,o=t[2].y<n.y?-1:t[2].y===n.y?0:1),a.push(["M",i.x-s*r,i.y-o*r]),e=1;e<h;e++){if(!i.eq(n)){var l=i.midPointFrom(n);a.push(["Q",i.x,i.y,l.x,l.y])}i=t[e],e+1<t.length&&(n=t[e+1])}return c&&(s=i.x>t[e-2].x?1:i.x===t[e-2].x?0:-1,o=i.y>t[e-2].y?1:i.y===t[e-2].y?0:-1),a.push(["L",i.x+s*r,i.y+o*r]),a},getSvgAttributes:t=>{var e=["instantiated_by_use","style","id","class"];switch(t){case"linearGradient":return e.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);case"radialGradient":return e.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);case"stop":return e.concat(["offset","stop-color","stop-opacity"])}return e},getUnitVector:Er,groupSVGElements:t=>t&&1===t.length?t[0]:new vn(t),hasStyleChanged:Cn,invertTransform:zt,isIdentityMatrix:t=>t.every(((t,e)=>t===ct[e])),isTouchEvent:Re,isTransparent:ki,joinPath:cs,loadImage:te,makeBoundingBoxFromPoints:Be,makePathSimpler:Kn,matrixToSVG:pe,mergeClipPaths:(t,e)=>{var r,i=t,n=e;i.inverted&&!n.inverted&&(i=e,n=t),Ne(n,null===(r=n.group)||void 0===r?void 0:r.calcTransformMatrix(),i.calcTransformMatrix());var s=i.inverted&&n.inverted;return s&&(i.inverted=n.inverted=!1),new vn([i],{clipPath:n,inverted:s})},multiplyTransformMatrices:Vt,multiplyTransformMatrixArray:Gt,parsePath:hs,parsePreserveAspectRatioAttribute:ge,parseUnit:de,pick:ie,projectStrokeOnPoints:wn,qrDecompose:Ut,radiansToDegrees:Xt,removeFromArray:St,removeTransformFromObject:(t,e)=>{var r=zt(e),i=Vt(r,t.calcOwnMatrix());We(t,i)},removeTransformMatrixForSvgParsing:ls,request:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.method?e.method.toUpperCase():"GET",i=e.onComplete||st,n=new(rt().XMLHttpRequest),s=e.body||e.parameters,o=e.signal,a=function(){n.abort()},h=function(){o&&o.removeEventListener("abort",a),n.onerror=n.ontimeout=st};if(o&&o.aborted)throw new Error("`options.signal` is in `aborted` state");if(o&&o.addEventListener("abort",a,{once:!0}),n.onreadystatechange=function(){4===n.readyState&&(h(),i(n),n.onreadystatechange=st)},n.onerror=n.ontimeout=h,"GET"===r&&e.parameters){var c=new URL(t),l=c.origin,u=c.pathname,f=c.searchParams;t="".concat(l).concat(u,"?").concat(new URLSearchParams([...Array.from(f.entries()),...Object.entries(e.parameters)]))}return n.open(r,t,!0),"POST"!==r&&"PUT"!==r||n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send("GET"===r?null:s),n},requestAnimFrame:At,resetObjectTransform:ze,rotatePoint:(t,e,r)=>t.rotate(r,e),rotateVector:Or,saveObjectTransform:Ve,sendObjectToPlane:Ne,sendPointToPlane:He,setStyle:ke,sin:Ot,sizeAfterTransform:Ge,string:An,stylesFromArray:Tn,stylesToArray:Sn,toDataURL:It,toFixed:fe,transformPath:(t,e,r)=>(r&&(e=Vt(e,[1,0,0,1,-r.x,-r.y])),t.map((t=>{for(var r=[...t],i=1;i<t.length-1;i+=2){var n=Wt({x:t[i],y:t[i+1]},e),s=n.x,o=n.y;r[i]=s,r[i+1]=o}return r}))),transformPoint:Wt,transformPointRelativeToCanvas:(t,e,r,i)=>{if("child"!==r&&"sibling"!==r)throw new Error("fabric.js: received bad argument ".concat(r));if("child"!==i&&"sibling"!==i)throw new Error("fabric.js: received bad argument ".concat(i));if(r===i)return t;var n=e.viewportTransform;return t.transform("child"===i?zt(n):n)}}));class us extends Ae{constructor(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.allowTouchScrolling,i=void 0!==r&&r,n=e.containerClass,s=void 0===n?"":n;super(t),z(this,"upper",void 0),z(this,"container",void 0);var o=this.lower.el,a=this.createUpperCanvas();this.upper={el:a,ctx:a.getContext("2d")},this.applyCanvasStyle(o,{allowTouchScrolling:i}),this.applyCanvasStyle(a,{allowTouchScrolling:i});var h=this.createContainerElement();h.classList.add(s),o.parentNode&&o.parentNode.replaceChild(h,o),h.append(o,a),this.container=h}createUpperCanvas(){var t=this.lower.el,e=Lt();return e.className=t.className,e.classList.remove("lower-canvas"),e.classList.add("upper-canvas"),e.setAttribute("data-fabric","top"),e.style.cssText=t.style.cssText,e.setAttribute("draggable","true"),e}createContainerElement(){var t=et().createElement("div");return t.setAttribute("data-fabric","wrapper"),ke(t,{position:"relative"}),Ee(t),t}applyCanvasStyle(t,e){var r=e.allowTouchScrolling;ke(t,{position:"absolute",left:0,top:0}),function(t,e){var r=e?"manipulation":vt;ke(t,{"touch-action":r,"-ms-touch-action":r})}(t,r),Ee(t)}setDimensions(t,e){super.setDimensions(t,e);var r=this.upper,i=r.el,n=r.ctx;De(i,n,t,e)}setCSSDimensions(t){super.setCSSDimensions(t),Me(this.upper.el,t),Me(this.container,t)}cleanupDOM(t){var e=this.container,r=this.lower.el,i=this.upper.el;super.cleanupDOM(t),e.removeChild(i),e.removeChild(r),e.parentNode&&e.parentNode.replaceChild(r,e)}dispose(){super.dispose(),tt().dispose(this.upper.el),delete this.upper,delete this.container}}class fs extends je{static getDefaults(){return W(W({},super.getDefaults()),fs.ownDefaults)}get upperCanvasEl(){var t;return null===(t=this.elements.upper)||void 0===t?void 0:t.el}get contextTop(){var t;return null===(t=this.elements.upper)||void 0===t?void 0:t.ctx}get wrapperEl(){return this.elements.container}constructor(t){super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),z(this,"interactive",!0),z(this,"targets",[]),z(this,"_hoveredTargets",[]),z(this,"_objectsToRender",[]),z(this,"_currentTransform",null),z(this,"_groupSelector",null),z(this,"contextTopDirty",!1),z(this,"_activeSelection",void 0),this._activeSelection=new mn([],{canvas:this})}initElements(t){this.elements=new us(t,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(t){this._objectsToRender=void 0,super._onObjectAdded(t)}_onObjectRemoved(t){this._objectsToRender=void 0,t===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[t]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[t]}),t.fire("deselected",{target:t})),t===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(t)}_chooseObjectsToRender(){var t=this._activeObject;return!this.preserveObjectStacking&&t?this._objects.filter((e=>!e.group&&e!==t)).concat(t):this._objects}renderAll(){this.cancelRequestedRender(),this.destroyed||(!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore()}renderTop(){var t=this.contextTop;this.clearContext(t),this.renderTopLayer(t),this.fire("after:render",{ctx:t})}_normalizePointer(t,e){return Wt(this.restorePointerVpt(e),zt(t.calcTransformMatrix()))}setTargetFindTolerance(t){t=Math.round(t),this.targetFindTolerance=t;var e=this.getRetinaScaling(),r=Math.ceil((2*t+1)*e);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=r,this.pixelFindContext.scale(e,e)}isTargetTransparent(t,e,r){var i=this.targetFindTolerance,n=this.pixelFindContext;this.clearContext(n),n.save(),n.translate(-e+i,-r+i),n.transform(...this.viewportTransform);var s=t.selectionBackgroundColor;t.selectionBackgroundColor="",t.render(n),t.selectionBackgroundColor=s,n.restore();var o=Math.round(i*this.getRetinaScaling());return ki(n,o,o,o)}_isSelectionKeyPressed(t){var e=this.selectionKey;return!!e&&(Array.isArray(e)?!!e.find((e=>!!e&&!0===t[e])):t[e])}_shouldClearSelection(t,e){var r=this.getActiveObjects(),i=this._activeObject;return!!(!e||e&&i&&r.length>1&&-1===r.indexOf(e)&&i!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&i&&i!==e)}_shouldCenterTransform(t,e,r){var i;if(t)return"scale"===e||"scaleX"===e||"scaleY"===e||"resizing"===e?i=this.centeredScaling||t.centeredScaling:"rotate"===e&&(i=this.centeredRotation||t.centeredRotation),i?!r:r}_getOriginFromCorner(t,e){var r={x:t.originX,y:t.originY};return["ml","tl","bl"].includes(e)?r.x=pt:["mr","tr","br"].includes(e)&&(r.x=ft),["tl","mt","tr"].includes(e)?r.y=gt:["bl","mb","br"].includes(e)&&(r.y=dt),r}_setupCurrentTransform(t,e,r){if(e){var i=e.group?He(this.getPointer(t),void 0,e.group.calcTransformMatrix()):this.getPointer(t),n=e.__corner||"",s=!!n&&e.controls[n],o=r&&s?s.getActionHandler(t,e,s):nr,a=((t,e,r,i)=>{if(!e||!t)return"drag";var n=i.controls[e];return n.getActionName(r,n,i)})(r,n,t,e),h=this._getOriginFromCorner(e,n),c=t[this.centeredKey],l={target:e,action:a,actionHandler:o,actionPerformed:!1,corner:n,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:i.x-e.left,offsetY:i.y-e.top,originX:h.x,originY:h.y,ex:i.x,ey:i.y,lastX:i.x,lastY:i.y,theta:Bt(e.angle),width:e.width,height:e.height,shiftKey:t.shiftKey,altKey:c,original:W(W({},Ve(e)),{},{originX:h.x,originY:h.y})};this._shouldCenterTransform(e,a,c)&&(l.originX=ut,l.originY=ut),this._currentTransform=l,this._beforeTransform(t)}}setCursor(t){this.upperCanvasEl.style.cursor=t}_drawSelection(t){var e=this._groupSelector,r=e.x,i=e.y,n=e.deltaX,s=e.deltaY,o=new kt(r,i).transform(this.viewportTransform),a=new kt(r+n,i+s).transform(this.viewportTransform),h=this.selectionLineWidth/2,c=Math.min(o.x,a.x),l=Math.min(o.y,a.y),u=Math.max(o.x,a.x),f=Math.max(o.y,a.y);this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(c,l,u-c,f-l)),this.selectionLineWidth&&this.selectionBorderColor&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,c+=h,l+=h,u-=h,f-=h,Si.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(c,l,u-c,f-l))}findTarget(t){if(!this.skipTargetFind){var e=this.getPointer(t,!0),r=this._activeObject,i=this.getActiveObjects();if(this.targets=[],r&&i.length>=1){if(r._findTargetCorner(e,Re(t)))return r;if(i.length>1&&this.searchPossibleTargets([r],e))return r;if(r===this.searchPossibleTargets([r],e)){if(this.preserveObjectStacking){var n=this.targets;this.targets=[];var s=this.searchPossibleTargets(this._objects,e);return t[this.altSelectionKey]&&s&&s!==r?(this.targets=n,r):s}return r}}return this.searchPossibleTargets(this._objects,e)}}_checkTarget(t,e,r){if(e&&e.visible&&e.evented&&e.containsPoint(t)){if(!this.perPixelTargetFind&&!e.perPixelTargetFind||e.isEditing)return!0;if(!this.isTargetTransparent(e,r.x,r.y))return!0}return!1}_searchPossibleTargets(t,e){for(var r,i=t.length;i--;){var n=t[i],s=n.group?this._normalizePointer(n.group,e):e;if(this._checkTarget(s,n,e)){if(r=t[i],xe(r)&&r.subTargetCheck){var o=this._searchPossibleTargets(r._objects,e);o&&this.targets.push(o)}break}}return r}searchPossibleTargets(t,e){var r=this._searchPossibleTargets(t,e);return r&&xe(r)&&r.interactive&&this.targets[0]?this.targets[0]:r}restorePointerVpt(t){return t.transform(zt(this.viewportTransform))}getPointer(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._absolutePointer&&!e)return this._absolutePointer;if(this._pointer&&e)return this._pointer;var r=this.upperCanvasEl,i=r.getBoundingClientRect(),n=Le(t),s=i.width||0,o=i.height||0;s&&o||(dt in i&&gt in i&&(o=Math.abs(i.top-i.bottom)),pt in i&&ft in i&&(s=Math.abs(i.right-i.left))),this.calcOffset(),n.x=n.x-this._offset.left,n.y=n.y-this._offset.top,e||(n=this.restorePointerVpt(n));var a=this.getRetinaScaling();1!==a&&(n.x/=a,n.y/=a);var h=0===s||0===o?new kt(1,1):new kt(r.width/s,r.height/o);return n.multiply(h)}_setDimensionsImpl(t,e){this._resetTransformEventData(),super._setDimensionsImpl(t,e),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=Lt(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveSelection(){return this._activeSelection}getActiveObjects(){var t=this._activeObject;return t?t===this._activeSelection?[...t._objects]:[t]:[]}_fireSelectionEvents(t,e){var r=!1,i=!1,n=this.getActiveObjects(),s=[],o=[];t.forEach((t=>{n.includes(t)||(r=!0,t.fire("deselected",{e:e,target:t}),o.push(t))})),n.forEach((i=>{t.includes(i)||(r=!0,i.fire("selected",{e:e,target:i}),s.push(i))})),t.length>0&&n.length>0?(i=!0,r&&this.fire("selection:updated",{e:e,selected:s,deselected:o})):n.length>0?(i=!0,this.fire("selection:created",{e:e,selected:s})):t.length>0&&(i=!0,this.fire("selection:cleared",{e:e,deselected:o})),i&&(this._objectsToRender=void 0)}setActiveObject(t,e){var r=this.getActiveObjects(),i=this._setActiveObject(t,e);return this._fireSelectionEvents(r,e),i}_setActiveObject(t,e){return this._activeObject!==t&&(!(!this._discardActiveObject(e,t)&&this._activeObject)&&(!t.onSelect({e:e})&&(this._activeObject=t,!0)))}_discardActiveObject(t,e){var r=this._activeObject;return!!r&&(!r.onDeselect({e:t,object:e})&&(r===this._activeSelection&&(this._activeSelection.removeAll(),ze(this._activeSelection)),this._currentTransform&&this._currentTransform.target===r&&this.endCurrentTransform(t),this._activeObject=void 0,!0))}discardActiveObject(t){var e=this.getActiveObjects(),r=this.getActiveObject();e.length&&this.fire("before:selection:cleared",{e:t,deselected:[r]});var i=this._discardActiveObject(t);return this._fireSelectionEvents(e,t),i}setViewportTransform(t){super.setViewportTransform(t);var e=this._activeObject;e&&e.setCoords()}destroy(){var t=this._activeSelection;t.removeAll(),this._activeSelection=void 0,t.dispose(),super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(t){var e=this._activeObject;e&&e._renderControls(t)}_toObject(t,e,r){var i=this._realizeGroupTransformOnObject(t),n=super._toObject(t,e,r);return t.set(i),n}_realizeGroupTransformOnObject(t){if(t.group&&t.group===this._activeSelection&&this._activeObject===t.group){var e=ie(t,["angle","flipX","flipY",ft,"scaleX","scaleY","skewX","skewY",dt]);return Ye(t,this._activeObject.calcOwnMatrix()),e}return{}}_setSVGObject(t,e,r){var i=this._realizeGroupTransformOnObject(e);super._setSVGObject(t,e,r),e.set(i)}}z(fs,"ownDefaults",{uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,preserveObjectStacking:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1});class ds{constructor(t){z(this,"targets",[]),z(this,"__disposer",void 0);var e=()=>{var e=t.getActiveObject();we(e)&&e.hiddenTextarea&&e.hiddenTextarea.focus()},r=t.upperCanvasEl;r.addEventListener("click",e),this.__disposer=()=>r.removeEventListener("click",e)}exitTextEditing(){this.target=void 0,this.targets.forEach((t=>{t.isEditing&&t.exitEditing()}))}add(t){this.targets.push(t)}remove(t){this.unregister(t),St(this.targets,t)}register(t){this.target=t}unregister(t){t===this.target&&(this.target=void 0)}onMouseMove(t){var e;(null===(e=this.target)||void 0===e?void 0:e.isEditing)&&this.target.updateSelectionOnMouseMove(t)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}var gs=["target","oldTarget","fireCanvas","e"],ps={passive:!1};function vs(t,e){return!!t.button&&t.button===e-1}var ms=function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return t.addEventListener(...r)},_s=function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return t.removeEventListener(...r)},ys={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class xs extends fs{constructor(t){super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),z(this,"_isClick",void 0),z(this,"textEditingManager",new ds(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onDoubleClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach((t=>{this[t]=this[t].bind(this)})),this.addOrRemove(ms,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(t,e){var r=this.upperCanvasEl,i=this._getEventPrefix();t(Oe(r),"resize",this._onResize),t(r,i+"down",this._onMouseDown),t(r,"".concat(i,"move"),this._onMouseMove,ps),t(r,"".concat(i,"out"),this._onMouseOut),t(r,"".concat(i,"enter"),this._onMouseEnter),t(r,"wheel",this._onMouseWheel),t(r,"contextmenu",this._onContextMenu),t(r,"dblclick",this._onDoubleClick),t(r,"dragstart",this._onDragStart),t(r,"dragend",this._onDragEnd),t(r,"dragover",this._onDragOver),t(r,"dragenter",this._onDragEnter),t(r,"dragleave",this._onDragLeave),t(r,"drop",this._onDrop),this.enablePointerEvents||t(r,"touchstart",this._onTouchStart,ps)}removeListeners(){this.addOrRemove(_s,"remove");var t=this._getEventPrefix(),e=Te(this.upperCanvasEl);_s(e,"".concat(t,"up"),this._onMouseUp),_s(e,"touchend",this._onTouchEnd,ps),_s(e,"".concat(t,"move"),this._onMouseMove,ps),_s(e,"touchmove",this._onMouseMove,ps)}_onMouseWheel(t){this.__onMouseWheel(t)}_onMouseOut(t){var e=this._hoveredTarget,r={e:t,isClick:!1,pointer:this.getPointer(t),absolutePointer:this.getPointer(t,!0)};this.fire("mouse:out",W(W({},r),{},{target:e})),this._hoveredTarget=void 0,e&&e.fire("mouseout",W({},r)),this._hoveredTargets.forEach((t=>{this.fire("mouse:out",W(W({},r),{},{target:t})),t&&t.fire("mouseout",W({},r))})),this._hoveredTargets=[]}_onMouseEnter(t){this._currentTransform||this.findTarget(t)||(this.fire("mouse:over",{e:t,isClick:!1,pointer:this.getPointer(t),absolutePointer:this.getPointer(t,!0)}),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(t){this._isClick=!1;var e=this.getActiveObject();if(Ce(e)&&e.onDragStart(t)){this._dragSource=e;var r={e:t,target:e};return this.fire("dragstart",r),e.fire("dragstart",r),void ms(this.upperCanvasEl,"drag",this._onDragProgress)}Ie(t)}_renderDragEffects(t,e,r){var i=!1,n=this._dropTarget;n&&n!==e&&n!==r&&(n.clearContextTop(),i=!0),null==e||e.clearContextTop(),r!==e&&(null==r||r.clearContextTop());var s=this.contextTop;s.save(),s.transform(...this.viewportTransform),e&&(s.save(),e.transform(s),e.renderDragSourceEffect(t),s.restore(),i=!0),r&&(s.save(),r.transform(s),r.renderDropTargetEffect(t),s.restore(),i=!0),s.restore(),i&&(this.contextTopDirty=!0)}_onDragEnd(t){var e=!!t.dataTransfer&&t.dataTransfer.dropEffect!==vt,r=e?this._activeObject:void 0,i={e:t,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:e,dropTarget:r};_s(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",i),this._dragSource&&this._dragSource.fire("dragend",i),delete this._dragSource,this._onMouseUp(t)}_onDragProgress(t){var e={e:t,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",e),this._dragSource&&this._dragSource.fire("drag",e)}findDragTargets(t){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getPointer(t,!0)),targets:[...this.targets]}}_onDragOver(t){var e,r="dragover",i=this.findDragTargets(t),n=i.target,s=i.targets,o=this._dragSource,a={e:t,target:n,subTargets:s,dragSource:o,canDrop:!1,dropTarget:void 0};this.fire(r,a),this._fireEnterLeaveEvents(n,a),n&&(n.canDrop(t)&&(e=n),n.fire(r,a));for(var h=0;h<s.length;h++){var c=s[h];c.canDrop(t)&&(e=c),c.fire(r,a)}this._renderDragEffects(t,o,e),this._dropTarget=e}_onDragEnter(t){var e=this.findDragTargets(t),r=e.target,i={e:t,target:r,subTargets:e.targets,dragSource:this._dragSource};this.fire("dragenter",i),this._fireEnterLeaveEvents(r,i)}_onDragLeave(t){var e={e:t,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",e),this._fireEnterLeaveEvents(void 0,e),this._renderDragEffects(t,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(t){var e=this.findDragTargets(t),r=e.target,i=e.targets,n=this._basicEventHandler("drop:before",{e:t,target:r,subTargets:i,dragSource:this._dragSource,pointer:this.getPointer(t)});n.didDrop=!1,n.dropTarget=void 0,this._basicEventHandler("drop",n),this.fire("drop:after",n)}_onContextMenu(t){var e=this.findTarget(t),r=this.targets||[],i=this._basicEventHandler("contextmenu:before",{e:t,target:e,subTargets:r});return this.stopContextMenu&&Ie(t),this._basicEventHandler("contextmenu",i),!1}_onDoubleClick(t){this._cacheTransformEventData(t),this._handleEvent(t,"dblclick"),this._resetTransformEventData()}getPointerId(t){var e=t.changedTouches;return e?e[0]&&e[0].identifier:this.enablePointerEvents?t.pointerId:-1}_isMainEvent(t){return!0===t.isPrimary||!1!==t.isPrimary&&("touchend"===t.type&&0===t.touches.length||(!t.changedTouches||t.changedTouches[0].identifier===this.mainTouchId))}_onTouchStart(t){t.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();var e=this.upperCanvasEl,r=this._getEventPrefix(),i=Te(e);ms(i,"touchend",this._onTouchEnd,ps),ms(i,"touchmove",this._onMouseMove,ps),_s(e,"".concat(r,"down"),this._onMouseDown)}_onMouseDown(t){this.__onMouseDown(t),this._resetTransformEventData();var e=this.upperCanvasEl,r=this._getEventPrefix();_s(e,"".concat(r,"move"),this._onMouseMove,ps);var i=Te(e);ms(i,"".concat(r,"up"),this._onMouseUp),ms(i,"".concat(r,"move"),this._onMouseMove,ps)}_onTouchEnd(t){if(!(t.touches.length>0)){this.__onMouseUp(t),this._resetTransformEventData(),this.mainTouchId=null;var e=this._getEventPrefix(),r=Te(this.upperCanvasEl);_s(r,"touchend",this._onTouchEnd,ps),_s(r,"touchmove",this._onMouseMove,ps),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout((()=>{ms(this.upperCanvasEl,"".concat(e,"down"),this._onMouseDown),this._willAddMouseDown=0}),400)}}_onMouseUp(t){this.__onMouseUp(t),this._resetTransformEventData();var e=this.upperCanvasEl,r=this._getEventPrefix();if(this._isMainEvent(t)){var i=Te(this.upperCanvasEl);_s(i,"".concat(r,"up"),this._onMouseUp),_s(i,"".concat(r,"move"),this._onMouseMove,ps),ms(e,"".concat(r,"move"),this._onMouseMove,ps)}}_onMouseMove(t){var e=this.getActiveObject();!this.allowTouchScrolling&&(!e||Ce(e)&&!e.shouldStartDragging())&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(t){var e=this.getActiveObject();return!!(!!e!=!!t||e&&t&&e!==t)||(we(e),!1)}__onMouseUp(t){var e=this._currentTransform;this._cacheTransformEventData(t);var r=this._target,i=this._isClick;if(this._handleEvent(t,"up:before"),vs(t,3))this.fireRightClick&&this._handleEvent(t,"up",3,i);else{if(vs(t,2))return this.fireMiddleClick&&this._handleEvent(t,"up",2,i),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(t);else if(this._isMainEvent(t)){var n,s,o=!1;if(e&&(this._finalizeCurrentTransform(t),o=e.actionPerformed),!i){var a=r===this._activeObject;this.handleSelection(t),o||(o=this._shouldRender(r)||!a&&r===this._activeObject)}if(r){if(s=r._findTargetCorner(this.getPointer(t,!0),Re(t)),r.selectable&&r!==this._activeObject&&"up"===r.activeOn)this.setActiveObject(r,t),o=!0;else{var h=r.controls[s],c=h&&h.getMouseUpHandler(t,r,h);c&&c(t,e,(n=this.getPointer(t)).x,n.y)}r.isMoving=!1}if(e&&(e.target!==r||e.corner!==s)){var l=e.target&&e.target.controls[e.corner],u=l&&l.getMouseUpHandler(t,e.target,l);n=n||this.getPointer(t),u&&u(t,e,n.x,n.y)}this._setCursorFromEvent(t,r),this._handleEvent(t,"up",1,i),this._groupSelector=null,this._currentTransform=null,r&&(r.__corner=void 0),o?this.requestRenderAll():i||we(this._activeObject)&&this._activeObject.isEditing||this.renderTop()}}}_basicEventHandler(t,e){var r=e.target,i=e.subTargets,n=void 0===i?[]:i;this.fire(t,e),r&&r.fire(t,e);for(var s=0;s<n.length;s++)n[s].fire(t,e);return e}_handleEvent(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=this._target,s=this.targets||[],o={e:t,target:n,subTargets:s,button:r,isClick:i,pointer:this.getPointer(t),absolutePointer:this.getPointer(t,!0),transform:this._currentTransform};"up"===e&&(o.currentTarget=this.findTarget(t),o.currentSubTargets=this.targets),this.fire("mouse:".concat(e),o),n&&n.fire("mouse".concat(e),o);for(var a=0;a<s.length;a++)s[a].fire("mouse".concat(e),o)}endCurrentTransform(t){var e=this._currentTransform;this._finalizeCurrentTransform(t),e&&e.target&&(e.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(t){var e=this._currentTransform,r=e.target,i={e:t,target:r,transform:e,action:e.action};r._scaling&&(r._scaling=!1),r.setCoords(),e.actionPerformed&&(this.fire("object:modified",i),r.fire("modified",i))}_onMouseDownInDrawingMode(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(t),this.requestRenderAll());var e=this.getPointer(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down")}_onMouseMoveInDrawingMode(t){if(this._isCurrentlyDrawing){var e=this.getPointer(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")}_onMouseUpInDrawingMode(t){var e=this.getPointer(t);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:t,pointer:e}):this._isCurrentlyDrawing=!1,this._handleEvent(t,"up")}__onMouseDown(t){this._isClick=!0,this._cacheTransformEventData(t),this._handleEvent(t,"down:before");var e=this._target;if(vs(t,3))this.fireRightClick&&this._handleEvent(t,"down",3);else if(vs(t,2))this.fireMiddleClick&&this._handleEvent(t,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(t);else if(this._isMainEvent(t)&&!this._currentTransform){var r=this._shouldRender(e),i=!1;if(this.handleMultiSelection(t,e)?(e=this._activeObject,i=!0,r=!0):this._shouldClearSelection(t,e)&&this.discardActiveObject(t),this.selection&&(!e||!e.selectable&&!e.isEditing&&e!==this._activeObject)){var n=this.getPointer(t);this._groupSelector={x:n.x,y:n.y,deltaY:0,deltaX:0}}if(e){var s=e===this._activeObject;e.selectable&&"down"===e.activeOn&&this.setActiveObject(e,t);var o=e._findTargetCorner(this.getPointer(t,!0),Re(t));if(e===this._activeObject&&(o||!i)){this._setupCurrentTransform(t,e,s);var a=e.controls[o],h=this.getPointer(t),c=a&&a.getMouseDownHandler(t,e,a);c&&c(t,this._currentTransform,h.x,h.y)}}r&&(this._objectsToRender=void 0),this._handleEvent(t,"down"),r&&this.requestRenderAll()}}_resetTransformEventData(){this._target=void 0,this._pointer=void 0,this._absolutePointer=void 0}_cacheTransformEventData(t){this._resetTransformEventData(),this._pointer=this.getPointer(t,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)}_beforeTransform(t){var e=this._currentTransform;this.fire("before:transform",{e:t,transform:e})}__onMouseMove(t){if(this._isClick=!1,this._handleEvent(t,"move:before"),this._cacheTransformEventData(t),this.isDrawingMode)this._onMouseMoveInDrawingMode(t);else if(this._isMainEvent(t)){var e=this._groupSelector;if(e){var r=this.getPointer(t);e.deltaX=r.x-e.x,e.deltaY=r.y-e.y,this.renderTop()}else if(this._currentTransform)this._transformObject(t);else{var i=this.findTarget(t);this._setCursorFromEvent(t,i),this._fireOverOutEvents(t,i)}this.textEditingManager.onMouseMove(t),this._handleEvent(t,"move"),this._resetTransformEventData()}}_fireOverOutEvents(t,e){var r=this._hoveredTarget,i=this._hoveredTargets,n=this.targets,s=Math.max(i.length,n.length);this.fireSyntheticInOutEvents("mouse",{e:t,target:e,oldTarget:r,fireCanvas:!0});for(var o=0;o<s;o++)this.fireSyntheticInOutEvents("mouse",{e:t,target:n[o],oldTarget:i[o]});this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(t,e){var r=this._draggedoverTarget,i=this._hoveredTargets,n=this.targets,s=Math.max(i.length,n.length);this.fireSyntheticInOutEvents("drag",W(W({},e),{},{target:t,oldTarget:r,fireCanvas:!0}));for(var o=0;o<s;o++)this.fireSyntheticInOutEvents("drag",W(W({},e),{},{target:n[o],oldTarget:i[o]}));this._draggedoverTarget=t}fireSyntheticInOutEvents(t,e){var r=e.target,i=e.oldTarget,n=e.fireCanvas,s=e.e,o=G(e,gs),a=ys[t],h=a.targetIn,c=a.targetOut,l=a.canvasIn,u=a.canvasOut,f=i!==r;if(i&&f){var d=W(W({},o),{},{e:s,target:i,nextTarget:r,isClick:!1,pointer:this.getPointer(s),absolutePointer:this.getPointer(s,!0)});n&&this.fire(l,d),i.fire(c,d)}if(r&&f){var g=W(W({},o),{},{e:s,target:r,previousTarget:i,isClick:!1,pointer:this.getPointer(s),absolutePointer:this.getPointer(s,!0)});n&&this.fire(u,g),r.fire(h,g)}}__onMouseWheel(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()}_transformObject(t){var e=this.getPointer(t),r=this._currentTransform,i=r.target,n=i.group?He(e,void 0,i.group.calcTransformMatrix()):e;r.reset=!1,r.shiftKey=t.shiftKey,r.altKey=!!this.centeredKey&&t[this.centeredKey],this._performTransformAction(t,r,n),r.actionPerformed&&this.requestRenderAll()}_performTransformAction(t,e,r){var i=r.x,n=r.y,s=e.action,o=e.actionHandler,a=!1;o&&(a=o(t,e,i,n)),"drag"===s&&a&&(e.target.isMoving=!0,this.setCursor(e.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||a}_setCursorFromEvent(t,e){if(e){var r=e.hoverCursor||this.hoverCursor,i=this._activeObject===this._activeSelection?this._activeObject:null,n=(!i||e.group!==i)&&e._findTargetCorner(this.getPointer(t,!0));if(n){var s=e.controls[n];this.setCursor(s.cursorStyleHandler(t,s,e))}else e.subTargetCheck&&this.targets.concat().reverse().map((t=>{r=t.hoverCursor||r})),this.setCursor(r)}else this.setCursor(this.defaultCursor)}handleMultiSelection(t,e){var r=this._activeObject,i=this._activeSelection,n=r===i;if(r&&this._isSelectionKeyPressed(t)&&this.selection&&e&&e.selectable&&(r!==e||n)&&(n||!e.isDescendantOf(r)&&!r.isDescendantOf(e))&&!e.onSelect({e:t})&&!r.__corner){if(n){var s=i.getObjects();if(!(e!==i||(e=this.searchPossibleTargets(s,this.getPointer(t,!0)))&&e.selectable))return!1;e.group===i?(i.remove(e),this._hoveredTarget=e,this._hoveredTargets=[...this.targets],1===i.size()&&this._setActiveObject(i.item(0),t)):(i.multiSelectAdd(e),this._hoveredTarget=i,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(s,t)}else we(r)&&r.exitEditing(),i.multiSelectAdd(r,e),this._hoveredTarget=i,this._setActiveObject(i,t),this._fireSelectionEvents([r],t);return!0}return!1}handleSelection(t){if(!this.selection||!this._groupSelector)return!1;var e=this._groupSelector,r=e.x,i=e.y,n=e.deltaX,s=e.deltaY,o=new kt(r,i),a=o.add(new kt(n,s)),h=o.min(a),c=o.max(a).subtract(h),l=o.eq(a),u=this.collectObjects({left:h.x,top:h.y,width:c.x,height:c.y},{includeIntersecting:!this.selectionFullyContained}),f=l?u[0]?[u[0]]:[]:u.length>1?u.filter((e=>!e.onSelect({e:t}))).reverse():u;return 1===f.length?this.setActiveObject(f[0],t):f.length>1&&(this._activeSelection.add(...f),this.setActiveObject(this._activeSelection,t)),this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}e("n",xs);var bs={x1:0,y1:0,x2:0,y2:0},ws=W(W({},bs),{},{r1:0,r2:0});function Cs(t){return"linearGradient"===t.nodeName||"LINEARGRADIENT"===t.nodeName?"linear":"radial"}function Ss(t){return"userSpaceOnUse"===t.getAttribute("gradientUnits")?"pixels":"percentage"}var Ts=/^(\d+\.\d+)%|(\d+)%$/;function Os(t){return t&&Ts.test(t)}function ks(t,e){var r="number"==typeof t?t:"string"==typeof t?parseFloat(t)/(Os(t)?100:1):NaN;return _r(0,Ct(r,e),1)}var Ds=/\s*;\s*/,Ms=/\s*:\s*/;function Es(t,e){var r,i,n=t.getAttribute("style");if(n){var o=n.split(Ds);""===o[o.length-1]&&o.pop();for(var a=o.length;a--;){var h=s(o[a].split(Ms).map((t=>t.trim())),2),c=h[0],l=h[1];"stop-color"===c?r=l:"stop-opacity"===c&&(i=l)}}var u=new ue(r||t.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:ks(t.getAttribute("offset"),0),color:u.toRgb(),opacity:Ct(parseFloat(i||t.getAttribute("stop-opacity")||""),1)*u.getAlpha()*e}}function As(t,e){for(var r=[],i=t.getElementsByTagName("stop"),n=ks(e,1),s=i.length;s--;)r.push(Es(i[s],n));return r}function Ps(t,e){return t.getAttribute(e)}function js(t,e){return r="linear"===Cs(t)?function(t){return{x1:Ps(t,"x1")||0,y1:Ps(t,"y1")||0,x2:Ps(t,"x2")||"100%",y2:Ps(t,"y2")||0}}(t):function(t){return{x1:Ps(t,"fx")||Ps(t,"cx")||"50%",y1:Ps(t,"fy")||Ps(t,"cy")||"50%",r1:0,x2:Ps(t,"cx")||"50%",y2:Ps(t,"cy")||"50%",r2:Ps(t,"r")||"50%"}}(t),i=W(W({},e),{},{gradientUnits:Ss(t)}),s=i.width,o=i.height,a=i.gradientUnits,Object.keys(r).reduce(((t,e)=>{var i=r[e];return"Infinity"===i?n=1:"-Infinity"===i?n=0:(n="string"==typeof i?parseFloat(i):i,"string"==typeof i&&Os(i)&&(n*=.01,"pixels"===a&&("x1"!==e&&"x2"!==e&&"r2"!==e||(n*=s),"y1"!==e&&"y2"!==e||(n*=o)))),t[e]=n,t}),{});var r,i,n,s,o,a}class Fs{constructor(t){var e=t.type,r=void 0===e?"linear":e,i=t.gradientUnits,n=void 0===i?"pixels":i,s=t.coords,o=t.colorStops,a=void 0===o?[]:o,h=t.offsetX,c=void 0===h?0:h,l=t.offsetY,u=void 0===l?0:l,f=t.gradientTransform,d=void 0===f?null:f,g=t.id;this.id=g?"".concat(g,"_").concat(Ft()):Ft(),this.type=r,this.gradientUnits=n,this.gradientTransform=d,this.offsetX=c,this.offsetY=u,this.coords=W(W({},"radial"===this.type?ws:bs),s),this.colorStops=a.slice()}addColorStop(t){for(var e in t){var r=new ue(t[e]);this.colorStops.push({offset:parseFloat(e),color:r.toRgb(),opacity:r.getAlpha()})}return this}toObject(t){return W(W({},ie(this,t)),{},{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform})}toSVG(t){var e=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).additionalTransform,r=[],i=this.gradientTransform?this.gradientTransform.concat():ct.concat(),n="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox",s=this.colorStops.map((t=>W({},t))).sort(((t,e)=>t.offset-e.offset)),o=-this.offsetX,a=-this.offsetY;"objectBoundingBox"===n?(o/=t.width,a/=t.height):(o+=t.width/2,a+=t.height/2),t instanceof Gr&&t.isType("Path")&&"percentage"!==this.gradientUnits&&(o-=t.pathOffset.x,a-=t.pathOffset.y),i[4]-=o,i[5]-=a;var h=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(n,'"'),'gradientTransform="'.concat(e?e+" ":"").concat(pe(i),'"'),""].join(" ");if("linear"===this.type){var c=this.coords,l=c.x1,u=c.y1,f=c.x2,d=c.y2;r.push("<linearGradient ",h,' x1="',l,'" y1="',u,'" x2="',f,'" y2="',d,'">\n')}else if("radial"===this.type){var g=this.coords,p=g.x1,v=g.y1,m=g.x2,_=g.y2,y=g.r1,x=g.r2,b=y>x;r.push("<radialGradient ",h,' cx="',b?p:m,'" cy="',b?v:_,'" r="',b?y:x,'" fx="',b?m:p,'" fy="',b?_:v,'">\n'),b&&(s.reverse(),s.forEach((t=>{t.offset=1-t.offset})));var w=Math.min(y,x);if(w>0){var C=w/Math.max(y,x);s.forEach((t=>{t.offset+=C*(1-t.offset)}))}}return s.forEach((t=>{var e=t.color,i=t.offset,n=t.opacity;r.push("<stop ",'offset="',100*i+"%",'" style="stop-color:',e,void 0!==n?";stop-opacity: "+n:";",'"/>\n')})),r.push("linear"===this.type?"</linearGradient>":"</radialGradient>","\n"),r.join("")}toLive(t){var e=this.coords,r="linear"===this.type?t.createLinearGradient(e.x1,e.y1,e.x2,e.y2):t.createRadialGradient(e.x1,e.y1,e.r1,e.x2,e.y2,e.r2);return this.colorStops.forEach((t=>{var e=t.color,i=t.opacity,n=t.offset;r.addColorStop(n,void 0!==i?new ue(e).setAlpha(i).toRgba():e)})),r}static fromElement(t,e,r){var i=Ss(t),n=e._findCenterFromElement();return new this(W({id:t.getAttribute("id")||void 0,type:Cs(t),coords:js(t,{width:r.viewBoxWidth||r.width,height:r.viewBoxHeight||r.height}),colorStops:As(t,r.opacity),gradientUnits:i,gradientTransform:cn(t.getAttribute("gradientTransform")||"")},"pixels"===i?{offsetX:e.width/2-n.x,offsetY:e.height/2-n.y}:{offsetX:0,offsetY:0}))}}e("a",Fs),z(Fs,"type","Gradient"),xt.setClass(Fs,"gradient");var Ls=["source"];class Rs{get type(){return"pattern"}set type(t){console.warn("Setting type has no effect",t)}constructor(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};z(this,"repeat","repeat"),z(this,"offsetX",0),z(this,"offsetY",0),z(this,"crossOrigin",""),z(this,"patternTransform",null),this.id=Ft(),Object.assign(this,t)}isImageSource(){return!!this.source&&"string"==typeof this.source.src}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(t){return this.source&&(!this.isImageSource()||this.source.complete&&0!==this.source.naturalWidth&&0!==this.source.naturalHeight)?t.createPattern(this.source,this.repeat):null}toObject(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this.repeat,r=this.crossOrigin;return W(W({},ie(this,t)),{},{type:"pattern",source:this.sourceToString(),repeat:e,crossOrigin:r,offsetX:fe(this.offsetX,q.NUM_FRACTION_DIGITS),offsetY:fe(this.offsetY,q.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(t){var e=t.width,r=t.height,i=this.source,n=this.repeat,s=this.id,o=Ct(this.offsetX/e,0),a=Ct(this.offsetY/r,0),h="repeat-y"===n||"no-repeat"===n?1+Math.abs(o||0):Ct(i.width/e,0),c="repeat-x"===n||"no-repeat"===n?1+Math.abs(a||0):Ct(i.height/r,0);return['<pattern id="SVGID_'.concat(s,'" x="').concat(o,'" y="').concat(a,'" width="').concat(h,'" height="').concat(c,'">'),'<image x="0" y="0" width="'.concat(i.width,'" height="').concat(i.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join("\n")}static fromObject(e,i){var n=this;return r(t().mark((function r(){var s,o,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=e.source,o=G(e,Ls),t.next=3,te(s,W(W({},i),{},{crossOrigin:o.crossOrigin}));case 3:return a=t.sent,t.abrupt("return",new n(W(W({},o),{},{source:a})));case 5:case"end":return t.stop()}}),r)})))()}}e("P",Rs),z(Rs,"type","Pattern"),xt.setClass(Rs),xt.setClass(Rs,"pattern");var Is=["path","left","top"],Bs=["d"];class Xs extends Si{constructor(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(e.path,e.left),i=e.top;super(G(e,Is)),this._setPath(t||[],!0),"number"==typeof r&&this.set(ft,r),"number"==typeof i&&this.set(dt,i)}_setPath(t,e){this.path=Kn(Array.isArray(t)?t:hs(t)),this.setBoundingBox(e)}_findCenterFromElement(){var t=this._calcBoundsFromPath();return new kt(t.left+t.width/2,t.top+t.height/2)}_renderPathCommands(t){var e=0,r=0,i=0,s=0,o=0,a=0,h=-this.pathOffset.x,c=-this.pathOffset.y;t.beginPath();var l,u=n(this.path);try{for(u.s();!(l=u.n()).done;){var f=l.value;switch(f[0]){case"L":i=f[1],s=f[2],t.lineTo(i+h,s+c);break;case"M":i=f[1],s=f[2],e=i,r=s,t.moveTo(i+h,s+c);break;case"C":i=f[5],s=f[6],o=f[3],a=f[4],t.bezierCurveTo(f[1]+h,f[2]+c,o+h,a+c,i+h,s+c);break;case"Q":t.quadraticCurveTo(f[1]+h,f[2]+c,f[3]+h,f[4]+c),i=f[3],s=f[4],o=f[1],a=f[2];break;case"Z":i=e,s=r,t.closePath()}}}catch(d){u.e(d)}finally{u.f()}}_render(t){this._renderPathCommands(t),this._renderPaintInOrder(t)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return W(W({},super.toObject(t)),{},{path:Xr(this.path)})}toDatalessObject(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this.toObject(t);return this.sourcePath&&(delete e.path,e.sourcePath=this.sourcePath),e}_toSVG(){var t=cs(this.path,q.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(t,'" stroke-linecap="round" />\n')]}_getOffsetTransform(){var t=q.NUM_FRACTION_DIGITS;return" translate(".concat(fe(-this.pathOffset.x,t),", ").concat(fe(-this.pathOffset.y,t),")")}toClipPathSVG(t){var e=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}toSVG(t){var e=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(t){var e=this._calcDimensions(),r=e.width,i=e.height,n=e.pathOffset;this.set({width:r,height:i,pathOffset:n}),t&&this.setPositionByOrigin(n,ut,ut)}_calcBoundsFromPath(){var t,e=[],r=0,i=0,s=0,o=0,a=n(this.path);try{for(a.s();!(t=a.n()).done;){var h=t.value;switch(h[0]){case"L":s=h[1],o=h[2],e.push(new kt(r,i),new kt(s,o));break;case"M":s=h[1],o=h[2],r=s,i=o;break;case"C":e.push(...Nn(s,o,h[1],h[2],h[3],h[4],h[5],h[6])),s=h[5],o=h[6];break;case"Q":e.push(...Nn(s,o,h[1],h[2],h[1],h[2],h[3],h[4])),s=h[3],o=h[4];break;case"Z":s=r,o=i}}}catch(c){a.e(c)}finally{a.f()}return Be(e)}_calcDimensions(){var t=this._calcBoundsFromPath();return W(W({},t),{},{pathOffset:new kt(t.left+t.width/2,t.top+t.height/2)})}static fromObject(t){return this._fromObject(t,{extraParam:"path"})}static fromElement(e,i){var n=this;return r(t().mark((function r(){var s,o,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=un(e,n.ATTRIBUTE_NAMES),o=s.d,a=G(s,Bs),t.abrupt("return",new n(o,W(W(W({},a),i),{},{left:void 0,top:void 0})));case 2:case"end":return t.stop()}}),r)})))()}}e("g",Xs),z(Xs,"type","Path"),z(Xs,"cacheProperties",[...Wr,"path","fillRule"]),z(Xs,"ATTRIBUTE_NAMES",[...Di,"d"]),xt.setClass(Xs),xt.setSVGClass(Xs);var Ys=["left","top","radius"],Ws=["radius","startAngle","endAngle"];class zs extends Si{static getDefaults(){return W(W({},super.getDefaults()),zs.ownDefaults)}_set(t,e){return super._set(t,e),"radius"===t&&this.setRadius(e),this}_render(t){t.beginPath(),t.arc(0,0,this.radius,Bt(this.startAngle),Bt(this.endAngle),!1),this._renderPaintInOrder(t)}getRadiusX(){return this.get("radius")*this.get("scaleX")}getRadiusY(){return this.get("radius")*this.get("scaleY")}setRadius(t){this.radius=t,this.set({width:2*t,height:2*t})}toObject(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...Ws,...t])}_toSVG(){var t=(this.endAngle-this.startAngle)%360;if(0===t)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];var e=this.radius,r=Bt(this.startAngle),i=Bt(this.endAngle),n=Tt(r)*e,s=Ot(r)*e,o=Tt(i)*e,a=Ot(i)*e,h=t>180?"1":"0";return['<path d="M '.concat(n," ").concat(s)," A ".concat(e," ").concat(e)," 0 ","".concat(h," 1")," ".concat(o," ").concat(a),'" ',"COMMON_PARTS"," />\n"]}static fromElement(e){var i=this;return r(t().mark((function r(){var n,s,o,a,h,c,l,u;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=un(e,i.ATTRIBUTE_NAMES),s=n.left,o=void 0===s?0:s,a=n.top,h=void 0===a?0:a,c=n.radius,l=void 0===c?0:c,u=G(n,Ys),t.abrupt("return",new i(W(W({},u),{},{radius:l,left:o-l,top:h-l})));case 2:case"end":return t.stop()}}),r)})))()}static fromObject(t){return super._fromObject(t)}}z(zs,"type","Circle"),z(zs,"cacheProperties",[...Wr,...Ws]),z(zs,"ownDefaults",{radius:0,startAngle:0,endAngle:360}),z(zs,"ATTRIBUTE_NAMES",["cx","cy","r",...Di]),xt.setClass(zs),xt.setSVGClass(zs);var Vs=["x1","y1","x2","y2"],Gs=["x1","y1","x2","y2"],Us=["x1","x2","y1","y2"];class Hs extends Si{constructor(){var t=s(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0],4),e=t[0],r=t[1],i=t[2],n=t[3],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(W(W({},o),{},{x1:e,y1:r,x2:i,y2:n})),this._setWidthHeight();var a=o.left,h=o.top;"number"==typeof a&&this.set(ft,a),"number"==typeof h&&this.set(dt,h)}_setWidthHeight(){var t=this.x1,e=this.y1,r=this.x2,i=this.y2;this.width=Math.abs(r-t),this.height=Math.abs(i-e);var n=Be([{x:t,y:e},{x:r,y:i}]),s=n.left,o=n.top,a=n.width,h=n.height,c=new kt(s+a/2,o+h/2);this.setPositionByOrigin(c,ut,ut)}_set(t,e){return super._set(t,e),Us.includes(t)&&this._setWidthHeight(),this}_render(t){t.beginPath();var e=this.calcLinePoints();t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineWidth=this.strokeWidth;var r,i=t.strokeStyle;me(this.stroke)?t.strokeStyle=this.stroke.toLive(t):t.strokeStyle=null!==(r=this.stroke)&&void 0!==r?r:t.fillStyle;this.stroke&&this._renderStroke(t),t.strokeStyle=i}_findCenterFromElement(){return new kt((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return W(W({},super.toObject(t)),this.calcLinePoints())}_getNonTransformedDimensions(){var t=super._getNonTransformedDimensions();return"butt"===this.strokeLineCap&&(0===this.width&&(t.y-=this.strokeWidth),0===this.height&&(t.x-=this.strokeWidth)),t}calcLinePoints(){var t=this.x1,e=this.x2,r=this.y1,i=this.y2,n=this.width,s=this.height,o=t<=e?-1:1,a=r<=i?-1:1;return{x1:o*n/2,x2:o*-n/2,y1:a*s/2,y2:a*-s/2}}_toSVG(){var t=this.calcLinePoints(),e=t.x1,r=t.x2,i=t.y1,n=t.y2;return["<line ","COMMON_PARTS",'x1="'.concat(e,'" y1="').concat(i,'" x2="').concat(r,'" y2="').concat(n,'" />\n')]}static fromElement(e){var i=this;return r(t().mark((function r(){var n,s,o,a,h,c,l,u,f,d;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=un(e,i.ATTRIBUTE_NAMES),s=n.x1,o=void 0===s?0:s,a=n.y1,h=void 0===a?0:a,c=n.x2,l=void 0===c?0:c,u=n.y2,f=void 0===u?0:u,d=G(n,Vs),t.abrupt("return",new i([o,h,l,f],d));case 2:case"end":return t.stop()}}),r)})))()}static fromObject(t){var e=t.x1,r=t.y1,i=t.x2,n=t.y2,s=G(t,Gs);return this._fromObject(W(W({},s),{},{points:[e,r,i,n]}),{extraParam:"points"})}}z(Hs,"type","Line"),z(Hs,"cacheProperties",[...Wr,...Us]),z(Hs,"ATTRIBUTE_NAMES",Di.concat(Us)),xt.setClass(Hs),xt.setSVGClass(Hs);class Ns extends Si{static getDefaults(){return W(W({},super.getDefaults()),Ns.ownDefaults)}_render(t){var e=this.width/2,r=this.height/2;t.beginPath(),t.moveTo(-e,r),t.lineTo(0,-r),t.lineTo(e,r),t.closePath(),this._renderPaintInOrder(t)}_toSVG(){var t=this.width/2,e=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-t," ").concat(e,",0 ").concat(-e,",").concat(t," ").concat(e),'" />']}}e("j",Ns),z(Ns,"type","Triangle"),z(Ns,"ownDefaults",{width:100,height:100}),xt.setClass(Ns),xt.setSVGClass(Ns);var qs=["rx","ry"];class Ks extends Si{static getDefaults(){return W(W({},super.getDefaults()),Ks.ownDefaults)}_set(t,e){switch(super._set(t,e),t){case"rx":this.rx=e,this.set("width",2*e);break;case"ry":this.ry=e,this.set("height",2*e)}return this}getRx(){return this.get("rx")*this.get("scaleX")}getRy(){return this.get("ry")*this.get("scaleY")}toObject(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return super.toObject([...qs,...t])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']}_render(t){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(0,0,this.rx,0,at,!1),t.restore(),this._renderPaintInOrder(t)}static fromElement(e){var i=this;return r(t().mark((function r(){var n;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=un(e,i.ATTRIBUTE_NAMES)).left=(n.left||0)-n.rx,n.top=(n.top||0)-n.ry,t.abrupt("return",new i(n));case 4:case"end":return t.stop()}}),r)})))()}}function $s(t){if(!t)return null;t=(t=t.replace(/,/g," ").trim()).split(/\s+/);for(var e=[],r=0;r<t.length;r+=2)e.push({x:parseFloat(t[r]),y:parseFloat(t[r+1])});return e}e("E",Ks),z(Ks,"type","Ellipse"),z(Ks,"cacheProperties",[...Wr,...qs]),z(Ks,"ownDefaults",{rx:0,ry:0}),z(Ks,"ATTRIBUTE_NAMES",[...Di,"cx","cy","rx","ry"]),xt.setClass(Ks),xt.setSVGClass(Ks);var Zs=["left","top"],Js={exactBoundingBox:!1};class Qs extends Si{static getDefaults(){return W(W({},super.getDefaults()),Qs.ownDefaults)}constructor(){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(W({points:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]},t));var e=t.left,r=t.top;this.initialized=!0,this.setBoundingBox(!0),"number"==typeof e&&this.set(ft,e),"number"==typeof r&&this.set(dt,r)}isOpen(){return!0}_projectStrokeOnPoints(){return wn(this.points,this,this.isOpen())}_calcDimensions(){var t=this.exactBoundingBox?this._projectStrokeOnPoints().map((t=>t.projectedPoint)):this.points;if(0===t.length)return{left:0,top:0,width:0,height:0,pathOffset:new kt,strokeOffset:new kt};var e=Be(t),r=Be(this.points),i=e.left+e.width/2,n=e.top+e.height/2,s=i-n*Math.tan(Bt(this.skewX)),o=n-s*Math.tan(Bt(this.skewY));return W(W({},e),{},{pathOffset:new kt(s,o),strokeOffset:new kt(r.left,r.top).subtract(new kt(e.left,e.top))})}_findCenterFromElement(){var t=Be(this.points);return new kt(t.left+t.width/2,t.top+t.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(t){var e=this._calcDimensions(),r=e.left,i=e.top,n=e.width,s=e.height,o=e.pathOffset,a=e.strokeOffset;this.set({width:n,height:s,pathOffset:o,strokeOffset:a}),t&&this.setPositionByOrigin(new kt(r+n/2,i+s/2),ut,ut)}_getNonTransformedDimensions(){return this.exactBoundingBox?new kt(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(t){return this.exactBoundingBox?super._getTransformedDimensions(W(W({},t||{}),{},{strokeWidth:0,skewX:0,skewY:0})):super._getTransformedDimensions(t)}_set(t,e){var r=this.initialized&&this[t]!==e,i=super._set(t,e);return r&&(("scaleX"===t||"scaleY"===t)&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")&&"round"!==this.strokeLineJoin||this.constructor.layoutProperties.includes(t))&&this.setDimensions(),i}toObject(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return W(W({},super.toObject(t)),{},{points:Xr(this.points)})}_toSVG(){for(var t=[],e=this.pathOffset.x,r=this.pathOffset.y,i=q.NUM_FRACTION_DIGITS,n=0,s=this.points.length;n<s;n++)t.push(fe(this.points[n].x-e,i),",",fe(this.points[n].y-r,i)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(t.join(""),'" />\n')]}_render(t){var e=this.points.length,r=this.pathOffset.x,i=this.pathOffset.y;if(e&&!isNaN(this.points[e-1].y)){t.beginPath(),t.moveTo(this.points[0].x-r,this.points[0].y-i);for(var n=0;n<e;n++){var s=this.points[n];t.lineTo(s.x-r,s.y-i)}!this.isOpen()&&t.closePath(),this._renderPaintInOrder(t)}}complexity(){return this.points.length}static fromElement(e,i){var n=this;return r(t().mark((function r(){var s,o,a;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=$s(e.getAttribute("points")),o=un(e,n.ATTRIBUTE_NAMES),a=G(o,Zs),t.abrupt("return",new n(s||[],W(W({},a),i)));case 2:case"end":return t.stop()}}),r)})))()}static fromObject(t){return this._fromObject(t,{extraParam:"points"})}}z(Qs,"ownDefaults",Js),z(Qs,"type","Polyline"),z(Qs,"layoutProperties",["skewX","skewY","strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]),z(Qs,"cacheProperties",[...Wr,"points"]),z(Qs,"ATTRIBUTE_NAMES",[...Di]),xt.setClass(Qs),xt.setSVGClass(Qs);class to extends Qs{static getDefaults(){return W(W({},super.getDefaults()),Qs.ownDefaults)}isOpen(){return!1}}z(to,"ownDefaults",Js),z(to,"type","Polygon"),xt.setClass(to),xt.setSVGClass(to);var eo=["fontSize","fontWeight","fontFamily","fontStyle"],ro=["underline","overline","linethrough"],io=[...eo,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],no=[...io,...ro,"textBackgroundColor","direction"],so=[...eo,...ro,"stroke","strokeWidth","fill","deltaY","textBackgroundColor"],oo={_reNewline:mt,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:ft,fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:ft,pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2},ao="justify",ho="justify-left",co="justify-right",lo="justify-center";class uo extends Si{isEmptyStyles(t){if(!this.styles)return!0;if(void 0!==t&&!this.styles[t])return!0;var e=void 0===t?this.styles:{line:this.styles[t]};for(var r in e)for(var i in e[r])for(var n in e[r][i])return!1;return!0}styleHas(t,e){if(!this.styles)return!1;if(void 0!==e&&!this.styles[e])return!1;var r=void 0===e?this.styles:{0:this.styles[e]};for(var i in r)for(var n in r[i])if(void 0!==r[i][n][t])return!0;return!1}cleanStyle(t){if(!this.styles)return!1;var e,r,i=this.styles,n=0,s=!0,o=0;for(var a in i){for(var h in e=0,i[a]){var c=i[a][h]||{};n++,void 0!==c[t]?(r?c[t]!==r&&(s=!1):r=c[t],c[t]===this[t]&&delete c[t]):s=!1,0!==Object.keys(c).length?e++:delete i[a][h]}0===e&&delete i[a]}for(var l=0;l<this._textLines.length;l++)o+=this._textLines[l].length;s&&n===o&&(this[t]=r,this.removeStyle(t))}removeStyle(t){if(this.styles){var e,r,i,n=this.styles;for(r in n){for(i in e=n[r])delete e[i][t],0===Object.keys(e[i]).length&&delete e[i];0===Object.keys(e).length&&delete n[r]}}}_extendStyles(t,e){var r=this.get2DCursorLocation(t),i=r.lineIndex,n=r.charIndex;return this._getLineStyle(i)||this._setLineStyle(i),this._getStyleDeclaration(i,n)||this._setStyleDeclaration(i,n,{}),Object.assign(this._getStyleDeclaration(i,n)||{},e)}getSelectionStyles(t,e,r){for(var i=[],n=t;n<(e||t);n++)i.push(this.getStyleAtPosition(n,r));return i}getStyleAtPosition(t,e){var r=this.get2DCursorLocation(t),i=r.lineIndex,n=r.charIndex;return(e?this.getCompleteStyleDeclaration(i,n):this._getStyleDeclaration(i,n))||{}}setSelectionStyles(t,e,r){for(var i=e;i<(r||e);i++)this._extendStyles(i,t);this._forceClearCache=!0}_getStyleDeclaration(t,e){var r=this.styles&&this.styles[t];return r?r[e]:null}getCompleteStyleDeclaration(t,e){return W(W({},ie(this,this.constructor._styleProperties)),this._getStyleDeclaration(t,e)||{})}_setStyleDeclaration(t,e,r){this.styles[t][e]=r}_deleteStyleDeclaration(t,e){delete this.styles[t][e]}_getLineStyle(t){return!!this.styles[t]}_setLineStyle(t){this.styles[t]={}}_deleteLineStyle(t){delete this.styles[t]}}z(uo,"_styleProperties",so);var fo=/  +/g,go=/"/g;function po(t,e,r,i,n){return"\t\t".concat(function(t,e){var r=e.left,i=e.top,n=e.width,o=e.height,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.NUM_FRACTION_DIGITS,h=ve("fill",t),c=s([r,i,n,o].map((t=>fe(t,a))),4),l=c[0],u=c[1],f=c[2],d=c[3];return"<rect ".concat(h,' x="').concat(l,'" y="').concat(u,'" width="').concat(f,'" height="').concat(d,'"></rect>')}(t,{left:e,top:r,width:i,height:n}),"\n")}var vo,mo=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];class _o extends uo{static getDefaults(){return W(W({},super.getDefaults()),_o.ownDefaults)}constructor(t,e){super(W(W({},e),{},{text:t,styles:(null==e?void 0:e.styles)||{}})),z(this,"__charBounds",[]),this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){var t=this.path;t&&(t.segmentsInfo=os(t.path))}_splitText(){var t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(ao)&&this.enlargeSpaces()}enlargeSpaces(){for(var t,e,r,i,n,s,o,a=0,h=this._textLines.length;a<h;a++)if((this.textAlign===ao||a!==h-1&&!this.isEndOfWrapping(a))&&(i=0,n=this._textLines[a],(e=this.getLineWidth(a))<this.width&&(o=this.textLines[a].match(this._reSpacesAndTabs)))){r=o.length,t=(this.width-e)/r;for(var c=0;c<=n.length;c++)s=this.__charBounds[a][c],this._reSpaceAndTab.test(n[c])?(s.width+=t,s.kernedWidth+=t,s.left+=i,i+=t):s.left+=i}}isEndOfWrapping(t){return t===this._textLines.length-1}missingNewlineOffset(t){return 1}get2DCursorLocation(t,e){var r,i=e?this._unwrappedTextLines:this._textLines;for(r=0;r<i.length;r++){if(t<=i[r].length)return{lineIndex:r,charIndex:t};t-=i[r].length+this.missingNewlineOffset(r)}return{lineIndex:r-1,charIndex:i[r-1].length<t?i[r-1].length:t}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){var t=super._getCacheCanvasDimensions(),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t}_render(t){var e=this.path;e&&!e.isNotVisible()&&e._render(t),this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")}_renderText(t){"stroke"===this.paintFirst?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))}_setTextStyles(t,e,r){if(t.textBaseline="alphabetic",this.path)switch(this.pathAlign){case ut:t.textBaseline="middle";break;case"ascender":t.textBaseline=dt;break;case"descender":t.textBaseline=gt}t.font=this._getFontDeclaration(e,r)}calcTextWidth(){for(var t=this.getLineWidth(0),e=1,r=this._textLines.length;e<r;e++){var i=this.getLineWidth(e);i>t&&(t=i)}return t}_renderTextLine(t,e,r,i,n,s){this._renderChars(t,e,r,i,n,s)}_renderTextLinesBackground(t){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var e=t.fillStyle,r=this._getLeftOffset(),i=this._getTopOffset(),n=0,s=this._textLines.length;n<s;n++){var o=this.getHeightOfLine(n);if(this.textBackgroundColor||this.styleHas("textBackgroundColor",n)){for(var a=this._textLines[n].length,h=this._getLineLeftOffset(n),c=0,l=0,u=void 0,f=void 0,d=this.getValueOfPropertyAt(n,0,"textBackgroundColor"),g=0;g<a;g++){var p=this.__charBounds[n][g];f=this.getValueOfPropertyAt(n,g,"textBackgroundColor"),this.path?(t.save(),t.translate(p.renderLeft,p.renderTop),t.rotate(p.angle),t.fillStyle=f,f&&t.fillRect(-p.width/2,-o/this.lineHeight*(1-this._fontSizeFraction),p.width,o/this.lineHeight),t.restore()):f!==d?(u=r+h+l,"rtl"===this.direction&&(u=this.width-u-c),t.fillStyle=d,d&&t.fillRect(u,i,c,o/this.lineHeight),l=p.left,c=p.width,d=f):c+=p.kernedWidth}f&&!this.path&&(u=r+h+l,"rtl"===this.direction&&(u=this.width-u-c),t.fillStyle=f,t.fillRect(u,i,c,o/this.lineHeight)),i+=o}else i+=o}t.fillStyle=e,this._removeShadow(t)}}_measureChar(t,e,r,i){var n,s,o,a,h=it.getFontCache(e),c=r+t,l=this._getFontDeclaration(e)===this._getFontDeclaration(i),u=e.fontSize/this.CACHE_FONT_SIZE;if(r&&void 0!==h[r]&&(o=h[r]),void 0!==h[t]&&(a=n=h[t]),l&&void 0!==h[c]&&(a=(s=h[c])-o),void 0===n||void 0===o||void 0===s){var f=(vo||(vo=Lt().getContext("2d")),vo);this._setTextStyles(f,e,!0),void 0===n&&(a=n=f.measureText(t).width,h[t]=n),void 0===o&&l&&r&&(o=f.measureText(r).width,h[r]=o),l&&void 0===s&&(s=f.measureText(c).width,h[c]=s,a=s-o)}return{width:n*u,kernedWidth:a*u}}getHeightOfChar(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")}measureLine(t){var e=this._measureLine(t);return 0!==this.charSpacing&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e}_measureLine(t){var e,r,i=0,n=this.pathSide===pt,s=this.path,o=this._textLines[t],a=o.length,h=new Array(a);this.__charBounds[t]=h;for(var c=0;c<a;c++){var l=o[c];r=this._getGraphemeBox(l,t,c,e),h[c]=r,i+=r.kernedWidth,e=l}if(h[a]={left:r?r.left+r.width:0,width:0,kernedWidth:0,height:this.fontSize},s&&s.segmentsInfo){var u=0,f=s.segmentsInfo[s.segmentsInfo.length-1].length,d=as(s.path,0,s.segmentsInfo);switch(d.x+=s.pathOffset.x,d.y+=s.pathOffset.y,this.textAlign){case ft:u=n?f-i:0;break;case ut:u=(f-i)/2;break;case pt:u=n?0:f-i}u+=this.pathStartOffset*(n?-1:1);for(var g=n?a-1:0;n?g>=0:g<a;n?g--:g++)r=h[g],u>f?u%=f:u<0&&(u+=f),this._setGraphemeOnPath(u,r,d),u+=r.kernedWidth}return{width:i,numOfSpaces:0}}_setGraphemeOnPath(t,e,r){var i=t+e.kernedWidth/2,n=this.path,s=as(n.path,i,n.segmentsInfo);e.renderLeft=s.x-r.x,e.renderTop=s.y-r.y,e.angle=s.angle+(this.pathSide===pt?Math.PI:0)}_getGraphemeBox(t,e,r,i,n){var s,o=this.getCompleteStyleDeclaration(e,r),a=i?this.getCompleteStyleDeclaration(e,r-1):{},h=this._measureChar(t,o,i,a),c=h.kernedWidth,l=h.width;0!==this.charSpacing&&(l+=s=this._getWidthOfCharSpacing(),c+=s);var u={width:l,left:0,height:o.fontSize,kernedWidth:c,deltaY:o.deltaY};if(r>0&&!n){var f=this.__charBounds[e][r-1];u.left=f.left+f.width+h.kernedWidth-h.width}return u}getHeightOfLine(t){if(this.__lineHeights[t])return this.__lineHeights[t];for(var e=this.getHeightOfChar(t,0),r=1,i=this._textLines[t].length;r<i;r++)e=Math.max(this.getHeightOfChar(t,r),e);return this.__lineHeights[t]=e*this.lineHeight*this._fontSizeMult}calcTextHeight(){for(var t,e=0,r=0,i=this._textLines.length;r<i;r++)t=this.getHeightOfLine(r),e+=r===i-1?t/this.lineHeight:t;return e}_getLeftOffset(){return"ltr"===this.direction?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(t,e){t.save();for(var r=0,i=this._getLeftOffset(),n=this._getTopOffset(),s=0,o=this._textLines.length;s<o;s++){var a=this.getHeightOfLine(s),h=a/this.lineHeight,c=this._getLineLeftOffset(s);this._renderTextLine(e,t,this._textLines[s],i+c,n+r+h,s),r+=a}t.restore()}_renderTextFill(t){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(t,"fillText")}_renderTextStroke(t){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())}_renderChars(t,e,r,i,n,s){var o,a,h,c,l,u=this.getHeightOfLine(s),f=this.textAlign.includes(ao),d=this.path,g=!f&&0===this.charSpacing&&this.isEmptyStyles(s)&&!d,p="ltr"===this.direction,v="ltr"===this.direction?1:-1,m=e.direction,_="",y=0;if(e.save(),m!==this.direction&&(e.canvas.setAttribute("dir",p?"ltr":"rtl"),e.direction=p?"ltr":"rtl",e.textAlign=p?ft:pt),n-=u*this._fontSizeFraction/this.lineHeight,g)return this._renderChar(t,e,s,0,r.join(""),i,n),void e.restore();for(var x=0,b=r.length-1;x<=b;x++)c=x===b||this.charSpacing||d,_+=r[x],h=this.__charBounds[s][x],0===y?(i+=v*(h.kernedWidth-h.width),y+=h.width):y+=h.kernedWidth,f&&!c&&this._reSpaceAndTab.test(r[x])&&(c=!0),c||(o=o||this.getCompleteStyleDeclaration(s,x),a=this.getCompleteStyleDeclaration(s,x+1),c=Cn(o,a,!1)),c&&(d?(e.save(),e.translate(h.renderLeft,h.renderTop),e.rotate(h.angle),this._renderChar(t,e,s,x,_,-y/2,0),e.restore()):(l=i,this._renderChar(t,e,s,x,_,l,n)),_="",o=a,i+=v*y,y=0);e.restore()}_applyPatternGradientTransformText(t){var e=Lt(),r=this.width+this.strokeWidth,i=this.height+this.strokeWidth,n=e.getContext("2d");return e.width=r,e.height=i,n.beginPath(),n.moveTo(0,0),n.lineTo(r,0),n.lineTo(r,i),n.lineTo(0,i),n.closePath(),n.translate(r/2,i/2),n.fillStyle=t.toLive(n),this._applyPatternGradientTransform(n,t),n.fill(),n.createPattern(e,"no-repeat")}handleFiller(t,e,r){var i,n;return r.toLive?"percentage"===r.gradientUnits||r.gradientTransform||r.patternTransform?(i=-this.width/2,n=-this.height/2,t.translate(i,n),t[e]=this._applyPatternGradientTransformText(r),{offsetX:i,offsetY:n}):(t[e]=r.toLive(t,this),this._applyPatternGradientTransform(t,r)):(t[e]=r,{offsetX:0,offsetY:0})}_setStrokeStyles(t,e){var r=e.stroke,i=e.strokeWidth;return t.lineWidth=i,t.lineCap=this.strokeLineCap,t.lineDashOffset=this.strokeDashOffset,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,this.handleFiller(t,"strokeStyle",r)}_setFillStyles(t,e){var r=e.fill;return this.handleFiller(t,"fillStyle",r)}_renderChar(t,e,r,i,n,s,o){var a,h,c=this._getStyleDeclaration(r,i),l=this.getCompleteStyleDeclaration(r,i),u="fillText"===t&&l.fill,f="strokeText"===t&&l.stroke&&l.strokeWidth;(f||u)&&(e.save(),u&&(a=this._setFillStyles(e,l)),f&&(h=this._setStrokeStyles(e,l)),e.font=this._getFontDeclaration(l),c&&c.textBackgroundColor&&this._removeShadow(e),c&&c.deltaY&&(o+=c.deltaY),u&&e.fillText(n,s-a.offsetX,o-a.offsetY),f&&e.strokeText(n,s-h.offsetX,o-h.offsetY),e.restore())}setSuperscript(t,e){this._setScript(t,e,this.superscript)}setSubscript(t,e){this._setScript(t,e,this.subscript)}_setScript(t,e,r){var i=this.get2DCursorLocation(t,!0),n=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"fontSize"),s=this.getValueOfPropertyAt(i.lineIndex,i.charIndex,"deltaY"),o={fontSize:n*r.size,deltaY:s+n*r.baseline};this.setSelectionStyles(o,t,e)}_getLineLeftOffset(t){var e=this.getLineWidth(t),r=this.width-e,i=this.textAlign,n=this.direction,s=this.isEndOfWrapping(t),o=0;return i===ao||i===lo&&!s||i===co&&!s||i===ho&&!s?0:(i===ut&&(o=r/2),i===pt&&(o=r),i===lo&&(o=r/2),i===co&&(o=r),"rtl"===n&&(i===pt||i===ao||i===co?o=0:i===ft||i===ho?o=-r:i!==ut&&i!==lo||(o=-r/2)),o)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(t){if(void 0!==this.__lineWidths[t])return this.__lineWidths[t];var e=this.measureLine(t).width;return this.__lineWidths[t]=e,e}_getWidthOfCharSpacing(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(t,e,r){var i=this._getStyleDeclaration(t,e);return i&&void 0!==i[r]?i[r]:this[r]}_renderTextDecoration(t,e){if(this[e]||this.styleHas(e)){for(var r=this._getTopOffset(),i=this._getLeftOffset(),n=this.path,s=this._getWidthOfCharSpacing(),o=this.offsets[e],a=0,h=this._textLines.length;a<h;a++){var c=this.getHeightOfLine(a);if(this[e]||this.styleHas(e,a)){for(var l=this._textLines[a],u=c/this.lineHeight,f=this._getLineLeftOffset(a),d=0,g=0,p=this.getValueOfPropertyAt(a,0,e),v=this.getValueOfPropertyAt(a,0,"fill"),m=void 0,_=void 0,y=r+u*(1-this._fontSizeFraction),x=this.getHeightOfChar(a,0),b=this.getValueOfPropertyAt(a,0,"deltaY"),w=0,C=l.length;w<C;w++){var S=this.__charBounds[a][w];m=this.getValueOfPropertyAt(a,w,e),_=this.getValueOfPropertyAt(a,w,"fill");var T=this.getHeightOfChar(a,w),O=this.getValueOfPropertyAt(a,w,"deltaY");if(n&&m&&_)t.save(),t.fillStyle=v,t.translate(S.renderLeft,S.renderTop),t.rotate(S.angle),t.fillRect(-S.kernedWidth/2,o*T+O,S.kernedWidth,this.fontSize/15),t.restore();else if((m!==p||_!==v||T!==x||O!==b)&&g>0){var k=i+f+d;"rtl"===this.direction&&(k=this.width-k-g),p&&v&&(t.fillStyle=v,t.fillRect(k,y+o*x+b,g,this.fontSize/15)),d=S.left,g=S.width,p=m,v=_,x=T,b=O}else g+=S.kernedWidth}var D=i+f+d;"rtl"===this.direction&&(D=this.width-D-g),t.fillStyle=_,m&&_&&t.fillRect(D,y+o*x+b,g-s,this.fontSize/15),r+=c}else r+=c}this._removeShadow(t)}}_getFontDeclaration(t,e){var r=t||this,i=this.fontFamily,n=_o.genericFonts.indexOf(i.toLowerCase())>-1,s=void 0===i||i.indexOf("'")>-1||i.indexOf(",")>-1||i.indexOf('"')>-1||n?r.fontFamily:'"'.concat(r.fontFamily,'"');return[r.fontStyle,r.fontWeight,e?this.CACHE_FONT_SIZE+"px":r.fontSize+"px",s].join(" ")}render(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(t)))}graphemeSplit(t){return Mn(t)}_splitTextIntoLines(t){for(var e=t.split(this._reNewline),r=new Array(e.length),i=["\n"],n=[],s=0;s<e.length;s++)r[s]=this.graphemeSplit(e[s]),n=n.concat(r[s],i);return n.pop(),{_unwrappedLines:r,lines:e,graphemeText:n,graphemeLines:r}}toObject(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return W(W({},super.toObject([...no,...t])),{},{styles:Sn(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(t,e){var r=this.constructor.textLayoutProperties;super.set(t,e);var i=!1,n=!1;if("object"==typeof t)for(var s in t)"path"===s&&this.setPathInfo(),i=i||r.includes(s),n=n||"path"===s;else i=r.includes(t),n="path"===t;return n&&this.setPathInfo(),i&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static fromElement(e,i){var n=this;return r(t().mark((function r(){var s,o,a,h,c,l,u,f,d,g,p,v,m,_,y,x,b,w,C,S,T,O,k,D,M,E;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=un(e,_o.ATTRIBUTE_NAMES),o=W(W({},i),s),a=o.textAnchor,h=void 0===a?ft:a,c=o.textDecoration,l=void 0===c?"":c,u=o.dx,f=void 0===u?0:u,d=o.dy,g=void 0===d?0:d,p=o.top,v=void 0===p?0:p,m=o.left,_=void 0===m?0:m,y=o.fontSize,x=void 0===y?16:y,b=o.strokeWidth,w=void 0===b?1:b,C=G(o,mo),S="","textContent"in e?S=e.textContent:"firstChild"in e&&null!==e.firstChild&&"data"in e.firstChild&&null!==e.firstChild.data&&(S=e.firstChild.data),S=S.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," "),T=new n(S,W({left:_+f,top:v+g,underline:l.includes("underline"),overline:l.includes("overline"),linethrough:l.includes("line-through"),strokeWidth:0,fontSize:x},C)),O=T.getScaledHeight()/T.height,k=(T.height+T.strokeWidth)*T.lineHeight-T.height,D=k*O,M=T.getScaledHeight()+D,E=0,h===ut&&(E=T.getScaledWidth()/2),h===pt&&(E=T.getScaledWidth()),T.set({left:T.left-E,top:T.top-(M-T.fontSize*(.07+T._fontSizeFraction))/T.lineHeight,strokeWidth:w}),t.abrupt("return",T);case 11:case"end":return t.stop()}}),r)})))()}static fromObject(t){return this._fromObject(W(W({},t),{},{styles:Tn(t.styles||{},t.text)}),{extraParam:"text"})}}e("f",_o),z(_o,"textLayoutProperties",io),z(_o,"cacheProperties",[...Wr,...no]),z(_o,"ownDefaults",oo),z(_o,"type","Text"),z(_o,"genericFonts",["sans-serif","serif","cursive","fantasy","monospace"]),z(_o,"ATTRIBUTE_NAMES",Di.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor")),Ci(_o,[class extends sr{_toSVG(){var t=this._getSVGLeftTopOffsets(),e=this._getSVGTextAndBg(t.textTop,t.textLeft);return this._wrapSVGTextAndBg(e)}toSVG(t){return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,noStyle:!0,withShadow:!0})}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(t){var e=t.textBgRects,r=t.textSpans,i=this.getSvgTextDecoration(this);return[e.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'.concat(this.fontFamily.replace(go,"'"),'" '):"",this.fontSize?'font-size="'.concat(this.fontSize,'" '):"",this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",i?'text-decoration="'.concat(i,'" '):"","rtl"===this.direction?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",r.join(""),"</text>\n"]}_getSVGTextAndBg(t,e){var r,i=[],n=[],s=t;this.backgroundColor&&n.push(...po(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(var o=0,a=this._textLines.length;o<a;o++)r=this._getLineLeftOffset(o),"rtl"===this.direction&&(r+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",o))&&this._setSVGTextLineBg(n,o,e+r,s),this._setSVGTextLineText(i,o,e+r,s),s+=this.getHeightOfLine(o);return{textSpans:i,textBgRects:n}}_createTextCharSpan(t,e,r,i){var n=this.getSvgSpanStyles(e,t!==t.trim()||!!t.match(fo)),s=n?'style="'.concat(n,'"'):"",o=e.deltaY,a=o?' dy="'.concat(fe(o,q.NUM_FRACTION_DIGITS),'" '):"";return'<tspan x="'.concat(fe(r,q.NUM_FRACTION_DIGITS),'" y="').concat(fe(i,q.NUM_FRACTION_DIGITS),'" ').concat(a).concat(s,">").concat(Dn(t),"</tspan>")}_setSVGTextLineText(t,e,r,i){var n,s,o,a,h,c=this.getHeightOfLine(e),l=this.textAlign.includes(ao),u=this._textLines[e],f="",d=0;i+=c*(1-this._fontSizeFraction)/this.lineHeight;for(var g=0,p=u.length-1;g<=p;g++)h=g===p||this.charSpacing,f+=u[g],o=this.__charBounds[e][g],0===d?(r+=o.kernedWidth-o.width,d+=o.width):d+=o.kernedWidth,l&&!h&&this._reSpaceAndTab.test(u[g])&&(h=!0),h||(n=n||this.getCompleteStyleDeclaration(e,g),s=this.getCompleteStyleDeclaration(e,g+1),h=Cn(n,s,!0)),h&&(a=this._getStyleDeclaration(e,g)||{},t.push(this._createTextCharSpan(f,a,r,i)),f="",n=s,"rtl"===this.direction?r-=d:r+=d,d=0)}_setSVGTextLineBg(t,e,r,i){for(var n,s,o=this._textLines[e],a=this.getHeightOfLine(e)/this.lineHeight,h=0,c=0,l=this.getValueOfPropertyAt(e,0,"textBackgroundColor"),u=0;u<o.length;u++)n=this.__charBounds[e][u],(s=this.getValueOfPropertyAt(e,u,"textBackgroundColor"))!==l?(l&&t.push(...po(l,r+c,i,h,a)),c=n.left,h=n.width,l=s):h+=n.kernedWidth;s&&t.push(...po(l,r+c,i,h,a))}_getSVGLineTopOffset(t){for(var e,r=0,i=0;i<t;i++)r+=this.getHeightOfLine(i);return e=this.getHeightOfLine(j),{lineTop:r,offset:(this._fontSizeMult-this._fontSizeFraction)*e/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(t){return"".concat(super.getSvgStyles(t)," white-space: pre;")}}]),xt.setClass(_o),xt.setSVGClass(_o);class yo{constructor(t){z(this,"target",void 0),z(this,"__mouseDownInPlace",!1),z(this,"__dragStartFired",!1),z(this,"__isDraggingOver",!1),z(this,"__dragStartSelection",void 0),z(this,"__dragImageDisposer",void 0),z(this,"_dispose",void 0),this.target=t;var e=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{e.forEach((t=>t())),this._dispose=void 0}}isPointerOverSelection(t){var e=this.target,r=e.getSelectionStartFromPointer(t);return e.isEditing&&r>=e.selectionStart&&r<=e.selectionEnd&&e.selectionStart<e.selectionEnd}start(t){return this.__mouseDownInPlace=this.isPointerOverSelection(t)}isActive(){return this.__mouseDownInPlace}end(t){var e=this.isActive();return e&&!this.__dragStartFired&&(this.target.setCursorByClick(t),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,e}getDragStartSelection(){return this.__dragStartSelection}setDragImage(t,e){var r,i=e.selectionStart,n=e.selectionEnd,s=this.target,o=s.canvas,a=new kt(s.flipX?-1:1,s.flipY?-1:1),h=s._getCursorBoundaries(i),c=new kt(h.left+h.leftOffset,h.top+h.topOffset).multiply(a).transform(s.calcTransformMatrix()),l=o.getPointer(t).subtract(c),u=o._isRetinaScaling(),f=s.getCanvasRetinaScaling(),d=s.getBoundingRect(!0),g=c.subtract(new kt(d.left,d.top)),p=o.viewportTransform,v=g.add(l).transform(p,!0),m=s.backgroundColor,_=Xr(s.styles);s.backgroundColor="";var y={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};s.setSelectionStyles(y,0,i),s.setSelectionStyles(y,n,s.text.length),s.dirty=!0;var x=s.toCanvasElement({enableRetinaScaling:u,viewportTransform:!0});s.backgroundColor=m,s.styles=_,s.dirty=!0,ke(x,{position:"fixed",left:"".concat(-x.width,"px"),border:vt,width:"".concat(x.width/f,"px"),height:"".concat(x.height/f,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{x.remove()},Te(t.target||this.target.hiddenTextarea).body.appendChild(x),null===(r=t.dataTransfer)||void 0===r||r.setDragImage(x,v.x,v.y)}onDragStart(t){this.__dragStartFired=!0;var e=this.target,r=this.isActive();if(r&&t.dataTransfer){var i=this.__dragStartSelection={selectionStart:e.selectionStart,selectionEnd:e.selectionEnd},n=e._text.slice(i.selectionStart,i.selectionEnd).join(""),s=W({text:e.text,value:n},i);t.dataTransfer.setData("text/plain",n),t.dataTransfer.setData("application/fabric",JSON.stringify({value:n,styles:e.getSelectionStyles(i.selectionStart,i.selectionEnd,!0)})),t.dataTransfer.effectAllowed="copyMove",this.setDragImage(t,s)}return e.abortCursorAnimation(),r}canDrop(t){if(this.target.editable&&!this.target.__corner&&!t.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){var e=this.target.getSelectionStartFromPointer(t),r=this.__dragStartSelection;return e<r.selectionStart||e>r.selectionEnd}return!0}return!1}targetCanDrop(t){return this.target.canDrop(t)}dragEnterHandler(t){var e=t.e,r=this.targetCanDrop(e);!this.__isDraggingOver&&r&&(this.__isDraggingOver=!0)}dragOverHandler(t){var e=t.e,r=this.targetCanDrop(e);!this.__isDraggingOver&&r?this.__isDraggingOver=!0:this.__isDraggingOver&&!r&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(e.preventDefault(),t.canDrop=!0,t.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(t){var e,r=t.e,i=r.defaultPrevented;this.__isDraggingOver=!1,r.preventDefault();var n=null===(e=r.dataTransfer)||void 0===e?void 0:e.getData("text/plain");if(n&&!i){var s=this.target,o=s.canvas,a=s.getSelectionStartFromPointer(r),h=(r.dataTransfer.types.includes("application/fabric")?JSON.parse(r.dataTransfer.getData("application/fabric")):{}).styles,c=n[Math.max(0,n.length-1)];if(this.__dragStartSelection){var l=this.__dragStartSelection.selectionStart,u=this.__dragStartSelection.selectionEnd;a>l&&a<=u?a=l:a>u&&(a-=u-l),s.removeChars(l,u),delete this.__dragStartSelection}s._reNewline.test(c)&&(s._reNewline.test(s._text[a])||a===s._text.length)&&(n=n.trimEnd()),t.didDrop=!0,t.dropTarget=s,s.insertChars(n,h,a),o.setActiveObject(s),s.enterEditing(r),s.selectionStart=Math.min(a+0,s._text.length),s.selectionEnd=Math.min(s.selectionStart+n.length,s._text.length),s.hiddenTextarea.value=s.text,s._updateTextarea(),s.hiddenTextarea.focus(),s.fire("changed",{index:a+0,action:"drop"}),o.fire("text:changed",{target:s}),o.contextTopDirty=!0,o.requestRenderAll()}}dragEndHandler(t){var e=t.e;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var r,i=this.target,n=this.target.canvas,s=this.__dragStartSelection,o=s.selectionStart,a=s.selectionEnd,h=(null===(r=e.dataTransfer)||void 0===r?void 0:r.dropEffect)||vt;h===vt?(i.selectionStart=o,i.selectionEnd=a,i._updateTextarea(),i.hiddenTextarea.focus()):(i.clearContextTop(),"move"===h&&(i.removeChars(o,a),i.selectionStart=i.selectionEnd=o,i.hiddenTextarea&&(i.hiddenTextarea.value=i.text),i._updateTextarea(),i.fire("changed",{index:o,action:"dragend"}),n.fire("text:changed",{target:i}),n.requestRenderAll()),i.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}var xo=/[ \n\.,;!\?\-]/;class bo extends _o{constructor(){super(...arguments),z(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(t){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(t)}_animateCursor(t){var e=t.toValue,r=t.duration,i=t.delay,n=t.onComplete;return Cr({startValue:this._currentCursorOpacity,endValue:e,duration:r,delay:i,onComplete:n,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:t=>{this._currentCursorOpacity=t,this.renderCursorOrSelection()}})}_tick(t){this._currentTickState=this._animateCursor({toValue:1,duration:this.cursorDuration,delay:t,onComplete:this._onTickComplete})}_onTickComplete(){var t;null===(t=this._currentTickCompleteState)||void 0===t||t.abort(),this._currentTickCompleteState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:100,onComplete:this._tick})}initDelayedCursor(t){this.abortCursorAnimation(),this._tick(t?0:this.cursorDelay)}abortCursorAnimation(){var t=!1;[this._currentTickState,this._currentTickCompleteState].forEach((e=>{e&&!e.isDone()&&(t=!0,e.abort())})),this._currentCursorOpacity=1,t&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some((t=>!t||t.isDone()))&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(t){var e=0,r=t-1;if(this._reSpace.test(this._text[r]))for(;this._reSpace.test(this._text[r]);)e++,r--;for(;/\S/.test(this._text[r])&&r>-1;)e++,r--;return t-e}findWordBoundaryRight(t){var e=0,r=t;if(this._reSpace.test(this._text[r]))for(;this._reSpace.test(this._text[r]);)e++,r++;for(;/\S/.test(this._text[r])&&r<this._text.length;)e++,r++;return t+e}findLineBoundaryLeft(t){for(var e=0,r=t-1;!/\n/.test(this._text[r])&&r>-1;)e++,r--;return t-e}findLineBoundaryRight(t){for(var e=0,r=t;!/\n/.test(this._text[r])&&r<this._text.length;)e++,r++;return t+e}searchWordBoundary(t,e){for(var r=this._text,i=this._reSpace.test(r[t])?t-1:t,n=r[i];!xo.test(n)&&i>0&&i<r.length;)n=r[i+=e];return xo.test(n)&&(i+=1===e?0:1),i}selectWord(t){t=t||this.selectionStart;var e=this.searchWordBoundary(t,-1),r=this.searchWordBoundary(t,1);this.selectionStart=e,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(t){t=t||this.selectionStart;var e=this.findLineBoundaryLeft(t),r=this.findLineBoundaryRight(t);return this.selectionStart=e,this.selectionEnd=r,this._fireSelectionChanged(),this._updateTextarea(),this}enterEditing(t){!this.isEditing&&this.editable&&(this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered",{e:t}),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:t}),this.canvas.requestRenderAll()))}updateSelectionOnMouseMove(t){if(!this.__corner){var e=this.hiddenTextarea;Te(e).activeElement!==e&&e.focus();var r=this.getSelectionStartFromPointer(t),i=this.selectionStart,n=this.selectionEnd;(r===this.__selectionStartOnMouseDown&&i!==n||i!==r&&n!==r)&&(r>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=r):(this.selectionStart=r,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===i&&this.selectionEnd===n||(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(t,e,r){var i=r.slice(0,t),n=this.graphemeSplit(i).length;if(t===e)return{selectionStart:n,selectionEnd:n};var s=r.slice(t,e);return{selectionStart:n,selectionEnd:n+this.graphemeSplit(s).length}}fromGraphemeToStringSelection(t,e,r){var i=r.slice(0,t).join("").length;return t===e?{selectionStart:i,selectionEnd:i}:{selectionStart:i,selectionEnd:i+r.slice(t,e).join("").length}}_updateTextarea(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(this.hiddenTextarea){this.cursorOffsetCache={};var t=this.hiddenTextarea;this.text=t.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();var e=this.fromStringToGraphemeSelection(t.selectionStart,t.selectionEnd,t.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){var t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};var t=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(t),r=this.get2DCursorLocation(t),i=r.lineIndex,n=r.charIndex,s=this.getValueOfPropertyAt(i,n,"fontSize")*this.lineHeight,o=e.leftOffset,a=this.getCanvasRetinaScaling(),h=this.canvas.upperCanvasEl,c=h.width/a,l=h.height/a,u=c-s,f=l-s,d=new kt(e.left+o,e.top+e.topOffset+s).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new kt(h.clientWidth/c,h.clientHeight/l));return d.x<0&&(d.x=0),d.x>u&&(d.x=u),d.y<0&&(d.y=0),d.y>f&&(d.y=f),d.x+=this.canvas._offset.left,d.y+=this.canvas._offset.top,{left:"".concat(d.x,"px"),top:"".concat(d.y,"px"),fontSize:"".concat(s,"px"),charHeight:s}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){var t=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,t&&(t.blur&&t.blur(),t.parentNode&&t.parentNode.removeChild(t)),this.hiddenTextarea=null,this.abortCursorAnimation()}exitEditing(){var t=this._textBeforeEdit!==this.text;return this.selectionEnd=this.selectionStart,this._exitEditing(),this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),t&&this.fire("modified"),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(var t in this.styles)this._textLines[t]||delete this.styles[t]}removeStyleFromTo(t,e){var r=this.get2DCursorLocation(t,!0),i=r.lineIndex,n=r.charIndex,s=this.get2DCursorLocation(e,!0),o=s.lineIndex,a=s.charIndex;if(i!==o){if(this.styles[i])for(var h=n;h<this._unwrappedTextLines[i].length;h++)delete this.styles[i][h];if(this.styles[o])for(var c=a;c<this._unwrappedTextLines[o].length;c++){var l=this.styles[o][c];l&&(this.styles[i]||(this.styles[i]={}),this.styles[i][n+c-a]=l)}for(var u=i+1;u<=o;u++)delete this.styles[u];this.shiftLineStyles(o,i-o)}else if(this.styles[i]){for(var f=this.styles[i],d=a-n,g=n;g<a;g++)delete f[g];for(var p in this.styles[i]){var v=parseInt(p,10);v>=a&&(f[v-d]=f[p],delete f[p])}}}shiftLineStyles(t,e){var r=Object.assign({},this.styles);for(var i in this.styles){var n=parseInt(i,10);n>t&&(this.styles[n+e]=r[n],r[n-e]||delete this.styles[n])}}insertNewlineStyleObject(t,e,r,i){var n={},s=this._unwrappedTextLines[t].length===e,o=!1;r||(r=1),this.shiftLineStyles(t,r);var a=this.styles[t]?this.styles[t][0===e?e:e-1]:void 0;for(var h in this.styles[t]){var c=parseInt(h,10);c>=e&&(o=!0,n[c-e]=this.styles[t][h],s&&0===e||delete this.styles[t][h])}var l=!1;for(o&&!s&&(this.styles[t+r]=n,l=!0),l&&r--;r>0;)i&&i[r-1]?this.styles[t+r]={0:W({},i[r-1])}:a?this.styles[t+r]={0:W({},a)}:delete this.styles[t+r],r--;this._forceClearCache=!0}insertCharStyleObject(t,e,r,i){this.styles||(this.styles={});var n=this.styles[t],s=n?W({},n):{};for(var o in r||(r=1),s){var a=parseInt(o,10);a>=e&&(n[a+r]=s[a],s[a-r]||delete n[a])}if(this._forceClearCache=!0,i)for(;r--;)Object.keys(i[r]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][e+r]=W({},i[r]));else if(n)for(var h=n[e?e-1:1];h&&r--;)this.styles[t][e+r]=W({},h)}insertNewStyleBlock(t,e,r){for(var i,n=this.get2DCursorLocation(e,!0),s=[0],o=0,a=0;a<t.length;a++)"\n"===t[a]?s[++o]=0:s[o]++;for(s[0]>0&&(this.insertCharStyleObject(n.lineIndex,n.charIndex,s[0],r),r=r&&r.slice(s[0]+1)),o&&this.insertNewlineStyleObject(n.lineIndex,n.charIndex+s[0],o),i=1;i<o;i++)s[i]>0?this.insertCharStyleObject(n.lineIndex+i,0,s[i],r):r&&this.styles[n.lineIndex+i]&&r[0]&&(this.styles[n.lineIndex+i][0]=r[0]),r=r&&r.slice(s[i]+1);s[i]>0&&this.insertCharStyleObject(n.lineIndex+i,0,s[i],r)}removeChars(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t+1;this.removeStyleFromTo(t,e),this._text.splice(t,e-t),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r;i>r&&this.removeStyleFromTo(r,i);var n=this.graphemeSplit(t);this.insertNewStyleBlock(n,r,e),this._text=[...this._text.slice(0,r),...n,...this._text.slice(i)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(t,e,r){r<=t?(e===t?this._selectionDirection=ft:this._selectionDirection===pt&&(this._selectionDirection=ft,this.selectionEnd=t),this.selectionStart=r):r>t&&r<e?this._selectionDirection===pt?this.selectionEnd=r:this.selectionStart=r:(e===t?this._selectionDirection=pt:this._selectionDirection===ft&&(this._selectionDirection=pt,this.selectionStart=e),this.selectionEnd=r)}}class wo extends bo{initHiddenTextarea(){var t=this.canvas&&Te(this.canvas.getElement())||et(),e=t.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map((t=>{var r=s(t,2),i=r[0],n=r[1];return e.setAttribute(i,n)}));var r=this._calcTextareaPosition(),i=r.top,n=r.left,o=r.fontSize;e.style.cssText="position: absolute; top: ".concat(i,"; left: ").concat(n,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(o,";"),(this.hiddenTextareaContainer||t.body).appendChild(e),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",onCompositionUpdate:"onCompositionEnd"}).map((t=>{var r=s(t,2),i=r[0],n=r[1];return e.addEventListener(i,this[n].bind(this))})),this.hiddenTextarea=e}blur(){this.abortCursorAnimation()}onKeyDown(t){if(this.isEditing){var e="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(t.keyCode in e)this[e[t.keyCode]](t);else{if(!(t.keyCode in this.ctrlKeysMapDown)||!t.ctrlKey&&!t.metaKey)return;this[this.ctrlKeysMapDown[t.keyCode]](t)}t.stopImmediatePropagation(),t.preventDefault(),t.keyCode>=33&&t.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}}onKeyUp(t){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey)&&(this[this.ctrlKeysMapUp[t.keyCode]](t),t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll())}onInput(t){var e=this.fromPaste;if(this.fromPaste=!1,t&&t.stopPropagation(),this.isEditing){var r=()=>{this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(""===this.hiddenTextarea.value)return this.styles={},void r();var i,n,s,o,a=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,h=this._text.length,c=a.length,l=this.selectionStart,u=this.selectionEnd,f=l!==u,d=c-h,g=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),p=l>g.selectionStart;f?(n=this._text.slice(l,u),d+=u-l):c<h&&(n=p?this._text.slice(u+d,u):this._text.slice(l,l-d));var v=a.slice(g.selectionEnd-d,g.selectionEnd);if(n&&n.length&&(v.length&&(i=this.getSelectionStyles(l,l+1,!1),i=v.map((()=>i[0]))),f?(s=l,o=u):p?(s=u-n.length,o=u):(s=u,o=u+n.length),this.removeStyleFromTo(s,o)),v.length){var m=tt().copyPasteData;e&&v.join("")===m.copiedText&&!q.disableStyleCopyPaste&&(i=m.copiedTextStyle),this.insertNewStyleBlock(v,l,i)}r()}}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(t){this.compositionStart=t.target.selectionStart,this.compositionEnd=t.target.selectionEnd,this.updateTextareaPosition()}copy(){if(this.selectionStart!==this.selectionEnd){var t=tt().copyPasteData;t.copiedText=this.getSelectedText(),q.disableStyleCopyPaste?t.copiedTextStyle=null:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}}paste(){this.fromPaste=!0}_getWidthBeforeCursor(t,e){var r,i=this._getLineLeftOffset(t);return e>0&&(i+=(r=this.__charBounds[t][e-1]).left+r.width),i}getDownCursorOffset(t,e){var r=this._getSelectionForOffset(t,e),i=this.get2DCursorLocation(r),n=i.lineIndex;if(n===this._textLines.length-1||t.metaKey||34===t.keyCode)return this._text.length-r;var s=i.charIndex,o=this._getWidthBeforeCursor(n,s),a=this._getIndexOnLine(n+1,o);return this._textLines[n].slice(s).length+a+1+this.missingNewlineOffset(n)}_getSelectionForOffset(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart}getUpCursorOffset(t,e){var r=this._getSelectionForOffset(t,e),i=this.get2DCursorLocation(r),n=i.lineIndex;if(0===n||t.metaKey||33===t.keyCode)return-r;var s=i.charIndex,o=this._getWidthBeforeCursor(n,s),a=this._getIndexOnLine(n-1,o),h=this._textLines[n].slice(0,s),c=this.missingNewlineOffset(n-1);return-this._textLines[n-1].length+a-h.length+(1-c)}_getIndexOnLine(t,e){for(var r,i,n=this._textLines[t],s=this._getLineLeftOffset(t),o=0,a=0,h=n.length;a<h;a++)if((s+=r=this.__charBounds[t][a].width)>e){i=!0;var c=s-r,l=s,u=Math.abs(c-e);o=Math.abs(l-e)<u?a:a-1;break}return i||(o=n.length-1),o}moveCursorDown(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t)}moveCursorUp(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",t)}_moveCursorUpOrDown(t,e){var r=this["get".concat(t,"CursorOffset")](e,this._selectionDirection===pt);if(e.shiftKey?this.moveCursorWithShift(r):this.moveCursorWithoutShift(r),0!==r){var i=this.text.length;this.selectionStart=_r(0,this.selectionStart,i),this.selectionEnd=_r(0,this.selectionEnd,i),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(t){var e=this._selectionDirection===ft?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),0!==t}moveCursorWithoutShift(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),0!==t}moveCursorLeft(t){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",t)}_move(t,e,r){var i;if(t.altKey)i=this["findWordBoundary"+r](this[e]);else{if(!t.metaKey&&35!==t.keyCode&&36!==t.keyCode)return this[e]+="Left"===r?-1:1,!0;i=this["findLineBoundary"+r](this[e])}if(void 0!==i&&this[e]!==i)return this[e]=i,!0}_moveLeft(t,e){return this._move(t,e,"Left")}_moveRight(t,e){return this._move(t,e,"Right")}moveCursorLeftWithoutShift(t){var e=!0;return this._selectionDirection=ft,this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e}moveCursorLeftWithShift(t){return this._selectionDirection===pt&&this.selectionStart!==this.selectionEnd?this._moveLeft(t,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection=ft,this._moveLeft(t,"selectionStart")):void 0}moveCursorRight(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t)}_moveCursorLeftOrRight(t,e){var r="moveCursor"+t+"With";this._currentCursorOpacity=1,e.shiftKey?r+="Shift":r+="outShift",this[r](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(t){return this._selectionDirection===ft&&this.selectionStart!==this.selectionEnd?this._moveRight(t,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection=pt,this._moveRight(t,"selectionEnd")):void 0}moveCursorRightWithoutShift(t){var e=!0;return this._selectionDirection=pt,this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e}}function Co(t){return t.button&&1!==t.button}class So extends wo{constructor(){super(...arguments),z(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler),this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown),this.draggableTextDelegate=new yo(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(t){return this.draggableTextDelegate.onDragStart(t)}canDrop(t){return this.draggableTextDelegate.canDrop(t)}onMouseDown(t){if(this.canvas){this.__newClickTime=+new Date;var e=t.pointer;this.isTripleClick(e)&&(this.fire("tripleclick",t),Ie(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastSelected=this.selected}}isTripleClick(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y}doubleClickHandler(t){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(t.e))}tripleClickHandler(t){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(t.e))}_mouseDownHandler(t){var e=t.e;this.canvas&&this.editable&&!Co(e)&&!this.__corner&&(this.draggableTextDelegate.start(e)||(this.canvas.textEditingManager.register(this),this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection())))}_mouseDownHandlerBefore(t){var e=t.e;this.canvas&&this.editable&&!Co(e)&&(this.selected=this===this.canvas._activeObject)}mouseUpHandler(t){var e=t.e,r=t.transform,i=(t.button,this.draggableTextDelegate.end(e));if(this.canvas){this.canvas.textEditingManager.unregister(this);var n=this.canvas._activeObject;if(n&&n!==this)return}!this.editable||this.group&&!this.group.interactive||r&&r.actionPerformed||Co(e)||i||(this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0)}setCursorByClick(t){var e=this.getSelectionStartFromPointer(t),r=this.selectionStart,i=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(r,i,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(t){for(var e=this.canvas.getPointer(t).transform(zt(this.calcTransformMatrix())).add(new kt(-this._getLeftOffset(),-this._getTopOffset())),r=0,i=0,n=0,s=0,o=this._textLines.length;s<o&&r<=e.y;s++)r+=this.getHeightOfLine(s),n=s,s>0&&(i+=this._textLines[s-1].length+this.missingNewlineOffset(s-1));for(var a=Math.abs(this._getLineLeftOffset(n)),h=this._textLines[n].length,c=0,l=0;l<h&&(c=a,(a+=this.__charBounds[n][l].kernedWidth)<=e.x);l++)i++;return this._getNewSelectionStartFromOffset(e,c,a,i,h)}_getNewSelectionStartFromOffset(t,e,r,i,n){var s=t.x-e,o=r-t.x,a=i+(o>s||o<0?0:1);return this.flipX&&(a=n-a),a>this._text.length&&(a=this._text.length),a}}var To="moveCursorUp",Oo="moveCursorDown",ko="moveCursorLeft",Do="moveCursorRight",Mo="exitEditing",Eo={selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_selectionDirection:null,_reSpace:/\s|\n/,inCompositionMode:!1,keysMap:{9:Mo,27:Mo,33:To,34:Oo,35:Do,36:ko,37:ko,38:To,39:Do,40:Oo},keysMapRtl:{9:Mo,27:Mo,33:To,34:Oo,35:ko,36:Do,37:Do,38:To,39:ko,40:Oo},ctrlKeysMapDown:{65:"selectAll"},ctrlKeysMapUp:{67:"copy",88:"cut"}};class Ao extends So{static getDefaults(){return W(W({},super.getDefaults()),Ao.ownDefaults)}get type(){return"i-text"}constructor(t,e){super(t,e),this.initBehavior()}_set(t,e){return this.isEditing&&this._savedProps&&t in this._savedProps?(this._savedProps[t]=e,this):("canvas"===t&&(this.canvas instanceof xs&&this.canvas.textEditingManager.remove(this),e instanceof xs&&e.textEditingManager.add(this)),super._set(t,e))}setSelectionStart(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)}setSelectionEnd(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)}_updateAndFire(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart||0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionEnd,r=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(t,e,r)}setSelectionStyles(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.selectionStart||0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.selectionEnd;return super.setSelectionStyles(t,e,r)}get2DCursorLocation(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(t,e)}render(t){super.render(t),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(t){var e=this.isEditing;this.isEditing=!1;var r=super.toCanvasElement(t);return this.isEditing=e,r}renderCursorOrSelection(){if(this.isEditing){var t=this.clearContextTop(!0);if(t){var e=this._getCursorBoundaries();this.selectionStart===this.selectionEnd?this.renderCursor(t,e):this.renderSelection(t,e),this.canvas.contextTopDirty=!0,t.restore()}}}_getCursorBoundaries(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0,r=this._getLeftOffset(),i=this._getTopOffset(),n=this._getCursorBoundariesOffsets(t,e);return{left:r,top:i,leftOffset:n.left,topOffset:n.top}}_getCursorBoundariesOffsets(t,e){return e?this.__getCursorBoundariesOffsets(t):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(t)}__getCursorBoundariesOffsets(t){for(var e=0,r=0,i=this.get2DCursorLocation(t),n=i.charIndex,s=i.lineIndex,o=0;o<s;o++)e+=this.getHeightOfLine(o);var a=this._getLineLeftOffset(s),h=this.__charBounds[s][n];h&&(r=h.left),0!==this.charSpacing&&n===this._textLines[s].length&&(r-=this._getWidthOfCharSpacing());var c={top:e,left:a+(r>0?r:0)};return"rtl"===this.direction&&(this.textAlign===pt||this.textAlign===ao||this.textAlign===co?c.left*=-1:this.textAlign===ft||this.textAlign===ho?c.left=a-(r>0?r:0):this.textAlign!==ut&&this.textAlign!==lo||(c.left=a-(r>0?r:0))),c}renderCursorAt(t){var e=this._getCursorBoundaries(t,!0);this._renderCursor(this.canvas.contextTop,e,t)}renderCursor(t,e){this._renderCursor(t,e,this.selectionStart)}_renderCursor(t,e,r){var i=this.get2DCursorLocation(r),n=i.lineIndex,s=i.charIndex>0?i.charIndex-1:0,o=this.getValueOfPropertyAt(n,s,"fontSize"),a=this.scaleX*this.canvas.getZoom(),h=this.cursorWidth/a,c=this.getValueOfPropertyAt(n,s,"deltaY"),l=e.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(n)/this.lineHeight-o*(1-this._fontSizeFraction);this.inCompositionMode&&this.renderSelection(t,e),t.fillStyle=this.cursorColor||this.getValueOfPropertyAt(n,s,"fill"),t.globalAlpha=this._currentCursorOpacity,t.fillRect(e.left+e.leftOffset-h/2,l+e.top+c,h,o)}renderSelection(t,e){var r={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(t,r,e)}renderDragSourceEffect(){var t=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,t,this._getCursorBoundaries(t.selectionStart,!0))}renderDropTargetEffect(t){var e=this.getSelectionStartFromPointer(t);this.renderCursorAt(e)}_renderSelection(t,e,r){for(var i=e.selectionStart,n=e.selectionEnd,s=this.textAlign.includes(ao),o=this.get2DCursorLocation(i),a=this.get2DCursorLocation(n),h=o.lineIndex,c=a.lineIndex,l=o.charIndex<0?0:o.charIndex,u=a.charIndex<0?0:a.charIndex,f=h;f<=c;f++){var d,g=this._getLineLeftOffset(f)||0,p=this.getHeightOfLine(f),v=0,m=0;if(f===h&&(v=this.__charBounds[h][l].left),f>=h&&f<c)m=s&&!this.isEndOfWrapping(f)?this.width:this.getLineWidth(f)||5;else if(f===c)if(0===u)m=this.__charBounds[c][u].left;else{var _=this._getWidthOfCharSpacing();m=this.__charBounds[c][u-1].left+this.__charBounds[c][u-1].width-_}d=p,(this.lineHeight<1||f===c&&this.lineHeight>1)&&(p/=this.lineHeight);var y=r.left+g+v,x=p,b=0,w=m-v;this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",x=1,b=p):t.fillStyle=this.selectionColor,"rtl"===this.direction&&(this.textAlign===pt||this.textAlign===ao||this.textAlign===co?y=this.width-y-w:this.textAlign===ft||this.textAlign===ho?y=r.left+g-m:this.textAlign!==ut&&this.textAlign!==lo||(y=r.left+g-m)),t.fillRect(y,r.top+r.topOffset+b,w,x),r.topOffset+=d}}getCurrentCharFontSize(){var t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")}getCurrentCharColor(){var t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fill")}_getCurrentCharIndex(){var t=this.get2DCursorLocation(this.selectionStart,!0),e=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:e}}dispose(){this._exitEditing(),this.draggableTextDelegate.dispose(),super.dispose()}}e("I",Ao),z(Ao,"ownDefaults",Eo),z(Ao,"type","IText"),xt.setClass(Ao),xt.setClass(Ao,"i-text");var Po,jo=class t extends Ao{static getDefaults(){return W(W({},super.getDefaults()),{},{controls:bi()},t.ownDefaults)}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(ao)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(t){for(var e=0,r=0,i=0,n={},s=0;s<t.graphemeLines.length;s++)"\n"===t.graphemeText[i]&&s>0?(r=0,i++,e++):!this.splitByGrapheme&&this._reSpaceAndTab.test(t.graphemeText[i])&&s>0&&(r++,i++),n[s]={line:e,offset:r},i+=t.graphemeLines[s].length,r+=t.graphemeLines[s].length;return n}styleHas(t,e){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[e];r&&(e=r.line)}return super.styleHas(t,e)}isEmptyStyles(t){if(!this.styles)return!0;var e,r=0,i=!1,n=this._styleMap[t],s=this._styleMap[t+1];n&&(t=n.line,r=n.offset),s&&(i=s.line===t,e=s.offset);var o=void 0===t?this.styles:{line:this.styles[t]};for(var a in o)for(var h in o[a])if(h>=r&&(!i||h<e))for(var c in o[a][h])return!1;return!0}_getStyleDeclaration(t,e){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[t];if(!r)return null;t=r.line,e=r.offset+e}return super._getStyleDeclaration(t,e)}_setStyleDeclaration(t,e,r){var i=this._styleMap[t];t=i.line,e=i.offset+e,this.styles[t][e]=r}_deleteStyleDeclaration(t,e){var r=this._styleMap[t];t=r.line,e=r.offset+e,delete this.styles[t][e]}_getLineStyle(t){var e=this._styleMap[t];return!!this.styles[e.line]}_setLineStyle(t){var e=this._styleMap[t];this.styles[e.line]={}}_wrapText(t,e){var r=[];this.isWrapping=!0;for(var i=0;i<t.length;i++)r.push(...this._wrapLine(t[i],i,e));return this.isWrapping=!1,r}_measureWord(t,e){for(var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=0,s=0,o=t.length;s<o;s++){n+=this._getGraphemeBox(t[s],e,s+i,r,true).kernedWidth,r=t[s]}return n}wordSplit(t){return t.split(this._wordJoiners)}_wrapLine(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=this._getWidthOfCharSpacing(),s=this.splitByGrapheme,o=[],a=s?this.graphemeSplit(t):this.wordSplit(t),h=s?"":" ",c=0,l=[],u=0,f=0,d=0,g=!0;0===a.length&&a.push([]),r-=i;var p,v=a.map((t=>{t=s?t:this.graphemeSplit(t);var r=this._measureWord(t,e,u);return d=Math.max(r,d),u+=t.length+h.length,{word:t,width:r}})),m=Math.max(r,d,this.dynamicMinWidth);for(u=0,p=0;p<a.length;p++){var _=v[p].word,y=v[p].width;u+=_.length,(c+=f+y-n)>m&&!g?(o.push(l),l=[],c=y,g=!0):c+=n,g||s||l.push(h),l=l.concat(_),f=s?0:this._measureWord([h],e,u),u++,g=!1}return p&&o.push(l),d+i>this.dynamicMinWidth&&(this.dynamicMinWidth=d-n+i),o}isEndOfWrapping(t){return!this._styleMap[t+1]||this._styleMap[t+1].line!==this._styleMap[t].line}missingNewlineOffset(t){return this.splitByGrapheme?this.isEndOfWrapping(t)?1:0:1}_splitTextIntoLines(t){for(var e=super._splitTextIntoLines(t),r=this._wrapText(e.lines,this.width),i=new Array(r.length),n=0;n<r.length;n++)i[n]=r[n].join("");return e.lines=i,e.graphemeLines=r,e}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){var t={};for(var e in this._styleMap)this._textLines[e]&&(t[this._styleMap[e].line]=1);for(var r in this.styles)t[r]||delete this.styles[r]}toObject(t){return super.toObject(["minWidth","splitByGrapheme"].concat(t))}};e("T",jo),z(jo,"type","Textbox"),z(jo,"textLayoutProperties",[...Ao.textLayoutProperties,"width"]),z(jo,"ownDefaults",{minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1}),xt.setClass(jo);class Fo{constructor(){z(this,"resources",{})}applyFilters(t,e,r,i,n){var s=n.getContext("2d");if(s){s.drawImage(e,0,0,r,i);var o={sourceWidth:r,sourceHeight:i,imageData:s.getImageData(0,0,r,i),originalEl:e,originalImageData:s.getImageData(0,0,r,i),canvasEl:n,ctx:s,filterBackend:this};t.forEach((t=>{t.applyTo(o)}));var a=o.imageData;return a.width===r&&a.height===i||(n.width=a.width,n.height=a.height),s.putImageData(a,0,0),o}}}class Lo{constructor(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).tileSize,e=void 0===t?q.textureSize:t;z(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),z(this,"resources",{}),this.tileSize=e,this.setupGLContext(e,e),this.captureGPUInfo()}setupGLContext(t,e){this.dispose(),this.createWebGLCanvas(t,e),this.chooseFastestCopyGLTo2DMethod(t,e)}chooseFastestCopyGLTo2DMethod(t,e){var r=Lt(),i=new ArrayBuffer(t*e*4);if(q.forceGLPutImageData)return this.imageBuffer=i,void(this.copyGLTo2D=Ro);var n,s={imageBuffer:i},o={destinationWidth:t,destinationHeight:e,targetCanvas:r};r.width=t,r.height=e,n=rt().performance.now(),this.copyGLTo2D.call(s,this.gl,o);var a=rt().performance.now()-n;n=rt().performance.now(),Ro.call(s,this.gl,o),a>rt().performance.now()-n&&(this.imageBuffer=i,this.copyGLTo2D=Ro)}createWebGLCanvas(t,e){var r=Lt();r.width=t,r.height=e;var i=r.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1});i&&(i.clearColor(0,0,0,0),this.canvas=r,this.gl=i)}applyFilters(t,e,r,i,n,s){var o=this.gl,a=n.getContext("2d");if(o&&a){var h;s&&(h=this.getCachedTexture(s,e));var c={originalWidth:e.width||e.originalWidth||0,originalHeight:e.height||e.originalHeight||0,sourceWidth:r,sourceHeight:i,destinationWidth:r,destinationHeight:i,context:o,sourceTexture:this.createTexture(o,r,i,h?void 0:e),targetTexture:this.createTexture(o,r,i),originalTexture:h||this.createTexture(o,r,i,h?void 0:e),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:n},l=o.createFramebuffer();return o.bindFramebuffer(o.FRAMEBUFFER,l),t.forEach((t=>{t&&t.applyTo(c)})),function(t){var e=t.targetCanvas,r=e.width,i=e.height,n=t.destinationWidth,s=t.destinationHeight;r===n&&i===s||(e.width=n,e.height=s)}(c),this.copyGLTo2D(o,c),o.bindTexture(o.TEXTURE_2D,null),o.deleteTexture(c.sourceTexture),o.deleteTexture(c.targetTexture),o.deleteFramebuffer(l),a.setTransform(1,0,0,1,0,0),c}}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(t,e,r,i,n){var s=t.NEAREST,o=t.TEXTURE_2D,a=t.RGBA,h=t.UNSIGNED_BYTE,c=t.CLAMP_TO_EDGE,l=t.TEXTURE_MAG_FILTER,u=t.TEXTURE_MIN_FILTER,f=t.TEXTURE_WRAP_S,d=t.TEXTURE_WRAP_T,g=t.createTexture();return t.bindTexture(o,g),t.texParameteri(o,l,n||s),t.texParameteri(o,u,n||s),t.texParameteri(o,f,c),t.texParameteri(o,d,c),i?t.texImage2D(o,0,a,a,h,i):t.texImage2D(o,0,a,e,r,0,a,h,null),g}getCachedTexture(t,e,r){var i=this.textureCache;if(i[t])return i[t];var n=this.createTexture(this.gl,e.width,e.height,e,r);return n&&(i[t]=n),n}evictCachesForKey(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])}copyGLTo2D(t,e){var r=t.canvas,i=e.targetCanvas,n=i.getContext("2d");if(n){n.translate(0,i.height),n.scale(1,-1);var s=r.height-i.height;n.drawImage(r,0,s,i.width,i.height,0,0,i.width,i.height)}}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;var t=this.gl,e={renderer:"",vendor:""};if(!t)return e;var r=t.getExtension("WEBGL_debug_renderer_info");if(r){var i=t.getParameter(r.UNMASKED_RENDERER_WEBGL),n=t.getParameter(r.UNMASKED_VENDOR_WEBGL);i&&(e.renderer=i.toLowerCase()),n&&(e.vendor=n.toLowerCase())}return this.gpuInfo=e,e}}function Ro(t,e){var r=e.targetCanvas.getContext("2d"),i=e.destinationWidth,n=e.destinationHeight,s=i*n*4;if(r){var o=new Uint8Array(this.imageBuffer,0,s),a=new Uint8ClampedArray(this.imageBuffer,0,s);t.readPixels(0,0,i,n,t.RGBA,t.UNSIGNED_BYTE,o);var h=new ImageData(a,i,n);r.putImageData(h,0,0)}}function Io(){return!Po&&(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(Po=function(){var t=tt().WebGLProbe;return t.queryWebGL(Lt()),q.enableGLFiltering&&t.isSupported(q.textureSize)?new Lo({tileSize:q.textureSize}):new Fo}()),Po}var Bo=["filters","resizeFilter","src","crossOrigin"],Xo=["cropX","cropY"];class Yo extends Si{static getDefaults(){return W(W({},super.getDefaults()),Yo.ownDefaults)}constructor(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(W({filters:[]},e)),z(this,"_lastScaleX",1),z(this,"_lastScaleY",1),z(this,"_filterScalingX",1),z(this,"_filterScalingY",1),this.cacheKey="texture".concat(Ft()),this.setElement("string"==typeof t?(this.canvas&&getElementDocument(this.canvas.getElement())||et()).getElementById(t):t,e)}getElement(){return this._element}setElement(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=t,this._originalElement=t,this._setWidthHeight(e),t.classList.add(Yo.CSS_CANVAS),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(t){var e=Io(!1);e instanceof Lo&&e.evictCachesForKey(t)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((t=>{var e=this[t];e&&tt().dispose(e),this[t]=void 0}))}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){var t=this.getElement();return t?{width:t.naturalWidth||t.width,height:t.naturalHeight||t.height}:{width:0,height:0}}_stroke(t){if(this.stroke&&0!==this.strokeWidth){var e=this.width/2,r=this.height/2;t.beginPath(),t.moveTo(-e,-r),t.lineTo(e,-r),t.lineTo(e,r),t.lineTo(-e,r),t.lineTo(-e,-r),t.closePath()}}toObject(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=[];return this.filters.forEach((t=>{t&&e.push(t.toObject())})),W(W({},super.toObject([...Xo,...t])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:e},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){var t,e=[],r=this._element,i=-this.width/2,n=-this.height/2,s=[],o="",a="";if(!r)return[];if(this.hasCrop()){var h=Ft();s.push('<clipPath id="imageCrop_'+h+'">\n','\t<rect x="'+i+'" y="'+n+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),o=' clip-path="url(#imageCrop_'+h+')" '}if(this.imageSmoothing||(a='" image-rendering="optimizeSpeed'),e.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',i-this.cropX,'" y="',n-this.cropY,'" width="',r.width||r.naturalWidth,'" height="',r.height||r.naturalHeight,a,'"',o,"></image>\n"),this.stroke||this.strokeDashArray){var c=this.fill;this.fill=null,t=["\t<rect ",'x="',i,'" y="',n,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=c}return s="fill"!==this.paintFirst?s.concat(t,e):s.concat(e,t)}getSrc(t){var e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():this.srcFromAttribute?e.getAttribute("src"):e.src:this.src||""}getSvgSrc(t){return this.getSrc(t)}setSrc(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.crossOrigin,i=e.signal;return te(t,{crossOrigin:r,signal:i}).then((t=>{void 0!==r&&this.set({crossOrigin:r}),this.setElement(t)}))}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){var t=this.resizeFilter,e=this.minimumScaleTrigger,r=this.getTotalObjectScaling(),i=r.x,n=r.y,s=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!t||i>e&&n>e)return this._element=s,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=i,void(this._lastScaleY=n);var o=Lt(),a=s.width,h=s.height;o.width=a,o.height=h,this._element=o,this._lastScaleX=t.scaleX=i,this._lastScaleY=t.scaleY=n,Io().applyFilters([t],s,a,h,this._element),this._filterScalingX=o.width/this._originalElement.width,this._filterScalingY=o.height/this._originalElement.height}applyFilters(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.filters||[];if(t=t.filter((t=>t&&!t.isNeutralState())),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),0===t.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,void(this._filterScalingY=1);var e=this._originalElement,r=e.naturalWidth||e.width,i=e.naturalHeight||e.height;if(this._element===this._originalElement){var n=Lt();n.width=r,n.height=i,this._element=n,this._filteredEl=n}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,r,i),this._lastScaleX=1,this._lastScaleY=1;Io().applyFilters(t,this._originalElement,r,i,this._element),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(t){t.imageSmoothingEnabled=this.imageSmoothing,!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(t),this._renderPaintInOrder(t)}drawCacheOnCanvas(t){t.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(t)}shouldCache(){return this.needsItsOwnCache()}_renderFill(t){var e=this._element;if(e){var r=this._filterScalingX,i=this._filterScalingY,n=this.width,s=this.height,o=Math.max(this.cropX,0),a=Math.max(this.cropY,0),h=e.naturalWidth||e.width,c=e.naturalHeight||e.height,l=o*r,u=a*i,f=Math.min(n*r,h-l),d=Math.min(s*i,c-u),g=-n/2,p=-s/2,v=Math.min(n,h/r-o),m=Math.min(s,c/i-a);e&&t.drawImage(e,l,u,f,d,g,p,v,m)}}_needsResize(){var t=this.getTotalObjectScaling();return t.x!==this._lastScaleX||t.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.width,r=t.height,i=this.getOriginalSize();this.width=e||i.width,this.height=r||i.height}parsePreserveAspectRatioAttribute(){var t,e=ge(this.preserveAspectRatio||""),r=this.width,i=this.height,n={width:r,height:i},s=this._element.width,o=this._element.height,a=1,h=1,c=0,l=0,u=0,f=0;return!e||e.alignX===vt&&e.alignY===vt?(a=r/s,h=i/o):("meet"===e.meetOrSlice&&(t=(r-s*(a=h=On(this._element,n)))/2,"Min"===e.alignX&&(c=-t),"Max"===e.alignX&&(c=t),t=(i-o*h)/2,"Min"===e.alignY&&(l=-t),"Max"===e.alignY&&(l=t)),"slice"===e.meetOrSlice&&(t=s-r/(a=h=kn(this._element,n)),"Mid"===e.alignX&&(u=t/2),"Max"===e.alignX&&(u=t),t=o-i/h,"Mid"===e.alignY&&(f=t/2),"Max"===e.alignY&&(f=t),s=r/a,o=i/h)),{width:s,height:o,scaleX:a,scaleY:h,offsetLeft:c,offsetTop:l,cropX:u,cropY:f}}static fromObject(t){var e=t.filters,r=t.resizeFilter,i=t.src,n=t.crossOrigin,o=G(t,Bo),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Promise.all([te(i,W(W({},a),{},{crossOrigin:n})),e&&ee(e,a),r&&ee([r],a),re(o,a)]).then((t=>{var e=s(t,4),r=e[0],a=e[1],h=void 0===a?[]:a,c=e[2],l=s(void 0===c?[]:c,1)[0],u=e[3],f=void 0===u?{}:u;return new this(r,W(W({},o),{},{src:i,crossOrigin:n,filters:h,resizeFilter:l},f))}))}static fromURL(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return te(t,e).then((t=>new this(t,e)))}static fromElement(e){var i=arguments,n=this;return r(t().mark((function r(){var s,o;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=i.length>1&&void 0!==i[1]?i[1]:{},o=un(e,n.ATTRIBUTE_NAMES),t.abrupt("return",n.fromURL(o["xlink:href"],W(W({},s),o)).catch((t=>(console.log(t),null))));case 3:case"end":return t.stop()}}),r)})))()}}e("h",Yo),z(Yo,"type","Image"),z(Yo,"cacheProperties",[...Wr,...Xo]),z(Yo,"ownDefaults",{strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0}),z(Yo,"CSS_CANVAS","canvas-img"),z(Yo,"ATTRIBUTE_NAMES",[...Di,"x","y","width","height","preserveAspectRatio","xlink:href","crossOrigin","image-rendering"]),xt.setClass(Yo),xt.setSVGClass(Yo);var Wo,zo=t=>xt.getSVGClass(t.tagName.toLowerCase().replace("svg:",""));(Wo=function(t,e,r,i,n){this.elements=t,this.options=e,this.reviver=r,this.svgUid=e&&e.svgUid||0,this.parsingOptions=i,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=n}.prototype).parse=function(){return Promise.all(this.elements.map(((t,e)=>(t.setAttribute("svgUid",this.svgUid),this.createObject(t)))))},Wo.createObject=function(){var e=r(t().mark((function e(r){var i,n,s;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(i=zo(r))){t.next=13;break}return t.next=4,i.fromElement(r,this.options);case 4:return n=t.sent,this.resolveGradient(n,r,"fill"),this.resolveGradient(n,r,"stroke"),n instanceof Yo&&n._originalElement&&(s=n.parsePreserveAspectRatioAttribute(r)),ls(n,s),t.next=11,this.resolveClipPath(n,r);case 11:return this.reviver&&this.reviver(r,n),t.abrupt("return",n);case 13:return t.abrupt("return",null);case 14:case"end":return t.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),Wo.extractPropertyDefinition=function(t,e,r){var i=t[e],n=this.regexUrl;if(n.test(i)){n.lastIndex=0;var s=n.exec(i)[1];return n.lastIndex=0,Ai[r][this.svgUid][s]}},Wo.resolveGradient=function(t,e,r){var i=this.extractPropertyDefinition(t,r,"gradientDefs");if(i){var n=e.getAttribute(r+"-opacity"),s=Fs.fromElement(i,t,W(W({},this.options),{},{opacity:n}));t.set(r,s)}},Wo.resolveClipPath=function(){var e=r(t().mark((function e(r,i){var n,s,o,a,h,c,l,u,f,d,g,p,v,m;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=this.extractPropertyDefinition(r,"clipPath","clipPaths"))){t.next=22;break}for(s=zt(r.calcTransformMatrix()),o=n[0].parentNode,a=i;a.parentNode&&a.getAttribute("clip-path")!==r.clipPath;)a=a.parentNode;return a.parentNode.appendChild(o),t.next=9,Promise.all(n.map((t=>zo(t).fromElement(t,this.options).then((t=>(ls(t),t.fillRule=t.clipRule,t))))));case 9:if(h=t.sent,c=1===h.length?h[0]:new vn(h),l=Vt(s,c.calcTransformMatrix()),!c.clipPath){t.next=15;break}return t.next=15,this.resolveClipPath(c,a);case 15:u=Ut(l),f=u.scaleX,d=u.scaleY,g=u.angle,p=u.skewX,v=u.translateX,m=u.translateY,c.set({flipX:!1,flipY:!1}),c.set({scaleX:f,scaleY:d,angle:g,skewX:p,skewY:0}),c.setPositionByOrigin(new kt(v,m),ut,ut),r.clipPath=c,t.next=24;break;case 22:return delete r.clipPath,t.abrupt("return");case 24:case"end":return t.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}();var Vo=t=>new kt(t.width,t.height),Go=t=>function(e,r,i){var n,s,o=i.points[t].x-i.pathOffset.x,a=i.points[t].y-i.pathOffset.y;return new kt(o,a).transform(Vt(null!==(n=null===(s=i.canvas)||void 0===s?void 0:s.viewportTransform)&&void 0!==n?n:ct,i.calcTransformMatrix()))},Uo=(t,e,r,i)=>{var n=e.target,s=e.pointIndex,o=ir(e,ut,ut,r,i),a=Vo(n),h=n._getTransformedDimensions(),c=a.divide(h),l=new kt(n.flipX?-1:1,n.flipY?-1:1),u=o.multiply(l).multiply(c).add(n.pathOffset);return n.points[s]=u,n.setDimensions(),!0},Ho=(t,e)=>function(r,i,n,s){var o=i.target,a=(t>0?t:o.points.length)-1,h=new kt(o.points[a].x-o.pathOffset.x,o.points[a].y-o.pathOffset.y).transform(o.calcOwnMatrix()),c=e(r,W(W({},i),{},{pointIndex:t}),n,s),l=Vo(o),u=new kt(o.flipX?-1:1,o.flipY?-1:1),f=new kt(o.points[a].x,o.points[a].y).subtract(o.pathOffset).divide(l).multiply(u);return o.setPositionByOrigin(h,f.x+.5,f.y+.5),c};e("b",Object.freeze({__proto__:null,changeWidth:Nr,createObjectDefaultControls:yi,createPolyControls:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={},i=0;i<("number"==typeof t?t:t.points.length);i++)r["p".concat(i)]=new $r(W({actionName:"modifyPoly",positionHandler:Go(i),actionHandler:Ho(i,Uo)},e));return r},createResizeControls:xi,createTextboxDefaultControls:bi,dragHandler:nr,getLocalPoint:ir,renderCircleControl:qr,renderSquareControl:Kr,rotationStyleHandler:Zr,rotationWithSnapping:Jr,scaleCursorStyleHandler:ri,scaleOrSkewActionName:pi,scaleSkewCursorStyleHandler:vi,scalingEqually:ni,scalingX:si,scalingXOrSkewingY:mi,scalingY:oi,scalingYOrSkewingX:_i,skewCursorStyleHandler:li,skewHandlerX:fi,skewHandlerY:di,wrapWithFireEvent:Ur,wrapWithFixedAnchor:Hr}));var No=t=>void 0!==t.webgl,qo="precision highp float",Ko="\n    ".concat(qo,";\n    varying vec2 vTexCoord;\n    uniform sampler2D uTexture;\n    void main() {\n      gl_FragColor = texture2D(uTexture, vTexCoord);\n    }"),$o=["type"];class Zo{get type(){return this.constructor.type}constructor(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=V({},(function(t){if(null==t)throw new TypeError("Cannot destructure "+t)}(t),t));z(this,"vertexSource","\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    void main() {\n      vTexCoord = aPosition;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }"),Object.assign(this,this.constructor.defaults,e)}getFragmentSource(){return Ko}createProgram(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getFragmentSource(),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.vertexSource,i=tt().WebGLProbe.GLPrecision,n=void 0===i?"highp":i;"highp"!==n&&(e=e.replace(new RegExp(qo,"g"),qo.replace("highp",n)));var s=t.createShader(t.VERTEX_SHADER),o=t.createShader(t.FRAGMENT_SHADER),a=t.createProgram();if(!s||!o||!a)throw new Error("Vertex, fragment shader or program creation error");if(t.shaderSource(s,r),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))throw new Error("Vertex shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(s)));if(t.shaderSource(o,e),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS))throw new Error("Fragment shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(o)));if(t.attachShader(a,s),t.attachShader(a,o),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+t.getProgramInfoLog(a));var h=this.getUniformLocations(t,a)||{};return h.uStepW=t.getUniformLocation(a,"uStepW"),h.uStepH=t.getUniformLocation(a,"uStepH"),{program:a,attributeLocations:this.getAttributeLocations(t,a),uniformLocations:h}}getAttributeLocations(t,e){return{aPosition:t.getAttribLocation(e,"aPosition")}}getUniformLocations(t,e){return{}}sendAttributeData(t,e,r){var i=e.aPosition,n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.enableVertexAttribArray(i),t.vertexAttribPointer(i,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW)}_setupFrameBuffer(t){var e=t.context;if(t.passes>1){var r=t.destinationWidth,i=t.destinationHeight;t.sourceWidth===r&&t.sourceHeight===i||(e.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(e,r,i)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.targetTexture,0)}else e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish()}_swapTextures(t){t.passes--,t.pass++;var e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e}isNeutralState(t){var e=this.mainParameter,r=this.constructor.defaults[e];if(e){var i=this[e];return Array.isArray(r)&&Array.isArray(i)?r.every(((t,e)=>t===i[e])):r===i}return!1}applyTo(t){No(t)?(this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){}getCacheKey(){return this.type}retrieveShader(t){var e=this.getCacheKey();return t.programCache[e]||(t.programCache[e]=this.createProgram(t.context)),t.programCache[e]}applyToWebGL(t){var e=t.context,r=this.retrieveShader(t);0===t.pass&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(r.program),this.sendAttributeData(e,r.attributeLocations,t.aPosition),e.uniform1f(r.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(r.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,r.uniformLocations),e.viewport(0,0,t.destinationWidth,t.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(t,e,r){t.activeTexture(r),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0)}unbindAdditionalTexture(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)}getMainParameter(){return this.mainParameter?this[this.mainParameter]:void 0}setMainParameter(t){this.mainParameter&&(this[this.mainParameter]=t)}sendUniformData(t,e){}createHelpLayer(t){if(!t.helpLayer){var e=Lt();e.width=t.sourceWidth,e.height=t.sourceHeight,t.helpLayer=e}}toObject(){var t=this.mainParameter;return W({type:this.type},t?{[t]:this[t]}:{})}toJSON(){return this.toObject()}static fromObject(e,i){var n=this;return r(t().mark((function r(){var i;return t().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=G(e,$o),t.abrupt("return",new n(i));case 2:case"end":return t.stop()}}),r)})))()}}z(Zo,"type","BaseFilter");var Jo={multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",difference:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"\n    if (uColor.r < 0.5) {\n      gl_FragColor.r *= 2.0 * uColor.r;\n    } else {\n      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n    }\n    if (uColor.g < 0.5) {\n      gl_FragColor.g *= 2.0 * uColor.g;\n    } else {\n      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n    }\n    if (uColor.b < 0.5) {\n      gl_FragColor.b *= 2.0 * uColor.b;\n    } else {\n      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n    }\n    ",tint:"\n    gl_FragColor.rgb *= (1.0 - uColor.a);\n    gl_FragColor.rgb += uColor.rgb;\n    "};class Qo extends Zo{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return"\n      precision highp float;\n      uniform sampler2D uTexture;\n      uniform vec4 uColor;\n      varying vec2 vTexCoord;\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        gl_FragColor = color;\n        if (color.a > 0.0) {\n          ".concat(Jo[this.mode],"\n        }\n      }\n      ")}applyTo2d(t){for(var e=t.imageData.data,r=new ue(this.color).getSource(),i=r[0]*this.alpha,n=r[1]*this.alpha,s=r[2]*this.alpha,o=1-this.alpha,a=0;a<e.length;a+=4){var h=e[a],c=e[a+1],l=e[a+2];switch(this.mode){case"multiply":e[a]=h*i/255,e[a+1]=c*n/255,e[a+2]=l*s/255;break;case"screen":e[a]=255-(255-h)*(255-i)/255,e[a+1]=255-(255-c)*(255-n)/255,e[a+2]=255-(255-l)*(255-s)/255;break;case"add":e[a]=h+i,e[a+1]=c+n,e[a+2]=l+s;break;case"difference":e[a]=Math.abs(h-i),e[a+1]=Math.abs(c-n),e[a+2]=Math.abs(l-s);break;case"subtract":e[a]=h-i,e[a+1]=c-n,e[a+2]=l-s;break;case"darken":e[a]=Math.min(h,i),e[a+1]=Math.min(c,n),e[a+2]=Math.min(l,s);break;case"lighten":e[a]=Math.max(h,i),e[a+1]=Math.max(c,n),e[a+2]=Math.max(l,s);break;case"overlay":e[a]=i<128?2*h*i/255:255-2*(255-h)*(255-i)/255,e[a+1]=n<128?2*c*n/255:255-2*(255-c)*(255-n)/255,e[a+2]=s<128?2*l*s/255:255-2*(255-l)*(255-s)/255;break;case"exclusion":e[a]=i+h-2*i*h/255,e[a+1]=n+c-2*n*c/255,e[a+2]=s+l-2*s*l/255;break;case"tint":e[a]=i+h*o,e[a+1]=n+c*o,e[a+2]=s+l*o}}}getUniformLocations(t,e){return{uColor:t.getUniformLocation(e,"uColor")}}sendUniformData(t,e){var r=new ue(this.color).getSource();r[0]=this.alpha*r[0]/255,r[1]=this.alpha*r[1]/255,r[2]=this.alpha*r[2]/255,r[3]=this.alpha,t.uniform4fv(e.uColor,r)}toObject(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}z(Qo,"defaults",{color:"#F95C63",mode:"multiply",alpha:1}),z(Qo,"type","BlendColor"),xt.setClass(Qo);var ta={multiply:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.rgba *= color2.rgba;\n      gl_FragColor = color;\n    }\n    ",mask:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform sampler2D uImage;\n    uniform vec4 uColor;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      vec4 color2 = texture2D(uImage, vTexCoord2);\n      color.a = color2.a;\n      gl_FragColor = color;\n    }\n    "},ea=["type","image"];class ra extends Zo{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return ta[this.mode]}applyToWebGL(t){var e=t.context,r=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(e,r,e.TEXTURE1),super.applyToWebGL(t),this.unbindAdditionalTexture(e,e.TEXTURE1)}createTexture(t,e){return t.getCachedTexture(e.cacheKey,e.getElement())}calculateMatrix(){var t=this.image,e=t.getElement(),r=e.width,i=e.height;return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/r,-t.top/i,1]}applyTo2d(t){var e=t.imageData,r=e.data,i=e.width,n=e.height,s=t.filterBackend.resources,o=this.image;s.blendImage||(s.blendImage=Lt());var a=s.blendImage,h=a.getContext("2d");a.width!==i||a.height!==n?(a.width=i,a.height=n):h.clearRect(0,0,i,n),h.setTransform(o.scaleX,0,0,o.scaleY,o.left,o.top),h.drawImage(o.getElement(),0,0,i,n);for(var c=h.getImageData(0,0,i,n).data,l=0;l<r.length;l+=4){var u=r[l],f=r[l+1],d=r[l+2],g=r[l+3],p=c[l],v=c[l+1],m=c[l+2],_=c[l+3];switch(this.mode){case"multiply":r[l]=u*p/255,r[l+1]=f*v/255,r[l+2]=d*m/255,r[l+3]=g*_/255;break;case"mask":r[l+3]=_}}}getUniformLocations(t,e){return{uTransformMatrix:t.getUniformLocation(e,"uTransformMatrix"),uImage:t.getUniformLocation(e,"uImage")}}sendUniformData(t,e){var r=this.calculateMatrix();t.uniform1i(e.uImage,1),t.uniformMatrix3fv(e.uTransformMatrix,!1,r)}toObject(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}static fromObject(t,e){t.type;var r=t.image,i=G(t,ea);return Yo.fromObject(r,e).then((t=>new this(W(W({},i),{},{image:t}))))}}z(ra,"type","BlendImage"),z(ra,"defaults",{mode:"multiply",alpha:1,vertexSource:"\n    attribute vec2 aPosition;\n    varying vec2 vTexCoord;\n    varying vec2 vTexCoord2;\n    uniform mat3 uTransformMatrix;\n    void main() {\n      vTexCoord = aPosition;\n      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\n      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n    }\n    "}),xt.setClass(ra);class ia extends Zo{getFragmentSource(){return"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform vec2 uDelta;\n    varying vec2 vTexCoord;\n    const float nSamples = 15.0;\n    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\n    float random(vec3 scale) {\n      /* use the fragment position for a different seed per-pixel */\n      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n    }\n    void main() {\n      vec4 color = vec4(0.0);\n      float total = 0.0;\n      float offset = random(v3offset);\n      for (float t = -nSamples; t <= nSamples; t++) {\n        float percent = (t + offset - 0.5) / nSamples;\n        float weight = 1.0 - abs(percent);\n        color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\n        total += weight;\n      }\n      gl_FragColor = color / total;\n    }\n  "}applyTo(t){No(t)?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){t.imageData=this.simpleBlur(t)}simpleBlur(t){var e=t.ctx,r=t.imageData,i=t.filterBackend.resources,n=r.width,s=r.height;i.blurLayer1||(i.blurLayer1=Lt(),i.blurLayer2=Lt());var o=i.blurLayer1,a=i.blurLayer2;o.width===n&&o.height===s||(a.width=o.width=n,a.height=o.height=s);var h,c,l,u,f=o.getContext("2d"),d=a.getContext("2d"),g=15,p=.06*this.blur*.5;for(f.putImageData(r,0,0),d.clearRect(0,0,n,s),u=-15;u<=g;u++)l=p*(c=u/g)*n+(h=(Math.random()-.5)/4),d.globalAlpha=1-Math.abs(c),d.drawImage(o,l,h),f.drawImage(a,0,0),d.globalAlpha=1,d.clearRect(0,0,a.width,a.height);for(u=-15;u<=g;u++)l=p*(c=u/g)*s+(h=(Math.random()-.5)/4),d.globalAlpha=1-Math.abs(c),d.drawImage(o,h,l),f.drawImage(a,0,0),d.globalAlpha=1,d.clearRect(0,0,a.width,a.height);e.drawImage(o,0,0);var v=e.getImageData(0,0,o.width,o.height);return f.globalAlpha=1,f.clearRect(0,0,o.width,o.height),v}getUniformLocations(t,e){return{delta:t.getUniformLocation(e,"uDelta")}}sendUniformData(t,e){var r=this.chooseRightDelta();t.uniform2fv(e.delta,r)}chooseRightDelta(){var t=1,e=[0,0];this.horizontal?this.aspectRatio>1&&(t=1/this.aspectRatio):this.aspectRatio<1&&(t=this.aspectRatio);var r=t*this.blur*.12;return this.horizontal?e[0]=r:e[1]=r,e}}z(ia,"type","Blur"),z(ia,"defaults",{blur:0,mainParameter:"blur"}),xt.setClass(ia);class na extends Zo{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBrightness;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += uBrightness;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){var e=t.imageData.data;if(0!==this.brightness)for(var r=Math.round(255*this.brightness),i=0;i<e.length;i+=4)e[i]=e[i]+r,e[i+1]=e[i+1]+r,e[i+2]=e[i+2]+r}getUniformLocations(t,e){return{uBrightness:t.getUniformLocation(e,"uBrightness")}}sendUniformData(t,e){t.uniform1f(e.uBrightness,this.brightness)}}z(na,"type","Brightness"),z(na,"defaults",{brightness:0,mainParameter:"brightness"}),xt.setClass(na);var sa=["matrix"],oa={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0};class aa extends Zo{setOptions(t){var e=t.matrix,r=G(t,sa);e&&(this.matrix=[...e]),Object.assign(this,r)}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  varying vec2 vTexCoord;\n  uniform mat4 uColorMatrix;\n  uniform vec4 uConstants;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color *= uColorMatrix;\n    color += uConstants;\n    gl_FragColor = color;\n  }"}applyTo2d(t){for(var e=t.imageData.data,r=this.matrix,i=this.colorsOnly,n=0;n<e.length;n+=4){var s=e[n],o=e[n+1],a=e[n+2];if(i)e[n]=s*r[0]+o*r[1]+a*r[2]+255*r[4],e[n+1]=s*r[5]+o*r[6]+a*r[7]+255*r[9],e[n+2]=s*r[10]+o*r[11]+a*r[12]+255*r[14];else{var h=e[n+3];e[n]=s*r[0]+o*r[1]+a*r[2]+h*r[3]+255*r[4],e[n+1]=s*r[5]+o*r[6]+a*r[7]+h*r[8]+255*r[9],e[n+2]=s*r[10]+o*r[11]+a*r[12]+h*r[13]+255*r[14],e[n+3]=s*r[15]+o*r[16]+a*r[17]+h*r[18]+255*r[19]}}}getUniformLocations(t,e){return{uColorMatrix:t.getUniformLocation(e,"uColorMatrix"),uConstants:t.getUniformLocation(e,"uConstants")}}sendUniformData(t,e){var r=this.matrix,i=[r[0],r[1],r[2],r[3],r[5],r[6],r[7],r[8],r[10],r[11],r[12],r[13],r[15],r[16],r[17],r[18]],n=[r[4],r[9],r[14],r[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,i),t.uniform4fv(e.uConstants,n)}}function ha(t,e){var r,i=(z(r=class extends aa{get type(){return t}},"type",t),z(r,"defaults",W(W({},oa),{},{mainParameter:void 0,matrix:e})),r);return xt.setClass(i,t),i}z(aa,"type","ColorMatrix"),z(aa,"defaults",oa),xt.setClass(aa),ha("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]),ha("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]),ha("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]),ha("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]),ha("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]),ha("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]),ha("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);var ca=["subFilters"];class la extends Zo{constructor(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.subFilters,r=void 0===e?[]:e;super(G(t,ca)),this.subFilters=r}applyTo(t){No(t)&&(t.passes+=this.subFilters.length-1),this.subFilters.forEach((e=>{e.applyTo(t)}))}toObject(){return W(W({},super.toObject()),{},{subFilters:this.subFilters.map((t=>t.toObject()))})}isNeutralState(){return!this.subFilters.some((t=>!t.isNeutralState()))}static fromObject(t,e){return Promise.all((t.subFilters||[]).map((t=>xt.getClass(t.type).fromObject(t,e)))).then((t=>new this({subFilters:t})))}}z(la,"type","Composed"),xt.setClass(la);class ua extends Zo{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uContrast;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\n    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\n    gl_FragColor = color;\n  }"}applyTo2d(t){var e=t.imageData.data;if(0!==this.contrast)for(var r=Math.floor(255*this.contrast),i=259*(r+255)/(255*(259-r)),n=0;n<e.length;n+=4)e[n]=i*(e[n]-128)+128,e[n+1]=i*(e[n+1]-128)+128,e[n+2]=i*(e[n+2]-128)+128}getUniformLocations(t,e){return{uContrast:t.getUniformLocation(e,"uContrast")}}sendUniformData(t,e){t.uniform1f(e.uContrast,this.contrast)}}z(ua,"type","Contrast"),z(ua,"defaults",{contrast:0,mainParameter:"contrast"}),xt.setClass(ua);var fa={Convolute_3_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_3_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[9];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 3.0; h+=1.0) {\n        for (float w = 0.0; w < 3.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_5_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_5_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[25];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 5.0; h+=1.0) {\n        for (float w = 0.0; w < 5.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_7_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_7_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[49];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 7.0; h+=1.0) {\n        for (float w = 0.0; w < 7.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    ",Convolute_9_1:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 0);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      gl_FragColor = color;\n    }\n    ",Convolute_9_0:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform float uMatrix[81];\n    uniform float uStepW;\n    uniform float uStepH;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = vec4(0, 0, 0, 1);\n      for (float h = 0.0; h < 9.0; h+=1.0) {\n        for (float w = 0.0; w < 9.0; w+=1.0) {\n          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\n          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n        }\n      }\n      float alpha = texture2D(uTexture, vTexCoord).a;\n      gl_FragColor = color;\n      gl_FragColor.a = alpha;\n    }\n    "};class da extends Zo{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return fa[this.getCacheKey()]}applyTo2d(t){var e,r,i,n,s,o,a,h,c,l,u,f,d,g=t.imageData,p=g.data,v=this.matrix,m=Math.round(Math.sqrt(v.length)),_=Math.floor(m/2),y=g.width,x=g.height,b=t.ctx.createImageData(y,x),w=b.data,C=this.opaque?1:0;for(u=0;u<x;u++)for(l=0;l<y;l++){for(s=4*(u*y+l),e=0,r=0,i=0,n=0,d=0;d<m;d++)for(f=0;f<m;f++)o=l+f-_,(a=u+d-_)<0||a>=x||o<0||o>=y||(h=4*(a*y+o),c=v[d*m+f],e+=p[h]*c,r+=p[h+1]*c,i+=p[h+2]*c,C||(n+=p[h+3]*c));w[s]=e,w[s+1]=r,w[s+2]=i,w[s+3]=C?p[s+3]:n}t.imageData=b}getUniformLocations(t,e){return{uMatrix:t.getUniformLocation(e,"uMatrix"),uOpaque:t.getUniformLocation(e,"uOpaque"),uHalfSize:t.getUniformLocation(e,"uHalfSize"),uSize:t.getUniformLocation(e,"uSize")}}sendUniformData(t,e){t.uniform1fv(e.uMatrix,this.matrix)}toObject(){return W(W({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}z(da,"type","Convolute"),z(da,"defaults",{opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]}),xt.setClass(da);var ga=["gamma"];class pa extends Zo{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform vec3 uGamma;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    vec3 correction = (1.0 / uGamma);\n    color.r = pow(color.r, correction.r);\n    color.g = pow(color.g, correction.g);\n    color.b = pow(color.b, correction.b);\n    gl_FragColor = color;\n    gl_FragColor.rgb *= color.a;\n  }\n"}constructor(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.gamma,r=void 0===e?[1,1,1]:e;super(G(t,ga)),this.gamma=r}applyTo2d(t){var e=t.imageData.data,r=this.gamma,i=1/r[0],n=1/r[1],s=1/r[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});for(var o=this.rgbValues,a=0;a<256;a++)o.r[a]=255*Math.pow(a/255,i),o.g[a]=255*Math.pow(a/255,n),o.b[a]=255*Math.pow(a/255,s);for(var h=0;h<e.length;h+=4)e[h]=o.r[e[h]],e[h+1]=o.g[e[h+1]],e[h+2]=o.b[e[h+2]]}getUniformLocations(t,e){return{uGamma:t.getUniformLocation(e,"uGamma")}}sendUniformData(t,e){t.uniform3fv(e.uGamma,this.gamma)}}z(pa,"type","Gamma"),z(pa,"defaults",{mainParameter:"gamma",gamma:[1,1,1]}),xt.setClass(pa);var va={average:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 color = texture2D(uTexture, vTexCoord);\n      float average = (color.r + color.b + color.g) / 3.0;\n      gl_FragColor = vec4(average, average, average, color.a);\n    }\n    ",lightness:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    ",luminosity:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform int uMode;\n    varying vec2 vTexCoord;\n    void main() {\n      vec4 col = texture2D(uTexture, vTexCoord);\n      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\n      gl_FragColor = vec4(average, average, average, col.a);\n    }\n    "};class ma extends Zo{applyTo2d(t){for(var e,r=t.imageData.data,i=0;i<r.length;i+=4){switch(this.mode){case"average":e=(r[i]+r[i+1]+r[i+2])/3;break;case"lightness":e=(Math.min(r[i],r[i+1],r[i+2])+Math.max(r[i],r[i+1],r[i+2]))/2;break;case"luminosity":e=.21*r[i]+.72*r[i+1]+.07*r[i+2]}r[i]=e,r[i+1]=e,r[i+2]=e}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return va[this.mode]}getUniformLocations(t,e){return{uMode:t.getUniformLocation(e,"uMode")}}sendUniformData(t,e){t.uniform1i(e.uMode,1)}isNeutralState(){return!1}}z(ma,"type","Grayscale"),z(ma,"defaults",{mode:"average",mainParameter:"mode"}),xt.setClass(ma);class _a extends aa{calculateMatrix(){var t=this.rotation*Math.PI,e=Tt(t),r=Ot(t),i=1/3,n=Math.sqrt(i)*r,s=1-e;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=e+s/3,this.matrix[1]=i*s-n,this.matrix[2]=i*s+n,this.matrix[5]=i*s+n,this.matrix[6]=e+i*s,this.matrix[7]=i*s-n,this.matrix[10]=i*s-n,this.matrix[11]=i*s+n,this.matrix[12]=e+i*s}isNeutralState(){return this.calculateMatrix(),super.isNeutralState()}applyTo(t){this.calculateMatrix(),super.applyTo(t)}}z(_a,"type","HueRotation"),z(_a,"defaults",{rotation:0,mainParameter:"rotation"}),xt.setClass(_a);class ya extends Zo{applyTo2d(t){for(var e=t.imageData.data,r=0;r<e.length;r+=4)e[r]=255-e[r],e[r+1]=255-e[r+1],e[r+2]=255-e[r+2],this.alpha&&(e[r+3]=255-e[r+3])}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform int uInvert;\n  uniform int uAlpha;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    if (uInvert == 1) {\n      if (uAlpha == 1) {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);\n      } else {\n        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n      }\n    } else {\n      gl_FragColor = color;\n    }\n  }\n"}isNeutralState(){return!this.invert}getUniformLocations(t,e){return{uInvert:t.getUniformLocation(e,"uInvert"),uAlpha:t.getUniformLocation(e,"uAlpha")}}sendUniformData(t,e){t.uniform1i(e.uInvert,Number(this.invert)),t.uniform1i(e.uAlpha,Number(this.alpha))}}z(ya,"type","Invert"),z(ya,"defaults",{alpha:!1,invert:!0,mainParameter:"invert"}),xt.setClass(ya);class xa extends Zo{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uStepH;\n  uniform float uNoise;\n  uniform float uSeed;\n  varying vec2 vTexCoord;\n  float rand(vec2 co, float seed, float vScale) {\n    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n  }\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){var e=t.imageData.data;if(0!==this.noise)for(var r=this.noise,i=0;i<e.length;i+=4){var n=(.5-Math.random())*r;e[i]+=n,e[i+1]+=n,e[i+2]+=n}}getUniformLocations(t,e){return{uNoise:t.getUniformLocation(e,"uNoise"),uSeed:t.getUniformLocation(e,"uSeed")}}sendUniformData(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random())}toObject(){return W(W({},super.toObject()),{},{noise:this.noise})}}z(xa,"type","Noise"),z(xa,"defaults",{mainParameter:"noise",noise:0}),xt.setClass(xa);class ba extends Zo{applyTo2d(t){for(var e=t.imageData,r=e.data,i=e.width,n=e.height,s=0;s<n;s+=this.blocksize)for(var o=0;o<i;o+=this.blocksize)for(var a=4*s*i+4*o,h=r[a],c=r[a+1],l=r[a+2],u=r[a+3],f=s;f<Math.min(s+this.blocksize,n);f++)for(var d=o;d<Math.min(o+this.blocksize,i);d++){var g=4*f*i+4*d;r[g]=h,r[g+1]=c,r[g+2]=l,r[g+3]=u}}isNeutralState(){return 1===this.blocksize}getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uBlocksize;\n  uniform float uStepW;\n  uniform float uStepH;\n  varying vec2 vTexCoord;\n  void main() {\n    float blockW = uBlocksize * uStepW;\n    float blockH = uBlocksize * uStepW;\n    int posX = int(vTexCoord.x / blockW);\n    int posY = int(vTexCoord.y / blockH);\n    float fposX = float(posX);\n    float fposY = float(posY);\n    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\n    vec4 color = texture2D(uTexture, squareCoords);\n    gl_FragColor = color;\n  }\n"}getUniformLocations(t,e){return{uBlocksize:t.getUniformLocation(e,"uBlocksize"),uStepW:t.getUniformLocation(e,"uStepW"),uStepH:t.getUniformLocation(e,"uStepH")}}sendUniformData(t,e){t.uniform1f(e.uBlocksize,this.blocksize)}}z(ba,"type","Pixelate"),z(ba,"defaults",{blocksize:4,mainParameter:"blocksize"}),xt.setClass(ba);class wa extends Zo{getFragmentShader(){return"\nprecision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_FragColor = texture2D(uTexture, vTexCoord);\n  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\n    gl_FragColor.a = 0.0;\n  }\n}\n"}applyTo2d(t){for(var e=t.imageData.data,r=255*this.distance,i=new ue(this.color).getSource(),n=[i[0]-r,i[1]-r,i[2]-r],s=[i[0]+r,i[1]+r,i[2]+r],o=0;o<e.length;o+=4){var a=e[o],h=e[o+1],c=e[o+2];a>n[0]&&h>n[1]&&c>n[2]&&a<s[0]&&h<s[1]&&c<s[2]&&(e[o+3]=0)}}getUniformLocations(t,e){return{uLow:t.getUniformLocation(e,"uLow"),uHigh:t.getUniformLocation(e,"uHigh")}}sendUniformData(t,e){var r=new ue(this.color).getSource(),i=this.distance,n=[0+r[0]/255-i,0+r[1]/255-i,0+r[2]/255-i,1],s=[r[0]/255+i,r[1]/255+i,r[2]/255+i,1];t.uniform4fv(e.uLow,n),t.uniform4fv(e.uHigh,s)}toObject(){return W(W({},super.toObject()),{},{color:this.color,distance:this.distance})}}z(wa,"type","RemoveColor"),z(wa,"defaults",{color:"#FFFFFF",distance:.02,useAlpha:!1}),xt.setClass(wa);class Ca extends Zo{getUniformLocations(t,e){return{uDelta:t.getUniformLocation(e,"uDelta"),uTaps:t.getUniformLocation(e,"uTaps")}}sendUniformData(t,e){t.uniform2fv(e.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),t.uniform1fv(e.uTaps,this.taps)}getFilterWindow(){var t=this.tempScale;return Math.ceil(this.lanczosLobes/t)}getCacheKey(){var t=this.getFilterWindow();return"".concat(this.type,"_").concat(t)}getFragmentSource(){var t=this.getFilterWindow();return this.generateShader(t)}getTaps(){for(var t=this.lanczosCreate(this.lanczosLobes),e=this.tempScale,r=this.getFilterWindow(),i=new Array(r),n=1;n<=r;n++)i[n-1]=t(n*e);return i}generateShader(t){for(var e=new Array(t),r=1;r<=t;r++)e[r-1]="".concat(r,".0 * uDelta");return"\n      ".concat(this.fragmentSourceTOP,"\n      uniform float uTaps[").concat(t,"];\n      void main() {\n        vec4 color = texture2D(uTexture, vTexCoord);\n        float sum = 1.0;\n        ").concat(e.map(((t,e)=>"\n              color += texture2D(uTexture, vTexCoord + ".concat(t,") * uTaps[").concat(e,"] + texture2D(uTexture, vTexCoord - ").concat(t,") * uTaps[").concat(e,"];\n              sum += 2.0 * uTaps[").concat(e,"];\n            "))).join("\n"),"\n        gl_FragColor = color / sum;\n      }\n    ")}applyTo(t){No(t)?(t.passes++,this.width=t.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=t.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),t.destinationWidth=this.dW,this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t),t.sourceWidth=t.destinationWidth,this.height=t.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),t.destinationHeight=this.dH,this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t),t.sourceHeight=t.destinationHeight):this.applyTo2d(t)}isNeutralState(){return 1===this.scaleX&&1===this.scaleY}lanczosCreate(t){return e=>{if(e>=t||e<=-t)return 0;if(e<1.1920929e-7&&e>-1.1920929e-7)return 1;var r=(e*=Math.PI)/t;return Math.sin(e)/e*Math.sin(r)/r}}applyTo2d(t){var e=t.imageData,r=this.scaleX,i=this.scaleY;this.rcpScaleX=1/r,this.rcpScaleY=1/i;var n,s=e.width,o=e.height,a=Math.round(s*r),h=Math.round(o*i);"sliceHack"===this.resizeType?n=this.sliceByTwo(t,s,o,a,h):"hermite"===this.resizeType?n=this.hermiteFastResize(t,s,o,a,h):"bilinear"===this.resizeType?n=this.bilinearFiltering(t,s,o,a,h):"lanczos"===this.resizeType&&(n=this.lanczosResize(t,s,o,a,h)),t.imageData=n}sliceByTwo(t,e,r,i,n){var s=t.imageData,o=.5,a=!1,h=!1,c=e*o,l=r*o,u=t.filterBackend.resources,f=0,d=0,g=e,p=0;u.sliceByTwo||(u.sliceByTwo=Lt());var v=u.sliceByTwo;(v.width<1.5*e||v.height<r)&&(v.width=1.5*e,v.height=r);var m=v.getContext("2d");for(m.clearRect(0,0,1.5*e,r),m.putImageData(s,0,0),i=Math.floor(i),n=Math.floor(n);!a||!h;)e=c,r=l,i<Math.floor(c*o)?c=Math.floor(c*o):(c=i,a=!0),n<Math.floor(l*o)?l=Math.floor(l*o):(l=n,h=!0),m.drawImage(v,f,d,e,r,g,p,c,l),f=g,d=p,p+=l;return m.getImageData(f,d,i,n)}lanczosResize(t,e,r,i,n){var s=t.imageData.data,o=t.ctx.createImageData(i,n),a=o.data,h=this.lanczosCreate(this.lanczosLobes),c=this.rcpScaleX,l=this.rcpScaleY,u=2/this.rcpScaleX,f=2/this.rcpScaleY,d=Math.ceil(c*this.lanczosLobes/2),g=Math.ceil(l*this.lanczosLobes/2),p={},v={},m={};return function t(_){var y,x,b,w,C,S,T,O,k,D,M;for(v.x=(_+.5)*c,m.x=Math.floor(v.x),y=0;y<n;y++){for(v.y=(y+.5)*l,m.y=Math.floor(v.y),C=0,S=0,T=0,O=0,k=0,x=m.x-d;x<=m.x+d;x++)if(!(x<0||x>=e)){D=Math.floor(1e3*Math.abs(x-v.x)),p[D]||(p[D]={});for(var E=m.y-g;E<=m.y+g;E++)E<0||E>=r||(M=Math.floor(1e3*Math.abs(E-v.y)),p[D][M]||(p[D][M]=h(Math.sqrt(Math.pow(D*u,2)+Math.pow(M*f,2))/1e3)),(b=p[D][M])>0&&(C+=b,S+=b*s[w=4*(E*e+x)],T+=b*s[w+1],O+=b*s[w+2],k+=b*s[w+3]))}a[w=4*(y*i+_)]=S/C,a[w+1]=T/C,a[w+2]=O/C,a[w+3]=k/C}return++_<i?t(_):o}(0)}bilinearFiltering(t,e,r,i,n){var s,o,a,h,c,l,u,f,d,g=0,p=this.rcpScaleX,v=this.rcpScaleY,m=4*(e-1),_=t.imageData.data,y=t.ctx.createImageData(i,n),x=y.data;for(a=0;a<n;a++)for(h=0;h<i;h++)for(c=p*h-(s=Math.floor(p*h)),l=v*a-(o=Math.floor(v*a)),d=4*(o*e+s),u=0;u<4;u++)f=_[d+u]*(1-c)*(1-l)+_[d+4+u]*c*(1-l)+_[d+m+u]*l*(1-c)+_[d+m+4+u]*c*l,x[g++]=f;return y}hermiteFastResize(t,e,r,i,n){for(var s=this.rcpScaleX,o=this.rcpScaleY,a=Math.ceil(s/2),h=Math.ceil(o/2),c=t.imageData.data,l=t.ctx.createImageData(i,n),u=l.data,f=0;f<n;f++)for(var d=0;d<i;d++){for(var g=4*(d+f*i),p=0,v=0,m=0,_=0,y=0,x=0,b=0,w=(f+.5)*o,C=Math.floor(f*o);C<(f+1)*o;C++)for(var S=Math.abs(w-(C+.5))/h,T=(d+.5)*s,O=S*S,k=Math.floor(d*s);k<(d+1)*s;k++){var D=Math.abs(T-(k+.5))/a,M=Math.sqrt(O+D*D);M>1&&M<-1||(p=2*M*M*M-3*M*M+1)>0&&(b+=p*c[(D=4*(k+C*e))+3],m+=p,c[D+3]<255&&(p=p*c[D+3]/250),_+=p*c[D],y+=p*c[D+1],x+=p*c[D+2],v+=p)}u[g]=_/v,u[g+1]=y/v,u[g+2]=x/v,u[g+3]=b/m}return l}toObject(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}z(Ca,"type","Resize"),z(Ca,"defaults",{resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,fragmentSourceTOP:"\n    precision highp float;\n    uniform sampler2D uTexture;\n    uniform vec2 uDelta;\n    varying vec2 vTexCoord;\n  "}),xt.setClass(Ca);class Sa extends Zo{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uSaturation;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float rgMax = max(color.r, color.g);\n    float rgbMax = max(rgMax, color.b);\n    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\n    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\n    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){var e=t.imageData.data;if(0!==this.saturation)for(var r=-this.saturation,i=0;i<e.length;i+=4){var n=Math.max(e[i],e[i+1],e[i+2]);e[i]+=n!==e[i]?(n-e[i])*r:0,e[i+1]+=n!==e[i+1]?(n-e[i+1])*r:0,e[i+2]+=n!==e[i+2]?(n-e[i+2])*r:0}}getUniformLocations(t,e){return{uSaturation:t.getUniformLocation(e,"uSaturation")}}sendUniformData(t,e){t.uniform1f(e.uSaturation,-this.saturation)}}z(Sa,"type","Saturation"),z(Sa,"defaults",{saturation:0,mainParameter:"saturation"}),xt.setClass(Sa);class Ta extends Zo{getFragmentSource(){return"\n  precision highp float;\n  uniform sampler2D uTexture;\n  uniform float uVibrance;\n  varying vec2 vTexCoord;\n  void main() {\n    vec4 color = texture2D(uTexture, vTexCoord);\n    float max = max(color.r, max(color.g, color.b));\n    float avg = (color.r + color.g + color.b) / 3.0;\n    float amt = (abs(max - avg) * 2.0) * uVibrance;\n    color.r += max != color.r ? (max - color.r) * amt : 0.00;\n    color.g += max != color.g ? (max - color.g) * amt : 0.00;\n    color.b += max != color.b ? (max - color.b) * amt : 0.00;\n    gl_FragColor = color;\n  }\n"}applyTo2d(t){var e=t.imageData.data;if(0!==this.vibrance)for(var r=-this.vibrance,i=0;i<e.length;i+=4){var n=Math.max(e[i],e[i+1],e[i+2]),s=(e[i]+e[i+1]+e[i+2])/3,o=2*Math.abs(n-s)/255*r;e[i]+=n!==e[i]?(n-e[i])*o:0,e[i+1]+=n!==e[i+1]?(n-e[i+1])*o:0,e[i+2]+=n!==e[i+2]?(n-e[i+2])*o:0}}getUniformLocations(t,e){return{uVibrance:t.getUniformLocation(e,"uVibrance")}}sendUniformData(t,e){t.uniform1f(e.uVibrance,-this.vibrance)}}z(Ta,"type","Vibrance"),z(Ta,"defaults",{vibrance:0,mainParameter:"vibrance"}),xt.setClass(Ta);var Oa={exports:{}};
/**
             * @license
             * Lodash <https://lodash.com/>
             * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
             * Released under MIT license <https://lodash.com/license>
             * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
             * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
             */!function(t,e){(function(){var r,i="Expected a function",n="__lodash_hash_undefined__",s="__lodash_placeholder__",o=16,h=32,c=64,l=128,u=256,f=1/0,d=9007199254740991,g=NaN,p=4294967295,v=[["ary",l],["bind",1],["bindKey",2],["curry",8],["curryRight",o],["flip",512],["partial",h],["partialRight",c],["rearg",u]],m="[object Arguments]",_="[object Array]",y="[object Boolean]",x="[object Date]",b="[object Error]",w="[object Function]",C="[object GeneratorFunction]",S="[object Map]",T="[object Number]",O="[object Object]",k="[object Promise]",D="[object RegExp]",M="[object Set]",E="[object String]",A="[object Symbol]",P="[object WeakMap]",j="[object ArrayBuffer]",F="[object DataView]",L="[object Float32Array]",R="[object Float64Array]",I="[object Int8Array]",B="[object Int16Array]",X="[object Int32Array]",Y="[object Uint8Array]",W="[object Uint8ClampedArray]",z="[object Uint16Array]",V="[object Uint32Array]",G=/\b__p \+= '';/g,U=/\b(__p \+=) '' \+/g,H=/(__e\(.*?\)|\b__t\)) \+\n'';/g,N=/&(?:amp|lt|gt|quot|#39);/g,q=/[&<>"']/g,K=RegExp(N.source),$=RegExp(q.source),Z=/<%-([\s\S]+?)%>/g,J=/<%([\s\S]+?)%>/g,Q=/<%=([\s\S]+?)%>/g,tt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,et=/^\w*$/,rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,it=/[\\^$.*+?()[\]{}|]/g,nt=RegExp(it.source),st=/^\s+/,ot=/\s/,at=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ht=/\{\n\/\* \[wrapped with (.+)\] \*/,ct=/,? & /,lt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ut=/[()=,{}\[\]\/\s]/,ft=/\\(\\)?/g,dt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,gt=/\w*$/,pt=/^[-+]0x[0-9a-f]+$/i,vt=/^0b[01]+$/i,mt=/^\[object .+?Constructor\]$/,_t=/^0o[0-7]+$/i,yt=/^(?:0|[1-9]\d*)$/,xt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,bt=/($^)/,wt=/['\n\r\u2028\u2029\\]/g,Ct="\\ud800-\\udfff",St="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Tt="\\u2700-\\u27bf",Ot="a-z\\xdf-\\xf6\\xf8-\\xff",kt="A-Z\\xc0-\\xd6\\xd8-\\xde",Dt="\\ufe0e\\ufe0f",Mt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Et="[']",At="["+Ct+"]",Pt="["+Mt+"]",jt="["+St+"]",Ft="\\d+",Lt="["+Tt+"]",Rt="["+Ot+"]",It="[^"+Ct+Mt+Ft+Tt+Ot+kt+"]",Bt="\\ud83c[\\udffb-\\udfff]",Xt="[^"+Ct+"]",Yt="(?:\\ud83c[\\udde6-\\uddff]){2}",Wt="[\\ud800-\\udbff][\\udc00-\\udfff]",zt="["+kt+"]",Vt="\\u200d",Gt="(?:"+Rt+"|"+It+")",Ut="(?:"+zt+"|"+It+")",Ht="(?:['](?:d|ll|m|re|s|t|ve))?",Nt="(?:['](?:D|LL|M|RE|S|T|VE))?",qt="(?:"+jt+"|"+Bt+")"+"?",Kt="["+Dt+"]?",$t=Kt+qt+("(?:"+Vt+"(?:"+[Xt,Yt,Wt].join("|")+")"+Kt+qt+")*"),Zt="(?:"+[Lt,Yt,Wt].join("|")+")"+$t,Jt="(?:"+[Xt+jt+"?",jt,Yt,Wt,At].join("|")+")",Qt=RegExp(Et,"g"),te=RegExp(jt,"g"),ee=RegExp(Bt+"(?="+Bt+")|"+Jt+$t,"g"),re=RegExp([zt+"?"+Rt+"+"+Ht+"(?="+[Pt,zt,"$"].join("|")+")",Ut+"+"+Nt+"(?="+[Pt,zt+Gt,"$"].join("|")+")",zt+"?"+Gt+"+"+Ht,zt+"+"+Nt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ft,Zt].join("|"),"g"),ie=RegExp("["+Vt+Ct+St+Dt+"]"),ne=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,se=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],oe=-1,ae={};ae[L]=ae[R]=ae[I]=ae[B]=ae[X]=ae[Y]=ae[W]=ae[z]=ae[V]=!0,ae[m]=ae[_]=ae[j]=ae[y]=ae[F]=ae[x]=ae[b]=ae[w]=ae[S]=ae[T]=ae[O]=ae[D]=ae[M]=ae[E]=ae[P]=!1;var he={};he[m]=he[_]=he[j]=he[F]=he[y]=he[x]=he[L]=he[R]=he[I]=he[B]=he[X]=he[S]=he[T]=he[O]=he[D]=he[M]=he[E]=he[A]=he[Y]=he[W]=he[z]=he[V]=!0,he[b]=he[w]=he[P]=!1;var ce={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},le=parseFloat,ue=parseInt,fe="object"==typeof a&&a&&a.Object===Object&&a,de="object"==typeof self&&self&&self.Object===Object&&self,ge=fe||de||Function("return this")(),pe=e&&!e.nodeType&&e,ve=pe&&t&&!t.nodeType&&t,me=ve&&ve.exports===pe,_e=me&&fe.process,ye=function(){try{var t=ve&&ve.require&&ve.require("util").types;return t||_e&&_e.binding&&_e.binding("util")}catch(e){}}(),xe=ye&&ye.isArrayBuffer,be=ye&&ye.isDate,we=ye&&ye.isMap,Ce=ye&&ye.isRegExp,Se=ye&&ye.isSet,Te=ye&&ye.isTypedArray;function Oe(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function ke(t,e,r,i){for(var n=-1,s=null==t?0:t.length;++n<s;){var o=t[n];e(i,o,r(o),t)}return i}function De(t,e){for(var r=-1,i=null==t?0:t.length;++r<i&&!1!==e(t[r],r,t););return t}function Me(t,e){for(var r=null==t?0:t.length;r--&&!1!==e(t[r],r,t););return t}function Ee(t,e){for(var r=-1,i=null==t?0:t.length;++r<i;)if(!e(t[r],r,t))return!1;return!0}function Ae(t,e){for(var r=-1,i=null==t?0:t.length,n=0,s=[];++r<i;){var o=t[r];e(o,r,t)&&(s[n++]=o)}return s}function Pe(t,e){return!!(null==t?0:t.length)&&ze(t,e,0)>-1}function je(t,e,r){for(var i=-1,n=null==t?0:t.length;++i<n;)if(r(e,t[i]))return!0;return!1}function Fe(t,e){for(var r=-1,i=null==t?0:t.length,n=Array(i);++r<i;)n[r]=e(t[r],r,t);return n}function Le(t,e){for(var r=-1,i=e.length,n=t.length;++r<i;)t[n+r]=e[r];return t}function Re(t,e,r,i){var n=-1,s=null==t?0:t.length;for(i&&s&&(r=t[++n]);++n<s;)r=e(r,t[n],n,t);return r}function Ie(t,e,r,i){var n=null==t?0:t.length;for(i&&n&&(r=t[--n]);n--;)r=e(r,t[n],n,t);return r}function Be(t,e){for(var r=-1,i=null==t?0:t.length;++r<i;)if(e(t[r],r,t))return!0;return!1}var Xe=He("length");function Ye(t,e,r){var i;return r(t,(function(t,r,n){if(e(t,r,n))return i=r,!1})),i}function We(t,e,r,i){for(var n=t.length,s=r+(i?1:-1);i?s--:++s<n;)if(e(t[s],s,t))return s;return-1}function ze(t,e,r){return e==e?function(t,e,r){var i=r-1,n=t.length;for(;++i<n;)if(t[i]===e)return i;return-1}(t,e,r):We(t,Ge,r)}function Ve(t,e,r,i){for(var n=r-1,s=t.length;++n<s;)if(i(t[n],e))return n;return-1}function Ge(t){return t!=t}function Ue(t,e){var r=null==t?0:t.length;return r?Ke(t,e)/r:g}function He(t){return function(e){return null==e?r:e[t]}}function Ne(t){return function(e){return null==t?r:t[e]}}function qe(t,e,r,i,n){return n(t,(function(t,n,s){r=i?(i=!1,t):e(r,t,n,s)})),r}function Ke(t,e){for(var i,n=-1,s=t.length;++n<s;){var o=e(t[n]);o!==r&&(i=i===r?o:i+o)}return i}function $e(t,e){for(var r=-1,i=Array(t);++r<t;)i[r]=e(r);return i}function Ze(t){return t?t.slice(0,gr(t)+1).replace(st,""):t}function Je(t){return function(e){return t(e)}}function Qe(t,e){return Fe(e,(function(e){return t[e]}))}function tr(t,e){return t.has(e)}function er(t,e){for(var r=-1,i=t.length;++r<i&&ze(e,t[r],0)>-1;);return r}function rr(t,e){for(var r=t.length;r--&&ze(e,t[r],0)>-1;);return r}var ir=Ne({"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss","":"A","":"A","":"A","":"a","":"a","":"a","":"C","":"C","":"C","":"C","":"c","":"c","":"c","":"c","":"D","":"D","":"d","":"d","":"E","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"e","":"G","":"G","":"G","":"G","":"g","":"g","":"g","":"g","":"H","":"H","":"h","":"h","":"I","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"i","":"J","":"j","":"K","":"k","":"k","":"L","":"L","":"L","":"L","":"L","":"l","":"l","":"l","":"l","":"l","":"N","":"N","":"N","":"N","":"n","":"n","":"n","":"n","":"O","":"O","":"O","":"o","":"o","":"o","":"R","":"R","":"R","":"r","":"r","":"r","":"S","":"S","":"S","":"S","":"s","":"s","":"s","":"s","":"T","":"T","":"T","":"t","":"t","":"t","":"U","":"U","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"u","":"u","":"W","":"w","":"Y","":"y","":"Y","":"Z","":"Z","":"Z","":"z","":"z","":"z","":"IJ","":"ij","":"Oe","":"oe","":"'n","":"s"}),nr=Ne({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function sr(t){return"\\"+ce[t]}function or(t){return ie.test(t)}function ar(t){var e=-1,r=Array(t.size);return t.forEach((function(t,i){r[++e]=[i,t]})),r}function hr(t,e){return function(r){return t(e(r))}}function cr(t,e){for(var r=-1,i=t.length,n=0,o=[];++r<i;){var a=t[r];a!==e&&a!==s||(t[r]=s,o[n++]=r)}return o}function lr(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=t})),r}function ur(t){var e=-1,r=Array(t.size);return t.forEach((function(t){r[++e]=[t,t]})),r}function fr(t){return or(t)?function(t){var e=ee.lastIndex=0;for(;ee.test(t);)++e;return e}(t):Xe(t)}function dr(t){return or(t)?function(t){return t.match(ee)||[]}(t):function(t){return t.split("")}(t)}function gr(t){for(var e=t.length;e--&&ot.test(t.charAt(e)););return e}var pr=Ne({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var vr=function t(e){var a=(e=null==e?ge:vr.defaults(ge.Object(),e,vr.pick(ge,se))).Array,ot=e.Date,Ct=e.Error,St=e.Function,Tt=e.Math,Ot=e.Object,kt=e.RegExp,Dt=e.String,Mt=e.TypeError,Et=a.prototype,At=St.prototype,Pt=Ot.prototype,jt=e["__core-js_shared__"],Ft=At.toString,Lt=Pt.hasOwnProperty,Rt=0,It=function(){var t=/[^.]+$/.exec(jt&&jt.keys&&jt.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),Bt=Pt.toString,Xt=Ft.call(Ot),Yt=ge._,Wt=kt("^"+Ft.call(Lt).replace(it,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),zt=me?e.Buffer:r,Vt=e.Symbol,Gt=e.Uint8Array,Ut=zt?zt.allocUnsafe:r,Ht=hr(Ot.getPrototypeOf,Ot),Nt=Ot.create,qt=Pt.propertyIsEnumerable,Kt=Et.splice,$t=Vt?Vt.isConcatSpreadable:r,Zt=Vt?Vt.iterator:r,Jt=Vt?Vt.toStringTag:r,ee=function(){try{var t=us(Ot,"defineProperty");return t({},"",{}),t}catch(e){}}(),ie=e.clearTimeout!==ge.clearTimeout&&e.clearTimeout,ce=ot&&ot.now!==ge.Date.now&&ot.now,fe=e.setTimeout!==ge.setTimeout&&e.setTimeout,de=Tt.ceil,pe=Tt.floor,ve=Ot.getOwnPropertySymbols,_e=zt?zt.isBuffer:r,ye=e.isFinite,Xe=Et.join,Ne=hr(Ot.keys,Ot),mr=Tt.max,_r=Tt.min,yr=ot.now,xr=e.parseInt,br=Tt.random,wr=Et.reverse,Cr=us(e,"DataView"),Sr=us(e,"Map"),Tr=us(e,"Promise"),Or=us(e,"Set"),kr=us(e,"WeakMap"),Dr=us(Ot,"create"),Mr=kr&&new kr,Er={},Ar=Is(Cr),Pr=Is(Sr),jr=Is(Tr),Fr=Is(Or),Lr=Is(kr),Rr=Vt?Vt.prototype:r,Ir=Rr?Rr.valueOf:r,Br=Rr?Rr.toString:r;function Xr(t){if(ea(t)&&!Go(t)&&!(t instanceof Vr)){if(t instanceof zr)return t;if(Lt.call(t,"__wrapped__"))return Bs(t)}return new zr(t)}var Yr=function(){function t(){}return function(e){if(!ta(e))return{};if(Nt)return Nt(e);t.prototype=e;var i=new t;return t.prototype=r,i}}();function Wr(){}function zr(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=r}function Vr(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=p,this.__views__=[]}function Gr(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function Ur(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function Hr(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var i=t[e];this.set(i[0],i[1])}}function Nr(t){var e=-1,r=null==t?0:t.length;for(this.__data__=new Hr;++e<r;)this.add(t[e])}function qr(t){var e=this.__data__=new Ur(t);this.size=e.size}function Kr(t,e){var r=Go(t),i=!r&&Vo(t),n=!r&&!i&&qo(t),s=!r&&!i&&!n&&ca(t),o=r||i||n||s,a=o?$e(t.length,Dt):[],h=a.length;for(var c in t)!e&&!Lt.call(t,c)||o&&("length"==c||n&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||_s(c,h))||a.push(c);return a}function $r(t){var e=t.length;return e?t[Ni(0,e-1)]:r}function Zr(t,e){return Fs(Mn(t),oi(e,0,t.length))}function Jr(t){return Fs(Mn(t))}function Qr(t,e,i){(i!==r&&!Yo(t[e],i)||i===r&&!(e in t))&&ni(t,e,i)}function ti(t,e,i){var n=t[e];Lt.call(t,e)&&Yo(n,i)&&(i!==r||e in t)||ni(t,e,i)}function ei(t,e){for(var r=t.length;r--;)if(Yo(t[r][0],e))return r;return-1}function ri(t,e,r,i){return ui(t,(function(t,n,s){e(i,t,r(t),s)})),i}function ii(t,e){return t&&En(e,Aa(e),t)}function ni(t,e,r){"__proto__"==e&&ee?ee(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}function si(t,e){for(var i=-1,n=e.length,s=a(n),o=null==t;++i<n;)s[i]=o?r:Oa(t,e[i]);return s}function oi(t,e,i){return t==t&&(i!==r&&(t=t<=i?t:i),e!==r&&(t=t>=e?t:e)),t}function ai(t,e,i,n,s,o){var a,h=1&e,c=2&e,l=4&e;if(i&&(a=s?i(t,n,s,o):i(t)),a!==r)return a;if(!ta(t))return t;var u=Go(t);if(u){if(a=function(t){var e=t.length,r=new t.constructor(e);e&&"string"==typeof t[0]&&Lt.call(t,"index")&&(r.index=t.index,r.input=t.input);return r}(t),!h)return Mn(t,a)}else{var f=gs(t),d=f==w||f==C;if(qo(t))return Cn(t,h);if(f==O||f==m||d&&!s){if(a=c||d?{}:vs(t),!h)return c?function(t,e){return En(t,ds(t),e)}(t,function(t,e){return t&&En(e,Pa(e),t)}(a,t)):function(t,e){return En(t,fs(t),e)}(t,ii(a,t))}else{if(!he[f])return s?t:{};a=function(t,e,r){var i=t.constructor;switch(e){case j:return Sn(t);case y:case x:return new i(+t);case F:return function(t,e){var r=e?Sn(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}(t,r);case L:case R:case I:case B:case X:case Y:case W:case z:case V:return Tn(t,r);case S:return new i;case T:case E:return new i(t);case D:return function(t){var e=new t.constructor(t.source,gt.exec(t));return e.lastIndex=t.lastIndex,e}(t);case M:return new i;case A:return n=t,Ir?Ot(Ir.call(n)):{}}var n}(t,f,h)}}o||(o=new qr);var g=o.get(t);if(g)return g;o.set(t,a),oa(t)?t.forEach((function(r){a.add(ai(r,e,i,r,t,o))})):ra(t)&&t.forEach((function(r,n){a.set(n,ai(r,e,i,n,t,o))}));var p=u?r:(l?c?ns:is:c?Pa:Aa)(t);return De(p||t,(function(r,n){p&&(r=t[n=r]),ti(a,n,ai(r,e,i,n,t,o))})),a}function hi(t,e,i){var n=i.length;if(null==t)return!n;for(t=Ot(t);n--;){var s=i[n],o=e[s],a=t[s];if(a===r&&!(s in t)||!o(a))return!1}return!0}function ci(t,e,n){if("function"!=typeof t)throw new Mt(i);return Es((function(){t.apply(r,n)}),e)}function li(t,e,r,i){var n=-1,s=Pe,o=!0,a=t.length,h=[],c=e.length;if(!a)return h;r&&(e=Fe(e,Je(r))),i?(s=je,o=!1):e.length>=200&&(s=tr,o=!1,e=new Nr(e));t:for(;++n<a;){var l=t[n],u=null==r?l:r(l);if(l=i||0!==l?l:0,o&&u==u){for(var f=c;f--;)if(e[f]===u)continue t;h.push(l)}else s(e,u,i)||h.push(l)}return h}Xr.templateSettings={escape:Z,evaluate:J,interpolate:Q,variable:"",imports:{_:Xr}},Xr.prototype=Wr.prototype,Xr.prototype.constructor=Xr,zr.prototype=Yr(Wr.prototype),zr.prototype.constructor=zr,Vr.prototype=Yr(Wr.prototype),Vr.prototype.constructor=Vr,Gr.prototype.clear=function(){this.__data__=Dr?Dr(null):{},this.size=0},Gr.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Gr.prototype.get=function(t){var e=this.__data__;if(Dr){var i=e[t];return i===n?r:i}return Lt.call(e,t)?e[t]:r},Gr.prototype.has=function(t){var e=this.__data__;return Dr?e[t]!==r:Lt.call(e,t)},Gr.prototype.set=function(t,e){var i=this.__data__;return this.size+=this.has(t)?0:1,i[t]=Dr&&e===r?n:e,this},Ur.prototype.clear=function(){this.__data__=[],this.size=0},Ur.prototype.delete=function(t){var e=this.__data__,r=ei(e,t);return!(r<0)&&(r==e.length-1?e.pop():Kt.call(e,r,1),--this.size,!0)},Ur.prototype.get=function(t){var e=this.__data__,i=ei(e,t);return i<0?r:e[i][1]},Ur.prototype.has=function(t){return ei(this.__data__,t)>-1},Ur.prototype.set=function(t,e){var r=this.__data__,i=ei(r,t);return i<0?(++this.size,r.push([t,e])):r[i][1]=e,this},Hr.prototype.clear=function(){this.size=0,this.__data__={hash:new Gr,map:new(Sr||Ur),string:new Gr}},Hr.prototype.delete=function(t){var e=cs(this,t).delete(t);return this.size-=e?1:0,e},Hr.prototype.get=function(t){return cs(this,t).get(t)},Hr.prototype.has=function(t){return cs(this,t).has(t)},Hr.prototype.set=function(t,e){var r=cs(this,t),i=r.size;return r.set(t,e),this.size+=r.size==i?0:1,this},Nr.prototype.add=Nr.prototype.push=function(t){return this.__data__.set(t,n),this},Nr.prototype.has=function(t){return this.__data__.has(t)},qr.prototype.clear=function(){this.__data__=new Ur,this.size=0},qr.prototype.delete=function(t){var e=this.__data__,r=e.delete(t);return this.size=e.size,r},qr.prototype.get=function(t){return this.__data__.get(t)},qr.prototype.has=function(t){return this.__data__.has(t)},qr.prototype.set=function(t,e){var r=this.__data__;if(r instanceof Ur){var i=r.__data__;if(!Sr||i.length<199)return i.push([t,e]),this.size=++r.size,this;r=this.__data__=new Hr(i)}return r.set(t,e),this.size=r.size,this};var ui=jn(yi),fi=jn(xi,!0);function di(t,e){var r=!0;return ui(t,(function(t,i,n){return r=!!e(t,i,n)})),r}function gi(t,e,i){for(var n=-1,s=t.length;++n<s;){var o=t[n],a=e(o);if(null!=a&&(h===r?a==a&&!ha(a):i(a,h)))var h=a,c=o}return c}function pi(t,e){var r=[];return ui(t,(function(t,i,n){e(t,i,n)&&r.push(t)})),r}function vi(t,e,r,i,n){var s=-1,o=t.length;for(r||(r=ms),n||(n=[]);++s<o;){var a=t[s];e>0&&r(a)?e>1?vi(a,e-1,r,i,n):Le(n,a):i||(n[n.length]=a)}return n}var mi=Fn(),_i=Fn(!0);function yi(t,e){return t&&mi(t,e,Aa)}function xi(t,e){return t&&_i(t,e,Aa)}function bi(t,e){return Ae(e,(function(e){return Zo(t[e])}))}function wi(t,e){for(var i=0,n=(e=yn(e,t)).length;null!=t&&i<n;)t=t[Rs(e[i++])];return i&&i==n?t:r}function Ci(t,e,r){var i=e(t);return Go(t)?i:Le(i,r(t))}function Si(t){return null==t?t===r?"[object Undefined]":"[object Null]":Jt&&Jt in Ot(t)?function(t){var e=Lt.call(t,Jt),i=t[Jt];try{t[Jt]=r;var n=!0}catch(o){}var s=Bt.call(t);n&&(e?t[Jt]=i:delete t[Jt]);return s}(t):function(t){return Bt.call(t)}(t)}function Ti(t,e){return t>e}function Oi(t,e){return null!=t&&Lt.call(t,e)}function ki(t,e){return null!=t&&e in Ot(t)}function Di(t,e,i){for(var n=i?je:Pe,s=t[0].length,o=t.length,h=o,c=a(o),l=1/0,u=[];h--;){var f=t[h];h&&e&&(f=Fe(f,Je(e))),l=_r(f.length,l),c[h]=!i&&(e||s>=120&&f.length>=120)?new Nr(h&&f):r}f=t[0];var d=-1,g=c[0];t:for(;++d<s&&u.length<l;){var p=f[d],v=e?e(p):p;if(p=i||0!==p?p:0,!(g?tr(g,v):n(u,v,i))){for(h=o;--h;){var m=c[h];if(!(m?tr(m,v):n(t[h],v,i)))continue t}g&&g.push(v),u.push(p)}}return u}function Mi(t,e,i){var n=null==(t=ks(t,e=yn(e,t)))?t:t[Rs(Ks(e))];return null==n?r:Oe(n,t,i)}function Ei(t){return ea(t)&&Si(t)==m}function Ai(t,e,i,n,s){return t===e||(null==t||null==e||!ea(t)&&!ea(e)?t!=t&&e!=e:function(t,e,i,n,s,o){var a=Go(t),h=Go(e),c=a?_:gs(t),l=h?_:gs(e),u=(c=c==m?O:c)==O,f=(l=l==m?O:l)==O,d=c==l;if(d&&qo(t)){if(!qo(e))return!1;a=!0,u=!1}if(d&&!u)return o||(o=new qr),a||ca(t)?es(t,e,i,n,s,o):function(t,e,r,i,n,s,o){switch(r){case F:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case j:return!(t.byteLength!=e.byteLength||!s(new Gt(t),new Gt(e)));case y:case x:case T:return Yo(+t,+e);case b:return t.name==e.name&&t.message==e.message;case D:case E:return t==e+"";case S:var a=ar;case M:var h=1&i;if(a||(a=lr),t.size!=e.size&&!h)return!1;var c=o.get(t);if(c)return c==e;i|=2,o.set(t,e);var l=es(a(t),a(e),i,n,s,o);return o.delete(t),l;case A:if(Ir)return Ir.call(t)==Ir.call(e)}return!1}(t,e,c,i,n,s,o);if(!(1&i)){var g=u&&Lt.call(t,"__wrapped__"),p=f&&Lt.call(e,"__wrapped__");if(g||p){var v=g?t.value():t,w=p?e.value():e;return o||(o=new qr),s(v,w,i,n,o)}}if(!d)return!1;return o||(o=new qr),function(t,e,i,n,s,o){var a=1&i,h=is(t),c=h.length,l=is(e),u=l.length;if(c!=u&&!a)return!1;var f=c;for(;f--;){var d=h[f];if(!(a?d in e:Lt.call(e,d)))return!1}var g=o.get(t),p=o.get(e);if(g&&p)return g==e&&p==t;var v=!0;o.set(t,e),o.set(e,t);var m=a;for(;++f<c;){var _=t[d=h[f]],y=e[d];if(n)var x=a?n(y,_,d,e,t,o):n(_,y,d,t,e,o);if(!(x===r?_===y||s(_,y,i,n,o):x)){v=!1;break}m||(m="constructor"==d)}if(v&&!m){var b=t.constructor,w=e.constructor;b==w||!("constructor"in t)||!("constructor"in e)||"function"==typeof b&&b instanceof b&&"function"==typeof w&&w instanceof w||(v=!1)}return o.delete(t),o.delete(e),v}(t,e,i,n,s,o)}(t,e,i,n,Ai,s))}function Pi(t,e,i,n){var s=i.length,o=s,a=!n;if(null==t)return!o;for(t=Ot(t);s--;){var h=i[s];if(a&&h[2]?h[1]!==t[h[0]]:!(h[0]in t))return!1}for(;++s<o;){var c=(h=i[s])[0],l=t[c],u=h[1];if(a&&h[2]){if(l===r&&!(c in t))return!1}else{var f=new qr;if(n)var d=n(l,u,c,t,e,f);if(!(d===r?Ai(u,l,3,n,f):d))return!1}}return!0}function ji(t){return!(!ta(t)||(e=t,It&&It in e))&&(Zo(t)?Wt:mt).test(Is(t));var e}function Fi(t){return"function"==typeof t?t:null==t?ih:"object"==typeof t?Go(t)?Yi(t[0],t[1]):Xi(t):fh(t)}function Li(t){if(!Cs(t))return Ne(t);var e=[];for(var r in Ot(t))Lt.call(t,r)&&"constructor"!=r&&e.push(r);return e}function Ri(t){if(!ta(t))return function(t){var e=[];if(null!=t)for(var r in Ot(t))e.push(r);return e}(t);var e=Cs(t),r=[];for(var i in t)("constructor"!=i||!e&&Lt.call(t,i))&&r.push(i);return r}function Ii(t,e){return t<e}function Bi(t,e){var r=-1,i=Ho(t)?a(t.length):[];return ui(t,(function(t,n,s){i[++r]=e(t,n,s)})),i}function Xi(t){var e=ls(t);return 1==e.length&&e[0][2]?Ts(e[0][0],e[0][1]):function(r){return r===t||Pi(r,t,e)}}function Yi(t,e){return xs(t)&&Ss(e)?Ts(Rs(t),e):function(i){var n=Oa(i,t);return n===r&&n===e?ka(i,t):Ai(e,n,3)}}function Wi(t,e,i,n,s){t!==e&&mi(e,(function(o,a){if(s||(s=new qr),ta(o))!function(t,e,i,n,s,o,a){var h=Ds(t,i),c=Ds(e,i),l=a.get(c);if(l)return void Qr(t,i,l);var u=o?o(h,c,i+"",t,e,a):r,f=u===r;if(f){var d=Go(c),g=!d&&qo(c),p=!d&&!g&&ca(c);u=c,d||g||p?Go(h)?u=h:No(h)?u=Mn(h):g?(f=!1,u=Cn(c,!0)):p?(f=!1,u=Tn(c,!0)):u=[]:na(c)||Vo(c)?(u=h,Vo(h)?u=ma(h):ta(h)&&!Zo(h)||(u=vs(c))):f=!1}f&&(a.set(c,u),s(u,c,n,o,a),a.delete(c));Qr(t,i,u)}(t,e,a,i,Wi,n,s);else{var h=n?n(Ds(t,a),o,a+"",t,e,s):r;h===r&&(h=o),Qr(t,a,h)}}),Pa)}function zi(t,e){var i=t.length;if(i)return _s(e+=e<0?i:0,i)?t[e]:r}function Vi(t,e,r){e=e.length?Fe(e,(function(t){return Go(t)?function(e){return wi(e,1===t.length?t[0]:t)}:t})):[ih];var i=-1;e=Fe(e,Je(hs()));var n=Bi(t,(function(t,r,n){var s=Fe(e,(function(e){return e(t)}));return{criteria:s,index:++i,value:t}}));return function(t,e){var r=t.length;for(t.sort(e);r--;)t[r]=t[r].value;return t}(n,(function(t,e){return function(t,e,r){var i=-1,n=t.criteria,s=e.criteria,o=n.length,a=r.length;for(;++i<o;){var h=On(n[i],s[i]);if(h)return i>=a?h:h*("desc"==r[i]?-1:1)}return t.index-e.index}(t,e,r)}))}function Gi(t,e,r){for(var i=-1,n=e.length,s={};++i<n;){var o=e[i],a=wi(t,o);r(a,o)&&Ji(s,yn(o,t),a)}return s}function Ui(t,e,r,i){var n=i?Ve:ze,s=-1,o=e.length,a=t;for(t===e&&(e=Mn(e)),r&&(a=Fe(t,Je(r)));++s<o;)for(var h=0,c=e[s],l=r?r(c):c;(h=n(a,l,h,i))>-1;)a!==t&&Kt.call(a,h,1),Kt.call(t,h,1);return t}function Hi(t,e){for(var r=t?e.length:0,i=r-1;r--;){var n=e[r];if(r==i||n!==s){var s=n;_s(n)?Kt.call(t,n,1):un(t,n)}}return t}function Ni(t,e){return t+pe(br()*(e-t+1))}function qi(t,e){var r="";if(!t||e<1||e>d)return r;do{e%2&&(r+=t),(e=pe(e/2))&&(t+=t)}while(e);return r}function Ki(t,e){return As(Os(t,e,ih),t+"")}function $i(t){return $r(Ya(t))}function Zi(t,e){var r=Ya(t);return Fs(r,oi(e,0,r.length))}function Ji(t,e,i,n){if(!ta(t))return t;for(var s=-1,o=(e=yn(e,t)).length,a=o-1,h=t;null!=h&&++s<o;){var c=Rs(e[s]),l=i;if("__proto__"===c||"constructor"===c||"prototype"===c)return t;if(s!=a){var u=h[c];(l=n?n(u,c,h):r)===r&&(l=ta(u)?u:_s(e[s+1])?[]:{})}ti(h,c,l),h=h[c]}return t}var Qi=Mr?function(t,e){return Mr.set(t,e),t}:ih,tn=ee?function(t,e){return ee(t,"toString",{configurable:!0,enumerable:!1,value:th(e),writable:!0})}:ih;function en(t){return Fs(Ya(t))}function rn(t,e,r){var i=-1,n=t.length;e<0&&(e=-e>n?0:n+e),(r=r>n?n:r)<0&&(r+=n),n=e>r?0:r-e>>>0,e>>>=0;for(var s=a(n);++i<n;)s[i]=t[i+e];return s}function nn(t,e){var r;return ui(t,(function(t,i,n){return!(r=e(t,i,n))})),!!r}function sn(t,e,r){var i=0,n=null==t?i:t.length;if("number"==typeof e&&e==e&&n<=2147483647){for(;i<n;){var s=i+n>>>1,o=t[s];null!==o&&!ha(o)&&(r?o<=e:o<e)?i=s+1:n=s}return n}return on(t,e,ih,r)}function on(t,e,i,n){var s=0,o=null==t?0:t.length;if(0===o)return 0;for(var a=(e=i(e))!=e,h=null===e,c=ha(e),l=e===r;s<o;){var u=pe((s+o)/2),f=i(t[u]),d=f!==r,g=null===f,p=f==f,v=ha(f);if(a)var m=n||p;else m=l?p&&(n||d):h?p&&d&&(n||!g):c?p&&d&&!g&&(n||!v):!g&&!v&&(n?f<=e:f<e);m?s=u+1:o=u}return _r(o,4294967294)}function an(t,e){for(var r=-1,i=t.length,n=0,s=[];++r<i;){var o=t[r],a=e?e(o):o;if(!r||!Yo(a,h)){var h=a;s[n++]=0===o?0:o}}return s}function hn(t){return"number"==typeof t?t:ha(t)?g:+t}function cn(t){if("string"==typeof t)return t;if(Go(t))return Fe(t,cn)+"";if(ha(t))return Br?Br.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function ln(t,e,r){var i=-1,n=Pe,s=t.length,o=!0,a=[],h=a;if(r)o=!1,n=je;else if(s>=200){var c=e?null:Kn(t);if(c)return lr(c);o=!1,n=tr,h=new Nr}else h=e?[]:a;t:for(;++i<s;){var l=t[i],u=e?e(l):l;if(l=r||0!==l?l:0,o&&u==u){for(var f=h.length;f--;)if(h[f]===u)continue t;e&&h.push(u),a.push(l)}else n(h,u,r)||(h!==a&&h.push(u),a.push(l))}return a}function un(t,e){return null==(t=ks(t,e=yn(e,t)))||delete t[Rs(Ks(e))]}function fn(t,e,r,i){return Ji(t,e,r(wi(t,e)),i)}function dn(t,e,r,i){for(var n=t.length,s=i?n:-1;(i?s--:++s<n)&&e(t[s],s,t););return r?rn(t,i?0:s,i?s+1:n):rn(t,i?s+1:0,i?n:s)}function gn(t,e){var r=t;return r instanceof Vr&&(r=r.value()),Re(e,(function(t,e){return e.func.apply(e.thisArg,Le([t],e.args))}),r)}function pn(t,e,r){var i=t.length;if(i<2)return i?ln(t[0]):[];for(var n=-1,s=a(i);++n<i;)for(var o=t[n],h=-1;++h<i;)h!=n&&(s[n]=li(s[n]||o,t[h],e,r));return ln(vi(s,1),e,r)}function vn(t,e,i){for(var n=-1,s=t.length,o=e.length,a={};++n<s;){var h=n<o?e[n]:r;i(a,t[n],h)}return a}function mn(t){return No(t)?t:[]}function _n(t){return"function"==typeof t?t:ih}function yn(t,e){return Go(t)?t:xs(t,e)?[t]:Ls(_a(t))}var xn=Ki;function bn(t,e,i){var n=t.length;return i=i===r?n:i,!e&&i>=n?t:rn(t,e,i)}var wn=ie||function(t){return ge.clearTimeout(t)};function Cn(t,e){if(e)return t.slice();var r=t.length,i=Ut?Ut(r):new t.constructor(r);return t.copy(i),i}function Sn(t){var e=new t.constructor(t.byteLength);return new Gt(e).set(new Gt(t)),e}function Tn(t,e){var r=e?Sn(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}function On(t,e){if(t!==e){var i=t!==r,n=null===t,s=t==t,o=ha(t),a=e!==r,h=null===e,c=e==e,l=ha(e);if(!h&&!l&&!o&&t>e||o&&a&&c&&!h&&!l||n&&a&&c||!i&&c||!s)return 1;if(!n&&!o&&!l&&t<e||l&&i&&s&&!n&&!o||h&&i&&s||!a&&s||!c)return-1}return 0}function kn(t,e,r,i){for(var n=-1,s=t.length,o=r.length,h=-1,c=e.length,l=mr(s-o,0),u=a(c+l),f=!i;++h<c;)u[h]=e[h];for(;++n<o;)(f||n<s)&&(u[r[n]]=t[n]);for(;l--;)u[h++]=t[n++];return u}function Dn(t,e,r,i){for(var n=-1,s=t.length,o=-1,h=r.length,c=-1,l=e.length,u=mr(s-h,0),f=a(u+l),d=!i;++n<u;)f[n]=t[n];for(var g=n;++c<l;)f[g+c]=e[c];for(;++o<h;)(d||n<s)&&(f[g+r[o]]=t[n++]);return f}function Mn(t,e){var r=-1,i=t.length;for(e||(e=a(i));++r<i;)e[r]=t[r];return e}function En(t,e,i,n){var s=!i;i||(i={});for(var o=-1,a=e.length;++o<a;){var h=e[o],c=n?n(i[h],t[h],h,i,t):r;c===r&&(c=t[h]),s?ni(i,h,c):ti(i,h,c)}return i}function An(t,e){return function(r,i){var n=Go(r)?ke:ri,s=e?e():{};return n(r,t,hs(i,2),s)}}function Pn(t){return Ki((function(e,i){var n=-1,s=i.length,o=s>1?i[s-1]:r,a=s>2?i[2]:r;for(o=t.length>3&&"function"==typeof o?(s--,o):r,a&&ys(i[0],i[1],a)&&(o=s<3?r:o,s=1),e=Ot(e);++n<s;){var h=i[n];h&&t(e,h,n,o)}return e}))}function jn(t,e){return function(r,i){if(null==r)return r;if(!Ho(r))return t(r,i);for(var n=r.length,s=e?n:-1,o=Ot(r);(e?s--:++s<n)&&!1!==i(o[s],s,o););return r}}function Fn(t){return function(e,r,i){for(var n=-1,s=Ot(e),o=i(e),a=o.length;a--;){var h=o[t?a:++n];if(!1===r(s[h],h,s))break}return e}}function Ln(t){return function(e){var i=or(e=_a(e))?dr(e):r,n=i?i[0]:e.charAt(0),s=i?bn(i,1).join(""):e.slice(1);return n[t]()+s}}function Rn(t){return function(e){return Re(Za(Va(e).replace(Qt,"")),t,"")}}function In(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var r=Yr(t.prototype),i=t.apply(r,e);return ta(i)?i:r}}function Bn(t){return function(e,i,n){var s=Ot(e);if(!Ho(e)){var o=hs(i,3);e=Aa(e),i=function(t){return o(s[t],t,s)}}var a=t(e,i,n);return a>-1?s[o?e[a]:a]:r}}function Xn(t){return rs((function(e){var n=e.length,s=n,o=zr.prototype.thru;for(t&&e.reverse();s--;){var a=e[s];if("function"!=typeof a)throw new Mt(i);if(o&&!h&&"wrapper"==os(a))var h=new zr([],!0)}for(s=h?s:n;++s<n;){var c=os(a=e[s]),l="wrapper"==c?ss(a):r;h=l&&bs(l[0])&&424==l[1]&&!l[4].length&&1==l[9]?h[os(l[0])].apply(h,l[3]):1==a.length&&bs(a)?h[c]():h.thru(a)}return function(){var t=arguments,r=t[0];if(h&&1==t.length&&Go(r))return h.plant(r).value();for(var i=0,s=n?e[i].apply(this,t):r;++i<n;)s=e[i].call(this,s);return s}}))}function Yn(t,e,i,n,s,o,h,c,u,f){var d=e&l,g=1&e,p=2&e,v=24&e,m=512&e,_=p?r:In(t);return function l(){for(var y=arguments.length,x=a(y),b=y;b--;)x[b]=arguments[b];if(v)var w=as(l),C=function(t,e){for(var r=t.length,i=0;r--;)t[r]===e&&++i;return i}(x,w);if(n&&(x=kn(x,n,s,v)),o&&(x=Dn(x,o,h,v)),y-=C,v&&y<f){var S=cr(x,w);return Nn(t,e,Yn,l.placeholder,i,x,S,c,u,f-y)}var T=g?i:this,O=p?T[t]:t;return y=x.length,c?x=function(t,e){var i=t.length,n=_r(e.length,i),s=Mn(t);for(;n--;){var o=e[n];t[n]=_s(o,i)?s[o]:r}return t}(x,c):m&&y>1&&x.reverse(),d&&u<y&&(x.length=u),this&&this!==ge&&this instanceof l&&(O=_||In(O)),O.apply(T,x)}}function Wn(t,e){return function(r,i){return function(t,e,r,i){return yi(t,(function(t,n,s){e(i,r(t),n,s)})),i}(r,t,e(i),{})}}function zn(t,e){return function(i,n){var s;if(i===r&&n===r)return e;if(i!==r&&(s=i),n!==r){if(s===r)return n;"string"==typeof i||"string"==typeof n?(i=cn(i),n=cn(n)):(i=hn(i),n=hn(n)),s=t(i,n)}return s}}function Vn(t){return rs((function(e){return e=Fe(e,Je(hs())),Ki((function(r){var i=this;return t(e,(function(t){return Oe(t,i,r)}))}))}))}function Gn(t,e){var i=(e=e===r?" ":cn(e)).length;if(i<2)return i?qi(e,t):e;var n=qi(e,de(t/fr(e)));return or(e)?bn(dr(n),0,t).join(""):n.slice(0,t)}function Un(t){return function(e,i,n){return n&&"number"!=typeof n&&ys(e,i,n)&&(i=n=r),e=da(e),i===r?(i=e,e=0):i=da(i),function(t,e,r,i){for(var n=-1,s=mr(de((e-t)/(r||1)),0),o=a(s);s--;)o[i?s:++n]=t,t+=r;return o}(e,i,n=n===r?e<i?1:-1:da(n),t)}}function Hn(t){return function(e,r){return"string"==typeof e&&"string"==typeof r||(e=va(e),r=va(r)),t(e,r)}}function Nn(t,e,i,n,s,o,a,l,u,f){var d=8&e;e|=d?h:c,4&(e&=~(d?c:h))||(e&=-4);var g=[t,e,s,d?o:r,d?a:r,d?r:o,d?r:a,l,u,f],p=i.apply(r,g);return bs(t)&&Ms(p,g),p.placeholder=n,Ps(p,t,e)}function qn(t){var e=Tt[t];return function(t,r){if(t=va(t),(r=null==r?0:_r(ga(r),292))&&ye(t)){var i=(_a(t)+"e").split("e");return+((i=(_a(e(i[0]+"e"+(+i[1]+r)))+"e").split("e"))[0]+"e"+(+i[1]-r))}return e(t)}}var Kn=Or&&1/lr(new Or([,-0]))[1]==f?function(t){return new Or(t)}:hh;function $n(t){return function(e){var r=gs(e);return r==S?ar(e):r==M?ur(e):function(t,e){return Fe(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function Zn(t,e,n,f,d,g,p,v){var m=2&e;if(!m&&"function"!=typeof t)throw new Mt(i);var _=f?f.length:0;if(_||(e&=-97,f=d=r),p=p===r?p:mr(ga(p),0),v=v===r?v:ga(v),_-=d?d.length:0,e&c){var y=f,x=d;f=d=r}var b=m?r:ss(t),w=[t,e,n,f,d,y,x,g,p,v];if(b&&function(t,e){var r=t[1],i=e[1],n=r|i,o=n<131,a=i==l&&8==r||i==l&&r==u&&t[7].length<=e[8]||384==i&&e[7].length<=e[8]&&8==r;if(!o&&!a)return t;1&i&&(t[2]=e[2],n|=1&r?0:4);var h=e[3];if(h){var c=t[3];t[3]=c?kn(c,h,e[4]):h,t[4]=c?cr(t[3],s):e[4]}(h=e[5])&&(c=t[5],t[5]=c?Dn(c,h,e[6]):h,t[6]=c?cr(t[5],s):e[6]);(h=e[7])&&(t[7]=h);i&l&&(t[8]=null==t[8]?e[8]:_r(t[8],e[8]));null==t[9]&&(t[9]=e[9]);t[0]=e[0],t[1]=n}(w,b),t=w[0],e=w[1],n=w[2],f=w[3],d=w[4],!(v=w[9]=w[9]===r?m?0:t.length:mr(w[9]-_,0))&&24&e&&(e&=-25),e&&1!=e)C=8==e||e==o?function(t,e,i){var n=In(t);return function s(){for(var o=arguments.length,h=a(o),c=o,l=as(s);c--;)h[c]=arguments[c];var u=o<3&&h[0]!==l&&h[o-1]!==l?[]:cr(h,l);return(o-=u.length)<i?Nn(t,e,Yn,s.placeholder,r,h,u,r,r,i-o):Oe(this&&this!==ge&&this instanceof s?n:t,this,h)}}(t,e,v):e!=h&&33!=e||d.length?Yn.apply(r,w):function(t,e,r,i){var n=1&e,s=In(t);return function e(){for(var o=-1,h=arguments.length,c=-1,l=i.length,u=a(l+h),f=this&&this!==ge&&this instanceof e?s:t;++c<l;)u[c]=i[c];for(;h--;)u[c++]=arguments[++o];return Oe(f,n?r:this,u)}}(t,e,n,f);else var C=function(t,e,r){var i=1&e,n=In(t);return function e(){return(this&&this!==ge&&this instanceof e?n:t).apply(i?r:this,arguments)}}(t,e,n);return Ps((b?Qi:Ms)(C,w),t,e)}function Jn(t,e,i,n){return t===r||Yo(t,Pt[i])&&!Lt.call(n,i)?e:t}function Qn(t,e,i,n,s,o){return ta(t)&&ta(e)&&(o.set(e,t),Wi(t,e,r,Qn,o),o.delete(e)),t}function ts(t){return na(t)?r:t}function es(t,e,i,n,s,o){var a=1&i,h=t.length,c=e.length;if(h!=c&&!(a&&c>h))return!1;var l=o.get(t),u=o.get(e);if(l&&u)return l==e&&u==t;var f=-1,d=!0,g=2&i?new Nr:r;for(o.set(t,e),o.set(e,t);++f<h;){var p=t[f],v=e[f];if(n)var m=a?n(v,p,f,e,t,o):n(p,v,f,t,e,o);if(m!==r){if(m)continue;d=!1;break}if(g){if(!Be(e,(function(t,e){if(!tr(g,e)&&(p===t||s(p,t,i,n,o)))return g.push(e)}))){d=!1;break}}else if(p!==v&&!s(p,v,i,n,o)){d=!1;break}}return o.delete(t),o.delete(e),d}function rs(t){return As(Os(t,r,Gs),t+"")}function is(t){return Ci(t,Aa,fs)}function ns(t){return Ci(t,Pa,ds)}var ss=Mr?function(t){return Mr.get(t)}:hh;function os(t){for(var e=t.name+"",r=Er[e],i=Lt.call(Er,e)?r.length:0;i--;){var n=r[i],s=n.func;if(null==s||s==t)return n.name}return e}function as(t){return(Lt.call(Xr,"placeholder")?Xr:t).placeholder}function hs(){var t=Xr.iteratee||nh;return t=t===nh?Fi:t,arguments.length?t(arguments[0],arguments[1]):t}function cs(t,e){var r,i,n=t.__data__;return("string"==(i=typeof(r=e))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==r:null===r)?n["string"==typeof e?"string":"hash"]:n.map}function ls(t){for(var e=Aa(t),r=e.length;r--;){var i=e[r],n=t[i];e[r]=[i,n,Ss(n)]}return e}function us(t,e){var i=function(t,e){return null==t?r:t[e]}(t,e);return ji(i)?i:r}var fs=ve?function(t){return null==t?[]:(t=Ot(t),Ae(ve(t),(function(e){return qt.call(t,e)})))}:ph,ds=ve?function(t){for(var e=[];t;)Le(e,fs(t)),t=Ht(t);return e}:ph,gs=Si;function ps(t,e,r){for(var i=-1,n=(e=yn(e,t)).length,s=!1;++i<n;){var o=Rs(e[i]);if(!(s=null!=t&&r(t,o)))break;t=t[o]}return s||++i!=n?s:!!(n=null==t?0:t.length)&&Qo(n)&&_s(o,n)&&(Go(t)||Vo(t))}function vs(t){return"function"!=typeof t.constructor||Cs(t)?{}:Yr(Ht(t))}function ms(t){return Go(t)||Vo(t)||!!($t&&t&&t[$t])}function _s(t,e){var r=typeof t;return!!(e=null==e?d:e)&&("number"==r||"symbol"!=r&&yt.test(t))&&t>-1&&t%1==0&&t<e}function ys(t,e,r){if(!ta(r))return!1;var i=typeof e;return!!("number"==i?Ho(r)&&_s(e,r.length):"string"==i&&e in r)&&Yo(r[e],t)}function xs(t,e){if(Go(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!ha(t))||(et.test(t)||!tt.test(t)||null!=e&&t in Ot(e))}function bs(t){var e=os(t),r=Xr[e];if("function"!=typeof r||!(e in Vr.prototype))return!1;if(t===r)return!0;var i=ss(r);return!!i&&t===i[0]}(Cr&&gs(new Cr(new ArrayBuffer(1)))!=F||Sr&&gs(new Sr)!=S||Tr&&gs(Tr.resolve())!=k||Or&&gs(new Or)!=M||kr&&gs(new kr)!=P)&&(gs=function(t){var e=Si(t),i=e==O?t.constructor:r,n=i?Is(i):"";if(n)switch(n){case Ar:return F;case Pr:return S;case jr:return k;case Fr:return M;case Lr:return P}return e});var ws=jt?Zo:vh;function Cs(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Pt)}function Ss(t){return t==t&&!ta(t)}function Ts(t,e){return function(i){return null!=i&&(i[t]===e&&(e!==r||t in Ot(i)))}}function Os(t,e,i){return e=mr(e===r?t.length-1:e,0),function(){for(var r=arguments,n=-1,s=mr(r.length-e,0),o=a(s);++n<s;)o[n]=r[e+n];n=-1;for(var h=a(e+1);++n<e;)h[n]=r[n];return h[e]=i(o),Oe(t,this,h)}}function ks(t,e){return e.length<2?t:wi(t,rn(e,0,-1))}function Ds(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Ms=js(Qi),Es=fe||function(t,e){return ge.setTimeout(t,e)},As=js(tn);function Ps(t,e,r){var i=e+"";return As(t,function(t,e){var r=e.length;if(!r)return t;var i=r-1;return e[i]=(r>1?"& ":"")+e[i],e=e.join(r>2?", ":" "),t.replace(at,"{\n/* [wrapped with "+e+"] */\n")}(i,function(t,e){return De(v,(function(r){var i="_."+r[0];e&r[1]&&!Pe(t,i)&&t.push(i)})),t.sort()}(function(t){var e=t.match(ht);return e?e[1].split(ct):[]}(i),r)))}function js(t){var e=0,i=0;return function(){var n=yr(),s=16-(n-i);if(i=n,s>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(r,arguments)}}function Fs(t,e){var i=-1,n=t.length,s=n-1;for(e=e===r?n:e;++i<e;){var o=Ni(i,s),a=t[o];t[o]=t[i],t[i]=a}return t.length=e,t}var Ls=function(t){var e=Fo(t,(function(t){return 500===r.size&&r.clear(),t})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(rt,(function(t,r,i,n){e.push(i?n.replace(ft,"$1"):r||t)})),e}));function Rs(t){if("string"==typeof t||ha(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function Is(t){if(null!=t){try{return Ft.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function Bs(t){if(t instanceof Vr)return t.clone();var e=new zr(t.__wrapped__,t.__chain__);return e.__actions__=Mn(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var Xs=Ki((function(t,e){return No(t)?li(t,vi(e,1,No,!0)):[]})),Ys=Ki((function(t,e){var i=Ks(e);return No(i)&&(i=r),No(t)?li(t,vi(e,1,No,!0),hs(i,2)):[]})),Ws=Ki((function(t,e){var i=Ks(e);return No(i)&&(i=r),No(t)?li(t,vi(e,1,No,!0),r,i):[]}));function zs(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var n=null==r?0:ga(r);return n<0&&(n=mr(i+n,0)),We(t,hs(e,3),n)}function Vs(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var s=n-1;return i!==r&&(s=ga(i),s=i<0?mr(n+s,0):_r(s,n-1)),We(t,hs(e,3),s,!0)}function Gs(t){return(null==t?0:t.length)?vi(t,1):[]}function Us(t){return t&&t.length?t[0]:r}var Hs=Ki((function(t){var e=Fe(t,mn);return e.length&&e[0]===t[0]?Di(e):[]})),Ns=Ki((function(t){var e=Ks(t),i=Fe(t,mn);return e===Ks(i)?e=r:i.pop(),i.length&&i[0]===t[0]?Di(i,hs(e,2)):[]})),qs=Ki((function(t){var e=Ks(t),i=Fe(t,mn);return(e="function"==typeof e?e:r)&&i.pop(),i.length&&i[0]===t[0]?Di(i,r,e):[]}));function Ks(t){var e=null==t?0:t.length;return e?t[e-1]:r}var $s=Ki(Zs);function Zs(t,e){return t&&t.length&&e&&e.length?Ui(t,e):t}var Js=rs((function(t,e){var r=null==t?0:t.length,i=si(t,e);return Hi(t,Fe(e,(function(t){return _s(t,r)?+t:t})).sort(On)),i}));function Qs(t){return null==t?t:wr.call(t)}var to=Ki((function(t){return ln(vi(t,1,No,!0))})),eo=Ki((function(t){var e=Ks(t);return No(e)&&(e=r),ln(vi(t,1,No,!0),hs(e,2))})),ro=Ki((function(t){var e=Ks(t);return e="function"==typeof e?e:r,ln(vi(t,1,No,!0),r,e)}));function io(t){if(!t||!t.length)return[];var e=0;return t=Ae(t,(function(t){if(No(t))return e=mr(t.length,e),!0})),$e(e,(function(e){return Fe(t,He(e))}))}function no(t,e){if(!t||!t.length)return[];var i=io(t);return null==e?i:Fe(i,(function(t){return Oe(e,r,t)}))}var so=Ki((function(t,e){return No(t)?li(t,e):[]})),oo=Ki((function(t){return pn(Ae(t,No))})),ao=Ki((function(t){var e=Ks(t);return No(e)&&(e=r),pn(Ae(t,No),hs(e,2))})),ho=Ki((function(t){var e=Ks(t);return e="function"==typeof e?e:r,pn(Ae(t,No),r,e)})),co=Ki(io);var lo=Ki((function(t){var e=t.length,i=e>1?t[e-1]:r;return i="function"==typeof i?(t.pop(),i):r,no(t,i)}));function uo(t){var e=Xr(t);return e.__chain__=!0,e}function fo(t,e){return e(t)}var go=rs((function(t){var e=t.length,i=e?t[0]:0,n=this.__wrapped__,s=function(e){return si(e,t)};return!(e>1||this.__actions__.length)&&n instanceof Vr&&_s(i)?((n=n.slice(i,+i+(e?1:0))).__actions__.push({func:fo,args:[s],thisArg:r}),new zr(n,this.__chain__).thru((function(t){return e&&!t.length&&t.push(r),t}))):this.thru(s)}));var po=An((function(t,e,r){Lt.call(t,r)?++t[r]:ni(t,r,1)}));var vo=Bn(zs),mo=Bn(Vs);function _o(t,e){return(Go(t)?De:ui)(t,hs(e,3))}function yo(t,e){return(Go(t)?Me:fi)(t,hs(e,3))}var xo=An((function(t,e,r){Lt.call(t,r)?t[r].push(e):ni(t,r,[e])}));var bo=Ki((function(t,e,r){var i=-1,n="function"==typeof e,s=Ho(t)?a(t.length):[];return ui(t,(function(t){s[++i]=n?Oe(e,t,r):Mi(t,e,r)})),s})),wo=An((function(t,e,r){ni(t,r,e)}));function Co(t,e){return(Go(t)?Fe:Bi)(t,hs(e,3))}var So=An((function(t,e,r){t[r?0:1].push(e)}),(function(){return[[],[]]}));var To=Ki((function(t,e){if(null==t)return[];var r=e.length;return r>1&&ys(t,e[0],e[1])?e=[]:r>2&&ys(e[0],e[1],e[2])&&(e=[e[0]]),Vi(t,vi(e,1),[])})),Oo=ce||function(){return ge.Date.now()};function ko(t,e,i){return e=i?r:e,e=t&&null==e?t.length:e,Zn(t,l,r,r,r,r,e)}function Do(t,e){var n;if("function"!=typeof e)throw new Mt(i);return t=ga(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=r),n}}var Mo=Ki((function(t,e,r){var i=1;if(r.length){var n=cr(r,as(Mo));i|=h}return Zn(t,i,e,r,n)})),Eo=Ki((function(t,e,r){var i=3;if(r.length){var n=cr(r,as(Eo));i|=h}return Zn(e,i,t,r,n)}));function Ao(t,e,n){var s,o,a,h,c,l,u=0,f=!1,d=!1,g=!0;if("function"!=typeof t)throw new Mt(i);function p(e){var i=s,n=o;return s=o=r,u=e,h=t.apply(n,i)}function v(t){var i=t-l;return l===r||i>=e||i<0||d&&t-u>=a}function m(){var t=Oo();if(v(t))return _(t);c=Es(m,function(t){var r=e-(t-l);return d?_r(r,a-(t-u)):r}(t))}function _(t){return c=r,g&&s?p(t):(s=o=r,h)}function y(){var t=Oo(),i=v(t);if(s=arguments,o=this,l=t,i){if(c===r)return function(t){return u=t,c=Es(m,e),f?p(t):h}(l);if(d)return wn(c),c=Es(m,e),p(l)}return c===r&&(c=Es(m,e)),h}return e=va(e)||0,ta(n)&&(f=!!n.leading,a=(d="maxWait"in n)?mr(va(n.maxWait)||0,e):a,g="trailing"in n?!!n.trailing:g),y.cancel=function(){c!==r&&wn(c),u=0,s=l=o=c=r},y.flush=function(){return c===r?h:_(Oo())},y}var Po=Ki((function(t,e){return ci(t,1,e)})),jo=Ki((function(t,e,r){return ci(t,va(e)||0,r)}));function Fo(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new Mt(i);var r=function r(){var i=arguments,n=e?e.apply(this,i):i[0],s=r.cache;if(s.has(n))return s.get(n);var o=t.apply(this,i);return r.cache=s.set(n,o)||s,o};return r.cache=new(Fo.Cache||Hr),r}function Lo(t){if("function"!=typeof t)throw new Mt(i);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}Fo.Cache=Hr;var Ro=xn((function(t,e){var r=(e=1==e.length&&Go(e[0])?Fe(e[0],Je(hs())):Fe(vi(e,1),Je(hs()))).length;return Ki((function(i){for(var n=-1,s=_r(i.length,r);++n<s;)i[n]=e[n].call(this,i[n]);return Oe(t,this,i)}))})),Io=Ki((function(t,e){var i=cr(e,as(Io));return Zn(t,h,r,e,i)})),Bo=Ki((function(t,e){var i=cr(e,as(Bo));return Zn(t,c,r,e,i)})),Xo=rs((function(t,e){return Zn(t,u,r,r,r,e)}));function Yo(t,e){return t===e||t!=t&&e!=e}var Wo=Hn(Ti),zo=Hn((function(t,e){return t>=e})),Vo=Ei(function(){return arguments}())?Ei:function(t){return ea(t)&&Lt.call(t,"callee")&&!qt.call(t,"callee")},Go=a.isArray,Uo=xe?Je(xe):function(t){return ea(t)&&Si(t)==j};function Ho(t){return null!=t&&Qo(t.length)&&!Zo(t)}function No(t){return ea(t)&&Ho(t)}var qo=_e||vh,Ko=be?Je(be):function(t){return ea(t)&&Si(t)==x};function $o(t){if(!ea(t))return!1;var e=Si(t);return e==b||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!na(t)}function Zo(t){if(!ta(t))return!1;var e=Si(t);return e==w||e==C||"[object AsyncFunction]"==e||"[object Proxy]"==e}function Jo(t){return"number"==typeof t&&t==ga(t)}function Qo(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=d}function ta(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function ea(t){return null!=t&&"object"==typeof t}var ra=we?Je(we):function(t){return ea(t)&&gs(t)==S};function ia(t){return"number"==typeof t||ea(t)&&Si(t)==T}function na(t){if(!ea(t)||Si(t)!=O)return!1;var e=Ht(t);if(null===e)return!0;var r=Lt.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&Ft.call(r)==Xt}var sa=Ce?Je(Ce):function(t){return ea(t)&&Si(t)==D};var oa=Se?Je(Se):function(t){return ea(t)&&gs(t)==M};function aa(t){return"string"==typeof t||!Go(t)&&ea(t)&&Si(t)==E}function ha(t){return"symbol"==typeof t||ea(t)&&Si(t)==A}var ca=Te?Je(Te):function(t){return ea(t)&&Qo(t.length)&&!!ae[Si(t)]};var la=Hn(Ii),ua=Hn((function(t,e){return t<=e}));function fa(t){if(!t)return[];if(Ho(t))return aa(t)?dr(t):Mn(t);if(Zt&&t[Zt])return function(t){for(var e,r=[];!(e=t.next()).done;)r.push(e.value);return r}(t[Zt]());var e=gs(t);return(e==S?ar:e==M?lr:Ya)(t)}function da(t){return t?(t=va(t))===f||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function ga(t){var e=da(t),r=e%1;return e==e?r?e-r:e:0}function pa(t){return t?oi(ga(t),0,p):0}function va(t){if("number"==typeof t)return t;if(ha(t))return g;if(ta(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=ta(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Ze(t);var r=vt.test(t);return r||_t.test(t)?ue(t.slice(2),r?2:8):pt.test(t)?g:+t}function ma(t){return En(t,Pa(t))}function _a(t){return null==t?"":cn(t)}var ya=Pn((function(t,e){if(Cs(e)||Ho(e))En(e,Aa(e),t);else for(var r in e)Lt.call(e,r)&&ti(t,r,e[r])})),xa=Pn((function(t,e){En(e,Pa(e),t)})),ba=Pn((function(t,e,r,i){En(e,Pa(e),t,i)})),wa=Pn((function(t,e,r,i){En(e,Aa(e),t,i)})),Ca=rs(si);var Sa=Ki((function(t,e){t=Ot(t);var i=-1,n=e.length,s=n>2?e[2]:r;for(s&&ys(e[0],e[1],s)&&(n=1);++i<n;)for(var o=e[i],a=Pa(o),h=-1,c=a.length;++h<c;){var l=a[h],u=t[l];(u===r||Yo(u,Pt[l])&&!Lt.call(t,l))&&(t[l]=o[l])}return t})),Ta=Ki((function(t){return t.push(r,Qn),Oe(Fa,r,t)}));function Oa(t,e,i){var n=null==t?r:wi(t,e);return n===r?i:n}function ka(t,e){return null!=t&&ps(t,e,ki)}var Da=Wn((function(t,e,r){null!=e&&"function"!=typeof e.toString&&(e=Bt.call(e)),t[e]=r}),th(ih)),Ma=Wn((function(t,e,r){null!=e&&"function"!=typeof e.toString&&(e=Bt.call(e)),Lt.call(t,e)?t[e].push(r):t[e]=[r]}),hs),Ea=Ki(Mi);function Aa(t){return Ho(t)?Kr(t):Li(t)}function Pa(t){return Ho(t)?Kr(t,!0):Ri(t)}var ja=Pn((function(t,e,r){Wi(t,e,r)})),Fa=Pn((function(t,e,r,i){Wi(t,e,r,i)})),La=rs((function(t,e){var r={};if(null==t)return r;var i=!1;e=Fe(e,(function(e){return e=yn(e,t),i||(i=e.length>1),e})),En(t,ns(t),r),i&&(r=ai(r,7,ts));for(var n=e.length;n--;)un(r,e[n]);return r}));var Ra=rs((function(t,e){return null==t?{}:function(t,e){return Gi(t,e,(function(e,r){return ka(t,r)}))}(t,e)}));function Ia(t,e){if(null==t)return{};var r=Fe(ns(t),(function(t){return[t]}));return e=hs(e),Gi(t,r,(function(t,r){return e(t,r[0])}))}var Ba=$n(Aa),Xa=$n(Pa);function Ya(t){return null==t?[]:Qe(t,Aa(t))}var Wa=Rn((function(t,e,r){return e=e.toLowerCase(),t+(r?za(e):e)}));function za(t){return $a(_a(t).toLowerCase())}function Va(t){return(t=_a(t))&&t.replace(xt,ir).replace(te,"")}var Ga=Rn((function(t,e,r){return t+(r?"-":"")+e.toLowerCase()})),Ua=Rn((function(t,e,r){return t+(r?" ":"")+e.toLowerCase()})),Ha=Ln("toLowerCase");var Na=Rn((function(t,e,r){return t+(r?"_":"")+e.toLowerCase()}));var qa=Rn((function(t,e,r){return t+(r?" ":"")+$a(e)}));var Ka=Rn((function(t,e,r){return t+(r?" ":"")+e.toUpperCase()})),$a=Ln("toUpperCase");function Za(t,e,i){return t=_a(t),(e=i?r:e)===r?function(t){return ne.test(t)}(t)?function(t){return t.match(re)||[]}(t):function(t){return t.match(lt)||[]}(t):t.match(e)||[]}var Ja=Ki((function(t,e){try{return Oe(t,r,e)}catch(i){return $o(i)?i:new Ct(i)}})),Qa=rs((function(t,e){return De(e,(function(e){e=Rs(e),ni(t,e,Mo(t[e],t))})),t}));function th(t){return function(){return t}}var eh=Xn(),rh=Xn(!0);function ih(t){return t}function nh(t){return Fi("function"==typeof t?t:ai(t,1))}var sh=Ki((function(t,e){return function(r){return Mi(r,t,e)}})),oh=Ki((function(t,e){return function(r){return Mi(t,r,e)}}));function ah(t,e,r){var i=Aa(e),n=bi(e,i);null!=r||ta(e)&&(n.length||!i.length)||(r=e,e=t,t=this,n=bi(e,Aa(e)));var s=!(ta(r)&&"chain"in r&&!r.chain),o=Zo(t);return De(n,(function(r){var i=e[r];t[r]=i,o&&(t.prototype[r]=function(){var e=this.__chain__;if(s||e){var r=t(this.__wrapped__);return(r.__actions__=Mn(this.__actions__)).push({func:i,args:arguments,thisArg:t}),r.__chain__=e,r}return i.apply(t,Le([this.value()],arguments))})})),t}function hh(){}var ch=Vn(Fe),lh=Vn(Ee),uh=Vn(Be);function fh(t){return xs(t)?He(Rs(t)):function(t){return function(e){return wi(e,t)}}(t)}var dh=Un(),gh=Un(!0);function ph(){return[]}function vh(){return!1}var mh=zn((function(t,e){return t+e}),0),_h=qn("ceil"),yh=zn((function(t,e){return t/e}),1),xh=qn("floor");var bh,wh=zn((function(t,e){return t*e}),1),Ch=qn("round"),Sh=zn((function(t,e){return t-e}),0);return Xr.after=function(t,e){if("function"!=typeof e)throw new Mt(i);return t=ga(t),function(){if(--t<1)return e.apply(this,arguments)}},Xr.ary=ko,Xr.assign=ya,Xr.assignIn=xa,Xr.assignInWith=ba,Xr.assignWith=wa,Xr.at=Ca,Xr.before=Do,Xr.bind=Mo,Xr.bindAll=Qa,Xr.bindKey=Eo,Xr.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Go(t)?t:[t]},Xr.chain=uo,Xr.chunk=function(t,e,i){e=(i?ys(t,e,i):e===r)?1:mr(ga(e),0);var n=null==t?0:t.length;if(!n||e<1)return[];for(var s=0,o=0,h=a(de(n/e));s<n;)h[o++]=rn(t,s,s+=e);return h},Xr.compact=function(t){for(var e=-1,r=null==t?0:t.length,i=0,n=[];++e<r;){var s=t[e];s&&(n[i++]=s)}return n},Xr.concat=function(){var t=arguments.length;if(!t)return[];for(var e=a(t-1),r=arguments[0],i=t;i--;)e[i-1]=arguments[i];return Le(Go(r)?Mn(r):[r],vi(e,1))},Xr.cond=function(t){var e=null==t?0:t.length,r=hs();return t=e?Fe(t,(function(t){if("function"!=typeof t[1])throw new Mt(i);return[r(t[0]),t[1]]})):[],Ki((function(r){for(var i=-1;++i<e;){var n=t[i];if(Oe(n[0],this,r))return Oe(n[1],this,r)}}))},Xr.conforms=function(t){return function(t){var e=Aa(t);return function(r){return hi(r,t,e)}}(ai(t,1))},Xr.constant=th,Xr.countBy=po,Xr.create=function(t,e){var r=Yr(t);return null==e?r:ii(r,e)},Xr.curry=function t(e,i,n){var s=Zn(e,8,r,r,r,r,r,i=n?r:i);return s.placeholder=t.placeholder,s},Xr.curryRight=function t(e,i,n){var s=Zn(e,o,r,r,r,r,r,i=n?r:i);return s.placeholder=t.placeholder,s},Xr.debounce=Ao,Xr.defaults=Sa,Xr.defaultsDeep=Ta,Xr.defer=Po,Xr.delay=jo,Xr.difference=Xs,Xr.differenceBy=Ys,Xr.differenceWith=Ws,Xr.drop=function(t,e,i){var n=null==t?0:t.length;return n?rn(t,(e=i||e===r?1:ga(e))<0?0:e,n):[]},Xr.dropRight=function(t,e,i){var n=null==t?0:t.length;return n?rn(t,0,(e=n-(e=i||e===r?1:ga(e)))<0?0:e):[]},Xr.dropRightWhile=function(t,e){return t&&t.length?dn(t,hs(e,3),!0,!0):[]},Xr.dropWhile=function(t,e){return t&&t.length?dn(t,hs(e,3),!0):[]},Xr.fill=function(t,e,i,n){var s=null==t?0:t.length;return s?(i&&"number"!=typeof i&&ys(t,e,i)&&(i=0,n=s),function(t,e,i,n){var s=t.length;for((i=ga(i))<0&&(i=-i>s?0:s+i),(n=n===r||n>s?s:ga(n))<0&&(n+=s),n=i>n?0:pa(n);i<n;)t[i++]=e;return t}(t,e,i,n)):[]},Xr.filter=function(t,e){return(Go(t)?Ae:pi)(t,hs(e,3))},Xr.flatMap=function(t,e){return vi(Co(t,e),1)},Xr.flatMapDeep=function(t,e){return vi(Co(t,e),f)},Xr.flatMapDepth=function(t,e,i){return i=i===r?1:ga(i),vi(Co(t,e),i)},Xr.flatten=Gs,Xr.flattenDeep=function(t){return(null==t?0:t.length)?vi(t,f):[]},Xr.flattenDepth=function(t,e){return(null==t?0:t.length)?vi(t,e=e===r?1:ga(e)):[]},Xr.flip=function(t){return Zn(t,512)},Xr.flow=eh,Xr.flowRight=rh,Xr.fromPairs=function(t){for(var e=-1,r=null==t?0:t.length,i={};++e<r;){var n=t[e];i[n[0]]=n[1]}return i},Xr.functions=function(t){return null==t?[]:bi(t,Aa(t))},Xr.functionsIn=function(t){return null==t?[]:bi(t,Pa(t))},Xr.groupBy=xo,Xr.initial=function(t){return(null==t?0:t.length)?rn(t,0,-1):[]},Xr.intersection=Hs,Xr.intersectionBy=Ns,Xr.intersectionWith=qs,Xr.invert=Da,Xr.invertBy=Ma,Xr.invokeMap=bo,Xr.iteratee=nh,Xr.keyBy=wo,Xr.keys=Aa,Xr.keysIn=Pa,Xr.map=Co,Xr.mapKeys=function(t,e){var r={};return e=hs(e,3),yi(t,(function(t,i,n){ni(r,e(t,i,n),t)})),r},Xr.mapValues=function(t,e){var r={};return e=hs(e,3),yi(t,(function(t,i,n){ni(r,i,e(t,i,n))})),r},Xr.matches=function(t){return Xi(ai(t,1))},Xr.matchesProperty=function(t,e){return Yi(t,ai(e,1))},Xr.memoize=Fo,Xr.merge=ja,Xr.mergeWith=Fa,Xr.method=sh,Xr.methodOf=oh,Xr.mixin=ah,Xr.negate=Lo,Xr.nthArg=function(t){return t=ga(t),Ki((function(e){return zi(e,t)}))},Xr.omit=La,Xr.omitBy=function(t,e){return Ia(t,Lo(hs(e)))},Xr.once=function(t){return Do(2,t)},Xr.orderBy=function(t,e,i,n){return null==t?[]:(Go(e)||(e=null==e?[]:[e]),Go(i=n?r:i)||(i=null==i?[]:[i]),Vi(t,e,i))},Xr.over=ch,Xr.overArgs=Ro,Xr.overEvery=lh,Xr.overSome=uh,Xr.partial=Io,Xr.partialRight=Bo,Xr.partition=So,Xr.pick=Ra,Xr.pickBy=Ia,Xr.property=fh,Xr.propertyOf=function(t){return function(e){return null==t?r:wi(t,e)}},Xr.pull=$s,Xr.pullAll=Zs,Xr.pullAllBy=function(t,e,r){return t&&t.length&&e&&e.length?Ui(t,e,hs(r,2)):t},Xr.pullAllWith=function(t,e,i){return t&&t.length&&e&&e.length?Ui(t,e,r,i):t},Xr.pullAt=Js,Xr.range=dh,Xr.rangeRight=gh,Xr.rearg=Xo,Xr.reject=function(t,e){return(Go(t)?Ae:pi)(t,Lo(hs(e,3)))},Xr.remove=function(t,e){var r=[];if(!t||!t.length)return r;var i=-1,n=[],s=t.length;for(e=hs(e,3);++i<s;){var o=t[i];e(o,i,t)&&(r.push(o),n.push(i))}return Hi(t,n),r},Xr.rest=function(t,e){if("function"!=typeof t)throw new Mt(i);return Ki(t,e=e===r?e:ga(e))},Xr.reverse=Qs,Xr.sampleSize=function(t,e,i){return e=(i?ys(t,e,i):e===r)?1:ga(e),(Go(t)?Zr:Zi)(t,e)},Xr.set=function(t,e,r){return null==t?t:Ji(t,e,r)},Xr.setWith=function(t,e,i,n){return n="function"==typeof n?n:r,null==t?t:Ji(t,e,i,n)},Xr.shuffle=function(t){return(Go(t)?Jr:en)(t)},Xr.slice=function(t,e,i){var n=null==t?0:t.length;return n?(i&&"number"!=typeof i&&ys(t,e,i)?(e=0,i=n):(e=null==e?0:ga(e),i=i===r?n:ga(i)),rn(t,e,i)):[]},Xr.sortBy=To,Xr.sortedUniq=function(t){return t&&t.length?an(t):[]},Xr.sortedUniqBy=function(t,e){return t&&t.length?an(t,hs(e,2)):[]},Xr.split=function(t,e,i){return i&&"number"!=typeof i&&ys(t,e,i)&&(e=i=r),(i=i===r?p:i>>>0)?(t=_a(t))&&("string"==typeof e||null!=e&&!sa(e))&&!(e=cn(e))&&or(t)?bn(dr(t),0,i):t.split(e,i):[]},Xr.spread=function(t,e){if("function"!=typeof t)throw new Mt(i);return e=null==e?0:mr(ga(e),0),Ki((function(r){var i=r[e],n=bn(r,0,e);return i&&Le(n,i),Oe(t,this,n)}))},Xr.tail=function(t){var e=null==t?0:t.length;return e?rn(t,1,e):[]},Xr.take=function(t,e,i){return t&&t.length?rn(t,0,(e=i||e===r?1:ga(e))<0?0:e):[]},Xr.takeRight=function(t,e,i){var n=null==t?0:t.length;return n?rn(t,(e=n-(e=i||e===r?1:ga(e)))<0?0:e,n):[]},Xr.takeRightWhile=function(t,e){return t&&t.length?dn(t,hs(e,3),!1,!0):[]},Xr.takeWhile=function(t,e){return t&&t.length?dn(t,hs(e,3)):[]},Xr.tap=function(t,e){return e(t),t},Xr.throttle=function(t,e,r){var n=!0,s=!0;if("function"!=typeof t)throw new Mt(i);return ta(r)&&(n="leading"in r?!!r.leading:n,s="trailing"in r?!!r.trailing:s),Ao(t,e,{leading:n,maxWait:e,trailing:s})},Xr.thru=fo,Xr.toArray=fa,Xr.toPairs=Ba,Xr.toPairsIn=Xa,Xr.toPath=function(t){return Go(t)?Fe(t,Rs):ha(t)?[t]:Mn(Ls(_a(t)))},Xr.toPlainObject=ma,Xr.transform=function(t,e,r){var i=Go(t),n=i||qo(t)||ca(t);if(e=hs(e,4),null==r){var s=t&&t.constructor;r=n?i?new s:[]:ta(t)&&Zo(s)?Yr(Ht(t)):{}}return(n?De:yi)(t,(function(t,i,n){return e(r,t,i,n)})),r},Xr.unary=function(t){return ko(t,1)},Xr.union=to,Xr.unionBy=eo,Xr.unionWith=ro,Xr.uniq=function(t){return t&&t.length?ln(t):[]},Xr.uniqBy=function(t,e){return t&&t.length?ln(t,hs(e,2)):[]},Xr.uniqWith=function(t,e){return e="function"==typeof e?e:r,t&&t.length?ln(t,r,e):[]},Xr.unset=function(t,e){return null==t||un(t,e)},Xr.unzip=io,Xr.unzipWith=no,Xr.update=function(t,e,r){return null==t?t:fn(t,e,_n(r))},Xr.updateWith=function(t,e,i,n){return n="function"==typeof n?n:r,null==t?t:fn(t,e,_n(i),n)},Xr.values=Ya,Xr.valuesIn=function(t){return null==t?[]:Qe(t,Pa(t))},Xr.without=so,Xr.words=Za,Xr.wrap=function(t,e){return Io(_n(e),t)},Xr.xor=oo,Xr.xorBy=ao,Xr.xorWith=ho,Xr.zip=co,Xr.zipObject=function(t,e){return vn(t||[],e||[],ti)},Xr.zipObjectDeep=function(t,e){return vn(t||[],e||[],Ji)},Xr.zipWith=lo,Xr.entries=Ba,Xr.entriesIn=Xa,Xr.extend=xa,Xr.extendWith=ba,ah(Xr,Xr),Xr.add=mh,Xr.attempt=Ja,Xr.camelCase=Wa,Xr.capitalize=za,Xr.ceil=_h,Xr.clamp=function(t,e,i){return i===r&&(i=e,e=r),i!==r&&(i=(i=va(i))==i?i:0),e!==r&&(e=(e=va(e))==e?e:0),oi(va(t),e,i)},Xr.clone=function(t){return ai(t,4)},Xr.cloneDeep=function(t){return ai(t,5)},Xr.cloneDeepWith=function(t,e){return ai(t,5,e="function"==typeof e?e:r)},Xr.cloneWith=function(t,e){return ai(t,4,e="function"==typeof e?e:r)},Xr.conformsTo=function(t,e){return null==e||hi(t,e,Aa(e))},Xr.deburr=Va,Xr.defaultTo=function(t,e){return null==t||t!=t?e:t},Xr.divide=yh,Xr.endsWith=function(t,e,i){t=_a(t),e=cn(e);var n=t.length,s=i=i===r?n:oi(ga(i),0,n);return(i-=e.length)>=0&&t.slice(i,s)==e},Xr.eq=Yo,Xr.escape=function(t){return(t=_a(t))&&$.test(t)?t.replace(q,nr):t},Xr.escapeRegExp=function(t){return(t=_a(t))&&nt.test(t)?t.replace(it,"\\$&"):t},Xr.every=function(t,e,i){var n=Go(t)?Ee:di;return i&&ys(t,e,i)&&(e=r),n(t,hs(e,3))},Xr.find=vo,Xr.findIndex=zs,Xr.findKey=function(t,e){return Ye(t,hs(e,3),yi)},Xr.findLast=mo,Xr.findLastIndex=Vs,Xr.findLastKey=function(t,e){return Ye(t,hs(e,3),xi)},Xr.floor=xh,Xr.forEach=_o,Xr.forEachRight=yo,Xr.forIn=function(t,e){return null==t?t:mi(t,hs(e,3),Pa)},Xr.forInRight=function(t,e){return null==t?t:_i(t,hs(e,3),Pa)},Xr.forOwn=function(t,e){return t&&yi(t,hs(e,3))},Xr.forOwnRight=function(t,e){return t&&xi(t,hs(e,3))},Xr.get=Oa,Xr.gt=Wo,Xr.gte=zo,Xr.has=function(t,e){return null!=t&&ps(t,e,Oi)},Xr.hasIn=ka,Xr.head=Us,Xr.identity=ih,Xr.includes=function(t,e,r,i){t=Ho(t)?t:Ya(t),r=r&&!i?ga(r):0;var n=t.length;return r<0&&(r=mr(n+r,0)),aa(t)?r<=n&&t.indexOf(e,r)>-1:!!n&&ze(t,e,r)>-1},Xr.indexOf=function(t,e,r){var i=null==t?0:t.length;if(!i)return-1;var n=null==r?0:ga(r);return n<0&&(n=mr(i+n,0)),ze(t,e,n)},Xr.inRange=function(t,e,i){return e=da(e),i===r?(i=e,e=0):i=da(i),function(t,e,r){return t>=_r(e,r)&&t<mr(e,r)}(t=va(t),e,i)},Xr.invoke=Ea,Xr.isArguments=Vo,Xr.isArray=Go,Xr.isArrayBuffer=Uo,Xr.isArrayLike=Ho,Xr.isArrayLikeObject=No,Xr.isBoolean=function(t){return!0===t||!1===t||ea(t)&&Si(t)==y},Xr.isBuffer=qo,Xr.isDate=Ko,Xr.isElement=function(t){return ea(t)&&1===t.nodeType&&!na(t)},Xr.isEmpty=function(t){if(null==t)return!0;if(Ho(t)&&(Go(t)||"string"==typeof t||"function"==typeof t.splice||qo(t)||ca(t)||Vo(t)))return!t.length;var e=gs(t);if(e==S||e==M)return!t.size;if(Cs(t))return!Li(t).length;for(var r in t)if(Lt.call(t,r))return!1;return!0},Xr.isEqual=function(t,e){return Ai(t,e)},Xr.isEqualWith=function(t,e,i){var n=(i="function"==typeof i?i:r)?i(t,e):r;return n===r?Ai(t,e,r,i):!!n},Xr.isError=$o,Xr.isFinite=function(t){return"number"==typeof t&&ye(t)},Xr.isFunction=Zo,Xr.isInteger=Jo,Xr.isLength=Qo,Xr.isMap=ra,Xr.isMatch=function(t,e){return t===e||Pi(t,e,ls(e))},Xr.isMatchWith=function(t,e,i){return i="function"==typeof i?i:r,Pi(t,e,ls(e),i)},Xr.isNaN=function(t){return ia(t)&&t!=+t},Xr.isNative=function(t){if(ws(t))throw new Ct("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return ji(t)},Xr.isNil=function(t){return null==t},Xr.isNull=function(t){return null===t},Xr.isNumber=ia,Xr.isObject=ta,Xr.isObjectLike=ea,Xr.isPlainObject=na,Xr.isRegExp=sa,Xr.isSafeInteger=function(t){return Jo(t)&&t>=-9007199254740991&&t<=d},Xr.isSet=oa,Xr.isString=aa,Xr.isSymbol=ha,Xr.isTypedArray=ca,Xr.isUndefined=function(t){return t===r},Xr.isWeakMap=function(t){return ea(t)&&gs(t)==P},Xr.isWeakSet=function(t){return ea(t)&&"[object WeakSet]"==Si(t)},Xr.join=function(t,e){return null==t?"":Xe.call(t,e)},Xr.kebabCase=Ga,Xr.last=Ks,Xr.lastIndexOf=function(t,e,i){var n=null==t?0:t.length;if(!n)return-1;var s=n;return i!==r&&(s=(s=ga(i))<0?mr(n+s,0):_r(s,n-1)),e==e?function(t,e,r){for(var i=r+1;i--;)if(t[i]===e)return i;return i}(t,e,s):We(t,Ge,s,!0)},Xr.lowerCase=Ua,Xr.lowerFirst=Ha,Xr.lt=la,Xr.lte=ua,Xr.max=function(t){return t&&t.length?gi(t,ih,Ti):r},Xr.maxBy=function(t,e){return t&&t.length?gi(t,hs(e,2),Ti):r},Xr.mean=function(t){return Ue(t,ih)},Xr.meanBy=function(t,e){return Ue(t,hs(e,2))},Xr.min=function(t){return t&&t.length?gi(t,ih,Ii):r},Xr.minBy=function(t,e){return t&&t.length?gi(t,hs(e,2),Ii):r},Xr.stubArray=ph,Xr.stubFalse=vh,Xr.stubObject=function(){return{}},Xr.stubString=function(){return""},Xr.stubTrue=function(){return!0},Xr.multiply=wh,Xr.nth=function(t,e){return t&&t.length?zi(t,ga(e)):r},Xr.noConflict=function(){return ge._===this&&(ge._=Yt),this},Xr.noop=hh,Xr.now=Oo,Xr.pad=function(t,e,r){t=_a(t);var i=(e=ga(e))?fr(t):0;if(!e||i>=e)return t;var n=(e-i)/2;return Gn(pe(n),r)+t+Gn(de(n),r)},Xr.padEnd=function(t,e,r){t=_a(t);var i=(e=ga(e))?fr(t):0;return e&&i<e?t+Gn(e-i,r):t},Xr.padStart=function(t,e,r){t=_a(t);var i=(e=ga(e))?fr(t):0;return e&&i<e?Gn(e-i,r)+t:t},Xr.parseInt=function(t,e,r){return r||null==e?e=0:e&&(e=+e),xr(_a(t).replace(st,""),e||0)},Xr.random=function(t,e,i){if(i&&"boolean"!=typeof i&&ys(t,e,i)&&(e=i=r),i===r&&("boolean"==typeof e?(i=e,e=r):"boolean"==typeof t&&(i=t,t=r)),t===r&&e===r?(t=0,e=1):(t=da(t),e===r?(e=t,t=0):e=da(e)),t>e){var n=t;t=e,e=n}if(i||t%1||e%1){var s=br();return _r(t+s*(e-t+le("1e-"+((s+"").length-1))),e)}return Ni(t,e)},Xr.reduce=function(t,e,r){var i=Go(t)?Re:qe,n=arguments.length<3;return i(t,hs(e,4),r,n,ui)},Xr.reduceRight=function(t,e,r){var i=Go(t)?Ie:qe,n=arguments.length<3;return i(t,hs(e,4),r,n,fi)},Xr.repeat=function(t,e,i){return e=(i?ys(t,e,i):e===r)?1:ga(e),qi(_a(t),e)},Xr.replace=function(){var t=arguments,e=_a(t[0]);return t.length<3?e:e.replace(t[1],t[2])},Xr.result=function(t,e,i){var n=-1,s=(e=yn(e,t)).length;for(s||(s=1,t=r);++n<s;){var o=null==t?r:t[Rs(e[n])];o===r&&(n=s,o=i),t=Zo(o)?o.call(t):o}return t},Xr.round=Ch,Xr.runInContext=t,Xr.sample=function(t){return(Go(t)?$r:$i)(t)},Xr.size=function(t){if(null==t)return 0;if(Ho(t))return aa(t)?fr(t):t.length;var e=gs(t);return e==S||e==M?t.size:Li(t).length},Xr.snakeCase=Na,Xr.some=function(t,e,i){var n=Go(t)?Be:nn;return i&&ys(t,e,i)&&(e=r),n(t,hs(e,3))},Xr.sortedIndex=function(t,e){return sn(t,e)},Xr.sortedIndexBy=function(t,e,r){return on(t,e,hs(r,2))},Xr.sortedIndexOf=function(t,e){var r=null==t?0:t.length;if(r){var i=sn(t,e);if(i<r&&Yo(t[i],e))return i}return-1},Xr.sortedLastIndex=function(t,e){return sn(t,e,!0)},Xr.sortedLastIndexBy=function(t,e,r){return on(t,e,hs(r,2),!0)},Xr.sortedLastIndexOf=function(t,e){if(null==t?0:t.length){var r=sn(t,e,!0)-1;if(Yo(t[r],e))return r}return-1},Xr.startCase=qa,Xr.startsWith=function(t,e,r){return t=_a(t),r=null==r?0:oi(ga(r),0,t.length),e=cn(e),t.slice(r,r+e.length)==e},Xr.subtract=Sh,Xr.sum=function(t){return t&&t.length?Ke(t,ih):0},Xr.sumBy=function(t,e){return t&&t.length?Ke(t,hs(e,2)):0},Xr.template=function(t,e,i){var n=Xr.templateSettings;i&&ys(t,e,i)&&(e=r),t=_a(t),e=ba({},e,n,Jn);var s,o,a=ba({},e.imports,n.imports,Jn),h=Aa(a),c=Qe(a,h),l=0,u=e.interpolate||bt,f="__p += '",d=kt((e.escape||bt).source+"|"+u.source+"|"+(u===Q?dt:bt).source+"|"+(e.evaluate||bt).source+"|$","g"),g="//# sourceURL="+(Lt.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++oe+"]")+"\n";t.replace(d,(function(e,r,i,n,a,h){return i||(i=n),f+=t.slice(l,h).replace(wt,sr),r&&(s=!0,f+="' +\n__e("+r+") +\n'"),a&&(o=!0,f+="';\n"+a+";\n__p += '"),i&&(f+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),l=h+e.length,e})),f+="';\n";var p=Lt.call(e,"variable")&&e.variable;if(p){if(ut.test(p))throw new Ct("Invalid `variable` option passed into `_.template`")}else f="with (obj) {\n"+f+"\n}\n";f=(o?f.replace(G,""):f).replace(U,"$1").replace(H,"$1;"),f="function("+(p||"obj")+") {\n"+(p?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var v=Ja((function(){return St(h,g+"return "+f).apply(r,c)}));if(v.source=f,$o(v))throw v;return v},Xr.times=function(t,e){if((t=ga(t))<1||t>d)return[];var r=p,i=_r(t,p);e=hs(e),t-=p;for(var n=$e(i,e);++r<t;)e(r);return n},Xr.toFinite=da,Xr.toInteger=ga,Xr.toLength=pa,Xr.toLower=function(t){return _a(t).toLowerCase()},Xr.toNumber=va,Xr.toSafeInteger=function(t){return t?oi(ga(t),-9007199254740991,d):0===t?t:0},Xr.toString=_a,Xr.toUpper=function(t){return _a(t).toUpperCase()},Xr.trim=function(t,e,i){if((t=_a(t))&&(i||e===r))return Ze(t);if(!t||!(e=cn(e)))return t;var n=dr(t),s=dr(e);return bn(n,er(n,s),rr(n,s)+1).join("")},Xr.trimEnd=function(t,e,i){if((t=_a(t))&&(i||e===r))return t.slice(0,gr(t)+1);if(!t||!(e=cn(e)))return t;var n=dr(t);return bn(n,0,rr(n,dr(e))+1).join("")},Xr.trimStart=function(t,e,i){if((t=_a(t))&&(i||e===r))return t.replace(st,"");if(!t||!(e=cn(e)))return t;var n=dr(t);return bn(n,er(n,dr(e))).join("")},Xr.truncate=function(t,e){var i=30,n="...";if(ta(e)){var s="separator"in e?e.separator:s;i="length"in e?ga(e.length):i,n="omission"in e?cn(e.omission):n}var o=(t=_a(t)).length;if(or(t)){var a=dr(t);o=a.length}if(i>=o)return t;var h=i-fr(n);if(h<1)return n;var c=a?bn(a,0,h).join(""):t.slice(0,h);if(s===r)return c+n;if(a&&(h+=c.length-h),sa(s)){if(t.slice(h).search(s)){var l,u=c;for(s.global||(s=kt(s.source,_a(gt.exec(s))+"g")),s.lastIndex=0;l=s.exec(u);)var f=l.index;c=c.slice(0,f===r?h:f)}}else if(t.indexOf(cn(s),h)!=h){var d=c.lastIndexOf(s);d>-1&&(c=c.slice(0,d))}return c+n},Xr.unescape=function(t){return(t=_a(t))&&K.test(t)?t.replace(N,pr):t},Xr.uniqueId=function(t){var e=++Rt;return _a(t)+e},Xr.upperCase=Ka,Xr.upperFirst=$a,Xr.each=_o,Xr.eachRight=yo,Xr.first=Us,ah(Xr,(bh={},yi(Xr,(function(t,e){Lt.call(Xr.prototype,e)||(bh[e]=t)})),bh),{chain:!1}),Xr.VERSION="4.17.21",De(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Xr[t].placeholder=Xr})),De(["drop","take"],(function(t,e){Vr.prototype[t]=function(i){i=i===r?1:mr(ga(i),0);var n=this.__filtered__&&!e?new Vr(this):this.clone();return n.__filtered__?n.__takeCount__=_r(i,n.__takeCount__):n.__views__.push({size:_r(i,p),type:t+(n.__dir__<0?"Right":"")}),n},Vr.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),De(["filter","map","takeWhile"],(function(t,e){var r=e+1,i=1==r||3==r;Vr.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:hs(t,3),type:r}),e.__filtered__=e.__filtered__||i,e}})),De(["head","last"],(function(t,e){var r="take"+(e?"Right":"");Vr.prototype[t]=function(){return this[r](1).value()[0]}})),De(["initial","tail"],(function(t,e){var r="drop"+(e?"":"Right");Vr.prototype[t]=function(){return this.__filtered__?new Vr(this):this[r](1)}})),Vr.prototype.compact=function(){return this.filter(ih)},Vr.prototype.find=function(t){return this.filter(t).head()},Vr.prototype.findLast=function(t){return this.reverse().find(t)},Vr.prototype.invokeMap=Ki((function(t,e){return"function"==typeof t?new Vr(this):this.map((function(r){return Mi(r,t,e)}))})),Vr.prototype.reject=function(t){return this.filter(Lo(hs(t)))},Vr.prototype.slice=function(t,e){t=ga(t);var i=this;return i.__filtered__&&(t>0||e<0)?new Vr(i):(t<0?i=i.takeRight(-t):t&&(i=i.drop(t)),e!==r&&(i=(e=ga(e))<0?i.dropRight(-e):i.take(e-t)),i)},Vr.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Vr.prototype.toArray=function(){return this.take(p)},yi(Vr.prototype,(function(t,e){var i=/^(?:filter|find|map|reject)|While$/.test(e),n=/^(?:head|last)$/.test(e),s=Xr[n?"take"+("last"==e?"Right":""):e],o=n||/^find/.test(e);s&&(Xr.prototype[e]=function(){var e=this.__wrapped__,a=n?[1]:arguments,h=e instanceof Vr,c=a[0],l=h||Go(e),u=function(t){var e=s.apply(Xr,Le([t],a));return n&&f?e[0]:e};l&&i&&"function"==typeof c&&1!=c.length&&(h=l=!1);var f=this.__chain__,d=!!this.__actions__.length,g=o&&!f,p=h&&!d;if(!o&&l){e=p?e:new Vr(this);var v=t.apply(e,a);return v.__actions__.push({func:fo,args:[u],thisArg:r}),new zr(v,f)}return g&&p?t.apply(this,a):(v=this.thru(u),g?n?v.value()[0]:v.value():v)})})),De(["pop","push","shift","sort","splice","unshift"],(function(t){var e=Et[t],r=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",i=/^(?:pop|shift)$/.test(t);Xr.prototype[t]=function(){var t=arguments;if(i&&!this.__chain__){var n=this.value();return e.apply(Go(n)?n:[],t)}return this[r]((function(r){return e.apply(Go(r)?r:[],t)}))}})),yi(Vr.prototype,(function(t,e){var r=Xr[e];if(r){var i=r.name+"";Lt.call(Er,i)||(Er[i]=[]),Er[i].push({name:e,func:r})}})),Er[Yn(r,2).name]=[{name:"wrapper",func:r}],Vr.prototype.clone=function(){var t=new Vr(this.__wrapped__);return t.__actions__=Mn(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Mn(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Mn(this.__views__),t},Vr.prototype.reverse=function(){if(this.__filtered__){var t=new Vr(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Vr.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,r=Go(t),i=e<0,n=r?t.length:0,s=function(t,e,r){var i=-1,n=r.length;for(;++i<n;){var s=r[i],o=s.size;switch(s.type){case"drop":t+=o;break;case"dropRight":e-=o;break;case"take":e=_r(e,t+o);break;case"takeRight":t=mr(t,e-o)}}return{start:t,end:e}}(0,n,this.__views__),o=s.start,a=s.end,h=a-o,c=i?a:o-1,l=this.__iteratees__,u=l.length,f=0,d=_r(h,this.__takeCount__);if(!r||!i&&n==h&&d==h)return gn(t,this.__actions__);var g=[];t:for(;h--&&f<d;){for(var p=-1,v=t[c+=e];++p<u;){var m=l[p],_=m.iteratee,y=m.type,x=_(v);if(2==y)v=x;else if(!x){if(1==y)continue t;break t}}g[f++]=v}return g},Xr.prototype.at=go,Xr.prototype.chain=function(){return uo(this)},Xr.prototype.commit=function(){return new zr(this.value(),this.__chain__)},Xr.prototype.next=function(){this.__values__===r&&(this.__values__=fa(this.value()));var t=this.__index__>=this.__values__.length;return{done:t,value:t?r:this.__values__[this.__index__++]}},Xr.prototype.plant=function(t){for(var e,i=this;i instanceof Wr;){var n=Bs(i);n.__index__=0,n.__values__=r,e?s.__wrapped__=n:e=n;var s=n;i=i.__wrapped__}return s.__wrapped__=t,e},Xr.prototype.reverse=function(){var t=this.__wrapped__;if(t instanceof Vr){var e=t;return this.__actions__.length&&(e=new Vr(this)),(e=e.reverse()).__actions__.push({func:fo,args:[Qs],thisArg:r}),new zr(e,this.__chain__)}return this.thru(Qs)},Xr.prototype.toJSON=Xr.prototype.valueOf=Xr.prototype.value=function(){return gn(this.__wrapped__,this.__actions__)},Xr.prototype.first=Xr.prototype.head,Zt&&(Xr.prototype[Zt]=function(){return this}),Xr}();ve?((ve.exports=vr)._=vr,pe._=vr):ge._=vr}).call(a)}(Oa,Oa.exports);e("l",Oa.exports);var ka={exports:{}};!function(t){!function(e,r,i){if(e){for(var n,s={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},o={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},a={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},h={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},c=1;c<20;++c)s[111+c]="f"+c;for(c=0;c<=9;++c)s[c+96]=c.toString();v.prototype.bind=function(t,e,r){var i=this;return t=t instanceof Array?t:[t],i._bindMultiple.call(i,t,e,r),i},v.prototype.unbind=function(t,e){return this.bind.call(this,t,(function(){}),e)},v.prototype.trigger=function(t,e){var r=this;return r._directMap[t+":"+e]&&r._directMap[t+":"+e]({},t),r},v.prototype.reset=function(){var t=this;return t._callbacks={},t._directMap={},t},v.prototype.stopCallback=function(t,e){if((" "+e.className+" ").indexOf(" mousetrap ")>-1)return!1;if(p(e,this.target))return!1;if("composedPath"in t&&"function"==typeof t.composedPath){var r=t.composedPath()[0];r!==t.target&&(e=r)}return"INPUT"==e.tagName||"SELECT"==e.tagName||"TEXTAREA"==e.tagName||e.isContentEditable},v.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},v.addKeycodes=function(t){for(var e in t)t.hasOwnProperty(e)&&(s[e]=t[e]);n=null},v.init=function(){var t=v(r);for(var e in t)"_"!==e.charAt(0)&&(v[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e))},v.init(),e.Mousetrap=v,t.exports&&(t.exports=v)}function l(t,e,r){t.addEventListener?t.addEventListener(e,r,!1):t.attachEvent("on"+e,r)}function u(t){if("keypress"==t.type){var e=String.fromCharCode(t.which);return t.shiftKey||(e=e.toLowerCase()),e}return s[t.which]?s[t.which]:o[t.which]?o[t.which]:String.fromCharCode(t.which).toLowerCase()}function f(t){return"shift"==t||"ctrl"==t||"alt"==t||"meta"==t}function d(t,e,r){return r||(r=function(){if(!n)for(var t in n={},s)t>95&&t<112||s.hasOwnProperty(t)&&(n[s[t]]=t);return n}()[t]?"keydown":"keypress"),"keypress"==r&&e.length&&(r="keydown"),r}function g(t,e){var r,i,n,s=[];for(r=function(t){return"+"===t?["+"]:(t=t.replace(/\+{2}/g,"+plus")).split("+")}(t),n=0;n<r.length;++n)i=r[n],h[i]&&(i=h[i]),e&&"keypress"!=e&&a[i]&&(i=a[i],s.push("shift")),f(i)&&s.push(i);return{key:i,modifiers:s,action:e=d(i,s,e)}}function p(t,e){return null!==t&&t!==r&&(t===e||p(t.parentNode,e))}function v(t){var e=this;if(t=t||r,!(e instanceof v))return new v(t);e.target=t,e._callbacks={},e._directMap={};var i,n={},s=!1,o=!1,a=!1;function h(t){t=t||{};var e,r=!1;for(e in n)t[e]?r=!0:n[e]=0;r||(a=!1)}function c(t,r,i,s,o,a){var h,c,l,u,d=[],g=i.type;if(!e._callbacks[t])return[];for("keyup"==g&&f(t)&&(r=[t]),h=0;h<e._callbacks[t].length;++h)if(c=e._callbacks[t][h],(s||!c.seq||n[c.seq]==c.level)&&g==c.action&&("keypress"==g&&!i.metaKey&&!i.ctrlKey||(l=r,u=c.modifiers,l.sort().join(",")===u.sort().join(",")))){var p=!s&&c.combo==o,v=s&&c.seq==s&&c.level==a;(p||v)&&e._callbacks[t].splice(h,1),d.push(c)}return d}function d(t,r,i,n){e.stopCallback(r,r.target||r.srcElement,i,n)||!1===t(r,i)&&(function(t){t.preventDefault?t.preventDefault():t.returnValue=!1}(r),function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}(r))}function p(t){"number"!=typeof t.which&&(t.which=t.keyCode);var r=u(t);r&&("keyup"!=t.type||s!==r?e.handleKey(r,function(t){var e=[];return t.shiftKey&&e.push("shift"),t.altKey&&e.push("alt"),t.ctrlKey&&e.push("ctrl"),t.metaKey&&e.push("meta"),e}(t),t):s=!1)}function m(t,e,r,o){function c(e){return function(){a=e,++n[t],clearTimeout(i),i=setTimeout(h,1e3)}}function l(e){d(r,e,t),"keyup"!==o&&(s=u(e)),setTimeout(h,10)}n[t]=0;for(var f=0;f<e.length;++f){var p=f+1===e.length?l:c(o||g(e[f+1]).action);_(e[f],p,o,t,f)}}function _(t,r,i,n,s){e._directMap[t+":"+i]=r;var o,a=(t=t.replace(/\s+/g," ")).split(" ");a.length>1?m(t,a,r,i):(o=g(t,i),e._callbacks[o.key]=e._callbacks[o.key]||[],c(o.key,o.modifiers,{type:o.action},n,t,s),e._callbacks[o.key][n?"unshift":"push"]({callback:r,modifiers:o.modifiers,action:o.action,seq:n,level:s,combo:t}))}e._handleKey=function(t,e,r){var i,n=c(t,e,r),s={},l=0,u=!1;for(i=0;i<n.length;++i)n[i].seq&&(l=Math.max(l,n[i].level));for(i=0;i<n.length;++i)if(n[i].seq){if(n[i].level!=l)continue;u=!0,s[n[i].seq]=1,d(n[i].callback,r,n[i].combo,n[i].seq)}else u||d(n[i].callback,r,n[i].combo);var g="keypress"==r.type&&o;r.type!=a||f(t)||g||h(s),o=u&&"keydown"==r.type},e._bindMultiple=function(t,e,r){for(var i=0;i<t.length;++i)_(t[i],e,r)},l(t,"keypress",p),l(t,"keydown",p),l(t,"keyup",p)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)}(ka);e("o",h(ka.exports))}}}))}();
