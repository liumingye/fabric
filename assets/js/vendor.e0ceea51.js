import{c as tr,g as fx}from"./index.3488ffbe.js";var Uu=function(){if(typeof Map<"u")return Map;function a(t,e){var n=-1;return t.some(function(r,o){return r[0]===e?(n=o,!0):!1}),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(e){var n=a(this.__entries__,e),r=this.__entries__[n];return r&&r[1]},t.prototype.set=function(e,n){var r=a(this.__entries__,e);~r?this.__entries__[r][1]=n:this.__entries__.push([e,n])},t.prototype.delete=function(e){var n=this.__entries__,r=a(n,e);~r&&n.splice(r,1)},t.prototype.has=function(e){return!!~a(this.__entries__,e)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,n){n===void 0&&(n=null);for(var r=0,o=this.__entries__;r<o.length;r++){var l=o[r];e.call(n,l[1],l[0])}},t}()}(),Ta=typeof window<"u"&&typeof document<"u"&&window.document===document,vs=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),dx=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(vs):function(a){return setTimeout(function(){return a(Date.now())},1e3/60)}}(),gx=2;function px(a,t){var e=!1,n=!1,r=0;function o(){e&&(e=!1,a()),n&&c()}function l(){dx(o)}function c(){var u=Date.now();if(e){if(u-r<gx)return;n=!0}else e=!0,n=!1,setTimeout(l,t);r=u}return c}var mx=20,_x=["top","right","bottom","left","width","height","size","weight"],vx=typeof MutationObserver<"u",yx=function(){function a(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=px(this.refresh.bind(this),mx)}return a.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},a.prototype.removeObserver=function(t){var e=this.observers_,n=e.indexOf(t);~n&&e.splice(n,1),!e.length&&this.connected_&&this.disconnect_()},a.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},a.prototype.updateObservers_=function(){var t=this.observers_.filter(function(e){return e.gatherActive(),e.hasActive()});return t.forEach(function(e){return e.broadcastActive()}),t.length>0},a.prototype.connect_=function(){!Ta||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),vx?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},a.prototype.disconnect_=function(){!Ta||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},a.prototype.onTransitionEnd_=function(t){var e=t.propertyName,n=e===void 0?"":e,r=_x.some(function(o){return!!~n.indexOf(o)});r&&this.refresh()},a.getInstance=function(){return this.instance_||(this.instance_=new a),this.instance_},a.instance_=null,a}(),Vu=function(a,t){for(var e=0,n=Object.keys(t);e<n.length;e++){var r=n[e];Object.defineProperty(a,r,{value:t[r],enumerable:!1,writable:!1,configurable:!0})}return a},Di=function(a){var t=a&&a.ownerDocument&&a.ownerDocument.defaultView;return t||vs},Nu=As(0,0,0,0);function ys(a){return parseFloat(a)||0}function cu(a){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return t.reduce(function(n,r){var o=a["border-"+r+"-width"];return n+ys(o)},0)}function xx(a){for(var t=["top","right","bottom","left"],e={},n=0,r=t;n<r.length;n++){var o=r[n],l=a["padding-"+o];e[o]=ys(l)}return e}function Cx(a){var t=a.getBBox();return As(0,0,t.width,t.height)}function wx(a){var t=a.clientWidth,e=a.clientHeight;if(!t&&!e)return Nu;var n=Di(a).getComputedStyle(a),r=xx(n),o=r.left+r.right,l=r.top+r.bottom,c=ys(n.width),u=ys(n.height);if(n.boxSizing==="border-box"&&(Math.round(c+o)!==t&&(c-=cu(n,"left","right")+o),Math.round(u+l)!==e&&(u-=cu(n,"top","bottom")+l)),!bx(a)){var d=Math.round(c+o)-t,g=Math.round(u+l)-e;Math.abs(d)!==1&&(c-=d),Math.abs(g)!==1&&(u-=g)}return As(r.left,r.top,c,u)}var Sx=function(){return typeof SVGGraphicsElement<"u"?function(a){return a instanceof Di(a).SVGGraphicsElement}:function(a){return a instanceof Di(a).SVGElement&&typeof a.getBBox=="function"}}();function bx(a){return a===Di(a).document.documentElement}function Tx(a){return Ta?Sx(a)?Cx(a):wx(a):Nu}function Ox(a){var t=a.x,e=a.y,n=a.width,r=a.height,o=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,l=Object.create(o.prototype);return Vu(l,{x:t,y:e,width:n,height:r,top:e,right:t+n,bottom:r+e,left:t}),l}function As(a,t,e,n){return{x:a,y:t,width:e,height:n}}var Dx=function(){function a(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=As(0,0,0,0),this.target=t}return a.prototype.isActive=function(){var t=Tx(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},a.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},a}(),Ex=function(){function a(t,e){var n=Ox(e);Vu(this,{target:t,contentRect:n})}return a}(),Px=function(){function a(t,e,n){if(this.activeObservations_=[],this.observations_=new Uu,typeof t!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=e,this.callbackCtx_=n}return a.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof Di(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new Dx(t)),this.controller_.addObserver(this),this.controller_.refresh())}},a.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof Di(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},a.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},a.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(e){e.isActive()&&t.activeObservations_.push(e)})},a.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map(function(n){return new Ex(n.target,n.broadcastRect())});this.callback_.call(t,e,t),this.clearActive()}},a.prototype.clearActive=function(){this.activeObservations_.splice(0)},a.prototype.hasActive=function(){return this.activeObservations_.length>0},a}(),Ku=typeof WeakMap<"u"?new WeakMap:new Uu,qu=function(){function a(t){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var e=yx.getInstance(),n=new Px(t,e,this);Ku.set(this,n)}return a}();["observe","unobserve","disconnect"].forEach(function(a){qu.prototype[a]=function(){var t;return(t=Ku.get(this))[a].apply(t,arguments)}});var _b=function(){return typeof vs.ResizeObserver<"u"?vs.ResizeObserver:qu}();function Ga(a,t){return t===void 0&&(t=15),+parseFloat(Number(a).toPrecision(t))}function Ze(a){var t=a.toString().split(/[eE]/),e=(t[0].split(".")[1]||"").length-+(t[1]||0);return e>0?e:0}function ur(a){if(a.toString().indexOf("e")===-1)return Number(a.toString().replace(".",""));var t=Ze(a);return t>0?Ga(Number(a)*Math.pow(10,t)):Number(a)}function Oa(a){Ju&&(a>Number.MAX_SAFE_INTEGER||a<Number.MIN_SAFE_INTEGER)&&console.warn(a+" is beyond boundary when transfer to integer, the results may not be accurate")}function Ms(a){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[0],r=t.slice(1);return r.reduce(function(o,l){return a(o,l)},n)}}var kn=Ms(function(a,t){var e=ur(a),n=ur(t),r=Ze(a)+Ze(t),o=e*n;return Oa(o),o/Math.pow(10,r)}),Ax=Ms(function(a,t){var e=Math.pow(10,Math.max(Ze(a),Ze(t)));return(kn(a,e)+kn(t,e))/e}),Mx=Ms(function(a,t){var e=Math.pow(10,Math.max(Ze(a),Ze(t)));return(kn(a,e)-kn(t,e))/e}),$u=Ms(function(a,t){var e=ur(a),n=ur(t);return Oa(e),Oa(n),kn(e/n,Ga(Math.pow(10,Ze(t)-Ze(a))))});function kx(a,t){var e=Math.pow(10,t),n=$u(Math.round(Math.abs(kn(a,e))),e);return a<0&&n!==0&&(n=kn(n,-1)),n}var Ju=!0;function Lx(a){a===void 0&&(a=!0),Ju=a}var vb={strip:Ga,plus:Ax,minus:Mx,times:kn,divide:$u,round:kx,digitLength:Ze,float2Fixed:ur,enableBoundaryChecking:Lx};function uu(a,t){var e=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);t&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(a,r).enumerable})),e.push.apply(e,n)}return e}function T(a){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?uu(Object(e),!0).forEach(function(n){D(a,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(e)):uu(Object(e)).forEach(function(n){Object.defineProperty(a,n,Object.getOwnPropertyDescriptor(e,n))})}return a}function D(a,t,e){return t=Zu(t),t in a?Object.defineProperty(a,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[t]=e,a}function Da(){return Da=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n])}return a},Da.apply(this,arguments)}function Fx(a){if(a==null)throw new TypeError("Cannot destructure "+a)}function Rx(a,t){if(a==null)return{};var e={},n=Object.keys(a),r,o;for(o=0;o<n.length;o++)r=n[o],!(t.indexOf(r)>=0)&&(e[r]=a[r]);return e}function At(a,t){if(a==null)return{};var e=Rx(a,t),n,r;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(a);for(r=0;r<o.length;r++)n=o[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(a,n)&&(e[n]=a[n])}return e}function tn(a,t){return t||(t=a.slice(0)),Object.freeze(Object.defineProperties(a,{raw:{value:Object.freeze(t)}}))}function Ix(a,t){if(typeof a!="object"||a===null)return a;var e=a[Symbol.toPrimitive];if(e!==void 0){var n=e.call(a,t||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(a)}function Zu(a){var t=Ix(a,"string");return typeof t=="symbol"?t:String(t)}class fu{constructor(){D(this,"browserShadowBlurConstant",1),D(this,"DPI",96),D(this,"devicePixelRatio",1),D(this,"perfLimitSizeTotal",2097152),D(this,"maxCacheSideLimit",4096),D(this,"minCacheSideLimit",256),D(this,"disableStyleCopyPaste",!1),D(this,"enableGLFiltering",!0),D(this,"textureSize",4096),D(this,"forceGLPutImageData",!1),D(this,"cachesBoundsOfCurve",!0),D(this,"fontPaths",{}),D(this,"NUM_FRACTION_DIGITS",4)}}class Bx extends fu{constructor(t){super(),this.configure(t)}configure(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.assign(this,t)}addFonts(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.fontPaths=T(T({},this.fontPaths),t)}removeFonts(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(e=>{delete this.fontPaths[e]})}clearFonts(){this.fontPaths={}}restoreDefaults(t){const e=new fu,n=(t==null?void 0:t.reduce((r,o)=>(r[o]=e[o],r),{}))||e;this.configure(n)}}const at=new Bx;class Wx{}class jx extends Wx{testPrecision(t,e){const n="precision ".concat(e,` float;
void main(){}`),r=t.createShader(t.FRAGMENT_SHADER);return r?(t.shaderSource(r,n),t.compileShader(r),!!t.getShaderParameter(r,t.COMPILE_STATUS)):!1}queryWebGL(t){const e=t.getContext("webgl");e&&(this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.GLPrecision=["highp","mediump","lowp"].find(n=>this.testPrecision(e,n)),console.log("fabric: max texture size ".concat(this.maxTextureSize)))}isSupported(t){return!!this.maxTextureSize&&this.maxTextureSize>=t}}const Xx={};let du=!1,gu;const Yx=()=>(du||(at.configure({devicePixelRatio:window.devicePixelRatio||1}),gu="ontouchstart"in window||"ontouchstart"in document||window&&window.navigator&&window.navigator.maxTouchPoints>0,du=!0),{document,window,isTouchSupported:gu,WebGLProbe:new jx,dispose(){},copyPasteData:Xx}),Qe=()=>Yx(),Mi=()=>Qe().document,Jn=()=>Qe().window;class Hx{constructor(){D(this,"charWidthsCache",{}),D(this,"boundsOfCurveCache",{})}getFontCache(t){let{fontFamily:e,fontStyle:n,fontWeight:r}=t;e=e.toLowerCase(),this.charWidthsCache[e]||(this.charWidthsCache[e]={});const o=this.charWidthsCache[e],l="".concat(n.toLowerCase(),"_").concat((r+"").toLowerCase());return o[l]||(o[l]={}),o[l]}clearFontCache(t){t=(t||"").toLowerCase(),t?this.charWidthsCache[t]&&delete this.charWidthsCache[t]:this.charWidthsCache={}}limitDimsByArea(t){const{perfLimitSizeTotal:e}=at,n=Math.sqrt(e*t);return[Math.floor(n),Math.floor(e/n)]}}const or=new Hx;var zx="6.0.0-beta9";const Ea=zx;function Qn(){}const mn=Math.PI/2,ti=Math.PI*2,Ua=Math.PI/180,be=Object.freeze([1,0,0,1,0,0]),Va=16,pu=2,Pn=1-.5522847498,mu=1,fs=2,ds=3,et="center",dt="left",ee="top",Pa="bottom",Yt="right",pe="none",Qu=/\r?\n/,er="json",da="svg";class Gx{constructor(){this[er]=new Map,this[da]=new Map}getClass(t){const e=this[er].get(t);if(!e)throw new Error("No class registered for ".concat(t));return e}setClass(t,e){e?this[er].set(e,t):(this[er].set(t.type,t),this[er].set(t.type.toLowerCase(),t))}getSVGClass(t){return this[da].get(t)}setSVGClass(t,e){this[da].set(e!=null?e:t.type.toLowerCase(),t)}}const q=new Gx;class Ux extends Array{remove(t){const e=this.indexOf(t);e>-1&&this.splice(e,1)}cancelAll(){const t=this.splice(0);return t.forEach(e=>e.abort()),t}cancelByCanvas(t){if(!t)return[];const e=this.filter(n=>{var r;return typeof n.target=="object"&&((r=n.target)===null||r===void 0?void 0:r.canvas)===t});return e.forEach(n=>n.abort()),e}cancelByTarget(t){if(!t)return[];const e=this.filter(n=>n.target===t);return e.forEach(n=>n.abort()),e}}const Aa=new Ux;class Vx{constructor(){D(this,"__eventListeners",{})}on(t,e){if(this.__eventListeners||(this.__eventListeners={}),typeof t=="object"){for(const n in t)this.on(n,t[n]);return()=>this.off(t)}else if(e){const n=t;return this.__eventListeners[n]||(this.__eventListeners[n]=[]),this.__eventListeners[n].push(e),()=>this.off(n,e)}else return()=>!1}once(t,e){if(typeof t=="object"){const n=[];for(const r in t)n.push(this.once(r,t[r]));return()=>n.forEach(r=>r())}else if(e){const n=this.on(t,function(){e(...arguments),n()});return n}else return()=>!1}_removeEventListener(t,e){if(this.__eventListeners[t])if(e){const n=this.__eventListeners[t],r=n.indexOf(e);r>-1&&n.splice(r,1)}else this.__eventListeners[t]=[]}off(t,e){if(this.__eventListeners)if(typeof t>"u")for(const n in this.__eventListeners)this._removeEventListener(n);else if(typeof t=="object")for(const n in t)this._removeEventListener(n,t[n]);else this._removeEventListener(t,e)}fire(t,e){var n;if(!this.__eventListeners)return;const r=(n=this.__eventListeners[t])===null||n===void 0?void 0:n.concat();if(r)for(let o=0;o<r.length;o++)r[o].call(this,e||{})}}const Nx=(a,t)=>Math.floor(Math.random()*(t-a+1))+a,bi=(a,t)=>isNaN(a)&&typeof t=="number"?t:a,$n=(a,t)=>{const e=a.indexOf(t);return e!==-1&&a.splice(e,1),a},ae=a=>{if(a===0)return 1;switch(Math.abs(a)/mn){case 1:case 3:return 0;case 2:return-1}return Math.cos(a)},le=a=>{if(a===0)return 0;const t=a/mn,e=Math.sign(a);switch(t){case 1:return e;case 2:return 0;case 3:return-e}return Math.sin(a)};class M{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;typeof t=="object"?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}add(t){return new M(this.x+t.x,this.y+t.y)}addEquals(t){return this.x+=t.x,this.y+=t.y,this}scalarAdd(t){return new M(this.x+t,this.y+t)}scalarAddEquals(t){return this.x+=t,this.y+=t,this}subtract(t){return new M(this.x-t.x,this.y-t.y)}subtractEquals(t){return this.x-=t.x,this.y-=t.y,this}scalarSubtract(t){return new M(this.x-t,this.y-t)}scalarSubtractEquals(t){return this.x-=t,this.y-=t,this}multiply(t){return new M(this.x*t.x,this.y*t.y)}scalarMultiply(t){return new M(this.x*t,this.y*t)}scalarMultiplyEquals(t){return this.x*=t,this.y*=t,this}divide(t){return new M(this.x/t.x,this.y/t.y)}scalarDivide(t){return new M(this.x/t,this.y/t)}scalarDivideEquals(t){return this.x/=t,this.y/=t,this}eq(t){return this.x===t.x&&this.y===t.y}lt(t){return this.x<t.x&&this.y<t.y}lte(t){return this.x<=t.x&&this.y<=t.y}gt(t){return this.x>t.x&&this.y>t.y}gte(t){return this.x>=t.x&&this.y>=t.y}lerp(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;return e=Math.max(Math.min(1,e),0),new M(this.x+(t.x-this.x)*e,this.y+(t.y-this.y)*e)}distanceFrom(t){const e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)}midPointFrom(t){return this.lerp(t)}min(t){return new M(Math.min(this.x,t.x),Math.min(this.y,t.y))}max(t){return new M(Math.max(this.x,t.x),Math.max(this.y,t.y))}toString(){return"".concat(this.x,",").concat(this.y)}setXY(t,e){return this.x=t,this.y=e,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setFromPoint(t){return this.x=t.x,this.y=t.y,this}swap(t){const e=this.x,n=this.y;this.x=t.x,this.y=t.y,t.x=e,t.y=n}clone(){return new M(this.x,this.y)}rotate(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Kx;const n=le(t),r=ae(t),o=this.subtract(e);return new M(o.x*r-o.y*n,o.x*n+o.y*r).add(e)}transform(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return new M(t[0]*this.x+t[2]*this.y+(e?0:t[4]),t[1]*this.x+t[3]*this.y+(e?0:t[5]))}}const Kx=new M(0,0);function tf(a){class t extends a{constructor(){super(...arguments),D(this,"_objects",[])}_onObjectAdded(n){}_onObjectRemoved(n){}_onStackOrderChanged(n){}add(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];const l=this._objects.push(...r);return r.forEach(c=>this._onObjectAdded(c)),l}insertAt(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),l=1;l<r;l++)o[l-1]=arguments[l];return this._objects.splice(n,0,...o),o.forEach(c=>this._onObjectAdded(c)),this._objects.length}remove(){const n=this._objects,r=[];for(var o=arguments.length,l=new Array(o),c=0;c<o;c++)l[c]=arguments[c];return l.forEach(u=>{const d=n.indexOf(u);d!==-1&&(n.splice(d,1),r.push(u),this._onObjectRemoved(u))}),r}forEachObject(n){this.getObjects().forEach((r,o,l)=>n(r,o,l))}getObjects(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return r.length===0?[...this._objects]:this._objects.filter(l=>l.isType(...r))}item(n){return this._objects[n]}isEmpty(){return this._objects.length===0}size(){return this._objects.length}contains(n,r){return this._objects.includes(n)?!0:r?this._objects.some(o=>o instanceof t&&o.contains(n,!0)):!1}complexity(){return this._objects.reduce((n,r)=>(n+=r.complexity?r.complexity():0,n),0)}sendObjectToBack(n){return!n||n===this._objects[0]?!1:($n(this._objects,n),this._objects.unshift(n),this._onStackOrderChanged(n),!0)}bringObjectToFront(n){return!n||n===this._objects[this._objects.length-1]?!1:($n(this._objects,n),this._objects.push(n),this._onStackOrderChanged(n),!0)}sendObjectBackwards(n,r){if(!n)return!1;const o=this._objects.indexOf(n);if(o!==0){const l=this.findNewLowerIndex(n,o,r);return $n(this._objects,n),this._objects.splice(l,0,n),this._onStackOrderChanged(n),!0}return!1}bringObjectForward(n,r){if(!n)return!1;const o=this._objects.indexOf(n);if(o!==this._objects.length-1){const l=this.findNewUpperIndex(n,o,r);return $n(this._objects,n),this._objects.splice(l,0,n),this._onStackOrderChanged(n),!0}return!1}moveObjectTo(n,r){return n===this._objects[r]?!1:($n(this._objects,n),this._objects.splice(r,0,n),this._onStackOrderChanged(n),!0)}findNewLowerIndex(n,r,o){let l;if(o){l=r;for(let c=r-1;c>=0;--c)if(n.isOverlapping(this._objects[c])){l=c;break}}else l=r-1;return l}findNewUpperIndex(n,r,o){let l;if(o){l=r;for(let c=r+1;c<this._objects.length;++c)if(n.isOverlapping(this._objects[c])){l=c;break}}else l=r+1;return l}collectObjects(n){let{left:r,top:o,width:l,height:c}=n,{includeIntersecting:u=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const d=[],g=new M(r,o),_=g.add(new M(l,c));for(let y=this._objects.length-1;y>=0;y--){const x=this._objects[y];x.selectable&&x.visible&&(u&&x.intersectsWithRect(g,_,!0)||x.isContainedWithinRect(g,_,!0)||u&&x.containsPoint(g,void 0,!0)||u&&x.containsPoint(_,void 0,!0))&&d.push(x)}return d}}return t}class ef extends Vx{_setOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};for(const e in t)this.set(e,t[e])}_setObject(t){for(const e in t)this._set(e,t[e])}set(t,e){return typeof t=="object"?this._setObject(t):this._set(t,e),this}_set(t,e){this[t]=e}toggle(t){const e=this.get(t);return typeof e=="boolean"&&this.set(t,!e),this}get(t){return this[t]}}function ar(a){return Jn().requestAnimationFrame(a)}function nf(a){return Jn().cancelAnimationFrame(a)}let qx=0;const Ln=()=>qx++,Wt=()=>{const a=Mi().createElement("canvas");if(!a||typeof a.getContext>"u")throw new Error("Failed to create `canvas` element");return a},rf=()=>Mi().createElement("img"),$x=a=>{var t;const e=Wt();return e.width=a.width,e.height=a.height,(t=e.getContext("2d"))===null||t===void 0||t.drawImage(a,0,0),e},Na=(a,t,e)=>a.toDataURL("image/".concat(t),e),Jx=a=>!!a&&a.getContext!==void 0,Ot=a=>a*Ua,Ei=a=>a/Ua,Zx=["translateX","translateY","angle"],Qx=a=>a.every((t,e)=>t===be[e]),Bt=(a,t,e)=>new M(a).transform(t,e),Nt=a=>{const t=1/(a[0]*a[3]-a[1]*a[2]),e=[t*a[3],-t*a[1],-t*a[2],t*a[0],0,0],{x:n,y:r}=new M(a[4],a[5]).transform(e,!0);return e[4]=-n,e[5]=-r,e},Kt=(a,t,e)=>[a[0]*t[0]+a[2]*t[1],a[1]*t[0]+a[3]*t[1],a[0]*t[2]+a[2]*t[3],a[1]*t[2]+a[3]*t[3],e?0:a[0]*t[4]+a[2]*t[5]+a[4],e?0:a[1]*t[4]+a[3]*t[5]+a[5]],ks=(a,t)=>a.reduceRight((e,n)=>n?Kt(n,e,t):e,be),Fn=a=>{const t=Math.atan2(a[1],a[0]),e=Math.pow(a[0],2)+Math.pow(a[1],2),n=Math.sqrt(e),r=(a[0]*a[3]-a[2]*a[1])/n,o=Math.atan2(a[0]*a[2]+a[1]*a[3],e);return{angle:Ei(t),scaleX:n,scaleY:r,skewX:Ei(o),skewY:0,translateX:a[4]||0,translateY:a[5]||0}},pr=function(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return[1,0,0,1,a,t]};function mr(){let{angle:a=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{x:t=0,y:e=0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=Ot(a),r=ae(n),o=le(n);return[r,o,-o,r,t?t-(r*t-o*e):0,e?e-(o*t+r*e):0]}const Ka=function(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:a;return[a,0,0,t,0,0]},sf=a=>Math.tan(Ot(a)),qa=a=>[1,0,sf(a),1,0,0],$a=a=>[1,sf(a),0,1,0,0],Ja=a=>{let{scaleX:t=1,scaleY:e=1,flipX:n=!1,flipY:r=!1,skewX:o=0,skewY:l=0}=a;return ks([Ka(n?-t:t,r?-e:e),o&&qa(o),l&&$a(l)],!0)},of=a=>{let{translateX:t=0,translateY:e=0,angle:n=0}=a,r=At(a,Zx);return ks([pr(t,e),n&&mr({angle:n}),Ja(r)])},lr=function(a){let{signal:t,crossOrigin:e=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise(function(n,r){if(t&&t.aborted)return r(new Error("`options.signal` is in `aborted` state"));const o=rf();let l;t&&(l=function(u){o.src="",r(u)},t.addEventListener("abort",l,{once:!0}));const c=function(){o.onload=o.onerror=null,l&&(t==null||t.removeEventListener("abort",l)),n(o)};if(!a){c();return}o.onload=c,o.onerror=function(){l&&(t==null||t.removeEventListener("abort",l)),r(new Error("Error loading "+o.src))},e&&(o.crossOrigin=e),o.src=a})},Pi=function(a){let{signal:t,reviver:e=Qn}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((n,r)=>{const o=[];t&&t.addEventListener("abort",r,{once:!0}),Promise.all(a.map(l=>q.getClass(l.type).fromObject(l,{signal:t,reviver:e}).then(c=>(e(l,c),o.push(c),c)))).then(n).catch(l=>{o.forEach(function(c){c.dispose&&c.dispose()}),r(l)}).finally(()=>{t&&t.removeEventListener("abort",r)})})},_r=function(a){let{signal:t}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return new Promise((e,n)=>{const r=[];t&&t.addEventListener("abort",n,{once:!0});const o=Object.values(a).map(c=>c&&(c.colorStops?new(q.getClass("gradient"))(c):c.type?Pi([c],{signal:t}).then(u=>{let[d]=u;return r.push(d),d}):c.source?q.getClass("pattern").fromObject(c,{signal:t}).then(u=>(r.push(u),u)):c)),l=Object.keys(a);Promise.all(o).then(c=>c.reduce((u,d,g)=>(u[l[g]]=d,u),{})).then(e).catch(c=>{r.forEach(u=>{u.dispose&&u.dispose()}),n(c)}).finally(()=>{t&&t.removeEventListener("abort",n)})})},ii=function(a){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:[]).reduce((e,n)=>(n in a&&(e[n]=a[n]),e),{})},af=(a,t)=>Object.keys(a).reduce((e,n)=>(t(a[n],n,a)&&(e[n]=a[n]),e),{}),_u={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#0FF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000",blanchedalmond:"#FFEBCD",blue:"#00F",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#0FF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#F0F",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#789",lightslategrey:"#789",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#0F0",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#F0F",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#639",red:"#F00",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFF",whitesmoke:"#F5F5F5",yellow:"#FF0",yellowgreen:"#9ACD32"},tC=()=>/^rgba?\(\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*[\s|,]\s*(\d{0,3}(?:\.\d+)?%?)\s*(?:\s*[,/]\s*(\d{0,3}(?:\.\d+)?%?)\s*)?\)$/i,eC=()=>/^hsla?\(\s*([+-]?\d{1,3})\s*[\s|,]\s*(\d{1,3}%)\s*[\s|,]\s*(\d{1,3}%)\s*(?:\s*[,/]\s*(\d*(?:\.\d+)?%?)\s*)?\)$/i,nC=()=>/^#?(([0-9a-f]){3,4}|([0-9a-f]{2}){3,4})$/i,ga=(a,t,e)=>(e<0&&(e+=1),e>1&&(e-=1),e<1/6?a+(t-a)*6*e:e<1/2?t:e<2/3?a+(t-a)*(2/3-e)*6:a),vu=(a,t,e,n)=>{a/=255,t/=255,e/=255;const r=Math.max(a,t,e),o=Math.min(a,t,e);let l,c;const u=(r+o)/2;if(r===o)l=c=0;else{const d=r-o;switch(c=u>.5?d/(2-r-o):d/(r+o),r){case a:l=(t-e)/d+(t<e?6:0);break;case t:l=(e-a)/d+2;break;case e:l=(a-t)/d+4;break}l/=6}return[Math.round(l*360),Math.round(c*100),Math.round(u*100),n]},yu=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"1";return parseFloat(a)/(a.endsWith("%")?100:1)},gs=a=>Math.min(Math.round(a),255).toString(16).toUpperCase().padStart(2,"0"),xu=a=>{let[t,e,n,r=1]=a;const o=Math.round(t*.3+e*.59+n*.11);return[o,o,o,r]};class wt{constructor(t){if(!t)this.setSource([0,0,0,1]);else if(t instanceof wt)this.setSource([...t._source]);else if(Array.isArray(t)){const[e,n,r,o=1]=t;this.setSource([e,n,r,o])}else this.setSource(this._tryParsingColor(t))}_tryParsingColor(t){return t in _u&&(t=_u[t]),t==="transparent"?[255,255,255,0]:wt.sourceFromHex(t)||wt.sourceFromRgb(t)||wt.sourceFromHsl(t)||[0,0,0,1]}getSource(){return this._source}setSource(t){this._source=t}toRgb(){const[t,e,n]=this.getSource();return"rgb(".concat(t,",").concat(e,",").concat(n,")")}toRgba(){return"rgba(".concat(this.getSource().join(","),")")}toHsl(){const[t,e,n]=vu(...this.getSource());return"hsl(".concat(t,",").concat(e,"%,").concat(n,"%)")}toHsla(){const[t,e,n,r]=vu(...this.getSource());return"hsla(".concat(t,",").concat(e,"%,").concat(n,"%,").concat(r,")")}toHex(){return this.toHexa().slice(0,6)}toHexa(){const[t,e,n,r]=this.getSource();return"".concat(gs(t)).concat(gs(e)).concat(gs(n)).concat(gs(Math.round(r*255)))}getAlpha(){return this.getSource()[3]}setAlpha(t){return this._source[3]=t,this}toGrayscale(){return this.setSource(xu(this.getSource())),this}toBlackWhite(t){const[e,,,n]=xu(this.getSource()),r=e<(t||127)?0:255;return this.setSource([r,r,r,n]),this}overlayWith(t){t instanceof wt||(t=new wt(t));const e=this.getSource(),n=.5,r=t.getSource(),[o,l,c]=e.map((u,d)=>Math.round(u*(1-n)+r[d]*n));return this.setSource([o,l,c,e[3]]),this}static fromRgb(t){return wt.fromRgba(t)}static fromRgba(t){return new wt(wt.sourceFromRgb(t))}static sourceFromRgb(t){const e=t.match(tC());if(e){const[n,r,o]=e.slice(1,4).map(l=>{const c=parseFloat(l);return l.endsWith("%")?Math.round(c*2.55):c});return[n,r,o,yu(e[4])]}}static fromHsl(t){return wt.fromHsla(t)}static fromHsla(t){return new wt(wt.sourceFromHsl(t))}static sourceFromHsl(t){const e=t.match(eC());if(!e)return;const n=(parseFloat(e[1])%360+360)%360/360,r=parseFloat(e[2])/100,o=parseFloat(e[3])/100;let l,c,u;if(r===0)l=c=u=o;else{const d=o<=.5?o*(r+1):o+r-o*r,g=o*2-d;l=ga(g,d,n+1/3),c=ga(g,d,n),u=ga(g,d,n-1/3)}return[Math.round(l*255),Math.round(c*255),Math.round(u*255),yu(e[4])]}static fromHex(t){return new wt(wt.sourceFromHex(t))}static sourceFromHex(t){if(t.match(nC())){const e=t.slice(t.indexOf("#")+1),n=e.length<=4;let r;n?r=e.split("").map(d=>d+d):r=e.match(/.{2}/g);const[o,l,c,u=255]=r.map(d=>parseInt(d,16));return[o,l,c,u/255]}}}const ut=(a,t)=>parseFloat(Number(a).toFixed(t)),iC=a=>{const t=["instantiated_by_use","style","id","class"];switch(a){case"linearGradient":return t.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);case"radialGradient":return t.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);case"stop":return t.concat(["offset","stop-color","stop-opacity"])}return t},Oi=(a,t)=>{const e=/\D{0,2}$/.exec(a),n=parseFloat(a);t||(t=Va);const r=at.DPI;switch(e==null?void 0:e[0]){case"mm":return n*r/25.4;case"cm":return n*r/2.54;case"in":return n*r;case"pt":return n*r/72;case"pc":return n*r/72*12;case"em":return n*t;default:return n}},rC=a=>a&&a!==pe?[a.slice(1,4),a.slice(5,8)]:a===pe?[a,a]:["Mid","Mid"],lf=a=>{const[t,e]=a.trim().split(" "),[n,r]=rC(t);return{meetOrSlice:e||"meet",alignX:n,alignY:r}},fr=a=>"matrix("+a.map(t=>ut(t,at.NUM_FRACTION_DIGITS)).join(" ")+")",nr=(a,t)=>{if(t){if(t.toLive)return"".concat(a,": url(#SVGID_").concat(t.id,"); ");{const e=new wt(t),n=e.getAlpha();let r="".concat(a,": ").concat(e.toRgb(),"; ");return n!==1&&(r+="".concat(a,"-opacity: ").concat(n.toString(),"; ")),r}}else return"".concat(a,": none; ")},sC=function(a,t){let{left:e,top:n,width:r,height:o}=t,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:at.NUM_FRACTION_DIGITS;const c=nr("fill",a),[u,d,g,_]=[e,n,r,o].map(y=>ut(y,l));return"<rect ".concat(c,' x="').concat(u,'" y="').concat(d,'" width="').concat(g,'" height="').concat(_,'"></rect>')},dn=a=>!!a&&a.toLive!==void 0,Cu=a=>!!a&&typeof a.toObject=="function",wu=a=>!!a&&a.offsetX!==void 0&&a.source!==void 0,Ma=a=>!!a&&Array.isArray(a._objects),oC=a=>!!a&&a.isType("ActiveSelection"),hf=a=>!!a&&a.isType("Text","IText","Textbox"),ms=a=>!!a&&a.isType("IText","Textbox"),Su=a=>!!a&&typeof a.onDragStart=="function"&&typeof a.shouldStartDragging=="function";function cf(a){let t=0,e=0;const n=$e(a),r=n.documentElement,o=n.body||{scrollLeft:0,scrollTop:0};for(;a&&(a.parentNode||a.host)&&(a=a.parentNode||a.host,a===n?(t=o.scrollLeft||r.scrollLeft||0,e=o.scrollTop||r.scrollTop||0):(t+=a.scrollLeft||0,e+=a.scrollTop||0),!(a.nodeType===1&&a.style.position==="fixed")););return{left:t,top:e}}const $e=a=>a.ownerDocument||null,uf=a=>{var t;return((t=a.ownerDocument)===null||t===void 0?void 0:t.defaultView)||null};function dr(a,t){const e=a.style;if(e)typeof t=="string"?a.style.cssText+=";"+t:Object.entries(t).forEach(n=>{let[r,o]=n;return e.setProperty(r,o)});else return}const ff=function(a,t,e){let{width:n,height:r}=e,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1;a.width=n,a.height=r,o>1&&(a.setAttribute("width",(n*o).toString()),a.setAttribute("height",(r*o).toString()),t.scale(o,o))};function aC(a,t){const e=t?"manipulation":pe;dr(a,{"touch-action":e,"-ms-touch-action":e})}const ka=(a,t)=>{let{width:e,height:n}=t;e&&(a.style.width=typeof e=="number"?"".concat(e,"px"):e),n&&(a.style.height=typeof n=="number"?"".concat(n,"px"):n)};function lC(a){var t;let e={left:0,top:0};const n=a&&$e(a),r={left:0,top:0},o={borderLeftWidth:dt,borderTopWidth:ee,paddingLeft:dt,paddingTop:ee};if(!n)return r;const l=((t=uf(a))===null||t===void 0?void 0:t.getComputedStyle(a,null))||{};for(const d in o)r[o[d]]+=parseInt(l[d],10)||0;const c=n.documentElement;typeof a.getBoundingClientRect<"u"&&(e=a.getBoundingClientRect());const u=cf(a);return{left:e.left+u.left-(c.clientLeft||0)+r.left,top:e.top+u.top-(c.clientTop||0)+r.top}}function bu(a){return typeof a.onselectstart<"u"&&(a.onselectstart=()=>!1),a.style.userSelect=pe,a}class df{constructor(t){D(this,"_originalCanvasStyle",void 0),D(this,"lower",void 0);const e=this.createLowerCanvas(t);this.lower={el:e,ctx:e.getContext("2d")}}createLowerCanvas(t){const e=Jx(t)?t:Mi().getElementById(t)||Wt();if(e.hasAttribute("data-fabric"))throw new Error("fabric.js: trying to initialize a canvas that has already been initialized");return this._originalCanvasStyle=e.style.cssText,e.setAttribute("data-fabric","main"),e.classList.add("lower-canvas"),e}cleanupDOM(t){let{width:e,height:n}=t;const{el:r}=this.lower;r.classList.remove("lower-canvas"),r.removeAttribute("data-fabric"),r.setAttribute("width","".concat(e)),r.setAttribute("height","".concat(n)),r.style.cssText=this._originalCanvasStyle||"",this._originalCanvasStyle=void 0}setDimensions(t,e){const{el:n,ctx:r}=this.lower;ff(n,r,t,e)}setCSSDimensions(t){ka(this.lower.el,t)}calcOffset(){return lC(this.lower.el)}dispose(){Qe().dispose(this.lower.el),delete this.lower}}const hC={backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:be.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,svgViewportTransformation:!0,skipOffscreen:!0,clipPath:void 0};class vr extends tf(ef){get lowerCanvasEl(){var t;return(t=this.elements.lower)===null||t===void 0?void 0:t.el}get contextContainer(){var t;return(t=this.elements.lower)===null||t===void 0?void 0:t.ctx}static getDefaults(){return vr.ownDefaults}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Object.assign(this,this.constructor.getDefaults()),this.set(e),this.initElements(t),this._setDimensionsImpl({width:this.width||this.elements.lower.el.width||0,height:this.height||this.elements.lower.el.height||0}),this.viewportTransform=[...this.viewportTransform],this.calcViewportBoundaries()}initElements(t){this.elements=new df(t)}add(){const t=super.add(...arguments);return arguments.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}insertAt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];const o=super.insertAt(t,...n);return n.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),o}remove(){const t=super.remove(...arguments);return t.length>0&&this.renderOnAddRemove&&this.requestRenderAll(),t}_onObjectAdded(t){t.canvas&&t.canvas!==this&&(console.warn(`fabric.Canvas: trying to add an object that belongs to a different canvas.
Resulting to default behavior: removing object from previous canvas and adding to new canvas`),t.canvas.remove(t)),t._set("canvas",this),t.setCoords(),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t){t._set("canvas",void 0),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onStackOrderChanged(){this.renderOnAddRemove&&this.requestRenderAll()}_isRetinaScaling(){return at.devicePixelRatio>1&&this.enableRetinaScaling}getRetinaScaling(){return this._isRetinaScaling()?Math.max(1,at.devicePixelRatio):1}calcOffset(){return this._offset=this.elements.calcOffset()}getWidth(){return this.width}getHeight(){return this.height}setWidth(t,e){return this.setDimensions({width:t},e)}setHeight(t,e){return this.setDimensions({height:t},e)}_setDimensionsImpl(t){let{cssOnly:e=!1,backstoreOnly:n=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!e){const r=T({width:this.width,height:this.height},t);this.elements.setDimensions(r,this.getRetinaScaling()),this.hasLostContext=!0,this.width=r.width,this.height=r.height}n||this.elements.setCSSDimensions(t),this.calcOffset()}setDimensions(t){let{cssOnly:e=!1,backstoreOnly:n=!1}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this._setDimensionsImpl(t,{cssOnly:e,backstoreOnly:n}),e||this.requestRenderAll()}getZoom(){return this.viewportTransform[0]}setViewportTransform(t){const e=this.backgroundImage,n=this.overlayImage,r=this._objects.length;this.viewportTransform=t;for(let o=0;o<r;o++){const l=this._objects[o];l.group||l.setCoords()}e&&e.setCoords(),n&&n.setCoords(),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll()}zoomToPoint(t,e){const n=t,r=[...this.viewportTransform],o=Bt(t,Nt(r));r[0]=e,r[3]=e;const l=Bt(o,r);r[4]+=n.x-l.x,r[5]+=n.y-l.y,this.setViewportTransform(r)}setZoom(t){this.zoomToPoint(new M(0,0),t)}absolutePan(t){const e=[...this.viewportTransform];return e[4]=-t.x,e[5]=-t.y,this.setViewportTransform(e)}relativePan(t){return this.absolutePan(new M(-t.x-this.viewportTransform[4],-t.y-this.viewportTransform[5]))}getElement(){return this.elements.lower.el}clearContext(t){t.clearRect(0,0,this.width,this.height)}getContext(){return this.elements.lower.ctx}clear(){this.remove(...this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this.clearContext(this.getContext()),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll()}renderAll(){this.cancelRequestedRender(),!this.destroyed&&this.renderCanvas(this.getContext(),this._objects)}renderAndReset(){this.nextRenderHandle=0,this.renderAll()}requestRenderAll(){!this.nextRenderHandle&&!this.disposed&&!this.destroyed&&(this.nextRenderHandle=ar(()=>this.renderAndReset()))}calcViewportBoundaries(){const t=this.width,e=this.height,n=Nt(this.viewportTransform),r=Bt({x:0,y:0},n),o=Bt({x:t,y:e},n),l=r.min(o),c=r.max(o);return this.vptCoords={tl:l,tr:new M(c.x,l.y),bl:new M(l.x,c.y),br:c}}cancelRequestedRender(){this.nextRenderHandle&&(nf(this.nextRenderHandle),this.nextRenderHandle=0)}drawControls(t){}renderCanvas(t,e){if(this.destroyed)return;const n=this.viewportTransform,r=this.clipPath;this.calcViewportBoundaries(),this.clearContext(t),t.imageSmoothingEnabled=this.imageSmoothingEnabled,t.patternQuality="best",this.fire("before:render",{ctx:t}),this._renderBackground(t),t.save(),t.transform(n[0],n[1],n[2],n[3],n[4],n[5]),this._renderObjects(t,e),t.restore(),this.controlsAboveOverlay||this.drawControls(t),r&&(r._set("canvas",this),r.shouldCache(),r._transformDone=!0,r.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(t,r)),this._renderOverlay(t),this.controlsAboveOverlay&&this.drawControls(t),this.fire("after:render",{ctx:t}),this.__cleanupTask&&(this.__cleanupTask(),this.__cleanupTask=void 0)}drawClipPathOnCanvas(t,e){const n=this.viewportTransform;t.save(),t.transform(...n),t.globalCompositeOperation="destination-in",e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}_renderObjects(t,e){for(let n=0,r=e.length;n<r;++n)e[n]&&e[n].render(t)}_renderBackgroundOrOverlay(t,e){const n=this["".concat(e,"Color")],r=this["".concat(e,"Image")],o=this.viewportTransform,l=this["".concat(e,"Vpt")];if(!n&&!r)return;const c=dn(n);if(n){if(t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.fillStyle=c?n.toLive(t):n,l&&t.transform(...o),c){t.transform(1,0,0,1,n.offsetX||0,n.offsetY||0);const u=n.gradientTransform||n.patternTransform;u&&t.transform(...u)}t.fill(),t.restore()}if(r){t.save();const{skipOffscreen:u}=this;this.skipOffscreen=l,l&&t.transform(...o),r.render(t),this.skipOffscreen=u,t.restore()}}_renderBackground(t){this._renderBackgroundOrOverlay(t,"background")}_renderOverlay(t){this._renderBackgroundOrOverlay(t,"overlay")}getCenter(){return{top:this.height/2,left:this.width/2}}getCenterPoint(){return new M(this.width/2,this.height/2)}centerObjectH(t){return this._centerObject(t,new M(this.getCenterPoint().x,t.getCenterPoint().y))}centerObjectV(t){return this._centerObject(t,new M(t.getCenterPoint().x,this.getCenterPoint().y))}centerObject(t){return this._centerObject(t,this.getCenterPoint())}viewportCenterObject(t){return this._centerObject(t,this.getVpCenter())}viewportCenterObjectH(t){return this._centerObject(t,new M(this.getVpCenter().x,t.getCenterPoint().y))}viewportCenterObjectV(t){return this._centerObject(t,new M(t.getCenterPoint().x,this.getVpCenter().y))}getVpCenter(){return Bt(this.getCenterPoint(),Nt(this.viewportTransform))}_centerObject(t,e){t.setXY(e,et,et),t.setCoords(),this.renderOnAddRemove&&this.requestRenderAll()}toDatalessJSON(t){return this.toDatalessObject(t)}toObject(t){return this._toObjectMethod("toObject",t)}toJSON(){return this.toObject()}toDatalessObject(t){return this._toObjectMethod("toDatalessObject",t)}_toObjectMethod(t,e){const n=this.clipPath,r=n&&!n.excludeFromExport?this._toObject(n,t,e):null;return T(T(T({version:Ea},ii(this,e)),{},{objects:this._objects.filter(o=>!o.excludeFromExport).map(o=>this._toObject(o,t,e))},this.__serializeBgOverlay(t,e)),r?{clipPath:r}:null)}_toObject(t,e,n){let r;this.includeDefaultValues||(r=t.includeDefaultValues,t.includeDefaultValues=!1);const o=t[e](n);return this.includeDefaultValues||(t.includeDefaultValues=!!r),o}__serializeBgOverlay(t,e){const n={},r=this.backgroundImage,o=this.overlayImage,l=this.backgroundColor,c=this.overlayColor;return dn(l)?l.excludeFromExport||(n.background=l.toObject(e)):l&&(n.background=l),dn(c)?c.excludeFromExport||(n.overlay=c.toObject(e)):c&&(n.overlay=c),r&&!r.excludeFromExport&&(n.backgroundImage=this._toObject(r,t,e)),o&&!o.excludeFromExport&&(n.overlayImage=this._toObject(o,t,e)),n}toSVG(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;t.reviver=e;const n=[];return this._setSVGPreamble(n,t),this._setSVGHeader(n,t),this.clipPath&&n.push('<g clip-path="url(#'.concat(this.clipPath.clipPathId,`)" >
`)),this._setSVGBgOverlayColor(n,"background"),this._setSVGBgOverlayImage(n,"backgroundImage",e),this._setSVGObjects(n,e),this.clipPath&&n.push(`</g>
`),this._setSVGBgOverlayColor(n,"overlay"),this._setSVGBgOverlayImage(n,"overlayImage",e),n.push("</svg>"),n.join("")}_setSVGPreamble(t,e){e.suppressPreamble||t.push('<?xml version="1.0" encoding="',e.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)}_setSVGHeader(t,e){const n=e.width||"".concat(this.width),r=e.height||"".concat(this.height),o=at.NUM_FRACTION_DIGITS,l=e.viewBox;let c;if(l)c='viewBox="'.concat(l.x," ").concat(l.y," ").concat(l.width," ").concat(l.height,'" ');else if(this.svgViewportTransformation){const u=this.viewportTransform;c='viewBox="'.concat(ut(-u[4]/u[0],o)," ").concat(ut(-u[5]/u[3],o)," ").concat(ut(this.width/u[0],o)," ").concat(ut(this.height/u[3],o),'" ')}else c='viewBox="0 0 '.concat(this.width," ").concat(this.height,'" ');t.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',n,'" ','height="',r,'" ',c,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",Ea,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(e),`</defs>
`)}createSVGClipPathMarkup(t){const e=this.clipPath;return e?(e.clipPathId="CLIPPATH_".concat(Ln()),'<clipPath id="'+e.clipPathId+`" >
`+this.clipPath.toClipPathSVG(t.reviver)+`</clipPath>
`):""}createSVGRefElementsMarkup(){return["background","overlay"].map(t=>{const e=this["".concat(t,"Color")];if(dn(e)){const n=this["".concat(t,"Vpt")],r=this.viewportTransform,o={width:this.width/(n?r[0]:1),height:this.height/(n?r[3]:1)};return e.toSVG(o,{additionalTransform:n?fr(r):""})}}).join("")}createSVGFontFacesMarkup(){const t=[],e={},n=at.fontPaths;this._objects.forEach(function o(l){t.push(l),Ma(l)&&l._objects.forEach(o)}),t.forEach(o=>{if(!hf(o))return;const{styles:l,fontFamily:c}=o;e[c]||!n[c]||(e[c]=!0,l&&Object.values(l).forEach(u=>{Object.values(u).forEach(d=>{let{fontFamily:g=""}=d;!e[g]&&n[g]&&(e[g]=!0)})}))});const r=Object.keys(e).map(o=>`		@font-face {
			font-family: '`.concat(o,`';
			src: url('`).concat(n[o],`');
		}
`)).join("");return r?`	<style type="text/css"><![CDATA[
`.concat(r,`]]></style>
`):""}_setSVGObjects(t,e){this.forEachObject(n=>{n.excludeFromExport||this._setSVGObject(t,n,e)})}_setSVGObject(t,e,n){t.push(e.toSVG(n))}_setSVGBgOverlayImage(t,e,n){const r=this[e];r&&!r.excludeFromExport&&r.toSVG&&t.push(r.toSVG(n))}_setSVGBgOverlayColor(t,e){const n=this["".concat(e,"Color")];if(n)if(dn(n)){const r=n.repeat||"",o=this.width,l=this.height,c=this["".concat(e,"Vpt")],u=c?fr(Nt(this.viewportTransform)):"";t.push('<rect transform="'.concat(u," translate(").concat(o/2,",").concat(l/2,')" x="').concat(n.offsetX-o/2,'" y="').concat(n.offsetY-l/2,'" width="').concat((r==="repeat-y"||r==="no-repeat")&&wu(n)?n.source.width:o,'" height="').concat((r==="repeat-x"||r==="no-repeat")&&wu(n)?n.source.height:l,'" fill="url(#SVGID_').concat(n.id,`)"></rect>
`))}else t.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',n,'"',`></rect>
`)}loadFromJSON(t,e){let{signal:n}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!t)return Promise.reject(new Error("fabric.js: `json` is undefined"));const r=typeof t=="string"?JSON.parse(t):t,{objects:o=[],backgroundImage:l,background:c,overlayImage:u,overlay:d,clipPath:g}=r,_=this.renderOnAddRemove;return this.renderOnAddRemove=!1,Promise.all([Pi(o,{reviver:e,signal:n}),_r({backgroundImage:l,backgroundColor:c,overlayImage:u,overlayColor:d,clipPath:g},{signal:n})]).then(y=>{let[x,S]=y;return this.clear(),this.add(...x),this.set(r),this.set(S),this.renderOnAddRemove=_,this})}clone(t){const e=this.toObject(t);return this.cloneWithoutData().loadFromJSON(e)}cloneWithoutData(){const t=Wt();return t.width=this.width,t.height=this.height,new this.constructor(t)}toDataURL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{format:e="png",quality:n=1,multiplier:r=1,enableRetinaScaling:o=!1}=t,l=r*(o?this.getRetinaScaling():1);return Na(this.toCanvasElement(l,t),e,n)}toCanvasElement(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1,{width:e,height:n,left:r,top:o,filter:l}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const c=(e||this.width)*t,u=(n||this.height)*t,d=this.getZoom(),g=this.width,_=this.height,y=d*t,x=this.viewportTransform,S=(x[4]-(r||0))*t,E=(x[5]-(o||0))*t,P=[y,0,0,y,S,E],L=this.enableRetinaScaling,W=Wt(),Y=l?this._objects.filter(H=>l(H)):this._objects;return W.width=c,W.height=u,this.enableRetinaScaling=!1,this.viewportTransform=P,this.width=c,this.height=u,this.calcViewportBoundaries(),this.renderCanvas(W.getContext("2d"),Y),this.viewportTransform=x,this.width=g,this.height=_,this.calcViewportBoundaries(),this.enableRetinaScaling=L,W}dispose(){return!this.disposed&&this.elements.cleanupDOM({width:this.width,height:this.height}),this.disposed=!0,new Promise((t,e)=>{const n=()=>{this.destroy(),t(!0)};n.kill=e,this.__cleanupTask&&this.__cleanupTask.kill("aborted"),this.destroyed?t(!1):this.nextRenderHandle?this.__cleanupTask=n:n()})}destroy(){this.destroyed=!0,this.cancelRequestedRender(),this.forEachObject(t=>t.dispose()),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose(),this.overlayImage=null,this.elements.dispose()}toString(){return"#<Canvas (".concat(this.complexity(),"): { objects: ").concat(this._objects.length," }>")}}D(vr,"ownDefaults",hC);const cC=["touchstart","touchmove","touchend"];function uC(a){const t=a.changedTouches;return t&&t[0]?t[0]:a}const gf=a=>{const t=a.target,e=cf(t),n=uC(a);return new M(n.clientX+e.left,n.clientY+e.top)},xs=a=>cC.indexOf(a.type)>-1||a.pointerType==="touch",La=a=>{a.preventDefault(),a.stopPropagation()},pn=a=>{if(a.length===0)return{left:0,top:0,width:0,height:0};const{min:t,max:e}=a.reduce((r,o)=>{let{min:l,max:c}=r;return{min:l.min(o),max:c.max(o)}},{min:new M(a[0]),max:new M(a[0])}),n=e.subtract(t);return{left:t.x,top:t.y,width:n.x,height:n.y}},fC=["translateX","translateY","scaleX","scaleY"],dC=(a,t)=>{const e=Nt(t),n=Kt(e,a.calcOwnMatrix());Ai(a,n)},pf=(a,t)=>Ai(a,Kt(t,a.calcOwnMatrix())),Ai=(a,t)=>{const e=Fn(t),{translateX:n,translateY:r,scaleX:o,scaleY:l}=e,c=At(e,fC),u=new M(n,r);a.flipX=!1,a.flipY=!1,Object.assign(a,c),a.set({scaleX:o,scaleY:l}),a.setPositionByOrigin(u,et,et)},Za=a=>{a.scaleX=1,a.scaleY=1,a.skewX=0,a.skewY=0,a.flipX=!1,a.flipY=!1,a.rotate(0)},Qa=a=>({scaleX:a.scaleX,scaleY:a.scaleY,skewX:a.skewX,skewY:a.skewY,angle:a.angle,left:a.left,flipX:a.flipX,flipY:a.flipY,top:a.top}),tl=(a,t,e)=>{const n=a/2,r=t/2,o=Ja(e),l=[new M(-n,-r),new M(n,-r),new M(-n,r),new M(n,r)].map(u=>u.transform(o)),c=pn(l);return new M(c.width,c.height)},el=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:be,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:be;return Kt(Nt(t),a)},nl=function(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:be,e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:be;return a.transform(el(t,e))},gC=(a,t,e,n)=>{if(e!=="child"&&e!=="sibling")throw new Error("fabric.js: received bad argument ".concat(e));if(n!=="child"&&n!=="sibling")throw new Error("fabric.js: received bad argument ".concat(n));if(e===n)return a;const r=t.viewportTransform;return a.transform(n==="child"?Nt(r):r)},il=(a,t,e)=>{const n=el(t,e);return Ai(a,Kt(n,a.calcOwnMatrix())),n},mf=(a,t)=>{var e;const{transform:{target:n}}=t;(e=n.canvas)===null||e===void 0||e.fire("object:".concat(a),T(T({},t),{},{target:n})),n.fire(a,t)},pC={left:-.5,top:-.5,center:0,bottom:.5,right:.5},Mn=a=>typeof a=="string"?pC[a]:a-.5,Cs="not-allowed",mC=(a,t,e,n)=>{if(!t||!a)return"drag";const r=n.controls[t];return r.getActionName(e,r,n)};function _f(a){return a.originX===et&&a.originY===et}function Tu(a){return-Mn(a)+.5}const Ge=(a,t)=>a[t],vf=(a,t,e,n)=>({e:a,transform:t,pointer:new M(e,n)});function yf(a,t){const e=a.getTotalAngle(),n=e+Ei(Math.atan2(t.y,t.x))+360;return Math.round(n%360/45)}function _C(a,t,e,n){const r=a.getRelativeCenterPoint(),o=typeof e<"u"&&typeof n<"u"?a.translateToGivenOrigin(r,et,et,e,n):new M(a.left,a.top);return(a.angle?t.rotate(-Ot(a.angle),r):t).subtract(o)}function yr(a,t,e,n,r){var o;let{target:l,corner:c}=a;const u=l.controls[c],d=((o=l.canvas)===null||o===void 0?void 0:o.getZoom())||1,g=l.padding/d,_=_C(l,new M(n,r),t,e);return _.x>=g&&(_.x-=g),_.x<=-g&&(_.x+=g),_.y>=g&&(_.y-=g),_.y<=g&&(_.y+=g),_.x-=u.offsetX,_.y-=u.offsetY,_}const xf=(a,t,e,n)=>{const{target:r,offsetX:o,offsetY:l}=t,c=e-o,u=n-l,d=!Ge(r,"lockMovementX")&&r.left!==c,g=!Ge(r,"lockMovementY")&&r.top!==u;return d&&r.set(dt,c),g&&r.set(ee,u),(d||g)&&mf("moving",vf(a,t,e,n)),d||g};class Cf{getSvgStyles(t){const e=this.fillRule?this.fillRule:"nonzero",n=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):pe,o=this.strokeDashOffset?this.strokeDashOffset:"0",l=this.strokeLineCap?this.strokeLineCap:"butt",c=this.strokeLineJoin?this.strokeLineJoin:"miter",u=this.strokeMiterLimit?this.strokeMiterLimit:"4",d=typeof this.opacity<"u"?this.opacity:"1",g=this.visible?"":" visibility: hidden;",_=t?"":this.getSvgFilter(),y=nr("fill",this.fill);return[nr("stroke",this.stroke),"stroke-width: ",n,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",l,"; ","stroke-dashoffset: ",o,"; ","stroke-linejoin: ",c,"; ","stroke-miterlimit: ",u,"; ",y,"fill-rule: ",e,"; ","opacity: ",d,";",_,g].join("")}getSvgSpanStyles(t,e){const n="; ",r=t.fontFamily?"font-family: ".concat(t.fontFamily.indexOf("'")===-1&&t.fontFamily.indexOf('"')===-1?"'".concat(t.fontFamily,"'"):t.fontFamily).concat(n):"",o=t.strokeWidth?"stroke-width: ".concat(t.strokeWidth).concat(n):"",l=t.fontSize?"font-size: ".concat(t.fontSize,"px").concat(n):"",c=t.fontStyle?"font-style: ".concat(t.fontStyle).concat(n):"",u=t.fontWeight?"font-weight: ".concat(t.fontWeight).concat(n):"",d=t.fill?nr("fill",t.fill):"",g=t.stroke?nr("stroke",t.stroke):"",_=this.getSvgTextDecoration(t),y=t.deltaY?"baseline-shift: ".concat(-t.deltaY,"; "):"";return[g,o,r,l,c,u,_&&"text-decoration: ".concat(_).concat(n),d,y,e?"white-space: pre; ":""].join("")}getSvgTextDecoration(t){return["overline","underline","line-through"].filter(e=>t[e.replace("-","")]).join(" ")}getSvgFilter(){return this.shadow?"filter: url(#SVGID_".concat(this.shadow.id,");"):""}getSvgCommons(){return[this.id?'id="'.concat(this.id,'" '):"",this.clipPath?'clip-path="url(#'.concat(this.clipPath.clipPathId,')" '):""].join("")}getSvgTransform(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const n=t?this.calcTransformMatrix():this.calcOwnMatrix(),r='transform="'.concat(fr(n));return"".concat(r).concat(e,'" ')}toSVG(t){return this._createBaseSVGMarkup(this._toSVG(t),{reviver:t})}toClipPathSVG(t){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(t),{reviver:t})}_createBaseClipPathSVGMarkup(t){let{reviver:e,additionalTransform:n=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=[this.getSvgTransform(!0,n),this.getSvgCommons()].join(""),o=t.indexOf("COMMON_PARTS");return t[o]=r,e?e(t.join("")):t.join("")}_createBaseSVGMarkup(t){let{noStyle:e,reviver:n,withShadow:r,additionalTransform:o}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const l=e?"":'style="'.concat(this.getSvgStyles(),'" '),c=r?'style="'.concat(this.getSvgFilter(),'" '):"",u=this.clipPath,d=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",g=u&&u.absolutePositioned,_=this.stroke,y=this.fill,x=this.shadow,S=[],E=t.indexOf("COMMON_PARTS");let P;u&&(u.clipPathId="CLIPPATH_".concat(Ln()),P='<clipPath id="'.concat(u.clipPathId,`" >
`).concat(u.toClipPathSVG(n),`</clipPath>
`)),g&&S.push("<g ",c,this.getSvgCommons(),` >
`),S.push("<g ",this.getSvgTransform(!1),g?"":c+this.getSvgCommons(),` >
`);const L=[l,d,e?"":this.addPaintOrder()," ",o?'transform="'.concat(o,'" '):""].join("");return t[E]=L,y&&y.toLive&&S.push(y.toSVG(this)),_&&_.toLive&&S.push(_.toSVG(this)),x&&S.push(x.toSVG(this)),u&&S.push(P),S.push(t.join("")),S.push(`</g>
`),g&&S.push(`</g>
`),n?n(S.join("")):S.join("")}addPaintOrder(){return this.paintFirst!=="fill"?' paint-order="'.concat(this.paintFirst,'" '):""}}const rl=(a,t,e,n)=>(a<Math.abs(t)?(a=t,n=e/4):t===0&&a===0?n=e/ti*Math.asin(1):n=e/ti*Math.asin(t/a),{a,c:t,p:e,s:n}),wf=(a,t,e,n,r)=>a*Math.pow(2,10*(n-=1))*Math.sin((n*r-t)*ti/e),Sf=(a,t,e,n)=>-e*Math.cos(a/n*mn)+e+t,vC=(a,t,e,n)=>e*(a/n)**3+t,yC=(a,t,e,n)=>e*((a/n-1)**3+1)+t,xC=(a,t,e,n)=>(a/=n/2,a<1?e/2*a**3+t:e/2*((a-2)**3+2)+t),CC=(a,t,e,n)=>e*(a/=n)*a**3+t,wC=(a,t,e,n)=>-e*((a=a/n-1)*a**3-1)+t,SC=(a,t,e,n)=>(a/=n/2,a<1?e/2*a**4+t:-e/2*((a-=2)*a**3-2)+t),bC=(a,t,e,n)=>e*(a/n)**5+t,TC=(a,t,e,n)=>e*((a/n-1)**5+1)+t,OC=(a,t,e,n)=>(a/=n/2,a<1?e/2*a**5+t:e/2*((a-2)**5+2)+t),DC=(a,t,e,n)=>-e*Math.cos(a/n*mn)+e+t,EC=(a,t,e,n)=>e*Math.sin(a/n*mn)+t,PC=(a,t,e,n)=>-e/2*(Math.cos(Math.PI*a/n)-1)+t,AC=(a,t,e,n)=>a===0?t:e*2**(10*(a/n-1))+t,MC=(a,t,e,n)=>a===n?t+e:e*-(2**(-10*a/n)+1)+t,kC=(a,t,e,n)=>a===0?t:a===n?t+e:(a/=n/2,a<1?e/2*2**(10*(a-1))+t:e/2*-(2**(-10*--a)+2)+t),LC=(a,t,e,n)=>-e*(Math.sqrt(1-(a/=n)*a)-1)+t,FC=(a,t,e,n)=>e*Math.sqrt(1-(a=a/n-1)*a)+t,RC=(a,t,e,n)=>(a/=n/2,a<1?-e/2*(Math.sqrt(1-a**2)-1)+t:e/2*(Math.sqrt(1-(a-=2)*a)+1)+t),IC=(a,t,e,n)=>{const o=e;let l=0;if(a===0)return t;if(a/=n,a===1)return t+e;l||(l=n*.3);const{a:c,s:u,p:d}=rl(o,e,l,1.70158);return-wf(c,u,d,a,n)+t},BC=(a,t,e,n)=>{const o=e;let l=0;if(a===0)return t;if(a/=n,a===1)return t+e;l||(l=n*.3);const{a:c,s:u,p:d,c:g}=rl(o,e,l,1.70158);return c*2**(-10*a)*Math.sin((a*n-u)*ti/d)+g+t},WC=(a,t,e,n)=>{const o=e;let l=0;if(a===0)return t;if(a/=n/2,a===2)return t+e;l||(l=n*(.3*1.5));const{a:c,s:u,p:d,c:g}=rl(o,e,l,1.70158);return a<1?-.5*wf(c,u,d,a,n)+t:c*Math.pow(2,-10*(a-=1))*Math.sin((a*n-u)*ti/d)*.5+g+t},jC=function(a,t,e,n){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1.70158;return e*(a/=n)*a*((r+1)*a-r)+t},XC=function(a,t,e,n){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1.70158;return e*((a=a/n-1)*a*((r+1)*a+r)+1)+t},YC=function(a,t,e,n){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1.70158;return a/=n/2,a<1?e/2*(a*a*(((r*=1.525)+1)*a-r))+t:e/2*((a-=2)*a*(((r*=1.525)+1)*a+r)+2)+t},sl=(a,t,e,n)=>(a/=n)<1/2.75?e*(7.5625*a*a)+t:a<2/2.75?e*(7.5625*(a-=1.5/2.75)*a+.75)+t:a<2.5/2.75?e*(7.5625*(a-=2.25/2.75)*a+.9375)+t:e*(7.5625*(a-=2.625/2.75)*a+.984375)+t,bf=(a,t,e,n)=>e-sl(n-a,0,e,n)+t,HC=(a,t,e,n)=>a<n/2?bf(a*2,0,e,n)*.5+t:sl(a*2-n,0,e,n)*.5+e*.5+t,zC=(a,t,e,n)=>e*(a/=n)*a+t,GC=(a,t,e,n)=>-e*(a/=n)*(a-2)+t,UC=(a,t,e,n)=>(a/=n/2,a<1?e/2*a**2+t:-e/2*(--a*(a-2)-1)+t);var VC=Object.freeze({__proto__:null,defaultEasing:Sf,easeInBack:jC,easeInBounce:bf,easeInCirc:LC,easeInCubic:vC,easeInElastic:IC,easeInExpo:AC,easeInOutBack:YC,easeInOutBounce:HC,easeInOutCirc:RC,easeInOutCubic:xC,easeInOutElastic:WC,easeInOutExpo:kC,easeInOutQuad:UC,easeInOutQuart:SC,easeInOutQuint:OC,easeInOutSine:PC,easeInQuad:zC,easeInQuart:CC,easeInQuint:bC,easeInSine:DC,easeOutBack:XC,easeOutBounce:sl,easeOutCirc:FC,easeOutCubic:yC,easeOutElastic:BC,easeOutExpo:MC,easeOutQuad:GC,easeOutQuart:wC,easeOutQuint:TC,easeOutSine:EC});const NC=()=>!1;class ol{constructor(t){let{startValue:e,byValue:n,duration:r=500,delay:o=0,easing:l=Sf,onStart:c=Qn,onChange:u=Qn,onComplete:d=Qn,abort:g=NC,target:_}=t;D(this,"_state","pending"),D(this,"durationProgress",0),D(this,"valueProgress",0),this.tick=this.tick.bind(this),this.duration=r,this.delay=o,this.easing=l,this._onStart=c,this._onChange=u,this._onComplete=d,this._abort=g,this.target=_,this.startValue=e,this.byValue=n,this.value=this.startValue,this.endValue=Object.freeze(this.calculate(this.duration).value)}get state(){return this._state}isDone(){return this._state==="aborted"||this._state==="completed"}start(){const t=e=>{this._state==="pending"&&(this.startTime=e||+new Date,this._state="running",this._onStart(),this.tick(this.startTime))};this.register(),this.delay>0?setTimeout(()=>ar(t),this.delay):ar(t)}tick(t){const e=(t||+new Date)-this.startTime,n=Math.min(e,this.duration);this.durationProgress=n/this.duration;const{value:r,valueProgress:o}=this.calculate(n);this.value=Object.freeze(r),this.valueProgress=o,this._state!=="aborted"&&(this._abort(this.value,this.valueProgress,this.durationProgress)?(this._state="aborted",this.unregister()):e>=this.duration?(this.durationProgress=this.valueProgress=1,this._onChange(this.endValue,this.valueProgress,this.durationProgress),this._state="completed",this._onComplete(this.endValue,this.valueProgress,this.durationProgress),this.unregister()):(this._onChange(this.value,this.valueProgress,this.durationProgress),ar(this.tick)))}register(){Aa.push(this)}unregister(){Aa.remove(this)}abort(){this._state="aborted",this.unregister()}}const KC=["startValue","endValue"];class qC extends ol{constructor(t){let{startValue:e=0,endValue:n=100}=t,r=At(t,KC);super(T(T({},r),{},{startValue:e,byValue:n-e}))}calculate(t){const e=this.easing(t,this.startValue,this.byValue,this.duration);return{value:e,valueProgress:Math.abs((e-this.startValue)/this.byValue)}}}const $C=["startValue","endValue"];class JC extends ol{constructor(t){let{startValue:e=[0],endValue:n=[100]}=t,r=At(t,$C);super(T(T({},r),{},{startValue:e,byValue:n.map((o,l)=>o-e[l])}))}calculate(t){const e=this.startValue.map((n,r)=>this.easing(t,n,this.byValue[r],this.duration,r));return{value:e,valueProgress:Math.abs((e[0]-this.startValue[0])/this.byValue[0])}}}const ei=(a,t,e)=>Math.max(a,Math.min(t,e)),ZC=["startValue","endValue","easing","onChange","onComplete","abort"],QC=(a,t,e,n)=>{const r=1-Math.cos(a/n*mn);return t+e*r},pa=a=>a&&((t,e,n)=>a(new wt(t).toRgba(),e,n));class tw extends ol{constructor(t){let{startValue:e,endValue:n,easing:r=QC,onChange:o,onComplete:l,abort:c}=t,u=At(t,ZC);const d=new wt(e).getSource(),g=new wt(n).getSource();super(T(T({},u),{},{startValue:d,byValue:g.map((_,y)=>_-d[y]),easing:r,onChange:pa(o),onComplete:pa(l),abort:pa(c)}))}calculate(t){const[e,n,r,o]=this.startValue.map((c,u)=>this.easing(t,c,this.byValue[u],this.duration,u)),l=[...[e,n,r].map(Math.round),ei(0,o,1)];return{value:l,valueProgress:l.map((c,u)=>this.byValue[u]!==0?Math.abs((c-this.startValue[u])/this.byValue[u]):0).find(c=>c!==0)||0}}}const ew=a=>Array.isArray(a.startValue)||Array.isArray(a.endValue);function al(a){const t=ew(a)?new JC(a):new qC(a);return t.start(),t}function Tf(a){const t=new tw(a);return t.start(),t}const nw=new M(1,0),ll=(a,t)=>a.rotate(t),ni=(a,t)=>new M(t).subtract(a),Of=a=>a.distanceFrom(new M),Ls=(a,t)=>{const e=a.x*t.x+a.y*t.y,n=a.x*t.y-a.y*t.x;return Math.atan2(n,e)},iw=a=>Ls(nw,a),Fs=a=>a.scalarDivide(Of(a)),Fa=(a,t,e)=>{const n=ni(a,t),r=ni(a,e),o=Ls(n,r);return{vector:Fs(ll(n,o/2)),angle:o}},Df=function(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return Fs(new M(-a.y,a.x).scalarMultiply(t?1:-1))};class Ht{constructor(t){this.status=t,this.points=[]}includes(t){return this.points.some(e=>e.eq(t))}append(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return this.points=this.points.concat(e.filter(r=>!this.includes(r))),this}static isPointContained(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(e.eq(n))return t.eq(e);if(e.x===n.x)return t.x===e.x&&(r||t.y>=Math.min(e.y,n.y)&&t.y<=Math.max(e.y,n.y));if(e.y===n.y)return t.y===e.y&&(r||t.x>=Math.min(e.x,n.x)&&t.x<=Math.max(e.x,n.x));{const o=ni(e,n),c=ni(e,t).divide(o);return r?Math.abs(c.x)===Math.abs(c.y):c.x===c.y&&c.x>=0&&c.x<=1}}static intersectLineLine(t,e,n,r){let o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,l=arguments.length>5&&arguments[5]!==void 0?arguments[5]:!0;const c=e.x-t.x,u=e.y-t.y,d=r.x-n.x,g=r.y-n.y,_=t.x-n.x,y=t.y-n.y,x=d*y-g*_,S=c*y-u*_,E=g*c-d*u;if(E!==0){const P=x/E,L=S/E;return(o||0<=P&&P<=1)&&(l||0<=L&&L<=1)?new Ht("Intersection").append(new M(t.x+P*c,t.y+P*u)):new Ht}else if(x===0||S===0){const P=o||l||Ht.isPointContained(t,n,r)||Ht.isPointContained(e,n,r)||Ht.isPointContained(n,t,e)||Ht.isPointContained(r,t,e);return new Ht(P?"Coincident":void 0)}else return new Ht("Parallel")}static intersectSegmentLine(t,e,n,r){return Ht.intersectLineLine(t,e,n,r,!1,!0)}static intersectSegmentSegment(t,e,n,r){return Ht.intersectLineLine(t,e,n,r,!1,!1)}static intersectLinePolygon(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;const o=new Ht,l=n.length;for(let c=0,u,d,g;c<l;c++){if(u=n[c],d=n[(c+1)%l],g=Ht.intersectLineLine(t,e,u,d,r,!1),g.status==="Coincident")return g;o.append(...g.points)}return o.points.length>0&&(o.status="Intersection"),o}static intersectSegmentPolygon(t,e,n){return Ht.intersectLinePolygon(t,e,n,!1)}static intersectPolygonPolygon(t,e){const n=new Ht,r=t.length,o=[];for(let l=0;l<r;l++){const c=t[l],u=t[(l+1)%r],d=Ht.intersectSegmentPolygon(c,u,e);d.status==="Coincident"?(o.push(d),n.append(c,u)):n.append(...d.points)}return o.length>0&&o.length===t.length?new Ht("Coincident"):(n.points.length>0&&(n.status="Intersection"),n)}static intersectPolygonRectangle(t,e,n){const r=e.min(n),o=e.max(n),l=new M(o.x,r.y),c=new M(r.x,o.y);return Ht.intersectPolygonPolygon(t,[r,l,o,c])}}class rw extends ef{_getTransformedDimensions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=T({scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,width:this.width,height:this.height,strokeWidth:this.strokeWidth},t),n=e.strokeWidth;let r=n,o=0;this.strokeUniform&&(r=0,o=n);const l=e.width+r,c=e.height+r,u=e.skewX===0&&e.skewY===0;let d;return u?d=new M(l*e.scaleX,c*e.scaleY):d=tl(l,c,e),d.scalarAdd(o)}translateToGivenOrigin(t,e,n,r,o){let l=t.x,c=t.y;const u=Mn(r)-Mn(e),d=Mn(o)-Mn(n);if(u||d){const g=this._getTransformedDimensions();l+=u*g.x,c+=d*g.y}return new M(l,c)}translateToCenterPoint(t,e,n){const r=this.translateToGivenOrigin(t,e,n,et,et);return this.angle?r.rotate(Ot(this.angle),t):r}translateToOriginPoint(t,e,n){const r=this.translateToGivenOrigin(t,et,et,e,n);return this.angle?r.rotate(Ot(this.angle),t):r}getCenterPoint(){const t=this.getRelativeCenterPoint();return this.group?Bt(t,this.group.calcTransformMatrix()):t}getRelativeCenterPoint(){return this.translateToCenterPoint(new M(this.left,this.top),this.originX,this.originY)}getPointByOrigin(t,e){return this.translateToOriginPoint(this.getRelativeCenterPoint(),t,e)}setPositionByOrigin(t,e,n){const r=this.translateToCenterPoint(t,e,n),o=this.translateToOriginPoint(r,this.originX,this.originY);this.set({left:o.x,top:o.y})}_setOriginToCenter(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;const t=this.getRelativeCenterPoint();this.originX=et,this.originY=et,this.left=t.x,this.top=t.y}_resetOrigin(){if(this._originalOriginX!==void 0&&this._originalOriginY!==void 0){const t=this.translateToOriginPoint(this.getRelativeCenterPoint(),this._originalOriginX,this._originalOriginY);this.left=t.x,this.top=t.y,this.originX=this._originalOriginX,this.originY=this._originalOriginY,this._originalOriginX=void 0,this._originalOriginY=void 0}}_getLeftTopCoords(){return this.translateToOriginPoint(this.getRelativeCenterPoint(),dt,ee)}}class sw extends rw{getX(){return this.getXY().x}setX(t){this.setXY(this.getXY().setX(t))}getY(){return this.getXY().y}setY(t){this.setXY(this.getXY().setY(t))}getRelativeX(){return this.left}setRelativeX(t){this.left=t}getRelativeY(){return this.top}setRelativeY(t){this.top=t}getXY(){const t=this.getRelativeXY();return this.group?Bt(t,this.group.calcTransformMatrix()):t}setXY(t,e,n){this.group&&(t=Bt(t,Nt(this.group.calcTransformMatrix()))),this.setRelativeXY(t,e,n)}getRelativeXY(){return new M(this.left,this.top)}setRelativeXY(t,e,n){this.setPositionByOrigin(t,e||this.originX,n||this.originY)}_getCoords(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1)?t?this.calcACoords():this.calcLineCoords():(this.aCoords||(this.aCoords=this.calcACoords()),this.lineCoords||(this.lineCoords=this.calcLineCoords()),t?this.aCoords:this.lineCoords)}getCoords(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const{tl:n,tr:r,br:o,bl:l}=this._getCoords(t,e),c=[n,r,o,l];if(this.group){const u=this.group.calcTransformMatrix();return c.map(d=>Bt(d,u))}return c}intersectsWithRect(t,e,n,r){const o=this.getCoords(n,r);return Ht.intersectPolygonRectangle(o,t,e).status==="Intersection"}intersectsWithObject(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const r=Ht.intersectPolygonPolygon(this.getCoords(e,n),t.getCoords(e,n));return r.status==="Intersection"||r.status==="Coincident"||t.isContainedWithinObject(this,e,n)||this.isContainedWithinObject(t,e,n)}isContainedWithinObject(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const r=this.getCoords(e,n),o=e?t.aCoords:t.lineCoords,l=t._getImageLines(o);for(let c=0;c<4;c++)if(!t.containsPoint(r[c],l))return!1;return!0}isContainedWithinRect(t,e,n,r){const o=this.getBoundingRect(n,r);return o.left>=t.x&&o.left+o.width<=e.x&&o.top>=t.y&&o.top+o.height<=e.y}isOverlapping(t){return this.intersectsWithObject(t)||this.isContainedWithinObject(t)||t.isContainedWithinObject(this)}containsPoint(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const o=this._getCoords(n,r),l=e||this._getImageLines(o),c=this._findCrossPoints(t,l);return c!==0&&c%2===1}isOnScreen(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(!this.canvas)return!1;const{tl:e,br:n}=this.canvas.vptCoords;return this.getCoords(!0,t).some(o=>o.x<=n.x&&o.x>=e.x&&o.y<=n.y&&o.y>=e.y)||this.intersectsWithRect(e,n,!0,t)?!0:this._containsCenterOfCanvas(e,n,t)}_containsCenterOfCanvas(t,e,n){const r=t.midPointFrom(e);return this.containsPoint(r,void 0,!0,n)}isPartiallyOnScreen(t){if(!this.canvas)return!1;const{tl:e,br:n}=this.canvas.vptCoords;return this.intersectsWithRect(e,n,!0,t)?!0:this.getCoords(!0,t).every(o=>(o.x>=n.x||o.x<=e.x)&&(o.y>=n.y||o.y<=e.y))&&this._containsCenterOfCanvas(e,n,t)}_getImageLines(t){let{tl:e,tr:n,bl:r,br:o}=t;return{topline:{o:e,d:n},rightline:{o:n,d:o},bottomline:{o,d:r},leftline:{o:r,d:e}}}_findCrossPoints(t,e){let n=0;for(const r in e){let o;const l=e[r];if(!(l.o.y<t.y&&l.d.y<t.y)&&!(l.o.y>=t.y&&l.d.y>=t.y)){if(l.o.x===l.d.x&&l.o.x>=t.x)o=l.o.x;else{const u=(l.d.y-l.o.y)/(l.d.x-l.o.x),d=t.y-0*t.x,g=l.o.y-u*l.o.x;o=-(d-g)/(0-u)}if(o>=t.x&&(n+=1),n===2)break}}return n}getBoundingRect(t,e){return pn(this.getCoords(t,e))}getScaledWidth(){return this._getTransformedDimensions().x}getScaledHeight(){return this._getTransformedDimensions().y}scale(t){this._set("scaleX",t),this._set("scaleY",t),this.setCoords()}scaleToWidth(t,e){const n=this.getBoundingRect(e).width/this.getScaledWidth();return this.scale(t/this.width/n)}scaleToHeight(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const n=this.getBoundingRect(e).height/this.getScaledHeight();return this.scale(t/this.height/n)}getCanvasRetinaScaling(){var t;return((t=this.canvas)===null||t===void 0?void 0:t.getRetinaScaling())||1}getTotalAngle(){return this.group?Fn(this.calcTransformMatrix()).angle:this.angle}calcLineCoords(){const t=this.getViewportTransform(),e=this.padding,n=Ot(this.getTotalAngle()),r=ae(n)*e,o=le(n)*e,l=r+o,c=r-o,{tl:u,tr:d,bl:g,br:_}=this.calcACoords(),y={tl:Bt(u,t),tr:Bt(d,t),bl:Bt(g,t),br:Bt(_,t)};return e&&(y.tl.x-=c,y.tl.y-=l,y.tr.x+=l,y.tr.y-=c,y.bl.x-=l,y.bl.y+=c,y.br.x+=c,y.br.y+=l),y}getViewportTransform(){var t;return((t=this.canvas)===null||t===void 0?void 0:t.viewportTransform)||be.concat()}calcACoords(){const t=mr({angle:this.angle}),{x:e,y:n}=this.getRelativeCenterPoint(),r=pr(e,n),o=Kt(r,t),l=this._getTransformedDimensions(),c=l.x/2,u=l.y/2;return{tl:Bt({x:-c,y:-u},o),tr:Bt({x:c,y:-u},o),bl:Bt({x:-c,y:u},o),br:Bt({x:c,y:u},o)}}setCoords(){this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords()}transformMatrixKey(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;const e="_";let n="";return!t&&this.group&&(n=this.group.transformMatrixKey(t)+e),n+this.top+e+this.left+e+this.scaleX+e+this.scaleY+e+this.skewX+e+this.skewY+e+this.angle+e+this.originX+e+this.originY+e+this.width+e+this.height+e+this.strokeWidth+this.flipX+this.flipY}calcTransformMatrix(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=this.calcOwnMatrix();if(t||!this.group)return e;const n=this.transformMatrixKey(t),r=this.matrixCache;return r&&r.key===n?r.value:(this.group&&(e=Kt(this.group.calcTransformMatrix(!1),e)),this.matrixCache={key:n,value:e},e)}calcOwnMatrix(){const t=this.transformMatrixKey(!0),e=this.ownMatrixCache;if(e&&e.key===t)return e.value;const n=this.getRelativeCenterPoint(),r={angle:this.angle,translateX:n.x,translateY:n.y,scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY},o=of(r);return this.ownMatrixCache={key:t,value:o},o}_getNonTransformedDimensions(){return new M(this.width,this.height).scalarAdd(this.strokeWidth)}_calculateCurrentDimensions(t){return this._getTransformedDimensions(t).transform(this.getViewportTransform(),!0).scalarAdd(2*this.padding)}}class hl extends sw{getParent(t){return(oC(this.group)?this.__owningGroup:this.group)||(t?void 0:this.canvas)}isDescendantOf(t){return this.__owningGroup===t||this.group===t||this.canvas===t||!!this.__owningGroup&&this.__owningGroup.isDescendantOf(t)||!!this.group&&this.group.isDescendantOf(t)}getAncestors(t){const e=[];let n=this;do n=n instanceof hl?n.getParent(t):void 0,n&&e.push(n);while(n);return e}findCommonAncestors(t,e){if(this===t)return{fork:[],otherFork:[],common:[this,...this.getAncestors(e)]};const n=this.getAncestors(e),r=t.getAncestors(e);if(n.length===0&&r.length>0&&this===r[r.length-1])return{fork:[],otherFork:[t,...r.slice(0,r.length-1)],common:[this]};for(let o=0,l;o<n.length;o++){if(l=n[o],l===t)return{fork:[this,...n.slice(0,o)],otherFork:[],common:n.slice(o)};for(let c=0;c<r.length;c++){if(this===r[c])return{fork:[],otherFork:[t,...r.slice(0,c)],common:[this,...n]};if(l===r[c])return{fork:[this,...n.slice(0,o)],otherFork:[t,...r.slice(0,c)],common:n.slice(o)}}}return{fork:[this,...n],otherFork:[t,...r],common:[]}}hasCommonAncestors(t,e){const n=this.findCommonAncestors(t,e);return n&&!!n.common.length}isInFrontOf(t){if(this===t)return;const e=this.findCommonAncestors(t);if(!e)return;if(e.fork.includes(t))return!0;if(e.otherFork.includes(this))return!1;const n=e.common[0];if(!n)return;const r=e.fork.pop(),o=e.otherFork.pop(),l=n._objects.indexOf(r),c=n._objects.indexOf(o);return l>-1&&l>c}}class ow extends hl{animate(t,e){return Object.entries(t).reduce((n,r)=>{let[o,l]=r;return n[o]=this._animate(o,l,e),n},{})}_animate(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=t.split("."),o=this.colorProperties.includes(r[r.length-1]),{easing:l,duration:c,abort:u,startValue:d,onChange:g,onComplete:_}=n,y={target:this,startValue:d!=null?d:r.reduce((x,S)=>x[S],this),endValue:e,easing:l,duration:c,abort:u==null?void 0:u.bind(this),onChange:(x,S,E)=>{r.reduce((P,L,W)=>(W===r.length-1&&(P[L]=x),P[L]),this),g&&g(x,S,E)},onComplete:(x,S,E)=>{this.setCoords(),_&&_(x,S,E)}};return o?Tf(y):al(y)}}const aw={color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1};class gn{constructor(t){const e=typeof t=="string"?gn.parseShadow(t):t;Object.assign(this,this.constructor.ownDefaults);for(const n in e)this[n]=e[n];this.id=Ln()}static parseShadow(t){const e=t.trim(),[n,r=0,o=0,l=0]=(gn.reOffsetsAndBlur.exec(e)||[]).map(u=>parseFloat(u)||0);return{color:(e.replace(gn.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:r,offsetY:o,blur:l}}toString(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")}toSVG(t){const e=ll(new M(this.offsetX,this.offsetY),Ot(-t.angle)),n=20,r=new wt(this.color);let o=40,l=40;return t.width&&t.height&&(o=ut((Math.abs(e.x)+this.blur)/t.width,at.NUM_FRACTION_DIGITS)*100+n,l=ut((Math.abs(e.y)+this.blur)/t.height,at.NUM_FRACTION_DIGITS)*100+n),t.flipX&&(e.x*=-1),t.flipY&&(e.y*=-1),'<filter id="SVGID_'.concat(this.id,'" y="-').concat(l,'%" height="').concat(100+2*l,'%" x="-').concat(o,'%" width="').concat(100+2*o,`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`).concat(ut(this.blur?this.blur/2:0,at.NUM_FRACTION_DIGITS),`"></feGaussianBlur>
	<feOffset dx="`).concat(ut(e.x,at.NUM_FRACTION_DIGITS),'" dy="').concat(ut(e.y,at.NUM_FRACTION_DIGITS),`" result="oBlur" ></feOffset>
	<feFlood flood-color="`).concat(r.toRgb(),'" flood-opacity="').concat(r.getAlpha(),`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`)}toObject(){const t={color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling},e=gn.ownDefaults;return this.includeDefaultValues?t:af(t,(n,r)=>n!==e[r])}}D(gn,"ownDefaults",aw);D(gn,"reOffsetsAndBlur",/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/);const ki=a=>JSON.parse(JSON.stringify(a)),lw=[ee,dt,"scaleX","scaleY","flipX","flipY","originX","originY","angle","opacity","globalCompositeOperation","shadow","visible","skewX","skewY"],_n=["fill","stroke","strokeWidth","strokeDashArray","width","height","paintFirst","strokeUniform","strokeLineCap","strokeDashOffset","strokeLineJoin","strokeMiterLimit","backgroundColor","clipPath"],hw={originX:dt,originY:ee,top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:"",cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!0,noScaleCache:!0,strokeUniform:!1,dirty:!0,paintFirst:"fill",activeOn:"down",colorProperties:["fill","stroke","backgroundColor"],clipPath:void 0,inverted:!1,absolutePositioned:!1,FX_DURATION:500},cw=["extraParam"];let Rn=class Ef extends ow{static getDefaults(){return T({},Ef.ownDefaults)}get type(){const t=this.constructor.type;return t==="FabricObject"?"object":t.toLowerCase()}set type(t){console.warn("Setting type has no effect",t)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};super(),D(this,"_cacheContext",null),Object.assign(this,this.constructor.getDefaults()),this.setOptions(t)}_createCacheCanvas(){this._cacheCanvas=Wt(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0}_limitCacheSize(t){const e=t.width,n=t.height,r=at.maxCacheSideLimit,o=at.minCacheSideLimit;if(e<=r&&n<=r&&e*n<=at.perfLimitSizeTotal)return e<o&&(t.width=o),n<o&&(t.height=o),t;const l=e/n,[c,u]=or.limitDimsByArea(l),d=ei(o,c,r),g=ei(o,u,r);return e>d&&(t.zoomX/=e/d,t.width=d,t.capped=!0),n>g&&(t.zoomY/=n/g,t.height=g,t.capped=!0),t}_getCacheCanvasDimensions(){const t=this.getTotalObjectScaling(),e=this._getTransformedDimensions({skewX:0,skewY:0}),n=e.x*t.x/this.scaleX,r=e.y*t.y/this.scaleY;return{width:n+pu,height:r+pu,zoomX:t.x,zoomY:t.y,x:n,y:r}}_updateCacheCanvas(){const t=this._cacheCanvas,e=this._cacheContext,n=this._limitCacheSize(this._getCacheCanvasDimensions()),r=at.minCacheSideLimit,o=n.width,l=n.height,c=n.zoomX,u=n.zoomY,d=o!==this.cacheWidth||l!==this.cacheHeight,g=this.zoomX!==c||this.zoomY!==u;if(!t||!e)return!1;let _,y,x=d||g,S=0,E=0,P=!1;if(d){const L=this._cacheCanvas.width,W=this._cacheCanvas.height,Y=o>L||l>W,H=(o<L*.9||l<W*.9)&&L>r&&W>r;P=Y||H,Y&&!n.capped&&(o>r||l>r)&&(S=o*.1,E=l*.1)}return hf(this)&&this.path&&(x=!0,P=!0,S+=this.getHeightOfLine(0)*this.zoomX,E+=this.getHeightOfLine(0)*this.zoomY),x?(P?(t.width=Math.ceil(o+S),t.height=Math.ceil(l+E)):(e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height)),_=n.x/2,y=n.y/2,this.cacheTranslationX=Math.round(t.width/2-_)+_,this.cacheTranslationY=Math.round(t.height/2-y)+y,this.cacheWidth=o,this.cacheHeight=l,e.translate(this.cacheTranslationX,this.cacheTranslationY),e.scale(c,u),this.zoomX=c,this.zoomY=u,!0):!1}setOptions(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setOptions(t)}transform(t){const e=this.group&&!this.group._transformDone||this.group&&this.canvas&&t===this.canvas.contextTop,n=this.calcTransformMatrix(!e);t.transform(n[0],n[1],n[2],n[3],n[4],n[5])}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=at.NUM_FRACTION_DIGITS,n=this.clipPath&&!this.clipPath.excludeFromExport?T(T({},this.clipPath.toObject(t)),{},{inverted:this.clipPath.inverted,absolutePositioned:this.clipPath.absolutePositioned}):null,r=T(T({},ii(this,t)),{},{type:this.constructor.type,version:Ea,originX:this.originX,originY:this.originY,left:ut(this.left,e),top:ut(this.top,e),width:ut(this.width,e),height:ut(this.height,e),fill:Cu(this.fill)?this.fill.toObject():this.fill,stroke:Cu(this.stroke)?this.stroke.toObject():this.stroke,strokeWidth:ut(this.strokeWidth,e),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:ut(this.strokeMiterLimit,e),scaleX:ut(this.scaleX,e),scaleY:ut(this.scaleY,e),angle:ut(this.angle,e),flipX:this.flipX,flipY:this.flipY,opacity:ut(this.opacity,e),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:ut(this.skewX,e),skewY:ut(this.skewY,e)},n?{clipPath:n}:null);return this.includeDefaultValues?r:this._removeDefaultValues(r)}toDatalessObject(t){return this.toObject(t)}_removeDefaultValues(t){const e=this.constructor.getDefaults(),r=Object.keys(e).length>0?e:Object.getPrototypeOf(this);return af(t,(o,l)=>{if(l===dt||l===ee||l==="type")return!0;const c=r[l];return o!==c&&!(Array.isArray(o)&&Array.isArray(c)&&o.length===0&&c.length===0)})}toString(){return"#<".concat(this.constructor.type,">")}getObjectScaling(){if(!this.group)return new M(Math.abs(this.scaleX),Math.abs(this.scaleY));const t=Fn(this.calcTransformMatrix());return new M(Math.abs(t.scaleX),Math.abs(t.scaleY))}getTotalObjectScaling(){const t=this.getObjectScaling();if(this.canvas){const e=this.canvas.getZoom(),n=this.getCanvasRetinaScaling();return t.scalarMultiply(e*n)}return t}getObjectOpacity(){let t=this.opacity;return this.group&&(t*=this.group.getObjectOpacity()),t}_constrainScale(t){return Math.abs(t)<this.minScaleLimit?t<0?-this.minScaleLimit:this.minScaleLimit:t===0?1e-4:t}_set(t,e){const n=this[t]!==e;if((t==="scaleX"||t==="scaleY")&&(e=this._constrainScale(e)),t==="scaleX"&&e<0?(this.flipX=!this.flipX,e*=-1):t==="scaleY"&&e<0?(this.flipY=!this.flipY,e*=-1):t==="shadow"&&e&&!(e instanceof gn)?e=new gn(e):t==="dirty"&&this.group&&this.group.set("dirty",e),this[t]=e,n){const r=this.group&&this.group.isOnACache();this.constructor.cacheProperties.includes(t)?(this.dirty=!0,r&&this.group.set("dirty",!0)):r&&this.constructor.stateProperties.includes(t)&&this.group.set("dirty",!0)}return this}isNotVisible(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible}render(t){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(t.save(),this._setupCompositeOperation(t),this.drawSelectionBackground(t),this.transform(t),this._setOpacity(t),this._setShadow(t),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(t)):(this._removeCacheCanvas(),this.drawObject(t),this.dirty=!1),t.restore())}drawSelectionBackground(t){}renderCache(t){t=t||{},(!this._cacheCanvas||!this._cacheContext)&&this._createCacheCanvas(),this.isCacheDirty()&&this._cacheContext&&(this.drawObject(this._cacheContext,t.forClipping),this.dirty=!1)}_removeCacheCanvas(){this._cacheCanvas=void 0,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0}hasStroke(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0}hasFill(){return this.fill&&this.fill!=="transparent"}needsItsOwnCache(){return!!(this.paintFirst==="stroke"&&this.hasFill()&&this.hasStroke()&&typeof this.shadow=="object"||this.clipPath)}shouldCache(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching}willDrawShadow(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)}drawClipPathOnCache(t,e){if(t.save(),e.inverted?t.globalCompositeOperation="destination-out":t.globalCompositeOperation="destination-in",e.absolutePositioned){const n=Nt(this.calcTransformMatrix());t.transform(n[0],n[1],n[2],n[3],n[4],n[5])}e.transform(t),t.scale(1/e.zoomX,1/e.zoomY),t.drawImage(e._cacheCanvas,-e.cacheTranslationX,-e.cacheTranslationY),t.restore()}drawObject(t,e){const n=this.fill,r=this.stroke;e?(this.fill="black",this.stroke="",this._setClippingProperties(t)):this._renderBackground(t),this._render(t),this._drawClipPath(t,this.clipPath),this.fill=n,this.stroke=r}_drawClipPath(t,e){e&&(e._set("canvas",this.canvas),e.shouldCache(),e._transformDone=!0,e.renderCache({forClipping:!0}),this.drawClipPathOnCache(t,e))}drawCacheOnCanvas(t){t.scale(1/this.zoomX,1/this.zoomY),t.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)}isCacheDirty(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!t&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned){if(this._cacheCanvas&&this._cacheContext&&!t){const e=this.cacheWidth/this.zoomX,n=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-e/2,-n/2,e,n)}return!0}return!1}_renderBackground(t){if(!this.backgroundColor)return;const e=this._getNonTransformedDimensions();t.fillStyle=this.backgroundColor,t.fillRect(-e.x/2,-e.y/2,e.x,e.y),this._removeShadow(t)}_setOpacity(t){this.group&&!this.group._transformDone?t.globalAlpha=this.getObjectOpacity():t.globalAlpha*=this.opacity}_setStrokeStyles(t,e){const n=e.stroke;n&&(t.lineWidth=e.strokeWidth,t.lineCap=e.strokeLineCap,t.lineDashOffset=e.strokeDashOffset,t.lineJoin=e.strokeLineJoin,t.miterLimit=e.strokeMiterLimit,dn(n)?n.gradientUnits==="percentage"||n.gradientTransform||n.patternTransform?this._applyPatternForTransformedGradient(t,n):(t.strokeStyle=n.toLive(t),this._applyPatternGradientTransform(t,n)):t.strokeStyle=e.stroke)}_setFillStyles(t,e){let{fill:n}=e;n&&(dn(n)?(t.fillStyle=n.toLive(t),this._applyPatternGradientTransform(t,n)):t.fillStyle=n)}_setClippingProperties(t){t.globalAlpha=1,t.strokeStyle="transparent",t.fillStyle="#000000"}_setLineDash(t,e){!e||e.length===0||(1&e.length&&e.push(...e),t.setLineDash(e))}_setShadow(t){if(!this.shadow)return;const e=this.shadow,n=this.canvas,r=this.getCanvasRetinaScaling(),[o,,,l]=(n==null?void 0:n.viewportTransform)||be,c=o*r,u=l*r,d=e.nonScaling?new M(1,1):this.getObjectScaling();t.shadowColor=e.color,t.shadowBlur=e.blur*at.browserShadowBlurConstant*(c+u)*(d.x+d.y)/4,t.shadowOffsetX=e.offsetX*c*d.x,t.shadowOffsetY=e.offsetY*u*d.y}_removeShadow(t){this.shadow&&(t.shadowColor="",t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0)}_applyPatternGradientTransform(t,e){if(!dn(e))return{offsetX:0,offsetY:0};const n=e.gradientTransform||e.patternTransform,r=-this.width/2+e.offsetX||0,o=-this.height/2+e.offsetY||0;return e.gradientUnits==="percentage"?t.transform(this.width,0,0,this.height,r,o):t.transform(1,0,0,1,r,o),n&&t.transform(n[0],n[1],n[2],n[3],n[4],n[5]),{offsetX:r,offsetY:o}}_renderPaintInOrder(t){this.paintFirst==="stroke"?(this._renderStroke(t),this._renderFill(t)):(this._renderFill(t),this._renderStroke(t))}_render(t){}_renderFill(t){this.fill&&(t.save(),this._setFillStyles(t,this),this.fillRule==="evenodd"?t.fill("evenodd"):t.fill(),t.restore())}_renderStroke(t){if(!(!this.stroke||this.strokeWidth===0)){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this.strokeUniform){const e=this.getObjectScaling();t.scale(1/e.x,1/e.y)}this._setLineDash(t,this.strokeDashArray),this._setStrokeStyles(t,this),t.stroke(),t.restore()}}_applyPatternForTransformedGradient(t,e){var n;const r=this._limitCacheSize(this._getCacheCanvasDimensions()),o=Wt(),l=this.getCanvasRetinaScaling(),c=r.x/this.scaleX/l,u=r.y/this.scaleY/l;o.width=Math.ceil(c),o.height=Math.ceil(u);const d=o.getContext("2d");d&&(d.beginPath(),d.moveTo(0,0),d.lineTo(c,0),d.lineTo(c,u),d.lineTo(0,u),d.closePath(),d.translate(c/2,u/2),d.scale(r.zoomX/this.scaleX/l,r.zoomY/this.scaleY/l),this._applyPatternGradientTransform(d,e),d.fillStyle=e.toLive(t),d.fill(),t.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),t.scale(l*this.scaleX/r.zoomX,l*this.scaleY/r.zoomY),t.strokeStyle=(n=d.createPattern(o,"no-repeat"))!==null&&n!==void 0?n:"")}_findCenterFromElement(){return new M(this.left+this.width/2,this.top+this.height/2)}clone(t){const e=this.toObject(t);return this.constructor.fromObject(e)}cloneAsImage(t){const e=this.toCanvasElement(t),n=q.getClass("image");return new n(e)}toCanvasElement(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=Qa(this),n=this.group,r=this.shadow,o=Math.abs,l=t.enableRetinaScaling?Math.max(at.devicePixelRatio,1):1,c=(t.multiplier||1)*l;delete this.group,t.withoutTransform&&Za(this),t.withoutShadow&&(this.shadow=null),t.viewportTransform&&il(this,this.getViewportTransform());const u=Wt(),d=this.getBoundingRect(!0,!0),g=this.shadow,_=new M;if(g){const L=g.blur,W=g.nonScaling?new M(1,1):this.getObjectScaling();_.x=2*Math.round(o(g.offsetX)+L)*o(W.x),_.y=2*Math.round(o(g.offsetY)+L)*o(W.y)}const y=d.width+_.x,x=d.height+_.y;u.width=Math.ceil(y),u.height=Math.ceil(x);const S=new vr(u,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});t.format==="jpeg"&&(S.backgroundColor="#fff"),this.setPositionByOrigin(new M(S.width/2,S.height/2),et,et);const E=this.canvas;S._objects=[this],this.set("canvas",S),this.setCoords();const P=S.toCanvasElement(c||1,t);return this.set("canvas",E),this.shadow=r,n&&(this.group=n),this.set(e),this.setCoords(),S._objects=[],S.destroy(),P}toDataURL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Na(this.toCanvasElement(t),t.format||"png",t.quality||1)}isType(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.includes(this.constructor.type)||e.includes(this.type)}complexity(){return 1}toJSON(){return this.toObject()}rotate(t){const e=(this.originX!==et||this.originY!==et)&&this.centeredRotation;e&&this._setOriginToCenter(),this.set("angle",t),e&&this._resetOrigin()}setOnGroup(){}_setupCompositeOperation(t){this.globalCompositeOperation&&(t.globalCompositeOperation=this.globalCompositeOperation)}dispose(){Aa.cancelByTarget(this),this.off(),this._set("canvas",void 0),this._cacheCanvas&&Qe().dispose(this._cacheCanvas),this._cacheCanvas=void 0,this._cacheContext=null}static _fromObject(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{extraParam:n}=e,r=At(e,cw);return _r(ki(t),r).then(o=>{const l=T(T({},r),o);if(n){const{[n]:c,type:u}=l,d=At(l,[n,"type"].map(Zu));return new this(c,d)}else return new this(l)})}static fromObject(t,e){return this._fromObject(t,e)}};D(Rn,"stateProperties",lw);D(Rn,"cacheProperties",_n);D(Rn,"ownDefaults",hw);D(Rn,"type","FabricObject");q.setClass(Rn);q.setClass(Rn,"object");const ri=(a,t)=>(e,n,r,o)=>{const l=t(e,n,r,o);return l&&mf(a,vf(e,n,r,o)),l};function si(a){return(t,e,n,r)=>{const{target:o,originX:l,originY:c}=e,u=o.getRelativeCenterPoint(),d=o.translateToOriginPoint(u,l,c),g=a(t,e,n,r);return o.setPositionByOrigin(d,l,c),g}}const uw=(a,t,e,n)=>{const r=yr(t,t.originX,t.originY,e,n);if(t.originX===et||t.originX===Yt&&r.x<0||t.originX===dt&&r.x>0){const{target:o}=t,l=o.strokeWidth/(o.strokeUniform?o.scaleX:1),c=_f(t)?2:1,u=o.width,d=Math.ceil(Math.abs(r.x*c/o.scaleX)-l);return o.set("width",Math.max(d,0)),u!==o.width}return!1},Ra=ri("resizing",si(uw));function Pf(a,t,e,n,r){n=n||{};const o=this.sizeX||n.cornerSize||r.cornerSize,l=this.sizeY||n.cornerSize||r.cornerSize,c=typeof n.transparentCorners<"u"?n.transparentCorners:r.transparentCorners,u=c?"stroke":"fill",d=!c&&(n.cornerStrokeColor||r.cornerStrokeColor);let g=t,_=e,y;a.save(),a.fillStyle=n.cornerColor||r.cornerColor||"",a.strokeStyle=n.cornerStrokeColor||r.cornerStrokeColor||"",o>l?(y=o,a.scale(1,l/o),_=e*o/l):l>o?(y=l,a.scale(o/l,1),g=t*l/o):y=o,a.lineWidth=1,a.beginPath(),a.arc(g,_,y/2,0,ti,!1),a[u](),d&&a.stroke(),a.restore()}function Af(a,t,e,n,r){n=n||{};const o=this.sizeX||n.cornerSize||r.cornerSize,l=this.sizeY||n.cornerSize||r.cornerSize,c=typeof n.transparentCorners<"u"?n.transparentCorners:r.transparentCorners,u=c?"stroke":"fill",d=!c&&(n.cornerStrokeColor||r.cornerStrokeColor),g=o/2,_=l/2;a.save(),a.fillStyle=n.cornerColor||r.cornerColor||"",a.strokeStyle=n.cornerStrokeColor||r.cornerStrokeColor||"",a.lineWidth=1,a.translate(t,e);const y=r.getTotalAngle();a.rotate(Ot(y)),a["".concat(u,"Rect")](-g,-_,o,l),d&&a.strokeRect(-g,-_,o,l),a.restore()}class Re{constructor(t){D(this,"visible",!0),D(this,"actionName","scale"),D(this,"angle",0),D(this,"x",0),D(this,"y",0),D(this,"offsetX",0),D(this,"offsetY",0),D(this,"sizeX",null),D(this,"sizeY",null),D(this,"touchSizeX",null),D(this,"touchSizeY",null),D(this,"cursorStyle","crosshair"),D(this,"withConnection",!1),Object.assign(this,t)}shouldActivate(t,e){var n;return((n=e.canvas)===null||n===void 0?void 0:n.getActiveObject())===e&&e.isControlVisible(t)}getActionHandler(t,e,n){return this.actionHandler}getMouseDownHandler(t,e,n){return this.mouseDownHandler}getMouseUpHandler(t,e,n){return this.mouseUpHandler}cursorStyleHandler(t,e,n){return e.cursorStyle}getActionName(t,e,n){return e.actionName}getVisibility(t,e){var n,r;return(n=(r=t._controlsVisibility)===null||r===void 0?void 0:r[e])!==null&&n!==void 0?n:this.visible}setVisibility(t,e,n){this.visible=t}positionHandler(t,e,n,r){return new M(this.x*t.x+this.offsetX,this.y*t.y+this.offsetY).transform(e)}calcCornerCoords(t,e,n,r,o){let l,c,u,d;const g=o?this.touchSizeX:this.sizeX,_=o?this.touchSizeY:this.sizeY;if(g&&_&&g!==_){const y=Math.atan2(_,g),x=Math.sqrt(g*g+_*_)/2,S=y-Ot(t),E=mn-y-Ot(t);l=x*ae(S),c=x*le(S),u=x*ae(E),d=x*le(E)}else{const x=(g&&_?g:e)*Math.SQRT1_2,S=Ot(45-t);l=u=x*ae(S),c=d=x*le(S)}return{tl:new M(n-d,r-u),tr:new M(n+l,r-c),bl:new M(n-l,r+c),br:new M(n+d,r+u)}}render(t,e,n,r,o){switch(r=r||{},r.cornerStyle||o.cornerStyle){case"circle":Pf.call(this,t,e,n,r,o);break;default:Af.call(this,t,e,n,r,o)}}}const Mf=(a,t,e)=>e.lockRotation?Cs:t.cursorStyle,fw=(a,t,e,n)=>{let{target:r,ex:o,ey:l,theta:c,originX:u,originY:d}=t;const g=r.translateToOriginPoint(r.getRelativeCenterPoint(),u,d);if(Ge(r,"lockRotation"))return!1;const _=Math.atan2(l-g.y,o-g.x),y=Math.atan2(n-g.y,e-g.x);let x=Ei(y-_+c);if(r.snapAngle&&r.snapAngle>0){const E=r.snapAngle,P=r.snapThreshold||E,L=Math.ceil(x/E)*E,W=Math.floor(x/E)*E;Math.abs(x-W)<P?x=W:Math.abs(x-L)<P&&(x=L)}x<0&&(x=360+x),x%=360;const S=r.angle!==x;return r.angle=x,S},kf=ri("rotating",si(fw));function Lf(a,t){const e=t.canvas,n=a[e.uniScaleKey];return e.uniformScaling&&!n||!e.uniformScaling&&n}function Ff(a,t,e){const n=Ge(a,"lockScalingX"),r=Ge(a,"lockScalingY");return!!(n&&r||!t&&(n||r)&&e||n&&t==="x"||r&&t==="y")}const dw=["e","se","s","sw","w","nw","n","ne","e"],Ti=(a,t,e)=>{const n=Lf(a,e),r=t.x!==0&&t.y===0?"x":t.x===0&&t.y!==0?"y":"";if(Ff(e,r,n))return Cs;const o=yf(e,t);return"".concat(dw[o],"-resize")};function cl(a,t,e,n){let r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};const o=t.target,l=r.by,c=Lf(a,o),u=Ff(o,l,c);let d,g,_,y,x,S;if(u)return!1;if(t.gestureScale)g=t.scaleX*t.gestureScale,_=t.scaleY*t.gestureScale;else{if(d=yr(t,t.originX,t.originY,e,n),x=l!=="y"?Math.sign(d.x||t.signX||1):1,S=l!=="x"?Math.sign(d.y||t.signY||1):1,t.signX||(t.signX=x),t.signY||(t.signY=S),Ge(o,"lockScalingFlip")&&(t.signX!==x||t.signY!==S))return!1;if(y=o._getTransformedDimensions(),c&&!l){const L=Math.abs(d.x)+Math.abs(d.y),{original:W}=t,Y=Math.abs(y.x*W.scaleX/o.scaleX)+Math.abs(y.y*W.scaleY/o.scaleY),H=L/Y;g=W.scaleX*H,_=W.scaleY*H}else g=Math.abs(d.x*o.scaleX/y.x),_=Math.abs(d.y*o.scaleY/y.y);_f(t)&&(g*=2,_*=2),t.signX!==x&&l!=="y"&&(t.originX=Tu(t.originX),g*=-1,t.signX=x),t.signY!==S&&l!=="x"&&(t.originY=Tu(t.originY),_*=-1,t.signY=S)}const E=o.scaleX,P=o.scaleY;return l?(l==="x"&&o.set("scaleX",g),l==="y"&&o.set("scaleY",_)):(!Ge(o,"lockScalingX")&&o.set("scaleX",g),!Ge(o,"lockScalingY")&&o.set("scaleY",_)),E!==o.scaleX||P!==o.scaleY}const gw=(a,t,e,n)=>cl(a,t,e,n),pw=(a,t,e,n)=>cl(a,t,e,n,{by:"x"}),mw=(a,t,e,n)=>cl(a,t,e,n,{by:"y"}),ir=ri("scaling",si(gw)),Rf=ri("scaling",si(pw)),If=ri("scaling",si(mw)),_w=["target","ex","ey","skewingSide"],Ia={x:{counterAxis:"y",scale:"scaleX",skew:"skewX",lockSkewing:"lockSkewingX",origin:"originX",flip:"flipX"},y:{counterAxis:"x",scale:"scaleY",skew:"skewY",lockSkewing:"lockSkewingY",origin:"originY",flip:"flipY"}},vw=["ns","nesw","ew","nwse"],Bf=(a,t,e)=>{if(t.x!==0&&Ge(e,"lockSkewingY")||t.y!==0&&Ge(e,"lockSkewingX"))return Cs;const n=yf(e,t)%4;return"".concat(vw[n],"-resize")};function yw(a,t,e){let{target:n,ex:r,ey:o,skewingSide:l}=t,c=At(t,_w);const{skew:u}=Ia[a],d=e.subtract(new M(r,o)).divide(new M(n.scaleX,n.scaleY))[a],g=n[u],_=c[u],y=Math.tan(Ot(_)),x=a==="y"?n._getTransformedDimensions({scaleX:1,scaleY:1,skewX:0}).x:n._getTransformedDimensions({scaleX:1,scaleY:1}).y,S=2*d*l/Math.max(x,1)+y,E=Ei(Math.atan(S));n.set(u,E);const P=g!==n[u];if(P&&a==="y"){const{skewX:L,scaleX:W}=n,Y=n._getTransformedDimensions({skewY:g}),H=n._getTransformedDimensions(),z=L!==0?Y.x/H.x:1;z!==1&&n.set("scaleX",z*W)}return P}function Wf(a,t,e,n,r){const{target:o}=e,{counterAxis:l,origin:c,lockSkewing:u,skew:d,flip:g}=Ia[a];if(Ge(o,u))return!1;const{origin:_,flip:y}=Ia[l],x=Mn(e[_])*(o[y]?-1:1),S=-Math.sign(x)*(o[g]?-1:1),E=(o[d]===0&&yr(e,et,et,n,r)[a]>0||o[d]>0?1:-1)*S,P=-E*.5+.5;return ri("skewing",si((W,Y,H,z)=>yw(a,Y,new M(H,z))))(t,T(T({},e),{},{[c]:P,skewingSide:S}),n,r)}const jf=(a,t,e,n)=>Wf("x",a,t,e,n),Xf=(a,t,e,n)=>Wf("y",a,t,e,n);function Rs(a,t){return a[t.canvas.altActionKey]}const rr=(a,t,e)=>{const n=Rs(a,e);return t.x===0?n?"skewX":"scaleY":t.y===0?n?"skewY":"scaleX":""},Zn=(a,t,e)=>Rs(a,e)?Bf(a,t,e):Ti(a,t,e),Ba=(a,t,e,n)=>Rs(a,t.target)?Xf(a,t,e,n):Rf(a,t,e,n),Wa=(a,t,e,n)=>Rs(a,t.target)?jf(a,t,e,n):If(a,t,e,n),ul=()=>({ml:new Re({x:-.5,y:0,cursorStyleHandler:Zn,actionHandler:Ba,getActionName:rr}),mr:new Re({x:.5,y:0,cursorStyleHandler:Zn,actionHandler:Ba,getActionName:rr}),mb:new Re({x:0,y:.5,cursorStyleHandler:Zn,actionHandler:Wa,getActionName:rr}),mt:new Re({x:0,y:-.5,cursorStyleHandler:Zn,actionHandler:Wa,getActionName:rr}),tl:new Re({x:-.5,y:-.5,cursorStyleHandler:Ti,actionHandler:ir}),tr:new Re({x:.5,y:-.5,cursorStyleHandler:Ti,actionHandler:ir}),bl:new Re({x:-.5,y:.5,cursorStyleHandler:Ti,actionHandler:ir}),br:new Re({x:.5,y:.5,cursorStyleHandler:Ti,actionHandler:ir}),mtr:new Re({x:0,y:-.5,actionHandler:kf,cursorStyleHandler:Mf,offsetY:-40,withConnection:!0,actionName:"rotate"})}),Yf=()=>({mr:new Re({x:.5,y:0,actionHandler:Ra,cursorStyleHandler:Zn,actionName:"resizing"}),ml:new Re({x:-.5,y:0,actionHandler:Ra,cursorStyleHandler:Zn,actionName:"resizing"})}),Hf=()=>T(T({},ul()),Yf()),xw={};class Is extends Rn{static getDefaults(){return T(T({},super.getDefaults()),{},{controls:ul()},Is.ownDefaults)}_updateCacheCanvas(){const t=this.canvas;if(this.noScaleCache&&t&&t._currentTransform){const e=t._currentTransform.target,n=t._currentTransform.action;if(this===e&&n.startsWith("scale"))return!1}return super._updateCacheCanvas()}_findTargetCorner(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!this.hasControls||!this.canvas)return"";this.__corner=void 0;const n=Object.entries(this.oCoords);for(let r=n.length-1;r>=0;r--){const[o,l]=n[r];if(this.controls[o].shouldActivate(o,this)){const c=this._getImageLines(e?l.touchCorner:l.corner),u=this._findCrossPoints(t,c);if(u!==0&&u%2===1)return this.__corner=o,o}}return""}calcOCoords(){const t=this.getViewportTransform(),e=this.getCenterPoint(),n=pr(e.x,e.y),r=mr({angle:this.getTotalAngle()-(this.group&&this.flipX?180:0)}),o=Kt(n,r),l=Kt(t,o),c=Kt(l,[1/t[0],0,0,1/t[3],0,0]),u=this.group?Fn(this.calcTransformMatrix()):void 0,d=this._calculateCurrentDimensions(u),g={};return this.forEachControl((_,y)=>{const x=_.positionHandler(d,c,this,_);g[y]=Object.assign(x,this._calcCornerCoords(_,x))}),g}_calcCornerCoords(t,e){const n=t.calcCornerCoords(this.angle,this.cornerSize,e.x,e.y,!1),r=t.calcCornerCoords(this.angle,this.touchCornerSize,e.x,e.y,!0);return{corner:n,touchCorner:r}}setCoords(){super.setCoords(),this.oCoords=this.calcOCoords()}forEachControl(t){for(const e in this.controls)t(this.controls[e],e,this)}drawSelectionBackground(t){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return;t.save();const e=this.getRelativeCenterPoint(),n=this._calculateCurrentDimensions(),r=this.getViewportTransform();t.translate(e.x,e.y),t.scale(1/r[0],1/r[3]),t.rotate(Ot(this.angle)),t.fillStyle=this.selectionBackgroundColor,t.fillRect(-n.x/2,-n.y/2,n.x,n.y),t.restore()}strokeBorders(t,e){t.strokeRect(-e.x/2,-e.y/2,e.x,e.y)}_drawBorders(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=T({hasControls:this.hasControls,borderColor:this.borderColor,borderDashArray:this.borderDashArray},n);t.save(),t.strokeStyle=r.borderColor,this._setLineDash(t,r.borderDashArray),this.strokeBorders(t,e),r.hasControls&&this.drawControlsConnectingLines(t,e),t.restore()}_renderControls(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{hasBorders:n,hasControls:r}=this,o=T({hasBorders:n,hasControls:r},e),l=this.getViewportTransform(),c=o.hasBorders,u=o.hasControls,d=Kt(l,this.calcTransformMatrix()),g=Fn(d);t.save(),t.translate(g.translateX,g.translateY),t.lineWidth=1*this.borderScaleFactor,this.group||(t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(g.angle-=180),t.rotate(Ot(this.group?g.angle:this.angle)),c&&this.drawBorders(t,g,e),u&&this.drawControls(t,e),t.restore()}drawBorders(t,e,n){let r;if(n&&n.forActiveSelection||this.group){const o=tl(this.width,this.height,e),l=(this.strokeUniform?new M().scalarAdd(this.canvas?this.canvas.getZoom():1):new M(e.scaleX,e.scaleY)).scalarMultiply(this.strokeWidth);r=o.add(l).scalarAdd(this.borderScaleFactor)}else r=this._calculateCurrentDimensions().scalarAdd(this.borderScaleFactor);this._drawBorders(t,r,n)}drawControlsConnectingLines(t,e){let n=!1;t.beginPath(),this.forEachControl((r,o)=>{r.withConnection&&r.getVisibility(this,o)&&(n=!0,t.moveTo(r.x*e.x,r.y*e.y),t.lineTo(r.x*e.x+r.offsetX,r.y*e.y+r.offsetY))}),n&&t.stroke()}drawControls(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};t.save();const n=this.getCanvasRetinaScaling(),{cornerStrokeColor:r,cornerDashArray:o,cornerColor:l}=this,c=T({cornerStrokeColor:r,cornerDashArray:o,cornerColor:l},e);t.setTransform(n,0,0,n,0,0),t.strokeStyle=t.fillStyle=c.cornerColor,this.transparentCorners||(t.strokeStyle=c.cornerStrokeColor),this._setLineDash(t,c.cornerDashArray),this.setCoords(),this.forEachControl((u,d)=>{if(u.getVisibility(this,d)){const g=this.oCoords[d];u.render(t,g.x,g.y,c,this)}}),t.restore()}isControlVisible(t){return this.controls[t]&&this.controls[t].getVisibility(this,t)}setControlVisible(t,e){this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[t]=e}setControlsVisibility(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.entries(t).forEach(e=>{let[n,r]=e;return this.setControlVisible(n,r)})}clearContextTop(t){if(!this.canvas)return;const e=this.canvas.contextTop;if(!e)return;const n=this.canvas.viewportTransform;e.save(),e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),this.transform(e);const r=this.width+4,o=this.height+4;return e.clearRect(-r/2,-o/2,r,o),t||e.restore(),e}onDeselect(t){return!1}onSelect(t){return!1}canDrop(t){return!1}renderDragSourceEffect(t){}renderDropTargetEffect(t){}}D(Is,"ownDefaults",xw);function zf(a,t){return t.forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(n=>{n!=="constructor"&&Object.defineProperty(a.prototype,n,Object.getOwnPropertyDescriptor(e.prototype,n)||Object.create(null))})}),a}class qt extends Is{}zf(qt,[Cf]);q.setClass(qt);q.setClass(qt,"object");const Gf=(a,t,e,n)=>{n=Math.round(n);const r=n*2+1,{data:o}=a.getImageData(t-n,e-n,r,r);for(let l=3;l<o.length;l+=4)if(o[l]>0)return!1;return!0},In=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"];function Bs(a){return new RegExp("^("+a.join("|")+")\\b","i")}var Ou,Du;const _s={},Cw={},ww={},Sw={cssRules:_s,gradientDefs:Cw,clipPaths:ww},gr=String.raw(Ou||(Ou=tn(["(?:[-+]?(?:d*.d+|d+.?)(?:[eE][-+]?d+)?)"],["(?:[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?)"])));String.raw(Du||(Du=tn(["(?:s+,?s*|,s*|$)"],["(?:\\s+,?\\s*|,\\s*|$)"])));const bw=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+gr+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+gr+"))?\\s+(.*)"),Tw=["path","circle","polygon","polyline","ellipse","rect","line","image","text"],Ow=["symbol","image","marker","pattern","view","svg"],Dw=["pattern","defs","symbol","metadata","clipPath","mask","desc"],Ew=["symbol","g","a","svg","clipPath","defs"],Eu={cx:dt,x:dt,r:"radius",cy:ee,y:ee,display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},ma={stroke:"strokeOpacity",fill:"fillOpacity"},_a="font-size",va="clip-path";Bs(Tw);Bs(Ow);Bs(Dw);const Pu=Bs(Ew);function Uf(a,t){const e=a.nodeName,n=a.getAttribute("class"),r=a.getAttribute("id");let o;if(o=new RegExp("^"+e,"i"),t=t.replace(o,""),r&&t.length&&(o=new RegExp("#"+r+"(?![a-zA-Z\\-]+)","i"),t=t.replace(o,"")),n&&t.length){const l=n.split(" ");for(let c=l.length;c--;)o=new RegExp("\\."+l[c]+"(?![a-zA-Z\\-]+)","i"),t=t.replace(o,"")}return t.length===0}function Pw(a,t){let e,n=!0;for(;a.parentNode&&a.parentNode.nodeType===1&&t.length;)n&&(e=t.pop()),a=a.parentNode,n=Uf(a,e);return t.length===0}function Aw(a,t){let e=!0;const n=Uf(a,t.pop());return n&&t.length&&(e=Pw(a,t)),n&&e&&t.length===0}function Mw(a,t){const e={};for(const n in _s[t])if(Aw(a,n.split(" ")))for(const r in _s[t][n])e[r]=_s[t][n][r];return e}function kw(a){return a in Eu?Eu[a]:a}const Vf=a=>a.replace(new RegExp("(".concat(gr,")"),"gi")," $1 ").replace(/,/gi," ").replace(/\s+/gi," ");var Au,Mu,ku,Lu,Fu,Ru,Iu;const oe="(".concat(gr,")"),Lw=String.raw(Au||(Au=tn(["(skewX)(",")"],["(skewX)\\(","\\)"])),oe),Fw=String.raw(Mu||(Mu=tn(["(skewY)(",")"],["(skewY)\\(","\\)"])),oe),Rw=String.raw(ku||(ku=tn(["(rotate)(","(?: "," ",")?)"],["(rotate)\\(","(?: "," ",")?\\)"])),oe,oe,oe),Iw=String.raw(Lu||(Lu=tn(["(scale)(","(?: ",")?)"],["(scale)\\(","(?: ",")?\\)"])),oe,oe),Bw=String.raw(Fu||(Fu=tn(["(translate)(","(?: ",")?)"],["(translate)\\(","(?: ",")?\\)"])),oe,oe),Ww=String.raw(Ru||(Ru=tn(["(matrix)("," "," "," "," "," ",")"],["(matrix)\\("," "," "," "," "," ","\\)"])),oe,oe,oe,oe,oe,oe),fl="(?:".concat(Ww,"|").concat(Bw,"|").concat(Rw,"|").concat(Iw,"|").concat(Lw,"|").concat(Fw,")"),jw="(?:".concat(fl,"*)"),Xw=String.raw(Iu||(Iu=tn(["^s*(?:","?)s*$"],["^\\s*(?:","?)\\s*$"])),jw),Yw=new RegExp(Xw),Hw=new RegExp(fl,"g");function ja(a){a=Vf(a).replace(/\s*([()])\s*/gi,"$1");const t=[];if(!a||a&&!Yw.test(a))return[...be];for(const e of a.matchAll(Hw)){const n=new RegExp(fl).exec(e[0]);if(!n)continue;let r=be;const o=n.filter(S=>!!S),[,l,...c]=o,[u,d,g,_,y,x]=c.map(S=>parseFloat(S));switch(l){case"translate":r=pr(u,d);break;case"rotate":r=mr({angle:u},{x:d,y:g});break;case"scale":r=Ka(u,d);break;case"skewX":r=qa(u);break;case"skewY":r=$a(u);break;case"matrix":r=[u,d,g,_,y,x];break}t.push(r)}return ks(t)}function zw(a,t,e,n){const r=Array.isArray(t);let o;if((a==="fill"||a==="stroke")&&t===pe)t="";else{if(a==="strokeUniform")return t==="non-scaling-stroke";if(a==="strokeDashArray")t===pe?t=null:t=t.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(a==="transformMatrix")e&&e.transformMatrix?t=Kt(e.transformMatrix,ja(t)):t=ja(t);else if(a==="visible")t=t!==pe&&t!=="hidden",e&&e.visible===!1&&(t=!1);else if(a==="opacity")t=parseFloat(t),e&&typeof e.opacity<"u"&&(t*=e.opacity);else if(a==="textAnchor")t=t==="start"?dt:t==="end"?Yt:et;else if(a==="charSpacing")o=Oi(t,n)/n*1e3;else if(a==="paintFirst"){const l=t.indexOf("fill"),c=t.indexOf("stroke");t="fill",(l>-1&&c>-1&&c<l||l===-1&&c>-1)&&(t="stroke")}else{if(a==="href"||a==="xlink:href"||a==="font")return t;if(a==="imageSmoothing")return t==="optimizeQuality";o=r?t.map(Oi):Oi(t,n)}}return!r&&isNaN(o)?t:o}function Gw(a,t){const e=a.match(bw);if(!e)return;const n=e[1],r=e[3],o=e[4],l=e[5],c=e[6];n&&(t.fontStyle=n),r&&(t.fontWeight=isNaN(parseFloat(r))?r:parseFloat(r)),o&&(t.fontSize=Oi(o)),c&&(t.fontFamily=c),l&&(t.lineHeight=l==="normal"?1:l)}function Uw(a,t){let e,n;for(const r in a)typeof a[r]>"u"||(e=r.toLowerCase(),n=a[r],t[e]=n)}function Vw(a,t){let e,n;a.replace(/;\s*$/,"").split(";").forEach(function(r){const o=r.split(":");e=o[0].trim().toLowerCase(),n=o[1].trim(),t[e]=n})}function Nw(a){const t={},e=a.getAttribute("style");return e&&(typeof e=="string"?Vw(e,t):Uw(e,t)),t}function Kw(a){for(const t in ma){if(typeof a[ma[t]]>"u"||a[t]==="")continue;const e=qt.getDefaults();if(typeof a[t]>"u"){if(!e[t])continue;a[t]=e[t]}if(a[t].indexOf("url(")===0)continue;const n=new wt(a[t]);a[t]=n.setAlpha(ut(n.getAlpha()*a[ma[t]],2)).toRgba()}return a}function vn(a,t,e){if(!a)return{};let n,r={},o,l;typeof e>"u"&&(e=a.getAttribute("svgUid")),a.parentNode&&Pu.test(a.parentNode.nodeName)&&(r=vn(a.parentNode,t,e));let c=t.reduce(function(_,y){return n=a.getAttribute(y),n&&(_[y]=n),_},{});const u=Object.assign(Mw(a,e),Nw(a));c=Object.assign(c,u),u[va]&&a.setAttribute(va,u[va]),o=l=r.fontSize||Va,c[_a]&&(c[_a]=o=Oi(c[_a],l));const d={};for(const _ in c){const y=kw(_),x=zw(y,c[_],r,o);d[y]=x}d&&d.font&&Gw(d.font,d);const g=T(T({},r),d);return Pu.test(a.nodeName)?g:Kw(g)}const qw=["left","top","width","height","visible"],$w={rx:0,ry:0},Nf=["rx","ry"];class yn extends qt{static getDefaults(){return T(T({},super.getDefaults()),yn.ownDefaults)}constructor(t){super(t),this._initRxRy()}_initRxRy(){const{rx:t,ry:e}=this;t&&!e?this.ry=t:e&&!t&&(this.rx=e)}_render(t){const{width:e,height:n}=this,r=-e/2,o=-n/2,l=this.rx?Math.min(this.rx,e/2):0,c=this.ry?Math.min(this.ry,n/2):0,u=l!==0||c!==0;t.beginPath(),t.moveTo(r+l,o),t.lineTo(r+e-l,o),u&&t.bezierCurveTo(r+e-Pn*l,o,r+e,o+Pn*c,r+e,o+c),t.lineTo(r+e,o+n-c),u&&t.bezierCurveTo(r+e,o+n-Pn*c,r+e-Pn*l,o+n,r+e-l,o+n),t.lineTo(r+l,o+n),u&&t.bezierCurveTo(r+Pn*l,o+n,r,o+n-Pn*c,r,o+n-c),t.lineTo(r,o+c),u&&t.bezierCurveTo(r,o+Pn*c,r+Pn*l,o,r+l,o),t.closePath(),this._renderPaintInOrder(t)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...Nf,...t])}_toSVG(){const{width:t,height:e,rx:n,ry:r}=this;return["<rect ","COMMON_PARTS",'x="'.concat(-t/2,'" y="').concat(-e/2,'" rx="').concat(n,'" ry="').concat(r,'" width="').concat(t,'" height="').concat(e,`" />
`)]}static async fromElement(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=vn(t,this.ATTRIBUTE_NAMES),{left:o=0,top:l=0,width:c=0,height:u=0,visible:d=!0}=r,g=At(r,qw);return new this(T(T(T({},n),g),{},{left:o,top:l,width:c,height:u,visible:!!(d&&c&&u)}))}}D(yn,"type","Rect");D(yn,"cacheProperties",[..._n,...Nf]);D(yn,"ownDefaults",$w);D(yn,"ATTRIBUTE_NAMES",[...In,"x","y","rx","ry","width","height"]);q.setClass(yn);q.setSVGClass(yn);const Jw=["objects"],Zw={layout:"fit-content",strokeWidth:0,subTargetCheck:!1,interactive:!1};class en extends tf(qt){static getDefaults(){return T(T({},super.getDefaults()),en.ownDefaults)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;super(),D(this,"_activeObjects",[]),D(this,"__objectSelectionTracker",void 0),D(this,"__objectSelectionDisposer",void 0),D(this,"_firstLayoutDone",!1),this._objects=t,this.__objectMonitor=this.__objectMonitor.bind(this),this.__objectSelectionTracker=this.__objectSelectionMonitor.bind(this,!0),this.__objectSelectionDisposer=this.__objectSelectionMonitor.bind(this,!1),this.set(T(T({},e),{},{angle:0,skewX:0,skewY:0})),this.forEachObject(r=>{this.enterGroup(r,!1)}),this._applyLayoutStrategy({type:"initialization",options:e,objectsRelativeToGroup:n})}canEnterGroup(t){return t===this||this.isDescendantOf(t)?(console.error("fabric.Group: circular object trees are not supported, this call has no effect"),!1):this._objects.indexOf(t)!==-1?(console.error("fabric.Group: duplicate objects are not supported inside group, this call has no effect"),!1):!0}_filterObjectsBeforeEnteringGroup(t){return t.filter((e,n,r)=>this.canEnterGroup(e)&&r.indexOf(e)===n)}add(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=this._filterObjectsBeforeEnteringGroup(e),o=super.add(...r);return this._onAfterObjectsChange("added",r),o}insertAt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];const o=this._filterObjectsBeforeEnteringGroup(n),l=super.insertAt(t,...o);return this._onAfterObjectsChange("added",o),l}remove(){const t=super.remove(...arguments);return this._onAfterObjectsChange("removed",t),t}_onObjectAdded(t){this.enterGroup(t,!0),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onRelativeObjectAdded(t){this.enterGroup(t,!1),this.fire("object:added",{target:t}),t.fire("added",{target:this})}_onObjectRemoved(t,e){this.exitGroup(t,e),this.fire("object:removed",{target:t}),t.fire("removed",{target:this})}_onAfterObjectsChange(t,e){this._applyLayoutStrategy({type:t,targets:e}),this._set("dirty",!0)}_onStackOrderChanged(){this._set("dirty",!0)}_set(t,e){const n=this[t];return super._set(t,e),t==="canvas"&&n!==e&&this.forEachObject(r=>{r._set(t,e)}),t==="layout"&&n!==e&&this._applyLayoutStrategy({type:"layout_change",layout:e,prevLayout:n}),t==="interactive"&&this.forEachObject(r=>this._watchObject(e,r)),this}_shouldSetNestedCoords(){return this.subTargetCheck}removeAll(){return this._activeObjects=[],this.remove(...this._objects)}__objectMonitor(t){this._applyLayoutStrategy(T(T({},t),{},{type:"object_modified"})),this._set("dirty",!0)}__objectSelectionMonitor(t,e){let{target:n}=e;if(t)this._activeObjects.push(n),this._set("dirty",!0);else if(this._activeObjects.length>0){const r=this._activeObjects.indexOf(n);r>-1&&(this._activeObjects.splice(r,1),this._set("dirty",!0))}}_watchObject(t,e){const n=t?"on":"off";t&&this._watchObject(!1,e),e[n]("changed",this.__objectMonitor),e[n]("modified",this.__objectMonitor),e[n]("selected",this.__objectSelectionTracker),e[n]("deselected",this.__objectSelectionDisposer)}enterGroup(t,e){return t.group&&t.group.remove(t),this._enterGroup(t,e),!0}_enterGroup(t,e){e&&Ai(t,Kt(Nt(this.calcTransformMatrix()),t.calcTransformMatrix())),this._shouldSetNestedCoords()&&t.setCoords(),t._set("group",this),t._set("canvas",this.canvas),this.interactive&&this._watchObject(!0,t);const n=this.canvas&&this.canvas.getActiveObject&&this.canvas.getActiveObject();n&&(n===t||t.isDescendantOf(n))&&this._activeObjects.push(t)}exitGroup(t,e){this._exitGroup(t,e),t._set("canvas",void 0)}_exitGroup(t,e){t._set("group",void 0),e||(Ai(t,Kt(this.calcTransformMatrix(),t.calcTransformMatrix())),t.setCoords()),this._watchObject(!1,t);const n=this._activeObjects.length>0?this._activeObjects.indexOf(t):-1;n>-1&&this._activeObjects.splice(n,1)}shouldCache(){const t=qt.prototype.shouldCache.call(this);if(t){for(let e=0;e<this._objects.length;e++)if(this._objects[e].willDrawShadow())return this.ownCaching=!1,!1}return t}willDrawShadow(){if(qt.prototype.willDrawShadow.call(this))return!0;for(let t=0;t<this._objects.length;t++)if(this._objects[t].willDrawShadow())return!0;return!1}isOnACache(){return this.ownCaching||!!this.group&&this.group.isOnACache()}drawObject(t){this._renderBackground(t);for(let n=0;n<this._objects.length;n++){var e;(e=this.canvas)!==null&&e!==void 0&&e.preserveObjectStacking&&this._objects[n].group!==this?(t.save(),t.transform(...Nt(this.calcTransformMatrix())),this._objects[n].render(t),t.restore()):this._objects[n].group===this&&this._objects[n].render(t)}this._drawClipPath(t,this.clipPath)}setCoords(){super.setCoords(),this._shouldSetNestedCoords()&&this.forEachObject(t=>t.setCoords())}render(t){this._transformDone=!0,super.render(t),this._transformDone=!1}triggerLayout(t){t&&t.layout&&(t.prevLayout=this.layout,this.layout=t.layout),this._applyLayoutStrategy({type:"imperative",context:t})}_adjustObjectPosition(t,e){t.set({left:t.left+e.x,top:t.top+e.y})}_applyLayoutStrategy(t){const e=t.type==="initialization";if(!e&&!this._firstLayoutDone)return;const n=e&&t.options,r=n&&{angle:n.angle||0,skewX:n.skewX||0,skewY:n.skewY||0},o=this.getRelativeCenterPoint();let l=this.getLayoutStrategyResult(this.layout,[...this._objects],t),c;if(l){const u=new M(l.centerX,l.centerY);c=o.subtract(u).add(new M(l.correctionX||0,l.correctionY||0)).transform(Nt(this.calcOwnMatrix()),!0),this.set({width:l.width,height:l.height}),!t.objectsRelativeToGroup&&this.forEachObject(g=>{g.group===this&&this._adjustObjectPosition(g,c)}),!e&&this.layout!=="clip-path"&&this.clipPath&&!this.clipPath.absolutePositioned&&this._adjustObjectPosition(this.clipPath,c),(!u.eq(o)||r)&&(this.setPositionByOrigin(u,et,et),r&&this.set(r),this.setCoords())}else if(e)l={centerX:o.x,centerY:o.y,width:this.width,height:this.height},r&&this.set(r),c=new M;else return;this._firstLayoutDone=!0,this.onLayout(t,l),this.fire("layout",{context:t,result:l,diff:c}),this.group&&this.group._applyLayoutStrategy&&(t.path||(t.path=[]),t.path.push(this),this.group._applyLayoutStrategy(t))}getLayoutStrategyResult(t,e,n){if(t==="fit-content-lazy"&&n.type==="added"&&e.length>n.targets.length){const r=n.targets.concat(this);return this.prepareBoundingBox(t,r,n)}else{if(t==="fit-content"||t==="fit-content-lazy"||t==="fixed"&&(n.type==="initialization"||n.type==="imperative"))return this.prepareBoundingBox(t,e,n);if(t==="clip-path"&&this.clipPath){const r=this.clipPath,o=r._getTransformedDimensions();if(r.absolutePositioned&&(n.type==="initialization"||n.type==="layout_change")){let l=r.getCenterPoint();if(this.group){const c=Nt(this.group.calcTransformMatrix());l=Bt(l,c)}return{centerX:l.x,centerY:l.y,width:o.x,height:o.y}}else if(!r.absolutePositioned){let l;const c=r.getRelativeCenterPoint(),u=Bt(c,this.calcOwnMatrix(),!0);if(n.type==="initialization"||n.type==="layout_change"){const d=this.prepareBoundingBox(t,e,n)||{};return l=new M(d.centerX||0,d.centerY||0),{centerX:l.x+u.x,centerY:l.y+u.y,correctionX:d.correctionX-u.x,correctionY:d.correctionY-u.y,width:r.width,height:r.height}}else return l=this.getRelativeCenterPoint(),{centerX:l.x+u.x,centerY:l.y+u.y,width:o.x,height:o.y}}}}}prepareBoundingBox(t,e,n){return n.type==="initialization"?this.prepareInitialBoundingBox(t,e,n):n.type==="imperative"&&n.context?T(T({},this.getObjectsBoundingBox(e)||{}),n.context):this.getObjectsBoundingBox(e)}prepareInitialBoundingBox(t,e,n){const r=n.options||{},o=typeof r.left=="number",l=typeof r.top=="number",c=typeof r.width=="number",u=typeof r.height=="number";if(o&&l&&c&&u&&n.objectsRelativeToGroup||e.length===0)return;const d=this.getObjectsBoundingBox(e)||{},{centerX:g=0,centerY:_=0,width:y=0,height:x=0}=d,S=c?this.width:y,E=u?this.height:x,P=new M(g,_),L=new M(Mn(this.originX),Mn(this.originY)),W=new M(S,E),Y=this._getTransformedDimensions({width:0,height:0}),H=this._getTransformedDimensions({width:S,height:E,strokeWidth:0}),z=this._getTransformedDimensions({width:d.width,height:d.height,strokeWidth:0}),U=new M(0,0),A=L.scalarAdd(.5),R=H.multiply(A),N=new M(c?z.x/2:R.x,u?z.y/2:R.y),tt=new M(o?this.left-(H.x+Y.x)*L.x:P.x-N.x,l?this.top-(H.y+Y.y)*L.y:P.y-N.y),Dt=new M(o?tt.x-P.x+z.x*(c?.5:0):-(c?(H.x-Y.x)*.5:H.x*A.x),l?tt.y-P.y+z.y*(u?.5:0):-(u?(H.y-Y.y)*.5:H.y*A.y)).add(U),vt=new M(c?-H.x/2:0,u?-H.y/2:0).add(Dt);return{centerX:tt.x,centerY:tt.y,correctionX:vt.x,correctionY:vt.y,width:W.x,height:W.y}}getObjectsBoundingBox(t,e){if(t.length===0)return null;const n=[];t.forEach(_=>{const y=_.getRelativeCenterPoint();let x=_._getTransformedDimensions().scalarDivide(2);if(_.angle){const S=Ot(_.angle),E=Math.abs(le(S)),P=Math.abs(ae(S)),L=x.x*P+x.y*E,W=x.x*E+x.y*P;x=new M(L,W)}n.push(y.subtract(x),y.add(x))});const{left:r,top:o,width:l,height:c}=pn(n),u=new M(l,c),d=(e?new M:new M(r,o)).add(u.scalarDivide(2)),g=d.transform(this.calcOwnMatrix());return{centerX:g.x,centerY:g.y,width:u.x,height:u.y}}onLayout(t,e){}__serializeObjects(t,e){const n=this.includeDefaultValues;return this._objects.filter(function(r){return!r.excludeFromExport}).map(function(r){const o=r.includeDefaultValues;r.includeDefaultValues=n;const l=r[t||"toObject"](e);return r.includeDefaultValues=o,l})}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return T(T({},super.toObject(["layout","subTargetCheck","interactive",...t])),{},{objects:this.__serializeObjects("toObject",t)})}toString(){return"#<Group: (".concat(this.complexity(),")>")}dispose(){this._activeObjects=[],this.forEachObject(t=>{this._watchObject(!1,t),t.dispose()}),super.dispose()}_createSVGBgRect(t){if(!this.backgroundColor)return"";const e=yn.prototype._toSVG.call(this),n=e.indexOf("COMMON_PARTS");e[n]='for="group" ';const r=e.join("");return t?t(r):r}_toSVG(t){const e=["<g ","COMMON_PARTS",` >
`],n=this._createSVGBgRect(t);n&&e.push("		",n);for(let r=0;r<this._objects.length;r++)e.push("		",this._objects[r].toSVG(t));return e.push(`</g>
`),e}getSvgStyles(){const t=typeof this.opacity<"u"&&this.opacity!==1?"opacity: ".concat(this.opacity,";"):"",e=this.visible?"":" visibility: hidden;";return[t,this.getSvgFilter(),e].join("")}toClipPathSVG(t){const e=[],n=this._createSVGBgRect(t);n&&e.push("	",n);for(let r=0;r<this._objects.length;r++)e.push("	",this._objects[r].toClipPathSVG(t));return this._createBaseClipPathSVGMarkup(e,{reviver:t})}static fromObject(t){let{objects:e=[]}=t,n=At(t,Jw);return Promise.all([Pi(e),_r(n)]).then(r=>{let[o,l]=r;return new this(o,T(T({},n),l),!0)})}}D(en,"stateProperties",[...qt.stateProperties,"layout"]);D(en,"type","Group");D(en,"ownDefaults",Zw);q.setClass(en);class Ws extends en{constructor(t,e,n){super(t,e,n),D(this,"multiSelectionStacking","canvas-stacking"),this.setCoords()}_shouldSetNestedCoords(){return!0}__objectSelectionMonitor(){}multiSelectAdd(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.multiSelectionStacking==="selection-order"?this.add(...e):e.forEach(r=>{const o=this._objects.findIndex(c=>c.isInFrontOf(r)),l=o===-1?this.size():o;this.insertAt(l,r)})}enterGroup(t,e){if(t.group){const n=t.group;n._exitGroup(t),t.__owningGroup=n}return this._enterGroup(t,e),!0}exitGroup(t,e){this._exitGroup(t,e);const n=t.__owningGroup;n&&(n._enterGroup(t,!0),delete t.__owningGroup)}_onAfterObjectsChange(t,e){super._onAfterObjectsChange(t,e);const n=[];e.forEach(r=>{r.group&&!n.includes(r.group)&&n.push(r.group)}),t==="removed"?n.forEach(r=>{r._onAfterObjectsChange("added",e)}):n.forEach(r=>{r._set("dirty",!0)})}onDeselect(){return this.removeAll(),!1}toString(){return"#<ActiveSelection: (".concat(this.complexity(),")>")}shouldCache(){return!1}isOnACache(){return!1}_renderControls(t,e,n){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,super._renderControls(t,e);const r=T(T({hasControls:!1},n),{},{forActiveSelection:!0});for(let o=0;o<this._objects.length;o++)this._objects[o]._renderControls(t,r);t.restore()}}D(Ws,"type","ActiveSelection");q.setClass(Ws);q.setClass(Ws,"activeSelection");const Qw=(a,t,e)=>a.rotate(e,t);class sr{static getAcuteAngleFactor(t,e){const n=e?Ls(t,e):iw(t);return Math.abs(n)<mn?-1:1}constructor(t){this.options=t,this.strokeProjectionMagnitude=this.options.strokeWidth/2,this.scale=new M(this.options.scaleX,this.options.scaleY),this.strokeUniformScalar=this.options.strokeUniform?new M(1/this.options.scaleX,1/this.options.scaleY):new M(1,1)}createSideVector(t,e){const n=ni(t,e);return this.options.strokeUniform?n.multiply(this.scale):n}projectOrthogonally(t,e,n){return this.applySkew(t.add(this.calcOrthogonalProjection(t,e,n)))}isSkewed(){return this.options.skewX!==0||this.options.skewY!==0}applySkew(t){const e=new M(t);return e.y+=e.x*Math.tan(Ot(this.options.skewY)),e.x+=e.y*Math.tan(Ot(this.options.skewX)),e}scaleUnitVector(t,e){return t.multiply(this.strokeUniformScalar).scalarMultiply(e)}}class Kf extends sr{constructor(t,e,n,r){super(r),this.A=new M(t),this.B=new M(e),this.C=new M(n),this.bisector=this.options.strokeUniform?Fa(this.A.multiply(this.scale),this.B.multiply(this.scale),this.C.multiply(this.scale)):Fa(this.A,this.B,this.C)}get bisectorVector(){return this.bisector.vector}get bisectorAngle(){return this.bisector.angle}calcOrthogonalProjection(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const r=this.createSideVector(t,e),o=Df(r),l=sr.getAcuteAngleFactor(o,this.bisectorVector);return this.scaleUnitVector(o,n*l)}projectBevel(){return[this.B,this.C].map(t=>this.projectOrthogonally(this.A,t))}projectMiter(){const t=Math.abs(this.bisectorAngle),e=1/Math.sin(t/2),n=this.scaleUnitVector(this.bisectorVector,-this.strokeProjectionMagnitude*e),r=this.options.strokeUniform?e:this.options.strokeMiterLimit;return Of(n)/this.strokeProjectionMagnitude<=r?[this.applySkew(this.A.add(n))]:this.projectBevel()}projectRoundNoSkew(){const t=new M(sr.getAcuteAngleFactor(this.bisectorVector),sr.getAcuteAngleFactor(new M(this.bisectorVector.y,this.bisectorVector.x))),e=new M(1,0).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(t),n=new M(0,1).scalarMultiply(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar).multiply(t);return[this.A.add(e),this.A.add(n)]}projectRoundWithSkew(){const t=[];[this.B,this.C].forEach(d=>t.push(this.projectOrthogonally(this.A,d)));const{skewX:e,skewY:n}=this.options,r=new M().scalarAdd(this.strokeProjectionMagnitude).multiply(this.strokeUniformScalar),o=r.y/Math.sqrt(1+Math.tan(Ot(n))**2),l=new M(Math.sqrt(r.x**2-(o*r.x/r.y)**2),o),c=r.x/Math.sqrt(1+Math.tan(Ot(e))**2);return[new M(c,Math.sqrt(o**2-(c*o/r.x)**2)),l].forEach(d=>{t.push(this.applySkew(this.A.add(d)),this.applySkew(this.A.subtract(d)))}),t}projectRound(){return this.isSkewed()?this.projectRoundWithSkew():this.projectRoundNoSkew()}projectPoints(){switch(this.options.strokeLineJoin){case"miter":return this.projectMiter();case"round":return this.projectRound();default:return this.projectBevel()}}project(){return this.projectPoints().map(t=>({originPoint:this.A,projectedPoint:t,bisector:this.bisector}))}}class tS extends sr{constructor(t,e,n){super(n),this.A=new M(t),this.T=new M(e)}calcOrthogonalProjection(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.strokeProjectionMagnitude;const r=this.createSideVector(t,e);return this.scaleUnitVector(Df(r),n)}projectButt(){return[this.projectOrthogonally(this.A,this.T,this.strokeProjectionMagnitude),this.projectOrthogonally(this.A,this.T,-this.strokeProjectionMagnitude)]}projectRound(){return new Kf(this.A,this.T,this.T,this.options).projectRound()}projectSquare(){const t=this.calcOrthogonalProjection(this.A,this.T,this.strokeProjectionMagnitude),e=this.scaleUnitVector(Fs(ni(this.A,this.T)),-this.strokeProjectionMagnitude),n=this.A.add(e);return[n.add(t),n.subtract(t)].map(r=>this.applySkew(r))}projectPoints(){switch(this.options.strokeLineCap){case"round":return this.projectRound();case"square":return this.projectSquare();default:return this.projectButt()}}project(){return this.projectPoints().map(t=>({originPoint:this.A,projectedPoint:t}))}}const qf=function(a,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const n=[];return a.length<=1||a.forEach((r,o)=>{let l,c;o===0?(c=a[1],l=e?r:a[a.length-1]):o===a.length-1?(l=a[o-1],c=e?r:a[0]):(l=a[o-1],c=a[o+1]),e&&(o===0||o===a.length-1)?n.push(...new tS(r,o===0?c:l,t).project()):n.push(...new Kf(r,l,c,t).project())}),n},js=function(a,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return a.fill!==t.fill||a.stroke!==t.stroke||a.strokeWidth!==t.strokeWidth||a.fontSize!==t.fontSize||a.fontFamily!==t.fontFamily||a.fontWeight!==t.fontWeight||a.fontStyle!==t.fontStyle||a.textBackgroundColor!==t.textBackgroundColor||a.deltaY!==t.deltaY||e&&(a.overline!==t.overline||a.underline!==t.underline||a.linethrough!==t.linethrough)},$f=(a,t)=>{const e=t.split(`
`),n=[];let r=-1,o={};a=ki(a);for(let l=0;l<e.length;l++){if(!a[l]){r+=e[l].length,o={};continue}for(let c=0;c<e[l].length;c++){r++;const u=a[l][c];u&&Object.keys(u).length>0&&(js(o,u,!0)?n.push({start:r,end:r+1,style:u}):n[n.length-1].end++),o=u||{}}}return n},Jf=(a,t)=>{if(!Array.isArray(a))return ki(a);const e=t.split(Qu),n={};let r=-1,o=0;for(let l=0;l<e.length;l++)for(let c=0;c<e[l].length;c++)r++,a[o]&&a[o].start<=r&&r<a[o].end&&(n[l]=n[l]||{},n[l][c]=T({},a[o].style),r===a[o].end-1&&o++);return n},eS=a=>a&&a.length===1?a[0]:new en(a),Zf=(a,t)=>Math.min(t.width/a.width,t.height/a.height),Qf=(a,t)=>Math.max(t.width/a.width,t.height/a.height),nS=function(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return"".concat(a.charAt(0).toUpperCase()).concat(t?a.slice(1):a.slice(1).toLowerCase())},td=a=>a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),ed=a=>{const t=[];for(let e=0,n;e<a.length;e++)(n=iS(a,e))!==!1&&t.push(n);return t},iS=(a,t)=>{const e=a.charCodeAt(t);if(isNaN(e))return"";if(e<55296||e>57343)return a.charAt(t);if(55296<=e&&e<=56319){if(a.length<=t+1)throw"High surrogate without following low surrogate";const r=a.charCodeAt(t+1);if(56320>r||r>57343)throw"High surrogate without following low surrogate";return a.charAt(t)+a.charAt(t+1)}if(t===0)throw"Low surrogate without preceding high surrogate";const n=a.charCodeAt(t-1);if(55296>n||n>56319)throw"Low surrogate without preceding high surrogate";return!1};var rS=Object.freeze({__proto__:null,capitalize:nS,escapeXml:td,graphemeSplit:ed}),Bu;const Tt="(".concat(gr,")"),sS="(M) (?:".concat(Tt," ").concat(Tt," ?)+"),oS="(L) (?:".concat(Tt," ").concat(Tt," ?)+"),aS="(H) (?:".concat(Tt," ?)+"),lS="(V) (?:".concat(Tt," ?)+"),hS=String.raw(Bu||(Bu=tn(["(Z)s*"],["(Z)\\s*"]))),cS="(C) (?:".concat(Tt," ").concat(Tt," ").concat(Tt," ").concat(Tt," ").concat(Tt," ").concat(Tt," ?)+"),uS="(S) (?:".concat(Tt," ").concat(Tt," ").concat(Tt," ").concat(Tt," ?)+"),fS="(Q) (?:".concat(Tt," ").concat(Tt," ").concat(Tt," ").concat(Tt," ?)+"),dS="(T) (?:".concat(Tt," ").concat(Tt," ?)+"),gS="(A) (?:".concat(Tt," ").concat(Tt," ").concat(Tt," ([01]) ?([01]) ").concat(Tt," ").concat(Tt," ?)+"),Wu="(?:(?:".concat(sS,")")+"|(?:".concat(oS,")")+"|(?:".concat(aS,")")+"|(?:".concat(lS,")")+"|(?:".concat(hS,")")+"|(?:".concat(cS,")")+"|(?:".concat(uS,")")+"|(?:".concat(fS,")")+"|(?:".concat(dS,")")+"|(?:".concat(gS,"))"),pS={m:"l",M:"L"},mS=(a,t,e,n,r,o,l,c,u,d,g)=>{const _=ae(a),y=le(a),x=ae(t),S=le(t),E=e*r*x-n*o*S+l,P=n*r*x+e*o*S+c,L=d+u*(-e*r*y-n*o*_),W=g+u*(-n*r*y+e*o*_),Y=E+u*(e*r*S+n*o*x),H=P+u*(n*r*S-e*o*x);return["C",L,W,Y,H,E,P]},_S=(a,t,e,n,r,o,l)=>{if(e===0||n===0)return[];let c=0,u=0,d=0;const g=Math.PI,_=l*Ua,y=le(_),x=ae(_),S=.5*(-x*a-y*t),E=.5*(-x*t+y*a),P=e**2,L=n**2,W=E**2,Y=S**2,H=P*L-P*W-L*Y;let z=Math.abs(e),U=Math.abs(n);if(H<0){const zt=Math.sqrt(1-H/(P*L));z*=zt,U*=zt}else d=(r===o?-1:1)*Math.sqrt(H/(P*W+L*Y));const A=d*z*E/U,R=-d*U*S/z,N=x*A-y*R+a*.5,tt=y*A+x*R+t*.5;let Dt=ju(1,0,(S-A)/z,(E-R)/U),vt=ju((S-A)/z,(E-R)/U,(-S-A)/z,(-E-R)/U);o===0&&vt>0?vt-=2*g:o===1&&vt<0&&(vt+=2*g);const Ft=Math.ceil(Math.abs(vt/g*2)),yt=new Array(Ft),Mt=vt/Ft,he=8/3*Math.sin(Mt/4)*Math.sin(Mt/4)/Math.sin(Mt/2);let ne=Dt+Mt;for(let zt=0;zt<Ft;zt++)yt[zt]=mS(Dt,ne,x,y,z,U,N,tt,he,c,u),c=yt[zt][5],u=yt[zt][6],Dt=ne,ne+=Mt;return yt},ju=(a,t,e,n)=>{const r=Math.atan2(t,a),o=Math.atan2(n,e);return o>=r?o-r:2*Math.PI-(r-o)},vS=a=>a**3,yS=a=>3*a**2*(1-a),xS=a=>3*a*(1-a)**2,CS=a=>(1-a)**3;function Xa(a,t,e,n,r,o,l,c){let u;if(at.cachesBoundsOfCurve&&(u=[...arguments].join(),or.boundsOfCurveCache[u]))return or.boundsOfCurveCache[u];const d=Math.sqrt,g=Math.abs,_=[],y=[[0,0],[0,0]];let x=6*a-12*e+6*r,S=-3*a+9*e-9*r+3*l,E=3*e-3*a;for(let H=0;H<2;++H){if(H>0&&(x=6*t-12*n+6*o,S=-3*t+9*n-9*o+3*c,E=3*n-3*t),g(S)<1e-12){if(g(x)<1e-12)continue;const N=-E/x;0<N&&N<1&&_.push(N);continue}const z=x*x-4*E*S;if(z<0)continue;const U=d(z),A=(-x+U)/(2*S);0<A&&A<1&&_.push(A);const R=(-x-U)/(2*S);0<R&&R<1&&_.push(R)}let P=_.length;const L=P,W=id(a,t,e,n,r,o,l,c);for(;P--;){const{x:H,y:z}=W(_[P]);y[0][P]=H,y[1][P]=z}y[0][L]=a,y[1][L]=t,y[0][L+1]=l,y[1][L+1]=c;const Y=[new M(Math.min(...y[0]),Math.min(...y[1])),new M(Math.max(...y[0]),Math.max(...y[1]))];return at.cachesBoundsOfCurve&&(or.boundsOfCurveCache[u]=Y),Y}const wS=(a,t,e)=>{let[n,r,o,l,c,u,d,g]=e;const _=_S(d-a,g-t,r,o,c,u,l);for(let y=0,x=_.length;y<x;y++)_[y][1]+=a,_[y][2]+=t,_[y][3]+=a,_[y][4]+=t,_[y][5]+=a,_[y][6]+=t;return _},nd=a=>{let t=0,e=0,n=0,r=0;const o=[];let l,c=0,u=0;for(const d of a){const g=[...d];let _;switch(g[0]){case"l":g[1]+=t,g[2]+=e;case"L":t=g[1],e=g[2],_=["L",t,e];break;case"h":g[1]+=t;case"H":t=g[1],_=["L",t,e];break;case"v":g[1]+=e;case"V":e=g[1],_=["L",t,e];break;case"m":g[1]+=t,g[2]+=e;case"M":t=g[1],e=g[2],n=g[1],r=g[2],_=["M",t,e];break;case"c":g[1]+=t,g[2]+=e,g[3]+=t,g[4]+=e,g[5]+=t,g[6]+=e;case"C":c=g[3],u=g[4],t=g[5],e=g[6],_=["C",g[1],g[2],c,u,t,e];break;case"s":g[1]+=t,g[2]+=e,g[3]+=t,g[4]+=e;case"S":l==="C"?(c=2*t-c,u=2*e-u):(c=t,u=e),t=g[3],e=g[4],_=["C",c,u,g[1],g[2],t,e],c=_[3],u=_[4];break;case"q":g[1]+=t,g[2]+=e,g[3]+=t,g[4]+=e;case"Q":c=g[1],u=g[2],t=g[3],e=g[4],_=["Q",c,u,t,e];break;case"t":g[1]+=t,g[2]+=e;case"T":l==="Q"?(c=2*t-c,u=2*e-u):(c=t,u=e),t=g[1],e=g[2],_=["Q",c,u,t,e];break;case"a":g[6]+=t,g[7]+=e;case"A":wS(t,e,g).forEach(y=>o.push(y)),t=g[6],e=g[7];break;case"z":case"Z":t=n,e=r,_=["Z"];break}_?(o.push(_),l=_[0]):l=""}return o},ws=(a,t,e,n)=>Math.sqrt((e-a)**2+(n-t)**2),id=(a,t,e,n,r,o,l,c)=>u=>{const d=vS(u),g=yS(u),_=xS(u),y=CS(u);return new M(l*d+r*g+e*_+a*y,c*d+o*g+n*_+t*y)},rd=a=>a**2,sd=a=>2*a*(1-a),od=a=>(1-a)**2,SS=(a,t,e,n,r,o,l,c)=>u=>{const d=rd(u),g=sd(u),_=od(u),y=3*(_*(e-a)+g*(r-e)+d*(l-r)),x=3*(_*(n-t)+g*(o-n)+d*(c-o));return Math.atan2(x,y)},bS=(a,t,e,n,r,o)=>l=>{const c=rd(l),u=sd(l),d=od(l);return new M(r*c+e*u+a*d,o*c+n*u+t*d)},TS=(a,t,e,n,r,o)=>l=>{const c=1-l,u=2*(c*(e-a)+l*(r-e)),d=2*(c*(n-t)+l*(o-n));return Math.atan2(d,u)},Xu=(a,t,e)=>{let n=new M(t,e),r=0;for(let o=1;o<=100;o+=1){const l=a(o/100);r+=ws(n.x,n.y,l.x,l.y),n=l}return r},Yu=(a,t)=>{let e=0,n=0,r={x:a.x,y:a.y},o=T({},r),l,c=.01,u=0;const d=a.iterator,g=a.angleFinder;for(;n<t&&c>1e-4;)o=d(e),u=e,l=ws(r.x,r.y,o.x,o.y),l+n>t?(e-=c,c/=2):(r=o,e+=c,n+=l);return T(T({},o),{},{angle:g(u)})},dl=a=>{let t=0,e=0,n=0,r=0,o=0,l,c;const u=[];for(const d of a){const g={x:e,y:n,command:d[0],length:0};switch(d[0]){case"M":c=g,r=e=d[1],o=n=d[2];break;case"L":c=g,c.length=ws(e,n,d[1],d[2]),e=d[1],n=d[2];break;case"C":l=id(e,n,d[1],d[2],d[3],d[4],d[5],d[6]),c=g,c.iterator=l,c.angleFinder=SS(e,n,d[1],d[2],d[3],d[4],d[5],d[6]),c.length=Xu(l,e,n),e=d[5],n=d[6];break;case"Q":l=bS(e,n,d[1],d[2],d[3],d[4]),c=g,c.iterator=l,c.angleFinder=TS(e,n,d[1],d[2],d[3],d[4]),c.length=Xu(l,e,n),e=d[3],n=d[4];break;case"Z":c=g,c.destX=r,c.destY=o,c.length=ws(e,n,r,o),e=r,n=o;break}t+=c.length,u.push(c)}return u.push({length:t,x:e,y:n}),u},Ya=function(a,t){let e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:dl(a),n=0;for(;t-e[n].length>0&&n<e.length-2;)t-=e[n].length,n++;const r=e[n],o=t/r.length,l=a[n];switch(r.command){case"M":return{x:r.x,y:r.y,angle:0};case"Z":return T(T({},new M(r.x,r.y).lerp(new M(r.destX,r.destY),o)),{},{angle:Math.atan2(r.destY-r.y,r.destX-r.x)});case"L":return T(T({},new M(r.x,r.y).lerp(new M(l[1],l[2]),o)),{},{angle:Math.atan2(l[2]-r.y,l[1]-r.x)});case"C":return Yu(r,t);case"Q":return Yu(r,t)}},ad=a=>{a=Vf(a);const t=[];for(const e of a.matchAll(new RegExp(Wu,"gi"))){let n=e[0];const r=[];let o;do{if(o=new RegExp(Wu,"i").exec(n),!o)break;const l=o.filter(u=>u);l.shift();const c=l.map(u=>{const d=Number.parseFloat(u);return Number.isNaN(d)?u:d});if(r.push(c),l.length<=1)break;l.shift(),n=n.replace(new RegExp("".concat(l.join(" ?")," ?$")),"")}while(o);r.reverse().forEach((l,c)=>{const u=pS[l[0]];c>0&&(u=="l"||u=="L")&&(l[0]=u),t.push(l)})}return t},OS=function(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=new M(a[0]),n=new M(a[1]),r=1,o=0;const l=[],c=a.length,u=c>2;u&&(r=a[2].x<n.x?-1:a[2].x===n.x?0:1,o=a[2].y<n.y?-1:a[2].y===n.y?0:1),l.push(["M",e.x-r*t,e.y-o*t]);let d;for(d=1;d<c;d++){if(!e.eq(n)){const g=e.midPointFrom(n);l.push(["Q",e.x,e.y,g.x,g.y])}e=a[d],d+1<a.length&&(n=a[d+1])}return u&&(r=e.x>a[d-2].x?1:e.x===a[d-2].x?0:-1,o=e.y>a[d-2].y?1:e.y===a[d-2].y?0:-1),l.push(["L",e.x+r*t,e.y+o*t]),l},DS=(a,t,e)=>(e&&(t=Kt(t,[1,0,0,1,-e.x,-e.y])),a.map(n=>{const r=[...n];for(let o=1;o<n.length-1;o+=2){const{x:l,y:c}=Bt({x:n[o],y:n[o+1]},t);r[o]=l,r[o+1]=c}return r})),ES=(a,t)=>{const e=Math.PI*2/a;let n=-mn;a%2===0&&(n+=e/2);const r=new Array(a+1);for(let o=0;o<a;o++){const l=o*e+n,{x:c,y:u}=new M(ae(l),le(l)).scalarMultiply(t);r[o]=[o===0?"M":"L",c,u]}return r[a]=["Z"],r},ld=(a,t)=>a.map(e=>e.map((n,r)=>r===0||t===void 0?n:ut(n,t)).join(" ")).join(" "),PS=(a,t)=>{var e;let n=a,r=t;n.inverted&&!r.inverted&&(n=t,r=a),il(r,(e=r.group)===null||e===void 0?void 0:e.calcTransformMatrix(),n.calcTransformMatrix());const o=n.inverted&&r.inverted;return o&&(n.inverted=r.inverted=!1),new en([n],{clipPath:r,inverted:o})};function AS(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e=t.method?t.method.toUpperCase():"GET",n=t.onComplete||Qn,r=new(Jn()).XMLHttpRequest,o=t.body||t.parameters,l=t.signal,c=function(){r.abort()},u=function(){l&&l.removeEventListener("abort",c),r.onerror=r.ontimeout=Qn};if(l&&l.aborted)throw new Error("`options.signal` is in `aborted` state");if(l&&l.addEventListener("abort",c,{once:!0}),r.onreadystatechange=function(){r.readyState===4&&(u(),n(r),r.onreadystatechange=Qn)},r.onerror=r.ontimeout=u,e==="GET"&&t.parameters){const{origin:d,pathname:g,searchParams:_}=new URL(a);a="".concat(d).concat(g,"?").concat(new URLSearchParams([...Array.from(_.entries()),...Object.entries(t.parameters)]))}return r.open(e,a,!0),(e==="POST"||e==="PUT")&&r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.send(e==="GET"?null:o),r}const MS=a=>{if(a.transformMatrix){const{scaleX:t,scaleY:e,angle:n,skewX:r}=Fn(a.transformMatrix);a.flipX=!1,a.flipY=!1,a.set("scaleX",t),a.set("scaleY",e),a.angle=n,a.skewX=r,a.skewY=0}},Ha=(a,t)=>{let e=a._findCenterFromElement();a.transformMatrix&&(MS(a),e=e.transform(a.transformMatrix)),delete a.transformMatrix,t&&(a.scaleX*=t.scaleX,a.scaleY*=t.scaleY,a.cropX=t.cropX,a.cropY=t.cropY,e.x+=t.offsetLeft,e.y+=t.offsetTop,a.width=t.width,a.height=t.height),a.setPositionByOrigin(e,et,et)};var yb=Object.freeze({__proto__:null,addTransformToObject:pf,animate:al,animateColor:Tf,applyTransformToObject:Ai,calcAngleBetweenVectors:Ls,calcDimensionsMatrix:Ja,calcPlaneChangeMatrix:el,cancelAnimFrame:nf,capValue:ei,composeMatrix:of,copyCanvasElement:$x,cos:ae,createCanvasElement:Wt,createImage:rf,createRotateMatrix:mr,createScaleMatrix:Ka,createSkewXMatrix:qa,createSkewYMatrix:$a,createTranslateMatrix:pr,createVector:ni,degreesToRadians:Ot,ease:VC,enlivenObjectEnlivables:_r,enlivenObjects:Pi,findScaleToCover:Qf,findScaleToFit:Zf,getBisector:Fa,getBoundsOfCurve:Xa,getPathSegmentsInfo:dl,getPointOnPath:Ya,getPointer:gf,getRandomInt:Nx,getRegularPolygonPath:ES,getSmoothPathFromPoints:OS,getSvgAttributes:iC,getUnitVector:Fs,groupSVGElements:eS,hasStyleChanged:js,invertTransform:Nt,isIdentityMatrix:Qx,isTouchEvent:xs,isTransparent:Gf,joinPath:ld,loadImage:lr,makeBoundingBoxFromPoints:pn,makePathSimpler:nd,matrixToSVG:fr,mergeClipPaths:PS,multiplyTransformMatrices:Kt,multiplyTransformMatrixArray:ks,parsePath:ad,parsePreserveAspectRatioAttribute:lf,parseUnit:Oi,pick:ii,projectStrokeOnPoints:qf,qrDecompose:Fn,radiansToDegrees:Ei,removeFromArray:$n,removeTransformFromObject:dC,removeTransformMatrixForSvgParsing:Ha,request:AS,requestAnimFrame:ar,resetObjectTransform:Za,rotatePoint:Qw,rotateVector:ll,saveObjectTransform:Qa,sendObjectToPlane:il,sendPointToPlane:nl,setStyle:dr,sin:le,sizeAfterTransform:tl,string:rS,stylesFromArray:Jf,stylesToArray:$f,toDataURL:Na,toFixed:ut,transformPath:DS,transformPoint:Bt,transformPointRelativeToCanvas:gC});class kS extends df{constructor(t){let{allowTouchScrolling:e=!1,containerClass:n=""}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t),D(this,"upper",void 0),D(this,"container",void 0);const{el:r}=this.lower,o=this.createUpperCanvas();this.upper={el:o,ctx:o.getContext("2d")},this.applyCanvasStyle(r,{allowTouchScrolling:e}),this.applyCanvasStyle(o,{allowTouchScrolling:e});const l=this.createContainerElement();l.classList.add(n),r.parentNode&&r.parentNode.replaceChild(l,r),l.append(r,o),this.container=l}createUpperCanvas(){const{el:t}=this.lower,e=Wt();return e.className=t.className,e.classList.remove("lower-canvas"),e.classList.add("upper-canvas"),e.setAttribute("data-fabric","top"),e.style.cssText=t.style.cssText,e.setAttribute("draggable","true"),e}createContainerElement(){const t=Mi().createElement("div");return t.setAttribute("data-fabric","wrapper"),dr(t,{position:"relative"}),bu(t),t}applyCanvasStyle(t,e){let{allowTouchScrolling:n}=e;dr(t,{position:"absolute",left:0,top:0}),aC(t,n),bu(t)}setDimensions(t,e){super.setDimensions(t,e);const{el:n,ctx:r}=this.upper;ff(n,r,t,e)}setCSSDimensions(t){super.setCSSDimensions(t),ka(this.upper.el,t),ka(this.container,t)}cleanupDOM(t){const e=this.container,{el:n}=this.lower,{el:r}=this.upper;super.cleanupDOM(t),e.removeChild(r),e.removeChild(n),e.parentNode&&e.parentNode.replaceChild(n,e)}dispose(){super.dispose(),Qe().dispose(this.upper.el),delete this.upper,delete this.container}}const LS={uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",selection:!0,selectionKey:"shiftKey",selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,preserveObjectStacking:!1,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,enablePointerEvents:!1};class Xs extends vr{static getDefaults(){return T(T({},super.getDefaults()),Xs.ownDefaults)}get upperCanvasEl(){var t;return(t=this.elements.upper)===null||t===void 0?void 0:t.el}get contextTop(){var t;return(t=this.elements.upper)===null||t===void 0?void 0:t.ctx}get wrapperEl(){return this.elements.container}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),D(this,"interactive",!0),D(this,"targets",[]),D(this,"_hoveredTargets",[]),D(this,"_objectsToRender",[]),D(this,"_currentTransform",null),D(this,"_groupSelector",null),D(this,"contextTopDirty",!1),D(this,"_activeSelection",void 0),this._activeSelection=new Ws([],{canvas:this})}initElements(t){this.elements=new kS(t,{allowTouchScrolling:this.allowTouchScrolling,containerClass:this.containerClass}),this._createCacheCanvas()}_onObjectAdded(t){this._objectsToRender=void 0,super._onObjectAdded(t)}_onObjectRemoved(t){this._objectsToRender=void 0,t===this._activeObject&&(this.fire("before:selection:cleared",{deselected:[t]}),this._discardActiveObject(),this.fire("selection:cleared",{deselected:[t]}),t.fire("deselected",{target:t})),t===this._hoveredTarget&&(this._hoveredTarget=void 0,this._hoveredTargets=[]),super._onObjectRemoved(t)}_chooseObjectsToRender(){const t=this._activeObject;return!this.preserveObjectStacking&&t?this._objects.filter(e=>!e.group&&e!==t).concat(t):this._objects}renderAll(){this.cancelRequestedRender(),!this.destroyed&&(this.contextTopDirty&&!this._groupSelector&&!this.isDrawingMode&&(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),!this._objectsToRender&&(this._objectsToRender=this._chooseObjectsToRender()),this.renderCanvas(this.getContext(),this._objectsToRender))}renderTopLayer(t){t.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(t),this.contextTopDirty=!0),t.restore()}renderTop(){const t=this.contextTop;this.clearContext(t),this.renderTopLayer(t),this.fire("after:render",{ctx:t})}_normalizePointer(t,e){return Bt(this.restorePointerVpt(e),Nt(t.calcTransformMatrix()))}setTargetFindTolerance(t){t=Math.round(t),this.targetFindTolerance=t;const e=this.getRetinaScaling(),n=Math.ceil((t*2+1)*e);this.pixelFindCanvasEl.width=this.pixelFindCanvasEl.height=n,this.pixelFindContext.scale(e,e)}isTargetTransparent(t,e,n){const r=this.targetFindTolerance,o=this.pixelFindContext;this.clearContext(o),o.save(),o.translate(-e+r,-n+r),o.transform(...this.viewportTransform);const l=t.selectionBackgroundColor;t.selectionBackgroundColor="",t.render(o),t.selectionBackgroundColor=l,o.restore();const c=Math.round(r*this.getRetinaScaling());return Gf(o,c,c,c)}_isSelectionKeyPressed(t){const e=this.selectionKey;return e?Array.isArray(e)?!!e.find(n=>!!n&&t[n]===!0):t[e]:!1}_shouldClearSelection(t,e){const n=this.getActiveObjects(),r=this._activeObject;return!!(!e||e&&r&&n.length>1&&n.indexOf(e)===-1&&r!==e&&!this._isSelectionKeyPressed(t)||e&&!e.evented||e&&!e.selectable&&r&&r!==e)}_shouldCenterTransform(t,e,n){if(!t)return;let r;return e==="scale"||e==="scaleX"||e==="scaleY"||e==="resizing"?r=this.centeredScaling||t.centeredScaling:e==="rotate"&&(r=this.centeredRotation||t.centeredRotation),r?!n:n}_getOriginFromCorner(t,e){const n={x:t.originX,y:t.originY};return["ml","tl","bl"].includes(e)?n.x=Yt:["mr","tr","br"].includes(e)&&(n.x=dt),["tl","mt","tr"].includes(e)?n.y=Pa:["bl","mb","br"].includes(e)&&(n.y=ee),n}_setupCurrentTransform(t,e,n){if(!e)return;const r=e.group?nl(this.getPointer(t),void 0,e.group.calcTransformMatrix()):this.getPointer(t),o=e.__corner||"",l=!!o&&e.controls[o],c=n&&l?l.getActionHandler(t,e,l):xf,u=mC(n,o,t,e),d=this._getOriginFromCorner(e,o),g=t[this.centeredKey],_={target:e,action:u,actionHandler:c,actionPerformed:!1,corner:o,scaleX:e.scaleX,scaleY:e.scaleY,skewX:e.skewX,skewY:e.skewY,offsetX:r.x-e.left,offsetY:r.y-e.top,originX:d.x,originY:d.y,ex:r.x,ey:r.y,lastX:r.x,lastY:r.y,theta:Ot(e.angle),width:e.width,height:e.height,shiftKey:t.shiftKey,altKey:g,original:T(T({},Qa(e)),{},{originX:d.x,originY:d.y})};this._shouldCenterTransform(e,u,g)&&(_.originX=et,_.originY=et),this._currentTransform=_,this._beforeTransform(t)}setCursor(t){this.upperCanvasEl.style.cursor=t}_drawSelection(t){const{x:e,y:n,deltaX:r,deltaY:o}=this._groupSelector,l=new M(e,n).transform(this.viewportTransform),c=new M(e+r,n+o).transform(this.viewportTransform),u=this.selectionLineWidth/2;let d=Math.min(l.x,c.x),g=Math.min(l.y,c.y),_=Math.max(l.x,c.x),y=Math.max(l.y,c.y);this.selectionColor&&(t.fillStyle=this.selectionColor,t.fillRect(d,g,_-d,y-g)),!(!this.selectionLineWidth||!this.selectionBorderColor)&&(t.lineWidth=this.selectionLineWidth,t.strokeStyle=this.selectionBorderColor,d+=u,g+=u,_-=u,y-=u,qt.prototype._setLineDash.call(this,t,this.selectionDashArray),t.strokeRect(d,g,_-d,y-g))}findTarget(t){if(this.skipTargetFind)return;const e=this.getPointer(t,!0),n=this._activeObject,r=this.getActiveObjects();if(this.targets=[],n&&r.length>=1){if(n._findTargetCorner(e,xs(t)))return n;if(r.length>1&&this.searchPossibleTargets([n],e))return n;if(n===this.searchPossibleTargets([n],e))if(this.preserveObjectStacking){const o=this.targets;this.targets=[];const l=this.searchPossibleTargets(this._objects,e);return t[this.altSelectionKey]&&l&&l!==n?(this.targets=o,n):l}else return n}return this.searchPossibleTargets(this._objects,e)}_checkTarget(t,e,n){if(e&&e.visible&&e.evented&&e.containsPoint(t))if((this.perPixelTargetFind||e.perPixelTargetFind)&&!e.isEditing){if(!this.isTargetTransparent(e,n.x,n.y))return!0}else return!0;return!1}_searchPossibleTargets(t,e){let n,r=t.length;for(;r--;){const o=t[r],l=o.group?this._normalizePointer(o.group,e):e;if(this._checkTarget(l,o,e)){if(n=t[r],Ma(n)&&n.subTargetCheck){const c=this._searchPossibleTargets(n._objects,e);c&&this.targets.push(c)}break}}return n}searchPossibleTargets(t,e){const n=this._searchPossibleTargets(t,e);return n&&Ma(n)&&n.interactive&&this.targets[0]?this.targets[0]:n}restorePointerVpt(t){return t.transform(Nt(this.viewportTransform))}getPointer(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this._absolutePointer&&!e)return this._absolutePointer;if(this._pointer&&e)return this._pointer;const n=this.upperCanvasEl,r=n.getBoundingClientRect();let o=gf(t),l=r.width||0,c=r.height||0;(!l||!c)&&(ee in r&&Pa in r&&(c=Math.abs(r.top-r.bottom)),Yt in r&&dt in r&&(l=Math.abs(r.right-r.left))),this.calcOffset(),o.x=o.x-this._offset.left,o.y=o.y-this._offset.top,e||(o=this.restorePointerVpt(o));const u=this.getRetinaScaling();u!==1&&(o.x/=u,o.y/=u);const d=l===0||c===0?new M(1,1):new M(n.width/l,n.height/c);return o.multiply(d)}_setDimensionsImpl(t,e){this._resetTransformEventData(),super._setDimensionsImpl(t,e),this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop)}_createCacheCanvas(){this.pixelFindCanvasEl=Wt(),this.pixelFindContext=this.pixelFindCanvasEl.getContext("2d",{willReadFrequently:!0}),this.setTargetFindTolerance(this.targetFindTolerance)}getTopContext(){return this.elements.upper.ctx}getSelectionContext(){return this.elements.upper.ctx}getSelectionElement(){return this.elements.upper.el}getActiveObject(){return this._activeObject}getActiveSelection(){return this._activeSelection}getActiveObjects(){const t=this._activeObject;return t?t===this._activeSelection?[...t._objects]:[t]:[]}_fireSelectionEvents(t,e){let n=!1,r=!1;const o=this.getActiveObjects(),l=[],c=[];t.forEach(u=>{o.includes(u)||(n=!0,u.fire("deselected",{e,target:u}),c.push(u))}),o.forEach(u=>{t.includes(u)||(n=!0,u.fire("selected",{e,target:u}),l.push(u))}),t.length>0&&o.length>0?(r=!0,n&&this.fire("selection:updated",{e,selected:l,deselected:c})):o.length>0?(r=!0,this.fire("selection:created",{e,selected:l})):t.length>0&&(r=!0,this.fire("selection:cleared",{e,deselected:c})),r&&(this._objectsToRender=void 0)}setActiveObject(t,e){const n=this.getActiveObjects(),r=this._setActiveObject(t,e);return this._fireSelectionEvents(n,e),r}_setActiveObject(t,e){return this._activeObject===t||!this._discardActiveObject(e,t)&&this._activeObject||t.onSelect({e})?!1:(this._activeObject=t,!0)}_discardActiveObject(t,e){const n=this._activeObject;return n?n.onDeselect({e:t,object:e})?!1:(n===this._activeSelection&&(this._activeSelection.removeAll(),Za(this._activeSelection)),this._currentTransform&&this._currentTransform.target===n&&this.endCurrentTransform(t),this._activeObject=void 0,!0):!1}discardActiveObject(t){const e=this.getActiveObjects(),n=this.getActiveObject();e.length&&this.fire("before:selection:cleared",{e:t,deselected:[n]});const r=this._discardActiveObject(t);return this._fireSelectionEvents(e,t),r}setViewportTransform(t){super.setViewportTransform(t);const e=this._activeObject;e&&e.setCoords()}destroy(){const t=this._activeSelection;t.removeAll(),this._activeSelection=void 0,t.dispose(),super.destroy(),this.pixelFindContext=null,this.pixelFindCanvasEl=void 0}clear(){this.discardActiveObject(),this._activeObject=void 0,this.clearContext(this.contextTop),super.clear()}drawControls(t){const e=this._activeObject;e&&e._renderControls(t)}_toObject(t,e,n){const r=this._realizeGroupTransformOnObject(t),o=super._toObject(t,e,n);return t.set(r),o}_realizeGroupTransformOnObject(t){if(t.group&&t.group===this._activeSelection&&this._activeObject===t.group){const n=ii(t,["angle","flipX","flipY",dt,"scaleX","scaleY","skewX","skewY",ee]);return pf(t,this._activeObject.calcOwnMatrix()),n}else return{}}_setSVGObject(t,e,n){const r=this._realizeGroupTransformOnObject(e);super._setSVGObject(t,e,n),e.set(r)}}D(Xs,"ownDefaults",LS);class FS{constructor(t){D(this,"targets",[]),D(this,"__disposer",void 0);const e=()=>{const r=t.getActiveObject();ms(r)&&r.hiddenTextarea&&r.hiddenTextarea.focus()},n=t.upperCanvasEl;n.addEventListener("click",e),this.__disposer=()=>n.removeEventListener("click",e)}exitTextEditing(){this.target=void 0,this.targets.forEach(t=>{t.isEditing&&t.exitEditing()})}add(t){this.targets.push(t)}remove(t){this.unregister(t),$n(this.targets,t)}register(t){this.target=t}unregister(t){t===this.target&&(this.target=void 0)}onMouseMove(t){var e;!((e=this.target)===null||e===void 0)&&e.isEditing&&this.target.updateSelectionOnMouseMove(t)}clear(){this.targets=[],this.target=void 0}dispose(){this.clear(),this.__disposer(),delete this.__disposer}}const RS=["target","oldTarget","fireCanvas","e"],Se={passive:!1};function ps(a,t){return!!a.button&&a.button===t-1}const An=function(a){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];return a.addEventListener(...e)},Fe=function(a){for(var t=arguments.length,e=new Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];return a.removeEventListener(...e)},IS={mouse:{in:"over",out:"out",targetIn:"mouseover",targetOut:"mouseout",canvasIn:"mouse:over",canvasOut:"mouse:out"},drag:{in:"enter",out:"leave",targetIn:"dragenter",targetOut:"dragleave",canvasIn:"drag:enter",canvasOut:"drag:leave"}};class Hu extends Xs{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(t,e),D(this,"_isClick",void 0),D(this,"textEditingManager",new FS(this)),["_onMouseDown","_onTouchStart","_onMouseMove","_onMouseUp","_onTouchEnd","_onResize","_onMouseWheel","_onMouseOut","_onMouseEnter","_onContextMenu","_onDoubleClick","_onDragStart","_onDragEnd","_onDragProgress","_onDragOver","_onDragEnter","_onDragLeave","_onDrop"].forEach(n=>{this[n]=this[n].bind(this)}),this.addOrRemove(An,"add")}_getEventPrefix(){return this.enablePointerEvents?"pointer":"mouse"}addOrRemove(t,e){const n=this.upperCanvasEl,r=this._getEventPrefix();t(uf(n),"resize",this._onResize),t(n,r+"down",this._onMouseDown),t(n,"".concat(r,"move"),this._onMouseMove,Se),t(n,"".concat(r,"out"),this._onMouseOut),t(n,"".concat(r,"enter"),this._onMouseEnter),t(n,"wheel",this._onMouseWheel),t(n,"contextmenu",this._onContextMenu),t(n,"dblclick",this._onDoubleClick),t(n,"dragstart",this._onDragStart),t(n,"dragend",this._onDragEnd),t(n,"dragover",this._onDragOver),t(n,"dragenter",this._onDragEnter),t(n,"dragleave",this._onDragLeave),t(n,"drop",this._onDrop),this.enablePointerEvents||t(n,"touchstart",this._onTouchStart,Se)}removeListeners(){this.addOrRemove(Fe,"remove");const t=this._getEventPrefix(),e=$e(this.upperCanvasEl);Fe(e,"".concat(t,"up"),this._onMouseUp),Fe(e,"touchend",this._onTouchEnd,Se),Fe(e,"".concat(t,"move"),this._onMouseMove,Se),Fe(e,"touchmove",this._onMouseMove,Se)}_onMouseWheel(t){this.__onMouseWheel(t)}_onMouseOut(t){const e=this._hoveredTarget,n={e:t,isClick:!1,pointer:this.getPointer(t),absolutePointer:this.getPointer(t,!0)};this.fire("mouse:out",T(T({},n),{},{target:e})),this._hoveredTarget=void 0,e&&e.fire("mouseout",T({},n)),this._hoveredTargets.forEach(r=>{this.fire("mouse:out",T(T({},n),{},{target:r})),r&&r.fire("mouseout",T({},n))}),this._hoveredTargets=[]}_onMouseEnter(t){!this._currentTransform&&!this.findTarget(t)&&(this.fire("mouse:over",{e:t,isClick:!1,pointer:this.getPointer(t),absolutePointer:this.getPointer(t,!0)}),this._hoveredTarget=void 0,this._hoveredTargets=[])}_onDragStart(t){this._isClick=!1;const e=this.getActiveObject();if(Su(e)&&e.onDragStart(t)){this._dragSource=e;const n={e:t,target:e};this.fire("dragstart",n),e.fire("dragstart",n),An(this.upperCanvasEl,"drag",this._onDragProgress);return}La(t)}_renderDragEffects(t,e,n){let r=!1;const o=this._dropTarget;o&&o!==e&&o!==n&&(o.clearContextTop(),r=!0),e==null||e.clearContextTop(),n!==e&&(n==null||n.clearContextTop());const l=this.contextTop;l.save(),l.transform(...this.viewportTransform),e&&(l.save(),e.transform(l),e.renderDragSourceEffect(t),l.restore(),r=!0),n&&(l.save(),n.transform(l),n.renderDropTargetEffect(t),l.restore(),r=!0),l.restore(),r&&(this.contextTopDirty=!0)}_onDragEnd(t){const e=!!t.dataTransfer&&t.dataTransfer.dropEffect!==pe,n=e?this._activeObject:void 0,r={e:t,target:this._dragSource,subTargets:this.targets,dragSource:this._dragSource,didDrop:e,dropTarget:n};Fe(this.upperCanvasEl,"drag",this._onDragProgress),this.fire("dragend",r),this._dragSource&&this._dragSource.fire("dragend",r),delete this._dragSource,this._onMouseUp(t)}_onDragProgress(t){const e={e:t,target:this._dragSource,dragSource:this._dragSource,dropTarget:this._draggedoverTarget};this.fire("drag",e),this._dragSource&&this._dragSource.fire("drag",e)}findDragTargets(t){return this.targets=[],{target:this._searchPossibleTargets(this._objects,this.getPointer(t,!0)),targets:[...this.targets]}}_onDragOver(t){const e="dragover",{target:n,targets:r}=this.findDragTargets(t),o=this._dragSource,l={e:t,target:n,subTargets:r,dragSource:o,canDrop:!1,dropTarget:void 0};let c;this.fire(e,l),this._fireEnterLeaveEvents(n,l),n&&(n.canDrop(t)&&(c=n),n.fire(e,l));for(let u=0;u<r.length;u++){const d=r[u];d.canDrop(t)&&(c=d),d.fire(e,l)}this._renderDragEffects(t,o,c),this._dropTarget=c}_onDragEnter(t){const{target:e,targets:n}=this.findDragTargets(t),r={e:t,target:e,subTargets:n,dragSource:this._dragSource};this.fire("dragenter",r),this._fireEnterLeaveEvents(e,r)}_onDragLeave(t){const e={e:t,target:this._draggedoverTarget,subTargets:this.targets,dragSource:this._dragSource};this.fire("dragleave",e),this._fireEnterLeaveEvents(void 0,e),this._renderDragEffects(t,this._dragSource),this._dropTarget=void 0,this.targets=[],this._hoveredTargets=[]}_onDrop(t){const{target:e,targets:n}=this.findDragTargets(t),r=this._basicEventHandler("drop:before",{e:t,target:e,subTargets:n,dragSource:this._dragSource,pointer:this.getPointer(t)});r.didDrop=!1,r.dropTarget=void 0,this._basicEventHandler("drop",r),this.fire("drop:after",r)}_onContextMenu(t){const e=this.findTarget(t),n=this.targets||[],r=this._basicEventHandler("contextmenu:before",{e:t,target:e,subTargets:n});return this.stopContextMenu&&La(t),this._basicEventHandler("contextmenu",r),!1}_onDoubleClick(t){this._cacheTransformEventData(t),this._handleEvent(t,"dblclick"),this._resetTransformEventData()}getPointerId(t){const e=t.changedTouches;return e?e[0]&&e[0].identifier:this.enablePointerEvents?t.pointerId:-1}_isMainEvent(t){return t.isPrimary===!0?!0:t.isPrimary===!1?!1:t.type==="touchend"&&t.touches.length===0?!0:t.changedTouches?t.changedTouches[0].identifier===this.mainTouchId:!0}_onTouchStart(t){t.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();const e=this.upperCanvasEl,n=this._getEventPrefix(),r=$e(e);An(r,"touchend",this._onTouchEnd,Se),An(r,"touchmove",this._onMouseMove,Se),Fe(e,"".concat(n,"down"),this._onMouseDown)}_onMouseDown(t){this.__onMouseDown(t),this._resetTransformEventData();const e=this.upperCanvasEl,n=this._getEventPrefix();Fe(e,"".concat(n,"move"),this._onMouseMove,Se);const r=$e(e);An(r,"".concat(n,"up"),this._onMouseUp),An(r,"".concat(n,"move"),this._onMouseMove,Se)}_onTouchEnd(t){if(t.touches.length>0)return;this.__onMouseUp(t),this._resetTransformEventData(),this.mainTouchId=null;const e=this._getEventPrefix(),n=$e(this.upperCanvasEl);Fe(n,"touchend",this._onTouchEnd,Se),Fe(n,"touchmove",this._onMouseMove,Se),this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(()=>{An(this.upperCanvasEl,"".concat(e,"down"),this._onMouseDown),this._willAddMouseDown=0},400)}_onMouseUp(t){this.__onMouseUp(t),this._resetTransformEventData();const e=this.upperCanvasEl,n=this._getEventPrefix();if(this._isMainEvent(t)){const r=$e(this.upperCanvasEl);Fe(r,"".concat(n,"up"),this._onMouseUp),Fe(r,"".concat(n,"move"),this._onMouseMove,Se),An(e,"".concat(n,"move"),this._onMouseMove,Se)}}_onMouseMove(t){const e=this.getActiveObject();!this.allowTouchScrolling&&(!e||Su(e)&&!e.shouldStartDragging())&&t.preventDefault&&t.preventDefault(),this.__onMouseMove(t)}_onResize(){this.calcOffset(),this._resetTransformEventData()}_shouldRender(t){const e=this.getActiveObject();return!!e!=!!t||e&&t&&e!==t?!0:(ms(e),!1)}__onMouseUp(t){const e=this._currentTransform;this._cacheTransformEventData(t);const n=this._target,r=this._isClick;if(this._handleEvent(t,"up:before"),ps(t,ds)){this.fireRightClick&&this._handleEvent(t,"up",ds,r);return}if(ps(t,fs)){this.fireMiddleClick&&this._handleEvent(t,"up",fs,r),this._resetTransformEventData();return}if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(t);return}if(!this._isMainEvent(t))return;let o=!1;if(e&&(this._finalizeCurrentTransform(t),o=e.actionPerformed),!r){const u=n===this._activeObject;this.handleSelection(t),o||(o=this._shouldRender(n)||!u&&n===this._activeObject)}let l,c;if(n){if(c=n._findTargetCorner(this.getPointer(t,!0),xs(t)),n.selectable&&n!==this._activeObject&&n.activeOn==="up")this.setActiveObject(n,t),o=!0;else{const u=n.controls[c],d=u&&u.getMouseUpHandler(t,n,u);d&&(l=this.getPointer(t),d(t,e,l.x,l.y))}n.isMoving=!1}if(e&&(e.target!==n||e.corner!==c)){const u=e.target&&e.target.controls[e.corner],d=u&&u.getMouseUpHandler(t,e.target,u);l=l||this.getPointer(t),d&&d(t,e,l.x,l.y)}this._setCursorFromEvent(t,n),this._handleEvent(t,"up",mu,r),this._groupSelector=null,this._currentTransform=null,n&&(n.__corner=void 0),o?this.requestRenderAll():!r&&!(ms(this._activeObject)&&this._activeObject.isEditing)&&this.renderTop()}_basicEventHandler(t,e){const{target:n,subTargets:r=[]}=e;this.fire(t,e),n&&n.fire(t,e);for(let o=0;o<r.length;o++)r[o].fire(t,e);return e}_handleEvent(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:mu,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const o=this._target,l=this.targets||[],c={e:t,target:o,subTargets:l,button:n,isClick:r,pointer:this.getPointer(t),absolutePointer:this.getPointer(t,!0),transform:this._currentTransform};e==="up"&&(c.currentTarget=this.findTarget(t),c.currentSubTargets=this.targets),this.fire("mouse:".concat(e),c),o&&o.fire("mouse".concat(e),c);for(let u=0;u<l.length;u++)l[u].fire("mouse".concat(e),c)}endCurrentTransform(t){const e=this._currentTransform;this._finalizeCurrentTransform(t),e&&e.target&&(e.target.isMoving=!1),this._currentTransform=null}_finalizeCurrentTransform(t){const e=this._currentTransform,n=e.target,r={e:t,target:n,transform:e,action:e.action};n._scaling&&(n._scaling=!1),n.setCoords(),e.actionPerformed&&(this.fire("object:modified",r),n.fire("modified",r))}_onMouseDownInDrawingMode(t){this._isCurrentlyDrawing=!0,this.getActiveObject()&&(this.discardActiveObject(t),this.requestRenderAll());const e=this.getPointer(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseDown(e,{e:t,pointer:e}),this._handleEvent(t,"down")}_onMouseMoveInDrawingMode(t){if(this._isCurrentlyDrawing){const e=this.getPointer(t);this.freeDrawingBrush&&this.freeDrawingBrush.onMouseMove(e,{e:t,pointer:e})}this.setCursor(this.freeDrawingCursor),this._handleEvent(t,"move")}_onMouseUpInDrawingMode(t){const e=this.getPointer(t);this.freeDrawingBrush?this._isCurrentlyDrawing=!!this.freeDrawingBrush.onMouseUp({e:t,pointer:e}):this._isCurrentlyDrawing=!1,this._handleEvent(t,"up")}__onMouseDown(t){this._isClick=!0,this._cacheTransformEventData(t),this._handleEvent(t,"down:before");let e=this._target;if(ps(t,ds)){this.fireRightClick&&this._handleEvent(t,"down",ds);return}if(ps(t,fs)){this.fireMiddleClick&&this._handleEvent(t,"down",fs);return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(t);return}if(!this._isMainEvent(t)||this._currentTransform)return;let n=this._shouldRender(e),r=!1;if(this.handleMultiSelection(t,e)?(e=this._activeObject,r=!0,n=!0):this._shouldClearSelection(t,e)&&this.discardActiveObject(t),this.selection&&(!e||!e.selectable&&!e.isEditing&&e!==this._activeObject)){const o=this.getPointer(t);this._groupSelector={x:o.x,y:o.y,deltaY:0,deltaX:0}}if(e){const o=e===this._activeObject;e.selectable&&e.activeOn==="down"&&this.setActiveObject(e,t);const l=e._findTargetCorner(this.getPointer(t,!0),xs(t));if(e===this._activeObject&&(l||!r)){this._setupCurrentTransform(t,e,o);const c=e.controls[l],u=this.getPointer(t),d=c&&c.getMouseDownHandler(t,e,c);d&&d(t,this._currentTransform,u.x,u.y)}}n&&(this._objectsToRender=void 0),this._handleEvent(t,"down"),n&&this.requestRenderAll()}_resetTransformEventData(){this._target=void 0,this._pointer=void 0,this._absolutePointer=void 0}_cacheTransformEventData(t){this._resetTransformEventData(),this._pointer=this.getPointer(t,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(t)}_beforeTransform(t){const e=this._currentTransform;this.fire("before:transform",{e:t,transform:e})}__onMouseMove(t){if(this._isClick=!1,this._handleEvent(t,"move:before"),this._cacheTransformEventData(t),this.isDrawingMode){this._onMouseMoveInDrawingMode(t);return}if(!this._isMainEvent(t))return;const e=this._groupSelector;if(e){const n=this.getPointer(t);e.deltaX=n.x-e.x,e.deltaY=n.y-e.y,this.renderTop()}else if(this._currentTransform)this._transformObject(t);else{const n=this.findTarget(t);this._setCursorFromEvent(t,n),this._fireOverOutEvents(t,n)}this.textEditingManager.onMouseMove(t),this._handleEvent(t,"move"),this._resetTransformEventData()}_fireOverOutEvents(t,e){const n=this._hoveredTarget,r=this._hoveredTargets,o=this.targets,l=Math.max(r.length,o.length);this.fireSyntheticInOutEvents("mouse",{e:t,target:e,oldTarget:n,fireCanvas:!0});for(let c=0;c<l;c++)this.fireSyntheticInOutEvents("mouse",{e:t,target:o[c],oldTarget:r[c]});this._hoveredTarget=e,this._hoveredTargets=this.targets.concat()}_fireEnterLeaveEvents(t,e){const n=this._draggedoverTarget,r=this._hoveredTargets,o=this.targets,l=Math.max(r.length,o.length);this.fireSyntheticInOutEvents("drag",T(T({},e),{},{target:t,oldTarget:n,fireCanvas:!0}));for(let c=0;c<l;c++)this.fireSyntheticInOutEvents("drag",T(T({},e),{},{target:o[c],oldTarget:r[c]}));this._draggedoverTarget=t}fireSyntheticInOutEvents(t,e){let{target:n,oldTarget:r,fireCanvas:o,e:l}=e,c=At(e,RS);const{targetIn:u,targetOut:d,canvasIn:g,canvasOut:_}=IS[t],y=r!==n;if(r&&y){const x=T(T({},c),{},{e:l,target:r,nextTarget:n,isClick:!1,pointer:this.getPointer(l),absolutePointer:this.getPointer(l,!0)});o&&this.fire(g,x),r.fire(d,x)}if(n&&y){const x=T(T({},c),{},{e:l,target:n,previousTarget:r,isClick:!1,pointer:this.getPointer(l),absolutePointer:this.getPointer(l,!0)});o&&this.fire(_,x),n.fire(u,x)}}__onMouseWheel(t){this._cacheTransformEventData(t),this._handleEvent(t,"wheel"),this._resetTransformEventData()}_transformObject(t){const e=this.getPointer(t),n=this._currentTransform,r=n.target,o=r.group?nl(e,void 0,r.group.calcTransformMatrix()):e;n.reset=!1,n.shiftKey=t.shiftKey,n.altKey=!!this.centeredKey&&t[this.centeredKey],this._performTransformAction(t,n,o),n.actionPerformed&&this.requestRenderAll()}_performTransformAction(t,e,n){const r=n.x,o=n.y,l=e.action,c=e.actionHandler;let u=!1;c&&(u=c(t,e,r,o)),l==="drag"&&u&&(e.target.isMoving=!0,this.setCursor(e.target.moveCursor||this.moveCursor)),e.actionPerformed=e.actionPerformed||u}_setCursorFromEvent(t,e){if(!e){this.setCursor(this.defaultCursor);return}let n=e.hoverCursor||this.hoverCursor;const r=this._activeObject===this._activeSelection?this._activeObject:null,o=(!r||e.group!==r)&&e._findTargetCorner(this.getPointer(t,!0));if(!o)e.subTargetCheck&&this.targets.concat().reverse().map(l=>{n=l.hoverCursor||n}),this.setCursor(n);else{const l=e.controls[o];this.setCursor(l.cursorStyleHandler(t,l,e))}}handleMultiSelection(t,e){const n=this._activeObject,r=this._activeSelection,o=n===r;if(n&&this._isSelectionKeyPressed(t)&&this.selection&&e&&e.selectable&&(n!==e||o)&&(o||!e.isDescendantOf(n)&&!n.isDescendantOf(e))&&!e.onSelect({e:t})&&!n.__corner){if(o){const l=r.getObjects();if(e===r&&(e=this.searchPossibleTargets(l,this.getPointer(t,!0)),!e||!e.selectable))return!1;e.group===r?(r.remove(e),this._hoveredTarget=e,this._hoveredTargets=[...this.targets],r.size()===1&&this._setActiveObject(r.item(0),t)):(r.multiSelectAdd(e),this._hoveredTarget=r,this._hoveredTargets=[...this.targets]),this._fireSelectionEvents(l,t)}else ms(n)&&n.exitEditing(),r.multiSelectAdd(n,e),this._hoveredTarget=r,this._setActiveObject(r,t),this._fireSelectionEvents([n],t);return!0}return!1}handleSelection(t){if(!this.selection||!this._groupSelector)return!1;const{x:e,y:n,deltaX:r,deltaY:o}=this._groupSelector,l=new M(e,n),c=l.add(new M(r,o)),u=l.min(c),d=l.max(c),g=d.subtract(u),_=l.eq(c),y=this.collectObjects({left:u.x,top:u.y,width:g.x,height:g.y},{includeIntersecting:!this.selectionFullyContained}),x=_?y[0]?[y[0]]:[]:y.length>1?y.filter(S=>!S.onSelect({e:t})).reverse():y;return x.length===1?this.setActiveObject(x[0],t):x.length>1&&(this._activeSelection.add(...x),this.setActiveObject(this._activeSelection,t)),this._groupSelector=null,!0}clear(){this.textEditingManager.clear(),super.clear()}destroy(){this.removeListeners(),this.textEditingManager.dispose(),super.destroy()}}const hd={x1:0,y1:0,x2:0,y2:0},BS=T(T({},hd),{},{r1:0,r2:0});function cd(a){return a.nodeName==="linearGradient"||a.nodeName==="LINEARGRADIENT"?"linear":"radial"}function ud(a){return a.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage"}const WS=/^(\d+\.\d+)%|(\d+)%$/;function fd(a){return a&&WS.test(a)}function dd(a,t){const e=typeof a=="number"?a:typeof a=="string"?parseFloat(a)/(fd(a)?100:1):NaN;return ei(0,bi(e,t),1)}const jS=/\s*;\s*/,XS=/\s*:\s*/;function YS(a,t){let e,n;const r=a.getAttribute("style");if(r){const l=r.split(jS);l[l.length-1]===""&&l.pop();for(let c=l.length;c--;){const[u,d]=l[c].split(XS).map(g=>g.trim());u==="stop-color"?e=d:u==="stop-opacity"&&(n=d)}}const o=new wt(e||a.getAttribute("stop-color")||"rgb(0,0,0)");return{offset:dd(a.getAttribute("offset"),0),color:o.toRgb(),opacity:bi(parseFloat(n||a.getAttribute("stop-opacity")||""),1)*o.getAlpha()*t}}function HS(a,t){const e=[],n=a.getElementsByTagName("stop"),r=dd(t,1);for(let o=n.length;o--;)e.push(YS(n[o],r));return e}function zS(a,t){let{width:e,height:n,gradientUnits:r}=t,o;return Object.keys(a).reduce((l,c)=>{const u=a[c];return u==="Infinity"?o=1:u==="-Infinity"?o=0:(o=typeof u=="string"?parseFloat(u):u,typeof u=="string"&&fd(u)&&(o*=.01,r==="pixels"&&((c==="x1"||c==="x2"||c==="r2")&&(o*=e),(c==="y1"||c==="y2")&&(o*=n)))),l[c]=o,l},{})}function ze(a,t){return a.getAttribute(t)}function GS(a){return{x1:ze(a,"x1")||0,y1:ze(a,"y1")||0,x2:ze(a,"x2")||"100%",y2:ze(a,"y2")||0}}function US(a){return{x1:ze(a,"fx")||ze(a,"cx")||"50%",y1:ze(a,"fy")||ze(a,"cy")||"50%",r1:0,x2:ze(a,"cx")||"50%",y2:ze(a,"cy")||"50%",r2:ze(a,"r")||"50%"}}function VS(a,t){return zS(cd(a)==="linear"?GS(a):US(a),T(T({},t),{},{gradientUnits:ud(a)}))}class gl{constructor(t){let{type:e="linear",gradientUnits:n="pixels",coords:r,colorStops:o=[],offsetX:l=0,offsetY:c=0,gradientTransform:u=null,id:d}=t;this.id=d?"".concat(d,"_").concat(Ln()):Ln(),this.type=e,this.gradientUnits=n,this.gradientTransform=u,this.offsetX=l,this.offsetY=c,this.coords=T(T({},this.type==="radial"?BS:hd),r),this.colorStops=o.slice()}addColorStop(t){for(const e in t){const n=new wt(t[e]);this.colorStops.push({offset:parseFloat(e),color:n.toRgb(),opacity:n.getAlpha()})}return this}toObject(t){return T(T({},ii(this,t)),{},{type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform})}toSVG(t){let{additionalTransform:e}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=[],r=this.gradientTransform?this.gradientTransform.concat():be.concat(),o=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox",l=this.colorStops.map(g=>T({},g)).sort((g,_)=>g.offset-_.offset);let c=-this.offsetX,u=-this.offsetY;o==="objectBoundingBox"?(c/=t.width,u/=t.height):(c+=t.width/2,u+=t.height/2),t instanceof Rn&&t.isType("Path")&&this.gradientUnits!=="percentage"&&(c-=t.pathOffset.x,u-=t.pathOffset.y),r[4]-=c,r[5]-=u;const d=['id="SVGID_'.concat(this.id,'"'),'gradientUnits="'.concat(o,'"'),'gradientTransform="'.concat(e?e+" ":"").concat(fr(r),'"'),""].join(" ");if(this.type==="linear"){const{x1:g,y1:_,x2:y,y2:x}=this.coords;n.push("<linearGradient ",d,' x1="',g,'" y1="',_,'" x2="',y,'" y2="',x,`">
`)}else if(this.type==="radial"){const{x1:g,y1:_,x2:y,y2:x,r1:S,r2:E}=this.coords,P=S>E;n.push("<radialGradient ",d,' cx="',P?g:y,'" cy="',P?_:x,'" r="',P?S:E,'" fx="',P?y:g,'" fy="',P?x:_,`">
`),P&&(l.reverse(),l.forEach(W=>{W.offset=1-W.offset}));const L=Math.min(S,E);if(L>0){const W=Math.max(S,E),Y=L/W;l.forEach(H=>{H.offset+=Y*(1-H.offset)})}}return l.forEach(g=>{let{color:_,offset:y,opacity:x}=g;n.push("<stop ",'offset="',y*100+"%",'" style="stop-color:',_,typeof x<"u"?";stop-opacity: "+x:";",`"/>
`)}),n.push(this.type==="linear"?"</linearGradient>":"</radialGradient>",`
`),n.join("")}toLive(t){const e=this.coords,n=this.type==="linear"?t.createLinearGradient(e.x1,e.y1,e.x2,e.y2):t.createRadialGradient(e.x1,e.y1,e.r1,e.x2,e.y2,e.r2);return this.colorStops.forEach(r=>{let{color:o,opacity:l,offset:c}=r;n.addColorStop(c,typeof l<"u"?new wt(o).setAlpha(l).toRgba():o)}),n}static fromElement(t,e,n){const r=ud(t),o=e._findCenterFromElement();return new this(T({id:t.getAttribute("id")||void 0,type:cd(t),coords:VS(t,{width:n.viewBoxWidth||n.width,height:n.viewBoxHeight||n.height}),colorStops:HS(t,n.opacity),gradientUnits:r,gradientTransform:ja(t.getAttribute("gradientTransform")||"")},r==="pixels"?{offsetX:e.width/2-o.x,offsetY:e.height/2-o.y}:{offsetX:0,offsetY:0}))}}D(gl,"type","Gradient");q.setClass(gl,"gradient");const NS=["source"];class pl{get type(){return"pattern"}set type(t){console.warn("Setting type has no effect",t)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};D(this,"repeat","repeat"),D(this,"offsetX",0),D(this,"offsetY",0),D(this,"crossOrigin",""),D(this,"patternTransform",null),this.id=Ln(),Object.assign(this,t)}isImageSource(){return!!this.source&&typeof this.source.src=="string"}isCanvasSource(){return!!this.source&&!!this.source.toDataURL}sourceToString(){return this.isImageSource()?this.source.src:this.isCanvasSource()?this.source.toDataURL():""}toLive(t){return!this.source||this.isImageSource()&&(!this.source.complete||this.source.naturalWidth===0||this.source.naturalHeight===0)?null:t.createPattern(this.source,this.repeat)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const{repeat:e,crossOrigin:n}=this;return T(T({},ii(this,t)),{},{type:"pattern",source:this.sourceToString(),repeat:e,crossOrigin:n,offsetX:ut(this.offsetX,at.NUM_FRACTION_DIGITS),offsetY:ut(this.offsetY,at.NUM_FRACTION_DIGITS),patternTransform:this.patternTransform?[...this.patternTransform]:null})}toSVG(t){let{width:e,height:n}=t;const{source:r,repeat:o,id:l}=this,c=bi(this.offsetX/e,0),u=bi(this.offsetY/n,0),d=o==="repeat-y"||o==="no-repeat"?1+Math.abs(c||0):bi(r.width/e,0),g=o==="repeat-x"||o==="no-repeat"?1+Math.abs(u||0):bi(r.height/n,0);return['<pattern id="SVGID_'.concat(l,'" x="').concat(c,'" y="').concat(u,'" width="').concat(d,'" height="').concat(g,'">'),'<image x="0" y="0" width="'.concat(r.width,'" height="').concat(r.height,'" xlink:href="').concat(this.sourceToString(),'"></image>'),"</pattern>",""].join(`
`)}static async fromObject(t,e){let{source:n}=t,r=At(t,NS);const o=await lr(n,T(T({},e),{},{crossOrigin:r.crossOrigin}));return new this(T(T({},r),{},{source:o}))}}D(pl,"type","Pattern");q.setClass(pl);q.setClass(pl,"pattern");const KS=["path","left","top"],qS=["d"];class xr extends qt{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},{path:n,left:r,top:o}=e,l=At(e,KS);super(l),this._setPath(t||[],!0),typeof r=="number"&&this.set(dt,r),typeof o=="number"&&this.set(ee,o)}_setPath(t,e){this.path=nd(Array.isArray(t)?t:ad(t)),this.setBoundingBox(e)}_findCenterFromElement(){const t=this._calcBoundsFromPath();return new M(t.left+t.width/2,t.top+t.height/2)}_renderPathCommands(t){let e=0,n=0,r=0,o=0,l=0,c=0;const u=-this.pathOffset.x,d=-this.pathOffset.y;t.beginPath();for(const g of this.path)switch(g[0]){case"L":r=g[1],o=g[2],t.lineTo(r+u,o+d);break;case"M":r=g[1],o=g[2],e=r,n=o,t.moveTo(r+u,o+d);break;case"C":r=g[5],o=g[6],l=g[3],c=g[4],t.bezierCurveTo(g[1]+u,g[2]+d,l+u,c+d,r+u,o+d);break;case"Q":t.quadraticCurveTo(g[1]+u,g[2]+d,g[3]+u,g[4]+d),r=g[3],o=g[4],l=g[1],c=g[2];break;case"Z":r=e,o=n,t.closePath();break}}_render(t){this._renderPathCommands(t),this._renderPaintInOrder(t)}toString(){return"#<Path (".concat(this.complexity(),'): { "top": ').concat(this.top,', "left": ').concat(this.left," }>")}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return T(T({},super.toObject(t)),{},{path:ki(this.path)})}toDatalessObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=this.toObject(t);return this.sourcePath&&(delete e.path,e.sourcePath=this.sourcePath),e}_toSVG(){const t=ld(this.path,at.NUM_FRACTION_DIGITS);return["<path ","COMMON_PARTS",'d="'.concat(t,`" stroke-linecap="round" />
`)]}_getOffsetTransform(){const t=at.NUM_FRACTION_DIGITS;return" translate(".concat(ut(-this.pathOffset.x,t),", ").concat(ut(-this.pathOffset.y,t),")")}toClipPathSVG(t){const e=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}toSVG(t){const e=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,additionalTransform:e})}complexity(){return this.path.length}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{width:e,height:n,pathOffset:r}=this._calcDimensions();this.set({width:e,height:n,pathOffset:r}),t&&this.setPositionByOrigin(r,et,et)}_calcBoundsFromPath(){const t=[];let e=0,n=0,r=0,o=0;for(const l of this.path)switch(l[0]){case"L":r=l[1],o=l[2],t.push(new M(e,n),new M(r,o));break;case"M":r=l[1],o=l[2],e=r,n=o;break;case"C":t.push(...Xa(r,o,l[1],l[2],l[3],l[4],l[5],l[6])),r=l[5],o=l[6];break;case"Q":t.push(...Xa(r,o,l[1],l[2],l[1],l[2],l[3],l[4])),r=l[3],o=l[4];break;case"Z":r=e,o=n;break}return pn(t)}_calcDimensions(){const t=this._calcBoundsFromPath();return T(T({},t),{},{pathOffset:new M(t.left+t.width/2,t.top+t.height/2)})}static fromObject(t){return this._fromObject(t,{extraParam:"path"})}static async fromElement(t,e){const n=vn(t,this.ATTRIBUTE_NAMES),{d:r}=n,o=At(n,qS);return new this(r,T(T(T({},o),e),{},{left:void 0,top:void 0}))}}D(xr,"type","Path");D(xr,"cacheProperties",[..._n,"path","fillRule"]);D(xr,"ATTRIBUTE_NAMES",[...In,"d"]);q.setClass(xr);q.setSVGClass(xr);const $S=["left","top","radius"],gd=["radius","startAngle","endAngle"],JS={radius:0,startAngle:0,endAngle:360};class Bn extends qt{static getDefaults(){return T(T({},super.getDefaults()),Bn.ownDefaults)}_set(t,e){return super._set(t,e),t==="radius"&&this.setRadius(e),this}_render(t){t.beginPath(),t.arc(0,0,this.radius,Ot(this.startAngle),Ot(this.endAngle),!1),this._renderPaintInOrder(t)}getRadiusX(){return this.get("radius")*this.get("scaleX")}getRadiusY(){return this.get("radius")*this.get("scaleY")}setRadius(t){this.radius=t,this.set({width:t*2,height:t*2})}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...gd,...t])}_toSVG(){const t=(this.endAngle-this.startAngle)%360;if(t===0)return["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,`" />
`];{const{radius:e}=this,n=Ot(this.startAngle),r=Ot(this.endAngle),o=ae(n)*e,l=le(n)*e,c=ae(r)*e,u=le(r)*e,d=t>180?"1":"0";return['<path d="M '.concat(o," ").concat(l)," A ".concat(e," ").concat(e)," 0 ","".concat(d," 1")," ".concat(c," ").concat(u),'" ',"COMMON_PARTS",` />
`]}}static async fromElement(t){const e=vn(t,this.ATTRIBUTE_NAMES),{left:n=0,top:r=0,radius:o=0}=e,l=At(e,$S);return new this(T(T({},l),{},{radius:o,left:n-o,top:r-o}))}static fromObject(t){return super._fromObject(t)}}D(Bn,"type","Circle");D(Bn,"cacheProperties",[..._n,...gd]);D(Bn,"ownDefaults",JS);D(Bn,"ATTRIBUTE_NAMES",["cx","cy","r",...In]);q.setClass(Bn);q.setSVGClass(Bn);const ZS=["x1","y1","x2","y2"],QS=["x1","y1","x2","y2"],ml=["x1","x2","y1","y2"];class Cr extends qt{constructor(){let[t,e,n,r]=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[0,0,0,0],o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(T(T({},o),{},{x1:t,y1:e,x2:n,y2:r})),this._setWidthHeight();const{left:l,top:c}=o;typeof l=="number"&&this.set(dt,l),typeof c=="number"&&this.set(ee,c)}_setWidthHeight(){const{x1:t,y1:e,x2:n,y2:r}=this;this.width=Math.abs(n-t),this.height=Math.abs(r-e);const{left:o,top:l,width:c,height:u}=pn([{x:t,y:e},{x:n,y:r}]),d=new M(o+c/2,l+u/2);this.setPositionByOrigin(d,et,et)}_set(t,e){return super._set(t,e),ml.includes(t)&&this._setWidthHeight(),this}_render(t){t.beginPath();const e=this.calcLinePoints();t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.lineWidth=this.strokeWidth;const n=t.strokeStyle;if(dn(this.stroke))t.strokeStyle=this.stroke.toLive(t);else{var r;t.strokeStyle=(r=this.stroke)!==null&&r!==void 0?r:t.fillStyle}this.stroke&&this._renderStroke(t),t.strokeStyle=n}_findCenterFromElement(){return new M((this.x1+this.x2)/2,(this.y1+this.y2)/2)}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return T(T({},super.toObject(t)),this.calcLinePoints())}_getNonTransformedDimensions(){const t=super._getNonTransformedDimensions();return this.strokeLineCap==="butt"&&(this.width===0&&(t.y-=this.strokeWidth),this.height===0&&(t.x-=this.strokeWidth)),t}calcLinePoints(){const{x1:t,x2:e,y1:n,y2:r,width:o,height:l}=this,c=t<=e?-1:1,u=n<=r?-1:1,d=c*o/2,g=u*l/2,_=c*-o/2,y=u*-l/2;return{x1:d,x2:_,y1:g,y2:y}}_toSVG(){const{x1:t,x2:e,y1:n,y2:r}=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="'.concat(t,'" y1="').concat(n,'" x2="').concat(e,'" y2="').concat(r,`" />
`)]}static async fromElement(t){const e=vn(t,this.ATTRIBUTE_NAMES),{x1:n=0,y1:r=0,x2:o=0,y2:l=0}=e,c=At(e,ZS);return new this([n,r,o,l],c)}static fromObject(t){let{x1:e,y1:n,x2:r,y2:o}=t,l=At(t,QS);return this._fromObject(T(T({},l),{},{points:[e,n,r,o]}),{extraParam:"points"})}}D(Cr,"type","Line");D(Cr,"cacheProperties",[..._n,...ml]);D(Cr,"ATTRIBUTE_NAMES",In.concat(ml));q.setClass(Cr);q.setSVGClass(Cr);const t1={width:100,height:100};class Li extends qt{static getDefaults(){return T(T({},super.getDefaults()),Li.ownDefaults)}_render(t){const e=this.width/2,n=this.height/2;t.beginPath(),t.moveTo(-e,n),t.lineTo(0,-n),t.lineTo(e,n),t.closePath(),this._renderPaintInOrder(t)}_toSVG(){const t=this.width/2,e=this.height/2;return["<polygon ","COMMON_PARTS",'points="',"".concat(-t," ").concat(e,",0 ").concat(-e,",").concat(t," ").concat(e),'" />']}}D(Li,"type","Triangle");D(Li,"ownDefaults",t1);q.setClass(Li);q.setSVGClass(Li);const e1={rx:0,ry:0},pd=["rx","ry"];class Wn extends qt{static getDefaults(){return T(T({},super.getDefaults()),Wn.ownDefaults)}_set(t,e){switch(super._set(t,e),t){case"rx":this.rx=e,this.set("width",e*2);break;case"ry":this.ry=e,this.set("height",e*2);break}return this}getRx(){return this.get("rx")*this.get("scaleX")}getRy(){return this.get("ry")*this.get("scaleY")}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return super.toObject([...pd,...t])}_toSVG(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]}_render(t){t.beginPath(),t.save(),t.transform(1,0,0,this.ry/this.rx,0,0),t.arc(0,0,this.rx,0,ti,!1),t.restore(),this._renderPaintInOrder(t)}static async fromElement(t){const e=vn(t,this.ATTRIBUTE_NAMES);return e.left=(e.left||0)-e.rx,e.top=(e.top||0)-e.ry,new this(e)}}D(Wn,"type","Ellipse");D(Wn,"cacheProperties",[..._n,...pd]);D(Wn,"ownDefaults",e1);D(Wn,"ATTRIBUTE_NAMES",[...In,"cx","cy","rx","ry"]);q.setClass(Wn);q.setSVGClass(Wn);function n1(a){if(!a)return null;a=a.replace(/,/g," ").trim(),a=a.split(/\s+/);const t=[];for(let e=0;e<a.length;e+=2)t.push({x:parseFloat(a[e]),y:parseFloat(a[e+1])});return t}const i1=["left","top"],md={exactBoundingBox:!1};class Ue extends qt{static getDefaults(){return T(T({},super.getDefaults()),Ue.ownDefaults)}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(T({points:t},e));const{left:n,top:r}=e;this.initialized=!0,this.setBoundingBox(!0),typeof n=="number"&&this.set(dt,n),typeof r=="number"&&this.set(ee,r)}isOpen(){return!0}_projectStrokeOnPoints(){return qf(this.points,this,this.isOpen())}_calcDimensions(){const t=this.exactBoundingBox?this._projectStrokeOnPoints().map(u=>u.projectedPoint):this.points;if(t.length===0)return{left:0,top:0,width:0,height:0,pathOffset:new M,strokeOffset:new M};const e=pn(t),n=pn(this.points),r=e.left+e.width/2,o=e.top+e.height/2,l=r-o*Math.tan(Ot(this.skewX)),c=o-l*Math.tan(Ot(this.skewY));return T(T({},e),{},{pathOffset:new M(l,c),strokeOffset:new M(n.left,n.top).subtract(new M(e.left,e.top))})}_findCenterFromElement(){const t=pn(this.points);return new M(t.left+t.width/2,t.top+t.height/2)}setDimensions(){this.setBoundingBox()}setBoundingBox(t){const{left:e,top:n,width:r,height:o,pathOffset:l,strokeOffset:c}=this._calcDimensions();this.set({width:r,height:o,pathOffset:l,strokeOffset:c}),t&&this.setPositionByOrigin(new M(e+r/2,n+o/2),et,et)}_getNonTransformedDimensions(){return this.exactBoundingBox?new M(this.width,this.height):super._getNonTransformedDimensions()}_getTransformedDimensions(t){return this.exactBoundingBox?super._getTransformedDimensions(T(T({},t||{}),{},{strokeWidth:0,skewX:0,skewY:0})):super._getTransformedDimensions(t)}_set(t,e){const n=this.initialized&&this[t]!==e,r=super._set(t,e);return n&&((t==="scaleX"||t==="scaleY")&&this.strokeUniform&&this.constructor.layoutProperties.includes("strokeUniform")&&this.strokeLineJoin!=="round"||this.constructor.layoutProperties.includes(t))&&this.setDimensions(),r}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return T(T({},super.toObject(t)),{},{points:ki(this.points)})}_toSVG(){const t=[],e=this.pathOffset.x,n=this.pathOffset.y,r=at.NUM_FRACTION_DIGITS;for(let o=0,l=this.points.length;o<l;o++)t.push(ut(this.points[o].x-e,r),",",ut(this.points[o].y-n,r)," ");return["<".concat(this.constructor.type.toLowerCase()," "),"COMMON_PARTS",'points="'.concat(t.join(""),`" />
`)]}_render(t){const e=this.points.length,n=this.pathOffset.x,r=this.pathOffset.y;if(!(!e||isNaN(this.points[e-1].y))){t.beginPath(),t.moveTo(this.points[0].x-n,this.points[0].y-r);for(let o=0;o<e;o++){const l=this.points[o];t.lineTo(l.x-n,l.y-r)}!this.isOpen()&&t.closePath(),this._renderPaintInOrder(t)}}complexity(){return this.points.length}static async fromElement(t,e){const n=n1(t.getAttribute("points")),r=vn(t,this.ATTRIBUTE_NAMES),o=At(r,i1);return new this(n||[],T(T({},o),e))}static fromObject(t){return this._fromObject(t,{extraParam:"points"})}}D(Ue,"ownDefaults",md);D(Ue,"type","Polyline");D(Ue,"layoutProperties",["skewX","skewY","strokeLineCap","strokeLineJoin","strokeMiterLimit","strokeWidth","strokeUniform","points"]);D(Ue,"cacheProperties",[..._n,"points"]);D(Ue,"ATTRIBUTE_NAMES",[...In]);q.setClass(Ue);q.setSVGClass(Ue);class Ys extends Ue{static getDefaults(){return T(T({},super.getDefaults()),Ue.ownDefaults)}isOpen(){return!1}}D(Ys,"ownDefaults",md);D(Ys,"type","Polygon");q.setClass(Ys);q.setSVGClass(Ys);const _d=["fontSize","fontWeight","fontFamily","fontStyle"],vd=["underline","overline","linethrough"],yd=[..._d,"lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],xd=[...yd,...vd,"textBackgroundColor","direction"],r1=[..._d,...vd,"stroke","strokeWidth","fill","deltaY","textBackgroundColor"],s1={_reNewline:Qu,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:dt,fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:dt,pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,deltaY:0,direction:"ltr",CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2},Je="justify",Ss="justify-left",hr="justify-right",cr="justify-center";class Cd extends qt{isEmptyStyles(t){if(!this.styles||typeof t<"u"&&!this.styles[t])return!0;const e=typeof t>"u"?this.styles:{line:this.styles[t]};for(const n in e)for(const r in e[n])for(const o in e[n][r])return!1;return!0}styleHas(t,e){if(!this.styles||typeof e<"u"&&!this.styles[e])return!1;const n=typeof e>"u"?this.styles:{0:this.styles[e]};for(const r in n)for(const o in n[r])if(typeof n[r][o][t]<"u")return!0;return!1}cleanStyle(t){if(!this.styles)return!1;const e=this.styles;let n=0,r,o,l=!0,c=0;for(const u in e){r=0;for(const d in e[u]){const g=e[u][d]||{},_=g[t]!==void 0;n++,_?(o?g[t]!==o&&(l=!1):o=g[t],g[t]===this[t]&&delete g[t]):l=!1,Object.keys(g).length!==0?r++:delete e[u][d]}r===0&&delete e[u]}for(let u=0;u<this._textLines.length;u++)c+=this._textLines[u].length;l&&n===c&&(this[t]=o,this.removeStyle(t))}removeStyle(t){if(!this.styles)return;const e=this.styles;let n,r,o;for(r in e){n=e[r];for(o in n)delete n[o][t],Object.keys(n[o]).length===0&&delete n[o];Object.keys(n).length===0&&delete e[r]}}_extendStyles(t,e){const{lineIndex:n,charIndex:r}=this.get2DCursorLocation(t);return this._getLineStyle(n)||this._setLineStyle(n),this._getStyleDeclaration(n,r)||this._setStyleDeclaration(n,r,{}),Object.assign(this._getStyleDeclaration(n,r)||{},e)}getSelectionStyles(t,e,n){const r=[];for(let o=t;o<(e||t);o++)r.push(this.getStyleAtPosition(o,n));return r}getStyleAtPosition(t,e){const{lineIndex:n,charIndex:r}=this.get2DCursorLocation(t);return(e?this.getCompleteStyleDeclaration(n,r):this._getStyleDeclaration(n,r))||{}}setSelectionStyles(t,e,n){for(let r=e;r<(n||e);r++)this._extendStyles(r,t);this._forceClearCache=!0}_getStyleDeclaration(t,e){const n=this.styles&&this.styles[t];return n?n[e]:null}getCompleteStyleDeclaration(t,e){return T(T({},ii(this,this.constructor._styleProperties)),this._getStyleDeclaration(t,e)||{})}_setStyleDeclaration(t,e,n){this.styles[t][e]=n}_deleteStyleDeclaration(t,e){delete this.styles[t][e]}_getLineStyle(t){return!!this.styles[t]}_setLineStyle(t){this.styles[t]={}}_deleteLineStyle(t){delete this.styles[t]}}D(Cd,"_styleProperties",r1);const o1=/  +/g,a1=/"/g;function ya(a,t,e,n,r){return"		".concat(sC(a,{left:t,top:e,width:n,height:r}),`
`)}class l1 extends Cf{_toSVG(){const t=this._getSVGLeftTopOffsets(),e=this._getSVGTextAndBg(t.textTop,t.textLeft);return this._wrapSVGTextAndBg(e)}toSVG(t){return this._createBaseSVGMarkup(this._toSVG(),{reviver:t,noStyle:!0,withShadow:!0})}_getSVGLeftTopOffsets(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}}_wrapSVGTextAndBg(t){let{textBgRects:e,textSpans:n}=t;const r=!0,o=this.getSvgTextDecoration(this);return[e.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'.concat(this.fontFamily.replace(a1,"'"),'" '):"",this.fontSize?'font-size="'.concat(this.fontSize,'" '):"",this.fontStyle?'font-style="'.concat(this.fontStyle,'" '):"",this.fontWeight?'font-weight="'.concat(this.fontWeight,'" '):"",o?'text-decoration="'.concat(o,'" '):"",this.direction==="rtl"?'direction="'.concat(this.direction,'" '):"",'style="',this.getSvgStyles(r),'"',this.addPaintOrder()," >",n.join(""),`</text>
`]}_getSVGTextAndBg(t,e){const n=[],r=[];let o=t,l;this.backgroundColor&&r.push(...ya(this.backgroundColor,-this.width/2,-this.height/2,this.width,this.height));for(let c=0,u=this._textLines.length;c<u;c++)l=this._getLineLeftOffset(c),this.direction==="rtl"&&(l+=this.width),(this.textBackgroundColor||this.styleHas("textBackgroundColor",c))&&this._setSVGTextLineBg(r,c,e+l,o),this._setSVGTextLineText(n,c,e+l,o),o+=this.getHeightOfLine(c);return{textSpans:n,textBgRects:r}}_createTextCharSpan(t,e,n,r){const o=this.getSvgSpanStyles(e,t!==t.trim()||!!t.match(o1)),l=o?'style="'.concat(o,'"'):"",c=e.deltaY,u=c?' dy="'.concat(ut(c,at.NUM_FRACTION_DIGITS),'" '):"";return'<tspan x="'.concat(ut(n,at.NUM_FRACTION_DIGITS),'" y="').concat(ut(r,at.NUM_FRACTION_DIGITS),'" ').concat(u).concat(l,">").concat(td(t),"</tspan>")}_setSVGTextLineText(t,e,n,r){const o=this.getHeightOfLine(e),l=this.textAlign.includes(Je),c=this._textLines[e];let u,d,g="",_,y,x=0,S;r+=o*(1-this._fontSizeFraction)/this.lineHeight;for(let E=0,P=c.length-1;E<=P;E++)S=E===P||this.charSpacing,g+=c[E],_=this.__charBounds[e][E],x===0?(n+=_.kernedWidth-_.width,x+=_.width):x+=_.kernedWidth,l&&!S&&this._reSpaceAndTab.test(c[E])&&(S=!0),S||(u=u||this.getCompleteStyleDeclaration(e,E),d=this.getCompleteStyleDeclaration(e,E+1),S=js(u,d,!0)),S&&(y=this._getStyleDeclaration(e,E)||{},t.push(this._createTextCharSpan(g,y,n,r)),g="",u=d,this.direction==="rtl"?n-=x:n+=x,x=0)}_setSVGTextLineBg(t,e,n,r){const o=this._textLines[e],l=this.getHeightOfLine(e)/this.lineHeight;let c=0,u=0,d,g,_=this.getValueOfPropertyAt(e,0,"textBackgroundColor");for(let y=0;y<o.length;y++)d=this.__charBounds[e][y],g=this.getValueOfPropertyAt(e,y,"textBackgroundColor"),g!==_?(_&&t.push(...ya(_,n+u,r,c,l)),u=d.left,c=d.width,_=g):c+=d.kernedWidth;g&&t.push(...ya(_,n+u,r,c,l))}_getSVGLineTopOffset(t){let e=0,n=0;for(let r=0;r<t;r++)e+=this.getHeightOfLine(r);return n=this.getHeightOfLine(j),{lineTop:e,offset:(this._fontSizeMult-this._fontSizeFraction)*n/(this.lineHeight*this._fontSizeMult)}}getSvgStyles(t){return"".concat(super.getSvgStyles(t)," white-space: pre;")}}const h1=["textAnchor","textDecoration","dx","dy","top","left","fontSize","strokeWidth"];let xa;function c1(){return xa||(xa=Wt().getContext("2d")),xa}class me extends Cd{static getDefaults(){return T(T({},super.getDefaults()),me.ownDefaults)}constructor(t,e){super(T(T({},e),{},{text:t,styles:(e==null?void 0:e.styles)||{}})),D(this,"__charBounds",[]),this.initialized=!0,this.path&&this.setPathInfo(),this.initDimensions(),this.setCoords()}setPathInfo(){const t=this.path;t&&(t.segmentsInfo=dl(t.path))}_splitText(){const t=this._splitTextIntoLines(this.text);return this.textLines=t.lines,this._textLines=t.graphemeLines,this._unwrappedTextLines=t._unwrappedLines,this._text=t.graphemeText,t}initDimensions(){this._splitText(),this._clearCache(),this.dirty=!0,this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.includes(Je)&&this.enlargeSpaces()}enlargeSpaces(){let t,e,n,r,o,l,c;for(let u=0,d=this._textLines.length;u<d;u++)if(!(this.textAlign!==Je&&(u===d-1||this.isEndOfWrapping(u)))&&(r=0,o=this._textLines[u],e=this.getLineWidth(u),e<this.width&&(c=this.textLines[u].match(this._reSpacesAndTabs)))){n=c.length,t=(this.width-e)/n;for(let g=0;g<=o.length;g++)l=this.__charBounds[u][g],this._reSpaceAndTab.test(o[g])?(l.width+=t,l.kernedWidth+=t,l.left+=r,r+=t):l.left+=r}}isEndOfWrapping(t){return t===this._textLines.length-1}missingNewlineOffset(t){return 1}get2DCursorLocation(t,e){const n=e?this._unwrappedTextLines:this._textLines;let r;for(r=0;r<n.length;r++){if(t<=n[r].length)return{lineIndex:r,charIndex:t};t-=n[r].length+this.missingNewlineOffset(r)}return{lineIndex:r-1,charIndex:n[r-1].length<t?n[r-1].length:t}}toString(){return"#<Text (".concat(this.complexity(),'): { "text": "').concat(this.text,'", "fontFamily": "').concat(this.fontFamily,'" }>')}_getCacheCanvasDimensions(){const t=super._getCacheCanvasDimensions(),e=this.fontSize;return t.width+=e*t.zoomX,t.height+=e*t.zoomY,t}_render(t){const e=this.path;e&&!e.isNotVisible()&&e._render(t),this._setTextStyles(t),this._renderTextLinesBackground(t),this._renderTextDecoration(t,"underline"),this._renderText(t),this._renderTextDecoration(t,"overline"),this._renderTextDecoration(t,"linethrough")}_renderText(t){this.paintFirst==="stroke"?(this._renderTextStroke(t),this._renderTextFill(t)):(this._renderTextFill(t),this._renderTextStroke(t))}_setTextStyles(t,e,n){if(t.textBaseline="alphabetic",this.path)switch(this.pathAlign){case et:t.textBaseline="middle";break;case"ascender":t.textBaseline=ee;break;case"descender":t.textBaseline=Pa;break}t.font=this._getFontDeclaration(e,n)}calcTextWidth(){let t=this.getLineWidth(0);for(let e=1,n=this._textLines.length;e<n;e++){const r=this.getLineWidth(e);r>t&&(t=r)}return t}_renderTextLine(t,e,n,r,o,l){this._renderChars(t,e,n,r,o,l)}_renderTextLinesBackground(t){if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor"))return;const e=t.fillStyle,n=this._getLeftOffset();let r=this._getTopOffset();for(let o=0,l=this._textLines.length;o<l;o++){const c=this.getHeightOfLine(o);if(!this.textBackgroundColor&&!this.styleHas("textBackgroundColor",o)){r+=c;continue}const u=this._textLines[o].length,d=this._getLineLeftOffset(o);let g=0,_=0,y,x,S=this.getValueOfPropertyAt(o,0,"textBackgroundColor");for(let E=0;E<u;E++){const P=this.__charBounds[o][E];x=this.getValueOfPropertyAt(o,E,"textBackgroundColor"),this.path?(t.save(),t.translate(P.renderLeft,P.renderTop),t.rotate(P.angle),t.fillStyle=x,x&&t.fillRect(-P.width/2,-c/this.lineHeight*(1-this._fontSizeFraction),P.width,c/this.lineHeight),t.restore()):x!==S?(y=n+d+_,this.direction==="rtl"&&(y=this.width-y-g),t.fillStyle=S,S&&t.fillRect(y,r,g,c/this.lineHeight),_=P.left,g=P.width,S=x):g+=P.kernedWidth}x&&!this.path&&(y=n+d+_,this.direction==="rtl"&&(y=this.width-y-g),t.fillStyle=x,t.fillRect(y,r,g,c/this.lineHeight)),r+=c}t.fillStyle=e,this._removeShadow(t)}_measureChar(t,e,n,r){const o=or.getFontCache(e),l=this._getFontDeclaration(e),c=this._getFontDeclaration(r),u=n+t,d=l===c,g=e.fontSize/this.CACHE_FONT_SIZE;let _,y,x,S;if(n&&o[n]!==void 0&&(x=o[n]),o[t]!==void 0&&(S=_=o[t]),d&&o[u]!==void 0&&(y=o[u],S=y-x),_===void 0||x===void 0||y===void 0){const E=c1();this._setTextStyles(E,e,!0),_===void 0&&(S=_=E.measureText(t).width,o[t]=_),x===void 0&&d&&n&&(x=E.measureText(n).width,o[n]=x),d&&y===void 0&&(y=E.measureText(u).width,o[u]=y,S=y-x)}return{width:_*g,kernedWidth:S*g}}getHeightOfChar(t,e){return this.getValueOfPropertyAt(t,e,"fontSize")}measureLine(t){const e=this._measureLine(t);return this.charSpacing!==0&&(e.width-=this._getWidthOfCharSpacing()),e.width<0&&(e.width=0),e}_measureLine(t){let e=0,n,r;const o=this.pathSide===Yt,l=this.path,c=this._textLines[t],u=c.length,d=new Array(u);this.__charBounds[t]=d;for(let g=0;g<u;g++){const _=c[g];r=this._getGraphemeBox(_,t,g,n),d[g]=r,e+=r.kernedWidth,n=_}if(d[u]={left:r?r.left+r.width:0,width:0,kernedWidth:0,height:this.fontSize},l&&l.segmentsInfo){let g=0;const _=l.segmentsInfo[l.segmentsInfo.length-1].length,y=Ya(l.path,0,l.segmentsInfo);switch(y.x+=l.pathOffset.x,y.y+=l.pathOffset.y,this.textAlign){case dt:g=o?_-e:0;break;case et:g=(_-e)/2;break;case Yt:g=o?0:_-e;break}g+=this.pathStartOffset*(o?-1:1);for(let x=o?u-1:0;o?x>=0:x<u;o?x--:x++)r=d[x],g>_?g%=_:g<0&&(g+=_),this._setGraphemeOnPath(g,r,y),g+=r.kernedWidth}return{width:e,numOfSpaces:0}}_setGraphemeOnPath(t,e,n){const r=t+e.kernedWidth/2,o=this.path,l=Ya(o.path,r,o.segmentsInfo);e.renderLeft=l.x-n.x,e.renderTop=l.y-n.y,e.angle=l.angle+(this.pathSide===Yt?Math.PI:0)}_getGraphemeBox(t,e,n,r,o){const l=this.getCompleteStyleDeclaration(e,n),c=r?this.getCompleteStyleDeclaration(e,n-1):{},u=this._measureChar(t,l,r,c);let d=u.kernedWidth,g=u.width,_;this.charSpacing!==0&&(_=this._getWidthOfCharSpacing(),g+=_,d+=_);const y={width:g,left:0,height:l.fontSize,kernedWidth:d,deltaY:l.deltaY};if(n>0&&!o){const x=this.__charBounds[e][n-1];y.left=x.left+x.width+u.kernedWidth-u.width}return y}getHeightOfLine(t){if(this.__lineHeights[t])return this.__lineHeights[t];let e=this.getHeightOfChar(t,0);for(let n=1,r=this._textLines[t].length;n<r;n++)e=Math.max(this.getHeightOfChar(t,n),e);return this.__lineHeights[t]=e*this.lineHeight*this._fontSizeMult}calcTextHeight(){let t,e=0;for(let n=0,r=this._textLines.length;n<r;n++)t=this.getHeightOfLine(n),e+=n===r-1?t/this.lineHeight:t;return e}_getLeftOffset(){return this.direction==="ltr"?-this.width/2:this.width/2}_getTopOffset(){return-this.height/2}_renderTextCommon(t,e){t.save();let n=0;const r=this._getLeftOffset(),o=this._getTopOffset();for(let l=0,c=this._textLines.length;l<c;l++){const u=this.getHeightOfLine(l),d=u/this.lineHeight,g=this._getLineLeftOffset(l);this._renderTextLine(e,t,this._textLines[l],r+g,o+n+d,l),n+=u}t.restore()}_renderTextFill(t){!this.fill&&!this.styleHas("fill")||this._renderTextCommon(t,"fillText")}_renderTextStroke(t){(!this.stroke||this.strokeWidth===0)&&this.isEmptyStyles()||(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(t),t.save(),this._setLineDash(t,this.strokeDashArray),t.beginPath(),this._renderTextCommon(t,"strokeText"),t.closePath(),t.restore())}_renderChars(t,e,n,r,o,l){const c=this.getHeightOfLine(l),u=this.textAlign.includes(Je),d=this.path,g=!u&&this.charSpacing===0&&this.isEmptyStyles(l)&&!d,_=this.direction==="ltr",y=this.direction==="ltr"?1:-1,x=e.direction;let S,E,P="",L,W=0,Y,H;if(e.save(),x!==this.direction&&(e.canvas.setAttribute("dir",_?"ltr":"rtl"),e.direction=_?"ltr":"rtl",e.textAlign=_?dt:Yt),o-=c*this._fontSizeFraction/this.lineHeight,g){this._renderChar(t,e,l,0,n.join(""),r,o),e.restore();return}for(let z=0,U=n.length-1;z<=U;z++)Y=z===U||this.charSpacing||d,P+=n[z],L=this.__charBounds[l][z],W===0?(r+=y*(L.kernedWidth-L.width),W+=L.width):W+=L.kernedWidth,u&&!Y&&this._reSpaceAndTab.test(n[z])&&(Y=!0),Y||(S=S||this.getCompleteStyleDeclaration(l,z),E=this.getCompleteStyleDeclaration(l,z+1),Y=js(S,E,!1)),Y&&(d?(e.save(),e.translate(L.renderLeft,L.renderTop),e.rotate(L.angle),this._renderChar(t,e,l,z,P,-W/2,0),e.restore()):(H=r,this._renderChar(t,e,l,z,P,H,o)),P="",S=E,r+=y*W,W=0);e.restore()}_applyPatternGradientTransformText(t){const e=Wt(),n=this.width+this.strokeWidth,r=this.height+this.strokeWidth,o=e.getContext("2d");return e.width=n,e.height=r,o.beginPath(),o.moveTo(0,0),o.lineTo(n,0),o.lineTo(n,r),o.lineTo(0,r),o.closePath(),o.translate(n/2,r/2),o.fillStyle=t.toLive(o),this._applyPatternGradientTransform(o,t),o.fill(),o.createPattern(e,"no-repeat")}handleFiller(t,e,n){let r,o;return n.toLive?n.gradientUnits==="percentage"||n.gradientTransform||n.patternTransform?(r=-this.width/2,o=-this.height/2,t.translate(r,o),t[e]=this._applyPatternGradientTransformText(n),{offsetX:r,offsetY:o}):(t[e]=n.toLive(t,this),this._applyPatternGradientTransform(t,n)):(t[e]=n,{offsetX:0,offsetY:0})}_setStrokeStyles(t,e){let{stroke:n,strokeWidth:r}=e;return t.lineWidth=r,t.lineCap=this.strokeLineCap,t.lineDashOffset=this.strokeDashOffset,t.lineJoin=this.strokeLineJoin,t.miterLimit=this.strokeMiterLimit,this.handleFiller(t,"strokeStyle",n)}_setFillStyles(t,e){let{fill:n}=e;return this.handleFiller(t,"fillStyle",n)}_renderChar(t,e,n,r,o,l,c){const u=this._getStyleDeclaration(n,r),d=this.getCompleteStyleDeclaration(n,r),g=t==="fillText"&&d.fill,_=t==="strokeText"&&d.stroke&&d.strokeWidth;let y,x;!_&&!g||(e.save(),g&&(y=this._setFillStyles(e,d)),_&&(x=this._setStrokeStyles(e,d)),e.font=this._getFontDeclaration(d),u&&u.textBackgroundColor&&this._removeShadow(e),u&&u.deltaY&&(c+=u.deltaY),g&&e.fillText(o,l-y.offsetX,c-y.offsetY),_&&e.strokeText(o,l-x.offsetX,c-x.offsetY),e.restore())}setSuperscript(t,e){this._setScript(t,e,this.superscript)}setSubscript(t,e){this._setScript(t,e,this.subscript)}_setScript(t,e,n){const r=this.get2DCursorLocation(t,!0),o=this.getValueOfPropertyAt(r.lineIndex,r.charIndex,"fontSize"),l=this.getValueOfPropertyAt(r.lineIndex,r.charIndex,"deltaY"),c={fontSize:o*n.size,deltaY:l+o*n.baseline};this.setSelectionStyles(c,t,e)}_getLineLeftOffset(t){const e=this.getLineWidth(t),n=this.width-e,r=this.textAlign,o=this.direction,l=this.isEndOfWrapping(t);let c=0;return r===Je||r===cr&&!l||r===hr&&!l||r===Ss&&!l?0:(r===et&&(c=n/2),r===Yt&&(c=n),r===cr&&(c=n/2),r===hr&&(c=n),o==="rtl"&&(r===Yt||r===Je||r===hr?c=0:r===dt||r===Ss?c=-n:(r===et||r===cr)&&(c=-n/2)),c)}_clearCache(){this._forceClearCache=!1,this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]}getLineWidth(t){if(this.__lineWidths[t]!==void 0)return this.__lineWidths[t];const{width:e}=this.measureLine(t);return this.__lineWidths[t]=e,e}_getWidthOfCharSpacing(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0}getValueOfPropertyAt(t,e,n){const r=this._getStyleDeclaration(t,e);return r&&typeof r[n]<"u"?r[n]:this[n]}_renderTextDecoration(t,e){if(!this[e]&&!this.styleHas(e))return;let n=this._getTopOffset();const r=this._getLeftOffset(),o=this.path,l=this._getWidthOfCharSpacing(),c=this.offsets[e];for(let u=0,d=this._textLines.length;u<d;u++){const g=this.getHeightOfLine(u);if(!this[e]&&!this.styleHas(e,u)){n+=g;continue}const _=this._textLines[u],y=g/this.lineHeight,x=this._getLineLeftOffset(u);let S=0,E=0,P=this.getValueOfPropertyAt(u,0,e),L=this.getValueOfPropertyAt(u,0,"fill"),W,Y;const H=n+y*(1-this._fontSizeFraction);let z=this.getHeightOfChar(u,0),U=this.getValueOfPropertyAt(u,0,"deltaY");for(let R=0,N=_.length;R<N;R++){const tt=this.__charBounds[u][R];W=this.getValueOfPropertyAt(u,R,e),Y=this.getValueOfPropertyAt(u,R,"fill");const Dt=this.getHeightOfChar(u,R),vt=this.getValueOfPropertyAt(u,R,"deltaY");if(o&&W&&Y)t.save(),t.fillStyle=L,t.translate(tt.renderLeft,tt.renderTop),t.rotate(tt.angle),t.fillRect(-tt.kernedWidth/2,c*Dt+vt,tt.kernedWidth,this.fontSize/15),t.restore();else if((W!==P||Y!==L||Dt!==z||vt!==U)&&E>0){let Ft=r+x+S;this.direction==="rtl"&&(Ft=this.width-Ft-E),P&&L&&(t.fillStyle=L,t.fillRect(Ft,H+c*z+U,E,this.fontSize/15)),S=tt.left,E=tt.width,P=W,L=Y,z=Dt,U=vt}else E+=tt.kernedWidth}let A=r+x+S;this.direction==="rtl"&&(A=this.width-A-E),t.fillStyle=Y,W&&Y&&t.fillRect(A,H+c*z+U,E-l,this.fontSize/15),n+=g}this._removeShadow(t)}_getFontDeclaration(t,e){const n=t||this,r=this.fontFamily,o=me.genericFonts.indexOf(r.toLowerCase())>-1,l=r===void 0||r.indexOf("'")>-1||r.indexOf(",")>-1||r.indexOf('"')>-1||o?n.fontFamily:'"'.concat(n.fontFamily,'"');return[n.fontStyle,n.fontWeight,e?this.CACHE_FONT_SIZE+"px":n.fontSize+"px",l].join(" ")}render(t){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._forceClearCache&&this.initDimensions(),super.render(t)))}graphemeSplit(t){return ed(t)}_splitTextIntoLines(t){const e=t.split(this._reNewline),n=new Array(e.length),r=[`
`];let o=[];for(let l=0;l<e.length;l++)n[l]=this.graphemeSplit(e[l]),o=o.concat(n[l],r);return o.pop(),{_unwrappedLines:n,lines:e,graphemeText:o,graphemeLines:n}}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return T(T({},super.toObject([...xd,...t])),{},{styles:$f(this.styles,this.text)},this.path?{path:this.path.toObject()}:{})}set(t,e){const{textLayoutProperties:n}=this.constructor;super.set(t,e);let r=!1,o=!1;if(typeof t=="object")for(const l in t)l==="path"&&this.setPathInfo(),r=r||n.includes(l),o=o||l==="path";else r=n.includes(t),o=t==="path";return o&&this.setPathInfo(),r&&this.initialized&&(this.initDimensions(),this.setCoords()),this}complexity(){return 1}static async fromElement(t,e){const n=vn(t,me.ATTRIBUTE_NAMES),r=T(T({},e),n),{textAnchor:o=dt,textDecoration:l="",dx:c=0,dy:u=0,top:d=0,left:g=0,fontSize:_=Va,strokeWidth:y=1}=r,x=At(r,h1);let S="";"textContent"in t?S=t.textContent:"firstChild"in t&&t.firstChild!==null&&"data"in t.firstChild&&t.firstChild.data!==null&&(S=t.firstChild.data),S=S.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");const E=new this(S,T({left:g+c,top:d+u,underline:l.includes("underline"),overline:l.includes("overline"),linethrough:l.includes("line-through"),strokeWidth:0,fontSize:_},x)),P=E.getScaledHeight()/E.height,L=(E.height+E.strokeWidth)*E.lineHeight-E.height,W=L*P,Y=E.getScaledHeight()+W;let H=0;return o===et&&(H=E.getScaledWidth()/2),o===Yt&&(H=E.getScaledWidth()),E.set({left:E.left-H,top:E.top-(Y-E.fontSize*(.07+E._fontSizeFraction))/E.lineHeight,strokeWidth:y}),E}static fromObject(t){return this._fromObject(T(T({},t),{},{styles:Jf(t.styles||{},t.text)}),{extraParam:"text"})}}D(me,"textLayoutProperties",yd);D(me,"cacheProperties",[..._n,...xd]);D(me,"ownDefaults",s1);D(me,"type","Text");D(me,"genericFonts",["sans-serif","serif","cursive","fantasy","monospace"]);D(me,"ATTRIBUTE_NAMES",In.concat("x","y","dx","dy","font-family","font-style","font-weight","font-size","letter-spacing","text-decoration","text-anchor"));zf(me,[l1]);q.setClass(me);q.setSVGClass(me);class u1{constructor(t){D(this,"target",void 0),D(this,"__mouseDownInPlace",!1),D(this,"__dragStartFired",!1),D(this,"__isDraggingOver",!1),D(this,"__dragStartSelection",void 0),D(this,"__dragImageDisposer",void 0),D(this,"_dispose",void 0),this.target=t;const e=[this.target.on("dragenter",this.dragEnterHandler.bind(this)),this.target.on("dragover",this.dragOverHandler.bind(this)),this.target.on("dragleave",this.dragLeaveHandler.bind(this)),this.target.on("dragend",this.dragEndHandler.bind(this)),this.target.on("drop",this.dropHandler.bind(this))];this._dispose=()=>{e.forEach(n=>n()),this._dispose=void 0}}isPointerOverSelection(t){const e=this.target,n=e.getSelectionStartFromPointer(t);return e.isEditing&&n>=e.selectionStart&&n<=e.selectionEnd&&e.selectionStart<e.selectionEnd}start(t){return this.__mouseDownInPlace=this.isPointerOverSelection(t)}isActive(){return this.__mouseDownInPlace}end(t){const e=this.isActive();return e&&!this.__dragStartFired&&(this.target.setCursorByClick(t),this.target.initDelayedCursor(!0)),this.__mouseDownInPlace=!1,this.__dragStartFired=!1,this.__isDraggingOver=!1,e}getDragStartSelection(){return this.__dragStartSelection}setDragImage(t,e){var n;let{selectionStart:r,selectionEnd:o}=e;const l=this.target,c=l.canvas,u=new M(l.flipX?-1:1,l.flipY?-1:1),d=l._getCursorBoundaries(r),_=new M(d.left+d.leftOffset,d.top+d.topOffset).multiply(u).transform(l.calcTransformMatrix()),x=c.getPointer(t).subtract(_),S=c._isRetinaScaling(),E=l.getCanvasRetinaScaling(),P=l.getBoundingRect(!0),L=_.subtract(new M(P.left,P.top)),W=c.viewportTransform,Y=L.add(x).transform(W,!0),H=l.backgroundColor,z=ki(l.styles);l.backgroundColor="";const U={stroke:"transparent",fill:"transparent",textBackgroundColor:"transparent"};l.setSelectionStyles(U,0,r),l.setSelectionStyles(U,o,l.text.length),l.dirty=!0;const A=l.toCanvasElement({enableRetinaScaling:S,viewportTransform:!0});l.backgroundColor=H,l.styles=z,l.dirty=!0,dr(A,{position:"fixed",left:"".concat(-A.width,"px"),border:pe,width:"".concat(A.width/E,"px"),height:"".concat(A.height/E,"px")}),this.__dragImageDisposer&&this.__dragImageDisposer(),this.__dragImageDisposer=()=>{A.remove()},$e(t.target||this.target.hiddenTextarea).body.appendChild(A),(n=t.dataTransfer)===null||n===void 0||n.setDragImage(A,Y.x,Y.y)}onDragStart(t){this.__dragStartFired=!0;const e=this.target,n=this.isActive();if(n&&t.dataTransfer){const r=this.__dragStartSelection={selectionStart:e.selectionStart,selectionEnd:e.selectionEnd},o=e._text.slice(r.selectionStart,r.selectionEnd).join(""),l=T({text:e.text,value:o},r);t.dataTransfer.setData("text/plain",o),t.dataTransfer.setData("application/fabric",JSON.stringify({value:o,styles:e.getSelectionStyles(r.selectionStart,r.selectionEnd,!0)})),t.dataTransfer.effectAllowed="copyMove",this.setDragImage(t,l)}return e.abortCursorAnimation(),n}canDrop(t){if(this.target.editable&&!this.target.__corner&&!t.defaultPrevented){if(this.isActive()&&this.__dragStartSelection){const e=this.target.getSelectionStartFromPointer(t),n=this.__dragStartSelection;return e<n.selectionStart||e>n.selectionEnd}return!0}return!1}targetCanDrop(t){return this.target.canDrop(t)}dragEnterHandler(t){let{e}=t;const n=this.targetCanDrop(e);!this.__isDraggingOver&&n&&(this.__isDraggingOver=!0)}dragOverHandler(t){const{e}=t,n=this.targetCanDrop(e);!this.__isDraggingOver&&n?this.__isDraggingOver=!0:this.__isDraggingOver&&!n&&(this.__isDraggingOver=!1),this.__isDraggingOver&&(e.preventDefault(),t.canDrop=!0,t.dropTarget=this.target)}dragLeaveHandler(){(this.__isDraggingOver||this.isActive())&&(this.__isDraggingOver=!1)}dropHandler(t){var e;const{e:n}=t,r=n.defaultPrevented;this.__isDraggingOver=!1,n.preventDefault();let o=(e=n.dataTransfer)===null||e===void 0?void 0:e.getData("text/plain");if(o&&!r){const l=this.target,c=l.canvas;let u=l.getSelectionStartFromPointer(n);const{styles:d}=n.dataTransfer.types.includes("application/fabric")?JSON.parse(n.dataTransfer.getData("application/fabric")):{},g=o[Math.max(0,o.length-1)],_=0;if(this.__dragStartSelection){const y=this.__dragStartSelection.selectionStart,x=this.__dragStartSelection.selectionEnd;u>y&&u<=x?u=y:u>x&&(u-=x-y),l.removeChars(y,x),delete this.__dragStartSelection}l._reNewline.test(g)&&(l._reNewline.test(l._text[u])||u===l._text.length)&&(o=o.trimEnd()),t.didDrop=!0,t.dropTarget=l,l.insertChars(o,d,u),c.setActiveObject(l),l.enterEditing(n),l.selectionStart=Math.min(u+_,l._text.length),l.selectionEnd=Math.min(l.selectionStart+o.length,l._text.length),l.hiddenTextarea.value=l.text,l._updateTextarea(),l.hiddenTextarea.focus(),l.fire("changed",{index:u+_,action:"drop"}),c.fire("text:changed",{target:l}),c.contextTopDirty=!0,c.requestRenderAll()}}dragEndHandler(t){let{e}=t;if(this.isActive()&&this.__dragStartFired&&this.__dragStartSelection){var n;const r=this.target,o=this.target.canvas,{selectionStart:l,selectionEnd:c}=this.__dragStartSelection,u=((n=e.dataTransfer)===null||n===void 0?void 0:n.dropEffect)||pe;u===pe?(r.selectionStart=l,r.selectionEnd=c,r._updateTextarea(),r.hiddenTextarea.focus()):(r.clearContextTop(),u==="move"&&(r.removeChars(l,c),r.selectionStart=r.selectionEnd=l,r.hiddenTextarea&&(r.hiddenTextarea.value=r.text),r._updateTextarea(),r.fire("changed",{index:l,action:"dragend"}),o.fire("text:changed",{target:r}),o.requestRenderAll()),r.exitEditing())}this.__dragImageDisposer&&this.__dragImageDisposer(),delete this.__dragImageDisposer,delete this.__dragStartSelection,this.__isDraggingOver=!1}dispose(){this._dispose&&this._dispose()}}const zu=/[ \n\.,;!\?\-]/;class f1 extends me{constructor(){super(...arguments),D(this,"_currentCursorOpacity",1)}initBehavior(){this._tick=this._tick.bind(this),this._onTickComplete=this._onTickComplete.bind(this),this.updateSelectionOnMouseMove=this.updateSelectionOnMouseMove.bind(this)}onDeselect(t){return this.isEditing&&this.exitEditing(),this.selected=!1,super.onDeselect(t)}_animateCursor(t){let{toValue:e,duration:n,delay:r,onComplete:o}=t;return al({startValue:this._currentCursorOpacity,endValue:e,duration:n,delay:r,onComplete:o,abort:()=>!this.canvas||this.selectionStart!==this.selectionEnd,onChange:l=>{this._currentCursorOpacity=l,this.renderCursorOrSelection()}})}_tick(t){this._currentTickState=this._animateCursor({toValue:1,duration:this.cursorDuration,delay:t,onComplete:this._onTickComplete})}_onTickComplete(){var t;(t=this._currentTickCompleteState)===null||t===void 0||t.abort(),this._currentTickCompleteState=this._animateCursor({toValue:0,duration:this.cursorDuration/2,delay:100,onComplete:this._tick})}initDelayedCursor(t){this.abortCursorAnimation(),this._tick(t?0:this.cursorDelay)}abortCursorAnimation(){let t=!1;[this._currentTickState,this._currentTickCompleteState].forEach(e=>{e&&!e.isDone()&&(t=!0,e.abort())}),this._currentCursorOpacity=1,t&&this.clearContextTop()}restartCursorIfNeeded(){[this._currentTickState,this._currentTickCompleteState].some(t=>!t||t.isDone())&&this.initDelayedCursor()}selectAll(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this}getSelectedText(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")}findWordBoundaryLeft(t){let e=0,n=t-1;if(this._reSpace.test(this._text[n]))for(;this._reSpace.test(this._text[n]);)e++,n--;for(;/\S/.test(this._text[n])&&n>-1;)e++,n--;return t-e}findWordBoundaryRight(t){let e=0,n=t;if(this._reSpace.test(this._text[n]))for(;this._reSpace.test(this._text[n]);)e++,n++;for(;/\S/.test(this._text[n])&&n<this._text.length;)e++,n++;return t+e}findLineBoundaryLeft(t){let e=0,n=t-1;for(;!/\n/.test(this._text[n])&&n>-1;)e++,n--;return t-e}findLineBoundaryRight(t){let e=0,n=t;for(;!/\n/.test(this._text[n])&&n<this._text.length;)e++,n++;return t+e}searchWordBoundary(t,e){const n=this._text;let r=this._reSpace.test(n[t])?t-1:t,o=n[r];for(;!zu.test(o)&&r>0&&r<n.length;)r+=e,o=n[r];return zu.test(o)&&(r+=e===1?0:1),r}selectWord(t){t=t||this.selectionStart;const e=this.searchWordBoundary(t,-1),n=this.searchWordBoundary(t,1);this.selectionStart=e,this.selectionEnd=n,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()}selectLine(t){t=t||this.selectionStart;const e=this.findLineBoundaryLeft(t),n=this.findLineBoundaryRight(t);return this.selectionStart=e,this.selectionEnd=n,this._fireSelectionChanged(),this._updateTextarea(),this}enterEditing(t){this.isEditing||!this.editable||(this.canvas&&(this.canvas.calcOffset(),this.canvas.textEditingManager.exitTextEditing()),this.isEditing=!0,this.initHiddenTextarea(),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered",{e:t}),this._fireSelectionChanged(),this.canvas&&(this.canvas.fire("text:editing:entered",{target:this,e:t}),this.canvas.requestRenderAll()))}updateSelectionOnMouseMove(t){if(this.__corner)return;const e=this.hiddenTextarea;$e(e).activeElement!==e&&e.focus();const n=this.getSelectionStartFromPointer(t),r=this.selectionStart,o=this.selectionEnd;(n!==this.__selectionStartOnMouseDown||r===o)&&(r===n||o===n)||(n>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=n):(this.selectionStart=n,this.selectionEnd=this.__selectionStartOnMouseDown),(this.selectionStart!==r||this.selectionEnd!==o)&&(this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}_setEditingProps(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0}fromStringToGraphemeSelection(t,e,n){const r=n.slice(0,t),o=this.graphemeSplit(r).length;if(t===e)return{selectionStart:o,selectionEnd:o};const l=n.slice(t,e),c=this.graphemeSplit(l).length;return{selectionStart:o,selectionEnd:o+c}}fromGraphemeToStringSelection(t,e,n){const r=n.slice(0,t),o=r.join("").length;if(t===e)return{selectionStart:o,selectionEnd:o};const l=n.slice(t,e),c=l.join("").length;return{selectionStart:o,selectionEnd:o+c}}_updateTextarea(){if(this.cursorOffsetCache={},!!this.hiddenTextarea){if(!this.inCompositionMode){const t=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=t.selectionStart,this.hiddenTextarea.selectionEnd=t.selectionEnd}this.updateTextareaPosition()}}updateFromTextArea(){if(!this.hiddenTextarea)return;this.cursorOffsetCache={};const t=this.hiddenTextarea;this.text=t.value,this.set("dirty",!0),this.initDimensions(),this.setCoords();const e=this.fromStringToGraphemeSelection(t.selectionStart,t.selectionEnd,t.value);this.selectionEnd=this.selectionStart=e.selectionEnd,this.inCompositionMode||(this.selectionStart=e.selectionStart),this.updateTextareaPosition()}updateTextareaPosition(){if(this.selectionStart===this.selectionEnd){const t=this._calcTextareaPosition();this.hiddenTextarea.style.left=t.left,this.hiddenTextarea.style.top=t.top}}_calcTextareaPosition(){if(!this.canvas)return{left:"1px",top:"1px"};const t=this.inCompositionMode?this.compositionStart:this.selectionStart,e=this._getCursorBoundaries(t),n=this.get2DCursorLocation(t),r=n.lineIndex,o=n.charIndex,l=this.getValueOfPropertyAt(r,o,"fontSize")*this.lineHeight,c=e.leftOffset,u=this.getCanvasRetinaScaling(),d=this.canvas.upperCanvasEl,g=d.width/u,_=d.height/u,y=g-l,x=_-l,S=new M(e.left+c,e.top+e.topOffset+l).transform(this.calcTransformMatrix()).transform(this.canvas.viewportTransform).multiply(new M(d.clientWidth/g,d.clientHeight/_));return S.x<0&&(S.x=0),S.x>y&&(S.x=y),S.y<0&&(S.y=0),S.y>x&&(S.y=x),S.x+=this.canvas._offset.left,S.y+=this.canvas._offset.top,{left:"".concat(S.x,"px"),top:"".concat(S.y,"px"),fontSize:"".concat(l,"px"),charHeight:l}}_saveEditingProps(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}}_restoreEditingProps(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor||this.canvas.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor||this.canvas.moveCursor),delete this._savedProps)}_exitEditing(){const t=this.hiddenTextarea;this.selected=!1,this.isEditing=!1,t&&(t.blur&&t.blur(),t.parentNode&&t.parentNode.removeChild(t)),this.hiddenTextarea=null,this.abortCursorAnimation()}exitEditing(){const t=this._textBeforeEdit!==this.text;return this.selectionEnd=this.selectionStart,this._exitEditing(),this._restoreEditingProps(),this._forceClearCache&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),t&&this.fire("modified"),this.canvas&&(this.canvas.fire("text:editing:exited",{target:this}),t&&this.canvas.fire("object:modified",{target:this})),this}_removeExtraneousStyles(){for(const t in this.styles)this._textLines[t]||delete this.styles[t]}removeStyleFromTo(t,e){const{lineIndex:n,charIndex:r}=this.get2DCursorLocation(t,!0),{lineIndex:o,charIndex:l}=this.get2DCursorLocation(e,!0);if(n!==o){if(this.styles[n])for(let c=r;c<this._unwrappedTextLines[n].length;c++)delete this.styles[n][c];if(this.styles[o])for(let c=l;c<this._unwrappedTextLines[o].length;c++){const u=this.styles[o][c];u&&(this.styles[n]||(this.styles[n]={}),this.styles[n][r+c-l]=u)}for(let c=n+1;c<=o;c++)delete this.styles[c];this.shiftLineStyles(o,n-o)}else if(this.styles[n]){const c=this.styles[n],u=l-r;for(let d=r;d<l;d++)delete c[d];for(const d in this.styles[n]){const g=parseInt(d,10);g>=l&&(c[g-u]=c[d],delete c[d])}}}shiftLineStyles(t,e){const n=Object.assign({},this.styles);for(const r in this.styles){const o=parseInt(r,10);o>t&&(this.styles[o+e]=n[o],n[o-e]||delete this.styles[o])}}insertNewlineStyleObject(t,e,n,r){const o={},l=this._unwrappedTextLines[t].length===e;let c=!1;n||(n=1),this.shiftLineStyles(t,n);const u=this.styles[t]?this.styles[t][e===0?e:e-1]:void 0;for(const g in this.styles[t]){const _=parseInt(g,10);_>=e&&(c=!0,o[_-e]=this.styles[t][g],l&&e===0||delete this.styles[t][g])}let d=!1;for(c&&!l&&(this.styles[t+n]=o,d=!0),d&&n--;n>0;)r&&r[n-1]?this.styles[t+n]={0:T({},r[n-1])}:u?this.styles[t+n]={0:T({},u)}:delete this.styles[t+n],n--;this._forceClearCache=!0}insertCharStyleObject(t,e,n,r){this.styles||(this.styles={});const o=this.styles[t],l=o?T({},o):{};n||(n=1);for(const u in l){const d=parseInt(u,10);d>=e&&(o[d+n]=l[d],l[d-n]||delete o[d])}if(this._forceClearCache=!0,r){for(;n--;)Object.keys(r[n]).length&&(this.styles[t]||(this.styles[t]={}),this.styles[t][e+n]=T({},r[n]));return}if(!o)return;const c=o[e?e-1:1];for(;c&&n--;)this.styles[t][e+n]=T({},c)}insertNewStyleBlock(t,e,n){const r=this.get2DCursorLocation(e,!0),o=[0];let l=0;for(let u=0;u<t.length;u++)t[u]===`
`?(l++,o[l]=0):o[l]++;o[0]>0&&(this.insertCharStyleObject(r.lineIndex,r.charIndex,o[0],n),n=n&&n.slice(o[0]+1)),l&&this.insertNewlineStyleObject(r.lineIndex,r.charIndex+o[0],l);let c;for(c=1;c<l;c++)o[c]>0?this.insertCharStyleObject(r.lineIndex+c,0,o[c],n):n&&this.styles[r.lineIndex+c]&&n[0]&&(this.styles[r.lineIndex+c][0]=n[0]),n=n&&n.slice(o[c]+1);o[c]>0&&this.insertCharStyleObject(r.lineIndex+c,0,o[c],n)}removeChars(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t+1;this.removeStyleFromTo(t,e),this._text.splice(t,e-t),this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}insertChars(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:n;r>n&&this.removeStyleFromTo(n,r);const o=this.graphemeSplit(t);this.insertNewStyleBlock(o,n,e),this._text=[...this._text.slice(0,n),...o,...this._text.slice(r)],this.text=this._text.join(""),this.set("dirty",!0),this.initDimensions(),this.setCoords(),this._removeExtraneousStyles()}setSelectionStartEndWithShift(t,e,n){n<=t?(e===t?this._selectionDirection=dt:this._selectionDirection===Yt&&(this._selectionDirection=dt,this.selectionEnd=t),this.selectionStart=n):n>t&&n<e?this._selectionDirection===Yt?this.selectionEnd=n:this.selectionStart=n:(e===t?this._selectionDirection=Yt:this._selectionDirection===dt&&(this._selectionDirection=Yt,this.selectionStart=e),this.selectionEnd=n)}}class d1 extends f1{initHiddenTextarea(){const t=this.canvas&&$e(this.canvas.getElement())||Mi(),e=t.createElement("textarea");Object.entries({autocapitalize:"off",autocorrect:"off",autocomplete:"off",spellcheck:"false","data-fabric":"textarea",wrap:"off"}).map(l=>{let[c,u]=l;return e.setAttribute(c,u)});const{top:n,left:r,fontSize:o}=this._calcTextareaPosition();e.style.cssText="position: absolute; top: ".concat(n,"; left: ").concat(r,"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding-top: ").concat(o,";"),(this.hiddenTextareaContainer||t.body).appendChild(e),Object.entries({blur:"blur",keydown:"onKeyDown",keyup:"onKeyUp",input:"onInput",copy:"copy",cut:"copy",paste:"paste",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate",onCompositionUpdate:"onCompositionEnd"}).map(l=>{let[c,u]=l;return e.addEventListener(c,this[u].bind(this))}),this.hiddenTextarea=e}blur(){this.abortCursorAnimation()}onKeyDown(t){if(!this.isEditing)return;const e=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(t.keyCode in e)this[e[t.keyCode]](t);else if(t.keyCode in this.ctrlKeysMapDown&&(t.ctrlKey||t.metaKey))this[this.ctrlKeysMapDown[t.keyCode]](t);else return;t.stopImmediatePropagation(),t.preventDefault(),t.keyCode>=33&&t.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}onKeyUp(t){if(!this.isEditing||this._copyDone||this.inCompositionMode){this._copyDone=!1;return}if(t.keyCode in this.ctrlKeysMapUp&&(t.ctrlKey||t.metaKey))this[this.ctrlKeysMapUp[t.keyCode]](t);else return;t.stopImmediatePropagation(),t.preventDefault(),this.canvas&&this.canvas.requestRenderAll()}onInput(t){const e=this.fromPaste;if(this.fromPaste=!1,t&&t.stopPropagation(),!this.isEditing)return;const n=()=>{this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())};if(this.hiddenTextarea.value===""){this.styles={},n();return}const r=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,o=this._text.length,l=r.length,c=this.selectionStart,u=this.selectionEnd,d=c!==u;let g,_,y=l-o,x,S;const E=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),P=c>E.selectionStart;d?(_=this._text.slice(c,u),y+=u-c):l<o&&(P?_=this._text.slice(u+y,u):_=this._text.slice(c,c-y));const L=r.slice(E.selectionEnd-y,E.selectionEnd);if(_&&_.length&&(L.length&&(g=this.getSelectionStyles(c,c+1,!1),g=L.map(()=>g[0])),d?(x=c,S=u):P?(x=u-_.length,S=u):(x=u,S=u+_.length),this.removeStyleFromTo(x,S)),L.length){const{copyPasteData:W}=Qe();e&&L.join("")===W.copiedText&&!at.disableStyleCopyPaste&&(g=W.copiedTextStyle),this.insertNewStyleBlock(L,c,g)}n()}onCompositionStart(){this.inCompositionMode=!0}onCompositionEnd(){this.inCompositionMode=!1}onCompositionUpdate(t){this.compositionStart=t.target.selectionStart,this.compositionEnd=t.target.selectionEnd,this.updateTextareaPosition()}copy(){if(this.selectionStart===this.selectionEnd)return;const{copyPasteData:t}=Qe();t.copiedText=this.getSelectedText(),at.disableStyleCopyPaste?t.copiedTextStyle=null:t.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0}paste(){this.fromPaste=!0}_getWidthBeforeCursor(t,e){let n=this._getLineLeftOffset(t),r;return e>0&&(r=this.__charBounds[t][e-1],n+=r.left+r.width),n}getDownCursorOffset(t,e){const n=this._getSelectionForOffset(t,e),r=this.get2DCursorLocation(n),o=r.lineIndex;if(o===this._textLines.length-1||t.metaKey||t.keyCode===34)return this._text.length-n;const l=r.charIndex,c=this._getWidthBeforeCursor(o,l),u=this._getIndexOnLine(o+1,c);return this._textLines[o].slice(l).length+u+1+this.missingNewlineOffset(o)}_getSelectionForOffset(t,e){return t.shiftKey&&this.selectionStart!==this.selectionEnd&&e?this.selectionEnd:this.selectionStart}getUpCursorOffset(t,e){const n=this._getSelectionForOffset(t,e),r=this.get2DCursorLocation(n),o=r.lineIndex;if(o===0||t.metaKey||t.keyCode===33)return-n;const l=r.charIndex,c=this._getWidthBeforeCursor(o,l),u=this._getIndexOnLine(o-1,c),d=this._textLines[o].slice(0,l),g=this.missingNewlineOffset(o-1);return-this._textLines[o-1].length+u-d.length+(1-g)}_getIndexOnLine(t,e){const n=this._textLines[t];let o=this._getLineLeftOffset(t),l=0,c,u;for(let d=0,g=n.length;d<g;d++)if(c=this.__charBounds[t][d].width,o+=c,o>e){u=!0;const _=o-c,y=o,x=Math.abs(_-e);l=Math.abs(y-e)<x?d:d-1;break}return u||(l=n.length-1),l}moveCursorDown(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",t)}moveCursorUp(t){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",t)}_moveCursorUpOrDown(t,e){const n="get".concat(t,"CursorOffset"),r=this[n](e,this._selectionDirection===Yt);if(e.shiftKey?this.moveCursorWithShift(r):this.moveCursorWithoutShift(r),r!==0){const o=this.text.length;this.selectionStart=ei(0,this.selectionStart,o),this.selectionEnd=ei(0,this.selectionEnd,o),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea()}}moveCursorWithShift(t){const e=this._selectionDirection===dt?this.selectionStart+t:this.selectionEnd+t;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,e),t!==0}moveCursorWithoutShift(t){return t<0?(this.selectionStart+=t,this.selectionEnd=this.selectionStart):(this.selectionEnd+=t,this.selectionStart=this.selectionEnd),t!==0}moveCursorLeft(t){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",t)}_move(t,e,n){let r;if(t.altKey)r=this["findWordBoundary"+n](this[e]);else if(t.metaKey||t.keyCode===35||t.keyCode===36)r=this["findLineBoundary"+n](this[e]);else return this[e]+=n==="Left"?-1:1,!0;if(typeof r<"u"&&this[e]!==r)return this[e]=r,!0}_moveLeft(t,e){return this._move(t,e,"Left")}_moveRight(t,e){return this._move(t,e,"Right")}moveCursorLeftWithoutShift(t){let e=!0;return this._selectionDirection=dt,this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(e=this._moveLeft(t,"selectionStart")),this.selectionEnd=this.selectionStart,e}moveCursorLeftWithShift(t){if(this._selectionDirection===Yt&&this.selectionStart!==this.selectionEnd)return this._moveLeft(t,"selectionEnd");if(this.selectionStart!==0)return this._selectionDirection=dt,this._moveLeft(t,"selectionStart")}moveCursorRight(t){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",t)}_moveCursorLeftOrRight(t,e){let n="moveCursor"+t+"With";this._currentCursorOpacity=1,e.shiftKey?n+="Shift":n+="outShift",this[n](e)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())}moveCursorRightWithShift(t){if(this._selectionDirection===dt&&this.selectionStart!==this.selectionEnd)return this._moveRight(t,"selectionStart");if(this.selectionEnd!==this._text.length)return this._selectionDirection=Yt,this._moveRight(t,"selectionEnd")}moveCursorRightWithoutShift(t){let e=!0;return this._selectionDirection=Yt,this.selectionStart===this.selectionEnd?(e=this._moveRight(t,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,e}}function Ca(a){return a.button&&a.button!==1}class g1 extends d1{constructor(){super(...arguments),D(this,"draggableTextDelegate",void 0)}initBehavior(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore),this.on("mouseup",this.mouseUpHandler),this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler),this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown),this.draggableTextDelegate=new u1(this),super.initBehavior()}shouldStartDragging(){return this.draggableTextDelegate.isActive()}onDragStart(t){return this.draggableTextDelegate.onDragStart(t)}canDrop(t){return this.draggableTextDelegate.canDrop(t)}onMouseDown(t){if(!this.canvas)return;this.__newClickTime=+new Date;const e=t.pointer;this.isTripleClick(e)&&(this.fire("tripleclick",t),La(t.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=e,this.__lastSelected=this.selected}isTripleClick(t){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===t.x&&this.__lastPointer.y===t.y}doubleClickHandler(t){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(t.e))}tripleClickHandler(t){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(t.e))}_mouseDownHandler(t){let{e}=t;!this.canvas||!this.editable||Ca(e)||this.__corner||this.draggableTextDelegate.start(e)||(this.canvas.textEditingManager.register(this),this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))}_mouseDownHandlerBefore(t){let{e}=t;!this.canvas||!this.editable||Ca(e)||(this.selected=this===this.canvas._activeObject)}mouseUpHandler(t){let{e,transform:n,button:r}=t;const o=this.draggableTextDelegate.end(e);if(this.canvas){this.canvas.textEditingManager.unregister(this);const l=this.canvas._activeObject;if(l&&l!==this)return}!this.editable||this.group&&!this.group.interactive||n&&n.actionPerformed||Ca(e)||o||(this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0)}setCursorByClick(t){const e=this.getSelectionStartFromPointer(t),n=this.selectionStart,r=this.selectionEnd;t.shiftKey?this.setSelectionStartEndWithShift(n,r,e):(this.selectionStart=e,this.selectionEnd=e),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())}getSelectionStartFromPointer(t){const e=this.canvas.getPointer(t).transform(Nt(this.calcTransformMatrix())).add(new M(-this._getLeftOffset(),-this._getTopOffset()));let n=0,r=0,o=0;for(let g=0,_=this._textLines.length;g<_&&n<=e.y;g++)n+=this.getHeightOfLine(g),o=g,g>0&&(r+=this._textLines[g-1].length+this.missingNewlineOffset(g-1));let c=Math.abs(this._getLineLeftOffset(o));const u=this._textLines[o].length;let d=0;for(let g=0;g<u&&(d=c,c+=this.__charBounds[o][g].kernedWidth,c<=e.x);g++)r++;return this._getNewSelectionStartFromOffset(e,d,c,r,u)}_getNewSelectionStartFromOffset(t,e,n,r,o){const l=t.x-e,c=n-t.x,u=c>l||c<0?0:1;let d=r+u;return this.flipX&&(d=o-d),d>this._text.length&&(d=this._text.length),d}}const bs="moveCursorUp",Ts="moveCursorDown",Os="moveCursorLeft",Ds="moveCursorRight",Es="exitEditing",p1={9:Es,27:Es,33:bs,34:Ts,35:Ds,36:Os,37:Os,38:bs,39:Ds,40:Ts},m1={9:Es,27:Es,33:bs,34:Ts,35:Os,36:Ds,37:Ds,38:bs,39:Os,40:Ts},_1={67:"copy",88:"cut"},v1={65:"selectAll"},y1={selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_selectionDirection:null,_reSpace:/\s|\n/,inCompositionMode:!1,keysMap:p1,keysMapRtl:m1,ctrlKeysMapDown:v1,ctrlKeysMapUp:_1};class jn extends g1{static getDefaults(){return T(T({},super.getDefaults()),jn.ownDefaults)}get type(){return"i-text"}constructor(t,e){super(t,e),this.initBehavior()}_set(t,e){return this.isEditing&&this._savedProps&&t in this._savedProps?(this._savedProps[t]=e,this):(t==="canvas"&&(this.canvas instanceof Hu&&this.canvas.textEditingManager.remove(this),e instanceof Hu&&e.textEditingManager.add(this)),super._set(t,e))}setSelectionStart(t){t=Math.max(t,0),this._updateAndFire("selectionStart",t)}setSelectionEnd(t){t=Math.min(t,this.text.length),this._updateAndFire("selectionEnd",t)}_updateAndFire(t,e){this[t]!==e&&(this._fireSelectionChanged(),this[t]=e),this._updateTextarea()}_fireSelectionChanged(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}initDimensions(){this.isEditing&&this.initDelayedCursor(),super.initDimensions()}getSelectionStyles(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart||0,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionEnd,n=arguments.length>2?arguments[2]:void 0;return super.getSelectionStyles(t,e,n)}setSelectionStyles(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.selectionStart||0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.selectionEnd;return super.setSelectionStyles(t,e,n)}get2DCursorLocation(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;return super.get2DCursorLocation(t,e)}render(t){super.render(t),this.cursorOffsetCache={},this.renderCursorOrSelection()}toCanvasElement(t){const e=this.isEditing;this.isEditing=!1;const n=super.toCanvasElement(t);return this.isEditing=e,n}renderCursorOrSelection(){if(!this.isEditing)return;const t=this.clearContextTop(!0);if(!t)return;const e=this._getCursorBoundaries();this.selectionStart===this.selectionEnd?this.renderCursor(t,e):this.renderSelection(t,e),this.canvas.contextTopDirty=!0,t.restore()}_getCursorBoundaries(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.selectionStart,e=arguments.length>1?arguments[1]:void 0;const n=this._getLeftOffset(),r=this._getTopOffset(),o=this._getCursorBoundariesOffsets(t,e);return{left:n,top:r,leftOffset:o.left,topOffset:o.top}}_getCursorBoundariesOffsets(t,e){return e?this.__getCursorBoundariesOffsets(t):this.cursorOffsetCache&&"top"in this.cursorOffsetCache?this.cursorOffsetCache:this.cursorOffsetCache=this.__getCursorBoundariesOffsets(t)}__getCursorBoundariesOffsets(t){let e=0,n=0;const{charIndex:r,lineIndex:o}=this.get2DCursorLocation(t);for(let d=0;d<o;d++)e+=this.getHeightOfLine(d);const l=this._getLineLeftOffset(o),c=this.__charBounds[o][r];c&&(n=c.left),this.charSpacing!==0&&r===this._textLines[o].length&&(n-=this._getWidthOfCharSpacing());const u={top:e,left:l+(n>0?n:0)};return this.direction==="rtl"&&(this.textAlign===Yt||this.textAlign===Je||this.textAlign===hr?u.left*=-1:(this.textAlign===dt||this.textAlign===Ss||this.textAlign===et||this.textAlign===cr)&&(u.left=l-(n>0?n:0))),u}renderCursorAt(t){const e=this._getCursorBoundaries(t,!0);this._renderCursor(this.canvas.contextTop,e,t)}renderCursor(t,e){this._renderCursor(t,e,this.selectionStart)}_renderCursor(t,e,n){const r=this.get2DCursorLocation(n),o=r.lineIndex,l=r.charIndex>0?r.charIndex-1:0,c=this.getValueOfPropertyAt(o,l,"fontSize"),u=this.scaleX*this.canvas.getZoom(),d=this.cursorWidth/u,g=this.getValueOfPropertyAt(o,l,"deltaY"),_=e.topOffset+(1-this._fontSizeFraction)*this.getHeightOfLine(o)/this.lineHeight-c*(1-this._fontSizeFraction);this.inCompositionMode&&this.renderSelection(t,e),t.fillStyle=this.cursorColor||this.getValueOfPropertyAt(o,l,"fill"),t.globalAlpha=this._currentCursorOpacity,t.fillRect(e.left+e.leftOffset-d/2,_+e.top+g,d,c)}renderSelection(t,e){const n={selectionStart:this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,selectionEnd:this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd};this._renderSelection(t,n,e)}renderDragSourceEffect(){const t=this.draggableTextDelegate.getDragStartSelection();this._renderSelection(this.canvas.contextTop,t,this._getCursorBoundaries(t.selectionStart,!0))}renderDropTargetEffect(t){const e=this.getSelectionStartFromPointer(t);this.renderCursorAt(e)}_renderSelection(t,e,n){const r=e.selectionStart,o=e.selectionEnd,l=this.textAlign.includes(Je),c=this.get2DCursorLocation(r),u=this.get2DCursorLocation(o),d=c.lineIndex,g=u.lineIndex,_=c.charIndex<0?0:c.charIndex,y=u.charIndex<0?0:u.charIndex;for(let x=d;x<=g;x++){const S=this._getLineLeftOffset(x)||0;let E=this.getHeightOfLine(x),P=0,L=0,W=0;if(x===d&&(L=this.__charBounds[d][_].left),x>=d&&x<g)W=l&&!this.isEndOfWrapping(x)?this.width:this.getLineWidth(x)||5;else if(x===g)if(y===0)W=this.__charBounds[g][y].left;else{const A=this._getWidthOfCharSpacing();W=this.__charBounds[g][y-1].left+this.__charBounds[g][y-1].width-A}P=E,(this.lineHeight<1||x===g&&this.lineHeight>1)&&(E/=this.lineHeight);let Y=n.left+S+L,H=E,z=0;const U=W-L;this.inCompositionMode?(t.fillStyle=this.compositionColor||"black",H=1,z=E):t.fillStyle=this.selectionColor,this.direction==="rtl"&&(this.textAlign===Yt||this.textAlign===Je||this.textAlign===hr?Y=this.width-Y-U:(this.textAlign===dt||this.textAlign===Ss||this.textAlign===et||this.textAlign===cr)&&(Y=n.left+S-W)),t.fillRect(Y,n.top+n.topOffset+z,U,H),n.topOffset+=P}}getCurrentCharFontSize(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fontSize")}getCurrentCharColor(){const t=this._getCurrentCharIndex();return this.getValueOfPropertyAt(t.l,t.c,"fill")}_getCurrentCharIndex(){const t=this.get2DCursorLocation(this.selectionStart,!0),e=t.charIndex>0?t.charIndex-1:0;return{l:t.lineIndex,c:e}}dispose(){this._exitEditing(),this.draggableTextDelegate.dispose(),super.dispose()}}D(jn,"ownDefaults",y1);D(jn,"type","IText");q.setClass(jn);q.setClass(jn,"i-text");const x1={minWidth:20,dynamicMinWidth:2,lockScalingFlip:!0,noScaleCache:!1,_wordJoiners:/[ \t\r]/,splitByGrapheme:!1};let Hs=class wd extends jn{static getDefaults(){return T(T({},super.getDefaults()),{},{controls:Hf()},wd.ownDefaults)}initDimensions(){this.initialized&&(this.isEditing&&this.initDelayedCursor(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.includes(Je)&&this.enlargeSpaces(),this.height=this.calcTextHeight())}_generateStyleMap(t){let e=0,n=0,r=0;const o={};for(let l=0;l<t.graphemeLines.length;l++)t.graphemeText[r]===`
`&&l>0?(n=0,r++,e++):!this.splitByGrapheme&&this._reSpaceAndTab.test(t.graphemeText[r])&&l>0&&(n++,r++),o[l]={line:e,offset:n},r+=t.graphemeLines[l].length,n+=t.graphemeLines[l].length;return o}styleHas(t,e){if(this._styleMap&&!this.isWrapping){const n=this._styleMap[e];n&&(e=n.line)}return super.styleHas(t,e)}isEmptyStyles(t){if(!this.styles)return!0;let e=0,n=t+1,r,o=!1;const l=this._styleMap[t],c=this._styleMap[t+1];l&&(t=l.line,e=l.offset),c&&(n=c.line,o=n===t,r=c.offset);const u=typeof t>"u"?this.styles:{line:this.styles[t]};for(const d in u)for(const g in u[d])if(g>=e&&(!o||g<r))for(const _ in u[d][g])return!1;return!0}_getStyleDeclaration(t,e){if(this._styleMap&&!this.isWrapping){const n=this._styleMap[t];if(!n)return null;t=n.line,e=n.offset+e}return super._getStyleDeclaration(t,e)}_setStyleDeclaration(t,e,n){const r=this._styleMap[t];t=r.line,e=r.offset+e,this.styles[t][e]=n}_deleteStyleDeclaration(t,e){const n=this._styleMap[t];t=n.line,e=n.offset+e,delete this.styles[t][e]}_getLineStyle(t){const e=this._styleMap[t];return!!this.styles[e.line]}_setLineStyle(t){const e=this._styleMap[t];this.styles[e.line]={}}_wrapText(t,e){const n=[];this.isWrapping=!0;for(let r=0;r<t.length;r++)n.push(...this._wrapLine(t[r],r,e));return this.isWrapping=!1,n}_measureWord(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,r=0,o;const l=!0;for(let c=0,u=t.length;c<u;c++){const d=this._getGraphemeBox(t[c],e,c+n,o,l);r+=d.kernedWidth,o=t[c]}return r}wordSplit(t){return t.split(this._wordJoiners)}_wrapLine(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0;const o=this._getWidthOfCharSpacing(),l=this.splitByGrapheme,c=[],u=l?this.graphemeSplit(t):this.wordSplit(t),d=l?"":" ";let g=0,_=[],y=0,x=0,S=0,E=!0;u.length===0&&u.push([]),n-=r;const P=u.map(Y=>{Y=l?Y:this.graphemeSplit(Y);const H=this._measureWord(Y,e,y);return S=Math.max(H,S),y+=Y.length+d.length,{word:Y,width:H}}),L=Math.max(n,S,this.dynamicMinWidth);y=0;let W;for(W=0;W<u.length;W++){const Y=P[W].word,H=P[W].width;y+=Y.length,g+=x+H-o,g>L&&!E?(c.push(_),_=[],g=H,E=!0):g+=o,!E&&!l&&_.push(d),_=_.concat(Y),x=l?0:this._measureWord([d],e,y),y++,E=!1}return W&&c.push(_),S+r>this.dynamicMinWidth&&(this.dynamicMinWidth=S-o+r),c}isEndOfWrapping(t){return!this._styleMap[t+1]||this._styleMap[t+1].line!==this._styleMap[t].line}missingNewlineOffset(t){return this.splitByGrapheme?this.isEndOfWrapping(t)?1:0:1}_splitTextIntoLines(t){const e=super._splitTextIntoLines(t),n=this._wrapText(e.lines,this.width),r=new Array(n.length);for(let o=0;o<n.length;o++)r[o]=n[o].join("");return e.lines=r,e.graphemeLines=n,e}getMinWidth(){return Math.max(this.minWidth,this.dynamicMinWidth)}_removeExtraneousStyles(){const t={};for(const e in this._styleMap)this._textLines[e]&&(t[this._styleMap[e].line]=1);for(const e in this.styles)t[e]||delete this.styles[e]}toObject(t){return super.toObject(["minWidth","splitByGrapheme"].concat(t))}};D(Hs,"type","Textbox");D(Hs,"textLayoutProperties",[...jn.textLayoutProperties,"width"]);D(Hs,"ownDefaults",x1);q.setClass(Hs);class C1{constructor(){D(this,"resources",{})}applyFilters(t,e,n,r,o){const l=o.getContext("2d");if(!l)return;l.drawImage(e,0,0,n,r);const c=l.getImageData(0,0,n,r),u=l.getImageData(0,0,n,r),d={sourceWidth:n,sourceHeight:r,imageData:c,originalEl:e,originalImageData:u,canvasEl:o,ctx:l,filterBackend:this};t.forEach(_=>{_.applyTo(d)});const{imageData:g}=d;return(g.width!==n||g.height!==r)&&(o.width=g.width,o.height=g.height),l.putImageData(g,0,0),d}}class Sd{constructor(){let{tileSize:t=at.textureSize}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};D(this,"aPosition",new Float32Array([0,0,0,1,1,0,1,1])),D(this,"resources",{}),this.tileSize=t,this.setupGLContext(t,t),this.captureGPUInfo()}setupGLContext(t,e){this.dispose(),this.createWebGLCanvas(t,e),this.chooseFastestCopyGLTo2DMethod(t,e)}chooseFastestCopyGLTo2DMethod(t,e){const n=Wt(),r=new ArrayBuffer(t*e*4);if(at.forceGLPutImageData){this.imageBuffer=r,this.copyGLTo2D=wa;return}const o={imageBuffer:r},l={destinationWidth:t,destinationHeight:e,targetCanvas:n};let c;n.width=t,n.height=e,c=Jn().performance.now(),this.copyGLTo2D.call(o,this.gl,l);const u=Jn().performance.now()-c;c=Jn().performance.now(),wa.call(o,this.gl,l);const d=Jn().performance.now()-c;u>d&&(this.imageBuffer=r,this.copyGLTo2D=wa)}createWebGLCanvas(t,e){const n=Wt();n.width=t,n.height=e;const r={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},o=n.getContext("webgl",r);o&&(o.clearColor(0,0,0,0),this.canvas=n,this.gl=o)}applyFilters(t,e,n,r,o,l){const c=this.gl,u=o.getContext("2d");if(!c||!u)return;let d;l&&(d=this.getCachedTexture(l,e));const g={originalWidth:e.width||e.originalWidth||0,originalHeight:e.height||e.originalHeight||0,sourceWidth:n,sourceHeight:r,destinationWidth:n,destinationHeight:r,context:c,sourceTexture:this.createTexture(c,n,r,d?void 0:e),targetTexture:this.createTexture(c,n,r),originalTexture:d||this.createTexture(c,n,r,d?void 0:e),passes:t.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:o},_=c.createFramebuffer();return c.bindFramebuffer(c.FRAMEBUFFER,_),t.forEach(y=>{y&&y.applyTo(g)}),w1(g),this.copyGLTo2D(c,g),c.bindTexture(c.TEXTURE_2D,null),c.deleteTexture(g.sourceTexture),c.deleteTexture(g.targetTexture),c.deleteFramebuffer(_),u.setTransform(1,0,0,1,0,0),g}dispose(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()}clearWebGLCaches(){this.programCache={},this.textureCache={}}createTexture(t,e,n,r,o){const{NEAREST:l,TEXTURE_2D:c,RGBA:u,UNSIGNED_BYTE:d,CLAMP_TO_EDGE:g,TEXTURE_MAG_FILTER:_,TEXTURE_MIN_FILTER:y,TEXTURE_WRAP_S:x,TEXTURE_WRAP_T:S}=t,E=t.createTexture();return t.bindTexture(c,E),t.texParameteri(c,_,o||l),t.texParameteri(c,y,o||l),t.texParameteri(c,x,g),t.texParameteri(c,S,g),r?t.texImage2D(c,0,u,u,d,r):t.texImage2D(c,0,u,e,n,0,u,d,null),E}getCachedTexture(t,e,n){const{textureCache:r}=this;if(r[t])return r[t];{const o=this.createTexture(this.gl,e.width,e.height,e,n);return o&&(r[t]=o),o}}evictCachesForKey(t){this.textureCache[t]&&(this.gl.deleteTexture(this.textureCache[t]),delete this.textureCache[t])}copyGLTo2D(t,e){const n=t.canvas,r=e.targetCanvas,o=r.getContext("2d");if(!o)return;o.translate(0,r.height),o.scale(1,-1);const l=n.height-r.height;o.drawImage(n,0,l,r.width,r.height,0,0,r.width,r.height)}captureGPUInfo(){if(this.gpuInfo)return this.gpuInfo;const t=this.gl,e={renderer:"",vendor:""};if(!t)return e;const n=t.getExtension("WEBGL_debug_renderer_info");if(n){const r=t.getParameter(n.UNMASKED_RENDERER_WEBGL),o=t.getParameter(n.UNMASKED_VENDOR_WEBGL);r&&(e.renderer=r.toLowerCase()),o&&(e.vendor=o.toLowerCase())}return this.gpuInfo=e,e}}function w1(a){const t=a.targetCanvas,e=t.width,n=t.height,r=a.destinationWidth,o=a.destinationHeight;(e!==r||n!==o)&&(t.width=r,t.height=o)}function wa(a,t){const e=t.targetCanvas,n=e.getContext("2d"),r=t.destinationWidth,o=t.destinationHeight,l=r*o*4;if(!n)return;const c=new Uint8Array(this.imageBuffer,0,l),u=new Uint8ClampedArray(this.imageBuffer,0,l);a.readPixels(0,0,r,o,a.RGBA,a.UNSIGNED_BYTE,c);const d=new ImageData(u,r,o);n.putImageData(d,0,0)}let Sa;function S1(){const{WebGLProbe:a}=Qe();return a.queryWebGL(Wt()),at.enableGLFiltering&&a.isSupported(at.textureSize)?new Sd({tileSize:at.textureSize}):new C1}function ba(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return!Sa&&a&&(Sa=S1()),Sa}const b1=["filters","resizeFilter","src","crossOrigin"],T1={strokeWidth:0,srcFromAttribute:!1,minimumScaleTrigger:.5,cropX:0,cropY:0,imageSmoothing:!0},bd=["cropX","cropY"];class Ie extends qt{static getDefaults(){return T(T({},super.getDefaults()),Ie.ownDefaults)}constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(T({filters:[]},e)),D(this,"_lastScaleX",1),D(this,"_lastScaleY",1),D(this,"_filterScalingX",1),D(this,"_filterScalingY",1),this.cacheKey="texture".concat(Ln()),this.setElement(typeof t=="string"?(this.canvas&&getElementDocument(this.canvas.getElement())||Mi()).getElementById(t):t,e)}getElement(){return this._element}setElement(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._element=t,this._originalElement=t,this._setWidthHeight(e),t.classList.add(Ie.CSS_CANVAS),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters()}removeTexture(t){const e=ba(!1);e instanceof Sd&&e.evictCachesForKey(t)}dispose(){super.dispose(),this.removeTexture(this.cacheKey),this.removeTexture("".concat(this.cacheKey,"_filtered")),this._cacheContext=null,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(t=>{const e=this[t];e&&Qe().dispose(e),this[t]=void 0})}getCrossOrigin(){return this._originalElement&&(this._originalElement.crossOrigin||null)}getOriginalSize(){const t=this.getElement();return t?{width:t.naturalWidth||t.width,height:t.naturalHeight||t.height}:{width:0,height:0}}_stroke(t){if(!this.stroke||this.strokeWidth===0)return;const e=this.width/2,n=this.height/2;t.beginPath(),t.moveTo(-e,-n),t.lineTo(e,-n),t.lineTo(e,n),t.lineTo(-e,n),t.lineTo(-e,-n),t.closePath()}toObject(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const e=[];return this.filters.forEach(n=>{n&&e.push(n.toObject())}),T(T({},super.toObject([...bd,...t])),{},{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:e},this.resizeFilter?{resizeFilter:this.resizeFilter.toObject()}:{})}hasCrop(){return!!this.cropX||!!this.cropY||this.width<this._element.width||this.height<this._element.height}_toSVG(){const t=[],e=this._element,n=-this.width/2,r=-this.height/2;let o=[],l,c="",u="";if(!e)return[];if(this.hasCrop()){const d=Ln();o.push('<clipPath id="imageCrop_'+d+`">
`,'	<rect x="'+n+'" y="'+r+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),c=' clip-path="url(#imageCrop_'+d+')" '}if(this.imageSmoothing||(u='" image-rendering="optimizeSpeed'),t.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',n-this.cropX,'" y="',r-this.cropY,'" width="',e.width||e.naturalWidth,'" height="',e.height||e.naturalHeight,u,'"',c,`></image>
`),this.stroke||this.strokeDashArray){const d=this.fill;this.fill=null,l=["	<rect ",'x="',n,'" y="',r,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=d}return this.paintFirst!=="fill"?o=o.concat(l,t):o=o.concat(t,l),o}getSrc(t){const e=t?this._element:this._originalElement;return e?e.toDataURL?e.toDataURL():this.srcFromAttribute?e.getAttribute("src"):e.src:this.src||""}getSvgSrc(t){return this.getSrc(t)}setSrc(t){let{crossOrigin:e,signal:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return lr(t,{crossOrigin:e,signal:n}).then(r=>{typeof e<"u"&&this.set({crossOrigin:e}),this.setElement(r)})}toString(){return'#<Image: { src: "'.concat(this.getSrc(),'" }>')}applyResizeFilters(){const t=this.resizeFilter,e=this.minimumScaleTrigger,n=this.getTotalObjectScaling(),r=n.x,o=n.y,l=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!t||r>e&&o>e){this._element=l,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=r,this._lastScaleY=o;return}const c=Wt(),u=l.width,d=l.height;c.width=u,c.height=d,this._element=c,this._lastScaleX=t.scaleX=r,this._lastScaleY=t.scaleY=o,ba().applyFilters([t],l,u,d,this._element),this._filterScalingX=c.width/this._originalElement.width,this._filterScalingY=c.height/this._originalElement.height}applyFilters(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.filters||[];if(t=t.filter(o=>o&&!o.isNeutralState()),this.set("dirty",!0),this.removeTexture("".concat(this.cacheKey,"_filtered")),t.length===0){this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1;return}const e=this._originalElement,n=e.naturalWidth||e.width,r=e.naturalHeight||e.height;if(this._element===this._originalElement){const o=Wt();o.width=n,o.height=r,this._element=o,this._filteredEl=o}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,n,r),this._lastScaleX=1,this._lastScaleY=1;ba().applyFilters(t,this._originalElement,n,r,this._element),(this._originalElement.width!==this._element.width||this._originalElement.height!==this._element.height)&&(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height)}_render(t){t.imageSmoothingEnabled=this.imageSmoothing,this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(t),this._renderPaintInOrder(t)}drawCacheOnCanvas(t){t.imageSmoothingEnabled=this.imageSmoothing,super.drawCacheOnCanvas(t)}shouldCache(){return this.needsItsOwnCache()}_renderFill(t){const e=this._element;if(!e)return;const n=this._filterScalingX,r=this._filterScalingY,o=this.width,l=this.height,c=Math.max(this.cropX,0),u=Math.max(this.cropY,0),d=e.naturalWidth||e.width,g=e.naturalHeight||e.height,_=c*n,y=u*r,x=Math.min(o*n,d-_),S=Math.min(l*r,g-y),E=-o/2,P=-l/2,L=Math.min(o,d/n-c),W=Math.min(l,g/r-u);e&&t.drawImage(e,_,y,x,S,E,P,L,W)}_needsResize(){const t=this.getTotalObjectScaling();return t.x!==this._lastScaleX||t.y!==this._lastScaleY}_resetWidthHeight(){this.set(this.getOriginalSize())}_setWidthHeight(){let{width:t,height:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.getOriginalSize();this.width=t||n.width,this.height=e||n.height}parsePreserveAspectRatioAttribute(){const t=lf(this.preserveAspectRatio||""),e=this.width,n=this.height,r={width:e,height:n};let o=this._element.width,l=this._element.height,c=1,u=1,d=0,g=0,_=0,y=0,x;return t&&(t.alignX!==pe||t.alignY!==pe)?(t.meetOrSlice==="meet"&&(c=u=Zf(this._element,r),x=(e-o*c)/2,t.alignX==="Min"&&(d=-x),t.alignX==="Max"&&(d=x),x=(n-l*u)/2,t.alignY==="Min"&&(g=-x),t.alignY==="Max"&&(g=x)),t.meetOrSlice==="slice"&&(c=u=Qf(this._element,r),x=o-e/c,t.alignX==="Mid"&&(_=x/2),t.alignX==="Max"&&(_=x),x=l-n/u,t.alignY==="Mid"&&(y=x/2),t.alignY==="Max"&&(y=x),o=e/c,l=n/u)):(c=e/o,u=n/l),{width:o,height:l,scaleX:c,scaleY:u,offsetLeft:d,offsetTop:g,cropX:_,cropY:y}}static fromObject(t){let{filters:e,resizeFilter:n,src:r,crossOrigin:o}=t,l=At(t,b1),c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Promise.all([lr(r,T(T({},c),{},{crossOrigin:o})),e&&Pi(e,c),n&&Pi([n],c),_r(l,c)]).then(u=>{let[d,g=[],[_]=[],y={}]=u;return new this(d,T(T({},l),{},{src:r,crossOrigin:o,filters:g,resizeFilter:_},y))})}static fromURL(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return lr(t,e).then(n=>new this(n,e))}static async fromElement(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=vn(t,this.ATTRIBUTE_NAMES);return this.fromURL(n["xlink:href"],T(T({},e),n)).catch(r=>(console.log(r),null))}}D(Ie,"type","Image");D(Ie,"cacheProperties",[..._n,...bd]);D(Ie,"ownDefaults",T1);D(Ie,"CSS_CANVAS","canvas-img");D(Ie,"ATTRIBUTE_NAMES",[...In,"x","y","width","height","preserveAspectRatio","xlink:href","crossOrigin","image-rendering"]);q.setClass(Ie);q.setSVGClass(Ie);const Gu=a=>q.getSVGClass(a.tagName.toLowerCase().replace("svg:","")),O1=function(a,t,e,n,r){this.elements=a,this.options=t,this.reviver=e,this.svgUid=t&&t.svgUid||0,this.parsingOptions=n,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=r};(function(a){a.parse=function(){return Promise.all(this.elements.map((t,e)=>(t.setAttribute("svgUid",this.svgUid),this.createObject(t))))},a.createObject=async function(t){const e=Gu(t);if(e){const n=await e.fromElement(t,this.options);let r;return this.resolveGradient(n,t,"fill"),this.resolveGradient(n,t,"stroke"),n instanceof Ie&&n._originalElement&&(r=n.parsePreserveAspectRatioAttribute(t)),Ha(n,r),await this.resolveClipPath(n,t),this.reviver&&this.reviver(t,n),n}return null},a.extractPropertyDefinition=function(t,e,n){const r=t[e],o=this.regexUrl;if(!o.test(r))return;o.lastIndex=0;const l=o.exec(r)[1];return o.lastIndex=0,Sw[n][this.svgUid][l]},a.resolveGradient=function(t,e,n){const r=this.extractPropertyDefinition(t,n,"gradientDefs");if(r){const o=e.getAttribute(n+"-opacity"),l=gl.fromElement(r,t,T(T({},this.options),{},{opacity:o}));t.set(n,l)}},a.resolveClipPath=async function(t,e){const n=this.extractPropertyDefinition(t,"clipPath","clipPaths");if(n){const r=Nt(t.calcTransformMatrix()),o=n[0].parentNode;let l=e;for(;l.parentNode&&l.getAttribute("clip-path")!==t.clipPath;)l=l.parentNode;l.parentNode.appendChild(o);const c=await Promise.all(n.map(P=>Gu(P).fromElement(P,this.options).then(L=>(Ha(L),L.fillRule=L.clipRule,L)))),u=c.length===1?c[0]:new en(c),d=Kt(r,u.calcTransformMatrix());u.clipPath&&await this.resolveClipPath(u,l);const{scaleX:g,scaleY:_,angle:y,skewX:x,translateX:S,translateY:E}=Fn(d);u.set({flipX:!1,flipY:!1}),u.set({scaleX:g,scaleY:_,angle:y,skewX:x,skewY:0}),u.setPositionByOrigin(new M(S,E),et,et),t.clipPath=u}else{delete t.clipPath;return}}})(O1.prototype);const Td=a=>new M(a.width,a.height),D1=a=>function(t,e,n){var r,o;const l=n.points[a].x-n.pathOffset.x,c=n.points[a].y-n.pathOffset.y;return new M(l,c).transform(Kt((r=(o=n.canvas)===null||o===void 0?void 0:o.viewportTransform)!==null&&r!==void 0?r:be,n.calcTransformMatrix()))},E1=(a,t,e,n)=>{const r=t.target,o=t.pointIndex,l=yr(t,et,et,e,n),c=Td(r),u=r._getTransformedDimensions(),d=c.divide(u),g=new M(r.flipX?-1:1,r.flipY?-1:1),_=l.multiply(g).multiply(d).add(r.pathOffset);return r.points[o]=_,r.setDimensions(),!0},P1=(a,t)=>function(e,n,r,o){const l=n.target,c=(a>0?a:l.points.length)-1,u=new M(l.points[c].x-l.pathOffset.x,l.points[c].y-l.pathOffset.y).transform(l.calcOwnMatrix()),d=t(e,T(T({},n),{},{pointIndex:a}),r,o),g=Td(l),_=new M(l.flipX?-1:1,l.flipY?-1:1),y=new M(l.points[c].x,l.points[c].y).subtract(l.pathOffset).divide(g).multiply(_);return l.setPositionByOrigin(u,y.x+.5,y.y+.5),d};function A1(a){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const e={};for(let n=0;n<(typeof a=="number"?a:a.points.length);n++)e["p".concat(n)]=new Re(T({actionName:"modifyPoly",positionHandler:D1(n),actionHandler:P1(n,E1)},t));return e}var xb=Object.freeze({__proto__:null,changeWidth:Ra,createObjectDefaultControls:ul,createPolyControls:A1,createResizeControls:Yf,createTextboxDefaultControls:Hf,dragHandler:xf,getLocalPoint:yr,renderCircleControl:Pf,renderSquareControl:Af,rotationStyleHandler:Mf,rotationWithSnapping:kf,scaleCursorStyleHandler:Ti,scaleOrSkewActionName:rr,scaleSkewCursorStyleHandler:Zn,scalingEqually:ir,scalingX:Rf,scalingXOrSkewingY:Ba,scalingY:If,scalingYOrSkewingX:Wa,skewCursorStyleHandler:Bf,skewHandlerX:jf,skewHandlerY:Xf,wrapWithFireEvent:ri,wrapWithFixedAnchor:si});const zs=a=>a.webgl!==void 0,za="precision highp float",M1=`
    `.concat(za,`;
    varying vec2 vTexCoord;
    uniform sampler2D uTexture;
    void main() {
      gl_FragColor = texture2D(uTexture, vTexCoord);
    }`),k1=`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    void main() {
      vTexCoord = aPosition;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }`,L1=["type"];class $t{get type(){return this.constructor.type}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Da({},(Fx(t),t));D(this,"vertexSource",k1),Object.assign(this,this.constructor.defaults,e)}getFragmentSource(){return M1}createProgram(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getFragmentSource(),n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.vertexSource;const{WebGLProbe:{GLPrecision:r="highp"}}=Qe();r!=="highp"&&(e=e.replace(new RegExp(za,"g"),za.replace("highp",r)));const o=t.createShader(t.VERTEX_SHADER),l=t.createShader(t.FRAGMENT_SHADER),c=t.createProgram();if(!o||!l||!c)throw new Error("Vertex, fragment shader or program creation error");if(t.shaderSource(o,n),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS))throw new Error("Vertex shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(o)));if(t.shaderSource(l,e),t.compileShader(l),!t.getShaderParameter(l,t.COMPILE_STATUS))throw new Error("Fragment shader compile error for ".concat(this.type,": ").concat(t.getShaderInfoLog(l)));if(t.attachShader(c,o),t.attachShader(c,l),t.linkProgram(c),!t.getProgramParameter(c,t.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+t.getProgramInfoLog(c));const u=this.getUniformLocations(t,c)||{};return u.uStepW=t.getUniformLocation(c,"uStepW"),u.uStepH=t.getUniformLocation(c,"uStepH"),{program:c,attributeLocations:this.getAttributeLocations(t,c),uniformLocations:u}}getAttributeLocations(t,e){return{aPosition:t.getAttribLocation(e,"aPosition")}}getUniformLocations(t,e){return{}}sendAttributeData(t,e,n){const r=e.aPosition,o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,2,t.FLOAT,!1,0,0),t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)}_setupFrameBuffer(t){const e=t.context;if(t.passes>1){const n=t.destinationWidth,r=t.destinationHeight;(t.sourceWidth!==n||t.sourceHeight!==r)&&(e.deleteTexture(t.targetTexture),t.targetTexture=t.filterBackend.createTexture(e,n,r)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t.targetTexture,0)}else e.bindFramebuffer(e.FRAMEBUFFER,null),e.finish()}_swapTextures(t){t.passes--,t.pass++;const e=t.targetTexture;t.targetTexture=t.sourceTexture,t.sourceTexture=e}isNeutralState(t){const e=this.mainParameter,n=this.constructor.defaults[e];if(e){const r=this[e];return Array.isArray(n)&&Array.isArray(r)?n.every((o,l)=>o===r[l]):n===r}else return!1}applyTo(t){zs(t)?(this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){}getCacheKey(){return this.type}retrieveShader(t){const e=this.getCacheKey();return t.programCache[e]||(t.programCache[e]=this.createProgram(t.context)),t.programCache[e]}applyToWebGL(t){const e=t.context,n=this.retrieveShader(t);t.pass===0&&t.originalTexture?e.bindTexture(e.TEXTURE_2D,t.originalTexture):e.bindTexture(e.TEXTURE_2D,t.sourceTexture),e.useProgram(n.program),this.sendAttributeData(e,n.attributeLocations,t.aPosition),e.uniform1f(n.uniformLocations.uStepW,1/t.sourceWidth),e.uniform1f(n.uniformLocations.uStepH,1/t.sourceHeight),this.sendUniformData(e,n.uniformLocations),e.viewport(0,0,t.destinationWidth,t.destinationHeight),e.drawArrays(e.TRIANGLE_STRIP,0,4)}bindAdditionalTexture(t,e,n){t.activeTexture(n),t.bindTexture(t.TEXTURE_2D,e),t.activeTexture(t.TEXTURE0)}unbindAdditionalTexture(t,e){t.activeTexture(e),t.bindTexture(t.TEXTURE_2D,null),t.activeTexture(t.TEXTURE0)}getMainParameter(){return this.mainParameter?this[this.mainParameter]:void 0}setMainParameter(t){this.mainParameter&&(this[this.mainParameter]=t)}sendUniformData(t,e){}createHelpLayer(t){if(!t.helpLayer){const e=Wt();e.width=t.sourceWidth,e.height=t.sourceHeight,t.helpLayer=e}}toObject(){const t=this.mainParameter;return T({type:this.type},t?{[t]:this[t]}:{})}toJSON(){return this.toObject()}static async fromObject(t,e){let n=At(t,L1);return new this(n)}}D($t,"type","BaseFilter");const F1={multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,difference:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`
    if (uColor.r < 0.5) {
      gl_FragColor.r *= 2.0 * uColor.r;
    } else {
      gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
    }
    if (uColor.g < 0.5) {
      gl_FragColor.g *= 2.0 * uColor.g;
    } else {
      gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
    }
    if (uColor.b < 0.5) {
      gl_FragColor.b *= 2.0 * uColor.b;
    } else {
      gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
    }
    `,tint:`
    gl_FragColor.rgb *= (1.0 - uColor.a);
    gl_FragColor.rgb += uColor.rgb;
    `},R1={color:"#F95C63",mode:"multiply",alpha:1};class _l extends $t{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return`
      precision highp float;
      uniform sampler2D uTexture;
      uniform vec4 uColor;
      varying vec2 vTexCoord;
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        gl_FragColor = color;
        if (color.a > 0.0) {
          `.concat(F1[this.mode],`
        }
      }
      `)}applyTo2d(t){let{imageData:{data:e}}=t;const n=new wt(this.color).getSource(),r=n[0]*this.alpha,o=n[1]*this.alpha,l=n[2]*this.alpha,c=1-this.alpha;for(let u=0;u<e.length;u+=4){const d=e[u],g=e[u+1],_=e[u+2];switch(this.mode){case"multiply":e[u]=d*r/255,e[u+1]=g*o/255,e[u+2]=_*l/255;break;case"screen":e[u]=255-(255-d)*(255-r)/255,e[u+1]=255-(255-g)*(255-o)/255,e[u+2]=255-(255-_)*(255-l)/255;break;case"add":e[u]=d+r,e[u+1]=g+o,e[u+2]=_+l;break;case"difference":e[u]=Math.abs(d-r),e[u+1]=Math.abs(g-o),e[u+2]=Math.abs(_-l);break;case"subtract":e[u]=d-r,e[u+1]=g-o,e[u+2]=_-l;break;case"darken":e[u]=Math.min(d,r),e[u+1]=Math.min(g,o),e[u+2]=Math.min(_,l);break;case"lighten":e[u]=Math.max(d,r),e[u+1]=Math.max(g,o),e[u+2]=Math.max(_,l);break;case"overlay":e[u]=r<128?2*d*r/255:255-2*(255-d)*(255-r)/255,e[u+1]=o<128?2*g*o/255:255-2*(255-g)*(255-o)/255,e[u+2]=l<128?2*_*l/255:255-2*(255-_)*(255-l)/255;break;case"exclusion":e[u]=r+d-2*r*d/255,e[u+1]=o+g-2*o*g/255,e[u+2]=l+_-2*l*_/255;break;case"tint":e[u]=r+d*c,e[u+1]=o+g*c,e[u+2]=l+_*c}}}getUniformLocations(t,e){return{uColor:t.getUniformLocation(e,"uColor")}}sendUniformData(t,e){const n=new wt(this.color).getSource();n[0]=this.alpha*n[0]/255,n[1]=this.alpha*n[1]/255,n[2]=this.alpha*n[2]/255,n[3]=this.alpha,t.uniform4fv(e.uColor,n)}toObject(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}D(_l,"defaults",R1);D(_l,"type","BlendColor");q.setClass(_l);const I1={multiply:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.rgba *= color2.rgba;
      gl_FragColor = color;
    }
    `,mask:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform sampler2D uImage;
    uniform vec4 uColor;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      vec4 color2 = texture2D(uImage, vTexCoord2);
      color.a = color2.a;
      gl_FragColor = color;
    }
    `},B1=["type","image"],W1={mode:"multiply",alpha:1,vertexSource:`
    attribute vec2 aPosition;
    varying vec2 vTexCoord;
    varying vec2 vTexCoord2;
    uniform mat3 uTransformMatrix;
    void main() {
      vTexCoord = aPosition;
      vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
      gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
    }
    `};class vl extends $t{getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return I1[this.mode]}applyToWebGL(t){const e=t.context,n=this.createTexture(t.filterBackend,this.image);this.bindAdditionalTexture(e,n,e.TEXTURE1),super.applyToWebGL(t),this.unbindAdditionalTexture(e,e.TEXTURE1)}createTexture(t,e){return t.getCachedTexture(e.cacheKey,e.getElement())}calculateMatrix(){const t=this.image,{width:e,height:n}=t.getElement();return[1/t.scaleX,0,0,0,1/t.scaleY,0,-t.left/e,-t.top/n,1]}applyTo2d(t){let{imageData:{data:e,width:n,height:r},filterBackend:{resources:o}}=t;const l=this.image;o.blendImage||(o.blendImage=Wt());const c=o.blendImage,u=c.getContext("2d");c.width!==n||c.height!==r?(c.width=n,c.height=r):u.clearRect(0,0,n,r),u.setTransform(l.scaleX,0,0,l.scaleY,l.left,l.top),u.drawImage(l.getElement(),0,0,n,r);const d=u.getImageData(0,0,n,r).data;for(let g=0;g<e.length;g+=4){const _=e[g],y=e[g+1],x=e[g+2],S=e[g+3],E=d[g],P=d[g+1],L=d[g+2],W=d[g+3];switch(this.mode){case"multiply":e[g]=_*E/255,e[g+1]=y*P/255,e[g+2]=x*L/255,e[g+3]=S*W/255;break;case"mask":e[g+3]=W;break}}}getUniformLocations(t,e){return{uTransformMatrix:t.getUniformLocation(e,"uTransformMatrix"),uImage:t.getUniformLocation(e,"uImage")}}sendUniformData(t,e){const n=this.calculateMatrix();t.uniform1i(e.uImage,1),t.uniformMatrix3fv(e.uTransformMatrix,!1,n)}toObject(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}static fromObject(t,e){let{type:n,image:r}=t,o=At(t,B1);return Ie.fromObject(r,e).then(l=>new this(T(T({},o),{},{image:l})))}}D(vl,"type","BlendImage");D(vl,"defaults",W1);q.setClass(vl);const j1=`
    precision highp float;
    uniform sampler2D uTexture;
    uniform vec2 uDelta;
    varying vec2 vTexCoord;
    const float nSamples = 15.0;
    vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
    float random(vec3 scale) {
      /* use the fragment position for a different seed per-pixel */
      return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
    }
    void main() {
      vec4 color = vec4(0.0);
      float total = 0.0;
      float offset = random(v3offset);
      for (float t = -nSamples; t <= nSamples; t++) {
        float percent = (t + offset - 0.5) / nSamples;
        float weight = 1.0 - abs(percent);
        color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
        total += weight;
      }
      gl_FragColor = color / total;
    }
  `,X1={blur:0,mainParameter:"blur"};class yl extends $t{getFragmentSource(){return j1}applyTo(t){zs(t)?(this.aspectRatio=t.sourceWidth/t.sourceHeight,t.passes++,this._setupFrameBuffer(t),this.horizontal=!0,this.applyToWebGL(t),this._swapTextures(t),this._setupFrameBuffer(t),this.horizontal=!1,this.applyToWebGL(t),this._swapTextures(t)):this.applyTo2d(t)}applyTo2d(t){t.imageData=this.simpleBlur(t)}simpleBlur(t){let{ctx:e,imageData:n,filterBackend:{resources:r}}=t;const{width:o,height:l}=n;r.blurLayer1||(r.blurLayer1=Wt(),r.blurLayer2=Wt());const c=r.blurLayer1,u=r.blurLayer2;(c.width!==o||c.height!==l)&&(u.width=c.width=o,u.height=c.height=l);const d=c.getContext("2d"),g=u.getContext("2d"),_=15,y=this.blur*.06*.5;let x,S,E,P;for(d.putImageData(n,0,0),g.clearRect(0,0,o,l),P=-_;P<=_;P++)x=(Math.random()-.5)/4,S=P/_,E=y*S*o+x,g.globalAlpha=1-Math.abs(S),g.drawImage(c,E,x),d.drawImage(u,0,0),g.globalAlpha=1,g.clearRect(0,0,u.width,u.height);for(P=-_;P<=_;P++)x=(Math.random()-.5)/4,S=P/_,E=y*S*l+x,g.globalAlpha=1-Math.abs(S),g.drawImage(c,x,E),d.drawImage(u,0,0),g.globalAlpha=1,g.clearRect(0,0,u.width,u.height);e.drawImage(c,0,0);const L=e.getImageData(0,0,c.width,c.height);return d.globalAlpha=1,d.clearRect(0,0,c.width,c.height),L}getUniformLocations(t,e){return{delta:t.getUniformLocation(e,"uDelta")}}sendUniformData(t,e){const n=this.chooseRightDelta();t.uniform2fv(e.delta,n)}chooseRightDelta(){let t=1;const e=[0,0];this.horizontal?this.aspectRatio>1&&(t=1/this.aspectRatio):this.aspectRatio<1&&(t=this.aspectRatio);const n=t*this.blur*.12;return this.horizontal?e[0]=n:e[1]=n,e}}D(yl,"type","Blur");D(yl,"defaults",X1);q.setClass(yl);const Y1=`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBrightness;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += uBrightness;
    gl_FragColor = color;
  }
`,H1={brightness:0,mainParameter:"brightness"};class xl extends $t{getFragmentSource(){return Y1}applyTo2d(t){let{imageData:{data:e}}=t;if(this.brightness===0)return;const n=Math.round(this.brightness*255);for(let r=0;r<e.length;r+=4)e[r]=e[r]+n,e[r+1]=e[r+1]+n,e[r+2]=e[r+2]+n}getUniformLocations(t,e){return{uBrightness:t.getUniformLocation(e,"uBrightness")}}sendUniformData(t,e){t.uniform1f(e.uBrightness,this.brightness)}}D(xl,"type","Brightness");D(xl,"defaults",H1);q.setClass(xl);const z1=`
  precision highp float;
  uniform sampler2D uTexture;
  varying vec2 vTexCoord;
  uniform mat4 uColorMatrix;
  uniform vec4 uConstants;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color *= uColorMatrix;
    color += uConstants;
    gl_FragColor = color;
  }`,G1=["matrix"],Od={matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0};class wr extends $t{setOptions(t){let{matrix:e}=t,n=At(t,G1);e&&(this.matrix=[...e]),Object.assign(this,n)}getFragmentSource(){return z1}applyTo2d(t){const e=t.imageData,n=e.data,r=this.matrix,o=this.colorsOnly;for(let l=0;l<n.length;l+=4){const c=n[l],u=n[l+1],d=n[l+2];if(o)n[l]=c*r[0]+u*r[1]+d*r[2]+r[4]*255,n[l+1]=c*r[5]+u*r[6]+d*r[7]+r[9]*255,n[l+2]=c*r[10]+u*r[11]+d*r[12]+r[14]*255;else{const g=n[l+3];n[l]=c*r[0]+u*r[1]+d*r[2]+g*r[3]+r[4]*255,n[l+1]=c*r[5]+u*r[6]+d*r[7]+g*r[8]+r[9]*255,n[l+2]=c*r[10]+u*r[11]+d*r[12]+g*r[13]+r[14]*255,n[l+3]=c*r[15]+u*r[16]+d*r[17]+g*r[18]+r[19]*255}}}getUniformLocations(t,e){return{uColorMatrix:t.getUniformLocation(e,"uColorMatrix"),uConstants:t.getUniformLocation(e,"uConstants")}}sendUniformData(t,e){const n=this.matrix,r=[n[0],n[1],n[2],n[3],n[5],n[6],n[7],n[8],n[10],n[11],n[12],n[13],n[15],n[16],n[17],n[18]],o=[n[4],n[9],n[14],n[19]];t.uniformMatrix4fv(e.uColorMatrix,!1,r),t.uniform4fv(e.uConstants,o)}}D(wr,"type","ColorMatrix");D(wr,"defaults",Od);q.setClass(wr);function oi(a,t){var e;const n=(e=class extends wr{get type(){return a}},D(e,"type",a),D(e,"defaults",T(T({},Od),{},{mainParameter:void 0,matrix:t})),e);return q.setClass(n,a),n}oi("Brownie",[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0]);oi("Vintage",[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0]);oi("Kodachrome",[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0]);oi("Technicolor",[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0]);oi("Polaroid",[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0]);oi("Sepia",[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0]);oi("BlackWhite",[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]);const U1=["subFilters"];class Dd extends $t{constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{subFilters:e=[]}=t,n=At(t,U1);super(n),this.subFilters=e}applyTo(t){zs(t)&&(t.passes+=this.subFilters.length-1),this.subFilters.forEach(e=>{e.applyTo(t)})}toObject(){return T(T({},super.toObject()),{},{subFilters:this.subFilters.map(t=>t.toObject())})}isNeutralState(){return!this.subFilters.some(t=>!t.isNeutralState())}static fromObject(t,e){return Promise.all((t.subFilters||[]).map(n=>q.getClass(n.type).fromObject(n,e))).then(n=>new this({subFilters:n}))}}D(Dd,"type","Composed");q.setClass(Dd);const V1=`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uContrast;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
    color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
    gl_FragColor = color;
  }`,N1={contrast:0,mainParameter:"contrast"};class Cl extends $t{getFragmentSource(){return V1}applyTo2d(t){let{imageData:{data:e}}=t;if(this.contrast===0)return;const n=Math.floor(this.contrast*255),r=259*(n+255)/(255*(259-n));for(let o=0;o<e.length;o+=4)e[o]=r*(e[o]-128)+128,e[o+1]=r*(e[o+1]-128)+128,e[o+2]=r*(e[o+2]-128)+128}getUniformLocations(t,e){return{uContrast:t.getUniformLocation(e,"uContrast")}}sendUniformData(t,e){t.uniform1f(e.uContrast,this.contrast)}}D(Cl,"type","Contrast");D(Cl,"defaults",N1);q.setClass(Cl);const K1={Convolute_3_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_3_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[9];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 3.0; h+=1.0) {
        for (float w = 0.0; w < 3.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_5_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_5_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[25];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 5.0; h+=1.0) {
        for (float w = 0.0; w < 5.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_7_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_7_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[49];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 7.0; h+=1.0) {
        for (float w = 0.0; w < 7.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `,Convolute_9_1:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 0);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
        }
      }
      gl_FragColor = color;
    }
    `,Convolute_9_0:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform float uMatrix[81];
    uniform float uStepW;
    uniform float uStepH;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = vec4(0, 0, 0, 1);
      for (float h = 0.0; h < 9.0; h+=1.0) {
        for (float w = 0.0; w < 9.0; w+=1.0) {
          vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
          color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
        }
      }
      float alpha = texture2D(uTexture, vTexCoord).a;
      gl_FragColor = color;
      gl_FragColor.a = alpha;
    }
    `},q1={opaque:!1,matrix:[0,0,0,0,1,0,0,0,0]};class wl extends $t{getCacheKey(){return"".concat(this.type,"_").concat(Math.sqrt(this.matrix.length),"_").concat(this.opaque?1:0)}getFragmentSource(){return K1[this.getCacheKey()]}applyTo2d(t){const e=t.imageData,n=e.data,r=this.matrix,o=Math.round(Math.sqrt(r.length)),l=Math.floor(o/2),c=e.width,u=e.height,d=t.ctx.createImageData(c,u),g=d.data,_=this.opaque?1:0;let y,x,S,E,P,L,W,Y,H,z,U,A,R;for(U=0;U<u;U++)for(z=0;z<c;z++){for(P=(U*c+z)*4,y=0,x=0,S=0,E=0,R=0;R<o;R++)for(A=0;A<o;A++)W=U+R-l,L=z+A-l,!(W<0||W>=u||L<0||L>=c)&&(Y=(W*c+L)*4,H=r[R*o+A],y+=n[Y]*H,x+=n[Y+1]*H,S+=n[Y+2]*H,_||(E+=n[Y+3]*H));g[P]=y,g[P+1]=x,g[P+2]=S,_?g[P+3]=n[P+3]:g[P+3]=E}t.imageData=d}getUniformLocations(t,e){return{uMatrix:t.getUniformLocation(e,"uMatrix"),uOpaque:t.getUniformLocation(e,"uOpaque"),uHalfSize:t.getUniformLocation(e,"uHalfSize"),uSize:t.getUniformLocation(e,"uSize")}}sendUniformData(t,e){t.uniform1fv(e.uMatrix,this.matrix)}toObject(){return T(T({},super.toObject()),{},{opaque:this.opaque,matrix:[...this.matrix]})}}D(wl,"type","Convolute");D(wl,"defaults",q1);q.setClass(wl);const $1=`
  precision highp float;
  uniform sampler2D uTexture;
  uniform vec3 uGamma;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    vec3 correction = (1.0 / uGamma);
    color.r = pow(color.r, correction.r);
    color.g = pow(color.g, correction.g);
    color.b = pow(color.b, correction.b);
    gl_FragColor = color;
    gl_FragColor.rgb *= color.a;
  }
`,J1=["gamma"],Z1={mainParameter:"gamma",gamma:[1,1,1]};class Sl extends $t{getFragmentSource(){return $1}constructor(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{gamma:e=[1,1,1]}=t,n=At(t,J1);super(n),this.gamma=e}applyTo2d(t){let{imageData:{data:e}}=t;const n=this.gamma,r=1/n[0],o=1/n[1],l=1/n[2];this.rgbValues||(this.rgbValues={r:new Uint8Array(256),g:new Uint8Array(256),b:new Uint8Array(256)});const c=this.rgbValues;for(let u=0;u<256;u++)c.r[u]=Math.pow(u/255,r)*255,c.g[u]=Math.pow(u/255,o)*255,c.b[u]=Math.pow(u/255,l)*255;for(let u=0;u<e.length;u+=4)e[u]=c.r[e[u]],e[u+1]=c.g[e[u+1]],e[u+2]=c.b[e[u+2]]}getUniformLocations(t,e){return{uGamma:t.getUniformLocation(e,"uGamma")}}sendUniformData(t,e){t.uniform3fv(e.uGamma,this.gamma)}}D(Sl,"type","Gamma");D(Sl,"defaults",Z1);q.setClass(Sl);const Q1={average:`
    precision highp float;
    uniform sampler2D uTexture;
    varying vec2 vTexCoord;
    void main() {
      vec4 color = texture2D(uTexture, vTexCoord);
      float average = (color.r + color.b + color.g) / 3.0;
      gl_FragColor = vec4(average, average, average, color.a);
    }
    `,lightness:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `,luminosity:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform int uMode;
    varying vec2 vTexCoord;
    void main() {
      vec4 col = texture2D(uTexture, vTexCoord);
      float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
      gl_FragColor = vec4(average, average, average, col.a);
    }
    `},tb={mode:"average",mainParameter:"mode"};class bl extends $t{applyTo2d(t){let{imageData:{data:e}}=t;for(let n=0,r;n<e.length;n+=4){switch(this.mode){case"average":r=(e[n]+e[n+1]+e[n+2])/3;break;case"lightness":r=(Math.min(e[n],e[n+1],e[n+2])+Math.max(e[n],e[n+1],e[n+2]))/2;break;case"luminosity":r=.21*e[n]+.72*e[n+1]+.07*e[n+2];break}e[n]=r,e[n+1]=r,e[n+2]=r}}getCacheKey(){return"".concat(this.type,"_").concat(this.mode)}getFragmentSource(){return Q1[this.mode]}getUniformLocations(t,e){return{uMode:t.getUniformLocation(e,"uMode")}}sendUniformData(t,e){t.uniform1i(e.uMode,1)}isNeutralState(){return!1}}D(bl,"type","Grayscale");D(bl,"defaults",tb);q.setClass(bl);const eb={rotation:0,mainParameter:"rotation"};class Tl extends wr{calculateMatrix(){const t=this.rotation*Math.PI,e=ae(t),n=le(t),r=1/3,o=Math.sqrt(r)*n,l=1-e;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=e+l/3,this.matrix[1]=r*l-o,this.matrix[2]=r*l+o,this.matrix[5]=r*l+o,this.matrix[6]=e+r*l,this.matrix[7]=r*l-o,this.matrix[10]=r*l-o,this.matrix[11]=r*l+o,this.matrix[12]=e+r*l}isNeutralState(){return this.calculateMatrix(),super.isNeutralState()}applyTo(t){this.calculateMatrix(),super.applyTo(t)}}D(Tl,"type","HueRotation");D(Tl,"defaults",eb);q.setClass(Tl);const nb=`
  precision highp float;
  uniform sampler2D uTexture;
  uniform int uInvert;
  uniform int uAlpha;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    if (uInvert == 1) {
      if (uAlpha == 1) {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,1.0 -color.a);
      } else {
        gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
      }
    } else {
      gl_FragColor = color;
    }
  }
`,ib={alpha:!1,invert:!0,mainParameter:"invert"};class Ol extends $t{applyTo2d(t){let{imageData:{data:e}}=t;for(let n=0;n<e.length;n+=4)e[n]=255-e[n],e[n+1]=255-e[n+1],e[n+2]=255-e[n+2],this.alpha&&(e[n+3]=255-e[n+3])}getFragmentSource(){return nb}isNeutralState(){return!this.invert}getUniformLocations(t,e){return{uInvert:t.getUniformLocation(e,"uInvert"),uAlpha:t.getUniformLocation(e,"uAlpha")}}sendUniformData(t,e){t.uniform1i(e.uInvert,Number(this.invert)),t.uniform1i(e.uAlpha,Number(this.alpha))}}D(Ol,"type","Invert");D(Ol,"defaults",ib);q.setClass(Ol);const rb=`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uStepH;
  uniform float uNoise;
  uniform float uSeed;
  varying vec2 vTexCoord;
  float rand(vec2 co, float seed, float vScale) {
    return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
  }
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
    gl_FragColor = color;
  }
`,sb={mainParameter:"noise",noise:0};class Dl extends $t{getFragmentSource(){return rb}applyTo2d(t){let{imageData:{data:e}}=t;if(this.noise===0)return;const n=this.noise;for(let r=0;r<e.length;r+=4){const o=(.5-Math.random())*n;e[r]+=o,e[r+1]+=o,e[r+2]+=o}}getUniformLocations(t,e){return{uNoise:t.getUniformLocation(e,"uNoise"),uSeed:t.getUniformLocation(e,"uSeed")}}sendUniformData(t,e){t.uniform1f(e.uNoise,this.noise/255),t.uniform1f(e.uSeed,Math.random())}toObject(){return T(T({},super.toObject()),{},{noise:this.noise})}}D(Dl,"type","Noise");D(Dl,"defaults",sb);q.setClass(Dl);const ob=`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uBlocksize;
  uniform float uStepW;
  uniform float uStepH;
  varying vec2 vTexCoord;
  void main() {
    float blockW = uBlocksize * uStepW;
    float blockH = uBlocksize * uStepW;
    int posX = int(vTexCoord.x / blockW);
    int posY = int(vTexCoord.y / blockH);
    float fposX = float(posX);
    float fposY = float(posY);
    vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
    vec4 color = texture2D(uTexture, squareCoords);
    gl_FragColor = color;
  }
`,ab={blocksize:4,mainParameter:"blocksize"};class El extends $t{applyTo2d(t){let{imageData:{data:e,width:n,height:r}}=t;for(let o=0;o<r;o+=this.blocksize)for(let l=0;l<n;l+=this.blocksize){const c=o*4*n+l*4,u=e[c],d=e[c+1],g=e[c+2],_=e[c+3];for(let y=o;y<Math.min(o+this.blocksize,r);y++)for(let x=l;x<Math.min(l+this.blocksize,n);x++){const S=y*4*n+x*4;e[S]=u,e[S+1]=d,e[S+2]=g,e[S+3]=_}}}isNeutralState(){return this.blocksize===1}getFragmentSource(){return ob}getUniformLocations(t,e){return{uBlocksize:t.getUniformLocation(e,"uBlocksize"),uStepW:t.getUniformLocation(e,"uStepW"),uStepH:t.getUniformLocation(e,"uStepH")}}sendUniformData(t,e){t.uniform1f(e.uBlocksize,this.blocksize)}}D(El,"type","Pixelate");D(El,"defaults",ab);q.setClass(El);const lb=`
precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
  gl_FragColor = texture2D(uTexture, vTexCoord);
  if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
    gl_FragColor.a = 0.0;
  }
}
`,hb={color:"#FFFFFF",distance:.02,useAlpha:!1};class Pl extends $t{getFragmentShader(){return lb}applyTo2d(t){let{imageData:{data:e}}=t;const n=this.distance*255,r=new wt(this.color).getSource(),o=[r[0]-n,r[1]-n,r[2]-n],l=[r[0]+n,r[1]+n,r[2]+n];for(let c=0;c<e.length;c+=4){const u=e[c],d=e[c+1],g=e[c+2];u>o[0]&&d>o[1]&&g>o[2]&&u<l[0]&&d<l[1]&&g<l[2]&&(e[c+3]=0)}}getUniformLocations(t,e){return{uLow:t.getUniformLocation(e,"uLow"),uHigh:t.getUniformLocation(e,"uHigh")}}sendUniformData(t,e){const n=new wt(this.color).getSource(),r=this.distance,o=[0+n[0]/255-r,0+n[1]/255-r,0+n[2]/255-r,1],l=[n[0]/255+r,n[1]/255+r,n[2]/255+r,1];t.uniform4fv(e.uLow,o),t.uniform4fv(e.uHigh,l)}toObject(){return T(T({},super.toObject()),{},{color:this.color,distance:this.distance})}}D(Pl,"type","RemoveColor");D(Pl,"defaults",hb);q.setClass(Pl);const cb={resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,fragmentSourceTOP:`
    precision highp float;
    uniform sampler2D uTexture;
    uniform vec2 uDelta;
    varying vec2 vTexCoord;
  `};class Al extends $t{getUniformLocations(t,e){return{uDelta:t.getUniformLocation(e,"uDelta"),uTaps:t.getUniformLocation(e,"uTaps")}}sendUniformData(t,e){t.uniform2fv(e.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),t.uniform1fv(e.uTaps,this.taps)}getFilterWindow(){const t=this.tempScale;return Math.ceil(this.lanczosLobes/t)}getCacheKey(){const t=this.getFilterWindow();return"".concat(this.type,"_").concat(t)}getFragmentSource(){const t=this.getFilterWindow();return this.generateShader(t)}getTaps(){const t=this.lanczosCreate(this.lanczosLobes),e=this.tempScale,n=this.getFilterWindow(),r=new Array(n);for(let o=1;o<=n;o++)r[o-1]=t(o*e);return r}generateShader(t){const e=new Array(t);for(let n=1;n<=t;n++)e[n-1]="".concat(n,".0 * uDelta");return`
      `.concat(this.fragmentSourceTOP,`
      uniform float uTaps[`).concat(t,`];
      void main() {
        vec4 color = texture2D(uTexture, vTexCoord);
        float sum = 1.0;
        `).concat(e.map((n,r)=>`
              color += texture2D(uTexture, vTexCoord + `.concat(n,") * uTaps[").concat(r,"] + texture2D(uTexture, vTexCoord - ").concat(n,") * uTaps[").concat(r,`];
              sum += 2.0 * uTaps[`).concat(r,`];
            `)).join(`
`),`
        gl_FragColor = color / sum;
      }
    `)}applyTo(t){zs(t)?(t.passes++,this.width=t.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=t.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),t.destinationWidth=this.dW,this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t),t.sourceWidth=t.destinationWidth,this.height=t.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),t.destinationHeight=this.dH,this._setupFrameBuffer(t),this.applyToWebGL(t),this._swapTextures(t),t.sourceHeight=t.destinationHeight):this.applyTo2d(t)}isNeutralState(){return this.scaleX===1&&this.scaleY===1}lanczosCreate(t){return e=>{if(e>=t||e<=-t)return 0;if(e<11920929e-14&&e>-11920929e-14)return 1;e*=Math.PI;const n=e/t;return Math.sin(e)/e*Math.sin(n)/n}}applyTo2d(t){const e=t.imageData,n=this.scaleX,r=this.scaleY;this.rcpScaleX=1/n,this.rcpScaleY=1/r;const o=e.width,l=e.height,c=Math.round(o*n),u=Math.round(l*r);let d;this.resizeType==="sliceHack"?d=this.sliceByTwo(t,o,l,c,u):this.resizeType==="hermite"?d=this.hermiteFastResize(t,o,l,c,u):this.resizeType==="bilinear"?d=this.bilinearFiltering(t,o,l,c,u):this.resizeType==="lanczos"&&(d=this.lanczosResize(t,o,l,c,u)),t.imageData=d}sliceByTwo(t,e,n,r,o){const l=t.imageData,c=.5;let u=!1,d=!1,g=e*c,_=n*c;const y=t.filterBackend.resources;let x=0,S=0;const E=e;let P=0;y.sliceByTwo||(y.sliceByTwo=Wt());const L=y.sliceByTwo;(L.width<e*1.5||L.height<n)&&(L.width=e*1.5,L.height=n);const W=L.getContext("2d");for(W.clearRect(0,0,e*1.5,n),W.putImageData(l,0,0),r=Math.floor(r),o=Math.floor(o);!u||!d;)e=g,n=_,r<Math.floor(g*c)?g=Math.floor(g*c):(g=r,u=!0),o<Math.floor(_*c)?_=Math.floor(_*c):(_=o,d=!0),W.drawImage(L,x,S,e,n,E,P,g,_),x=E,S=P,P+=_;return W.getImageData(x,S,r,o)}lanczosResize(t,e,n,r,o){function l(H){let z,U,A,R,N,tt,Dt,vt,Ft,yt,Mt;for(W.x=(H+.5)*_,Y.x=Math.floor(W.x),z=0;z<o;z++){for(W.y=(z+.5)*y,Y.y=Math.floor(W.y),N=0,tt=0,Dt=0,vt=0,Ft=0,U=Y.x-E;U<=Y.x+E;U++)if(!(U<0||U>=e)){yt=Math.floor(1e3*Math.abs(U-W.x)),L[yt]||(L[yt]={});for(let he=Y.y-P;he<=Y.y+P;he++)he<0||he>=n||(Mt=Math.floor(1e3*Math.abs(he-W.y)),L[yt][Mt]||(L[yt][Mt]=g(Math.sqrt(Math.pow(yt*x,2)+Math.pow(Mt*S,2))/1e3)),A=L[yt][Mt],A>0&&(R=(he*e+U)*4,N+=A,tt+=A*c[R],Dt+=A*c[R+1],vt+=A*c[R+2],Ft+=A*c[R+3]))}R=(z*r+H)*4,d[R]=tt/N,d[R+1]=Dt/N,d[R+2]=vt/N,d[R+3]=Ft/N}return++H<r?l(H):u}const c=t.imageData.data,u=t.ctx.createImageData(r,o),d=u.data,g=this.lanczosCreate(this.lanczosLobes),_=this.rcpScaleX,y=this.rcpScaleY,x=2/this.rcpScaleX,S=2/this.rcpScaleY,E=Math.ceil(_*this.lanczosLobes/2),P=Math.ceil(y*this.lanczosLobes/2),L={},W={},Y={};return l(0)}bilinearFiltering(t,e,n,r,o){let l,c,u,d,g,_,y,x,S,E,P,L,W=0,Y;const H=this.rcpScaleX,z=this.rcpScaleY,U=4*(e-1),R=t.imageData.data,N=t.ctx.createImageData(r,o),tt=N.data;for(y=0;y<o;y++)for(x=0;x<r;x++)for(g=Math.floor(H*x),_=Math.floor(z*y),S=H*x-g,E=z*y-_,Y=4*(_*e+g),P=0;P<4;P++)l=R[Y+P],c=R[Y+4+P],u=R[Y+U+P],d=R[Y+U+4+P],L=l*(1-S)*(1-E)+c*S*(1-E)+u*E*(1-S)+d*S*E,tt[W++]=L;return N}hermiteFastResize(t,e,n,r,o){const l=this.rcpScaleX,c=this.rcpScaleY,u=Math.ceil(l/2),d=Math.ceil(c/2),g=t.imageData,_=g.data,y=t.ctx.createImageData(r,o),x=y.data;for(let S=0;S<o;S++)for(let E=0;E<r;E++){const P=(E+S*r)*4;let L=0,W=0,Y=0,H=0,z=0,U=0,A=0;const R=(S+.5)*c;for(let N=Math.floor(S*c);N<(S+1)*c;N++){const tt=Math.abs(R-(N+.5))/d,Dt=(E+.5)*l,vt=tt*tt;for(let Ft=Math.floor(E*l);Ft<(E+1)*l;Ft++){let yt=Math.abs(Dt-(Ft+.5))/u;const Mt=Math.sqrt(vt+yt*yt);Mt>1&&Mt<-1||(L=2*Mt*Mt*Mt-3*Mt*Mt+1,L>0&&(yt=4*(Ft+N*e),A+=L*_[yt+3],Y+=L,_[yt+3]<255&&(L=L*_[yt+3]/250),H+=L*_[yt],z+=L*_[yt+1],U+=L*_[yt+2],W+=L))}}x[P]=H/W,x[P+1]=z/W,x[P+2]=U/W,x[P+3]=A/Y}return y}toObject(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}D(Al,"type","Resize");D(Al,"defaults",cb);q.setClass(Al);const ub=`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uSaturation;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float rgMax = max(color.r, color.g);
    float rgbMax = max(rgMax, color.b);
    color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
    color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
    color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
    gl_FragColor = color;
  }
`,fb={saturation:0,mainParameter:"saturation"};class Ml extends $t{getFragmentSource(){return ub}applyTo2d(t){let{imageData:{data:e}}=t;if(this.saturation===0)return;const n=-this.saturation;for(let r=0;r<e.length;r+=4){const o=Math.max(e[r],e[r+1],e[r+2]);e[r]+=o!==e[r]?(o-e[r])*n:0,e[r+1]+=o!==e[r+1]?(o-e[r+1])*n:0,e[r+2]+=o!==e[r+2]?(o-e[r+2])*n:0}}getUniformLocations(t,e){return{uSaturation:t.getUniformLocation(e,"uSaturation")}}sendUniformData(t,e){t.uniform1f(e.uSaturation,-this.saturation)}}D(Ml,"type","Saturation");D(Ml,"defaults",fb);q.setClass(Ml);const db=`
  precision highp float;
  uniform sampler2D uTexture;
  uniform float uVibrance;
  varying vec2 vTexCoord;
  void main() {
    vec4 color = texture2D(uTexture, vTexCoord);
    float max = max(color.r, max(color.g, color.b));
    float avg = (color.r + color.g + color.b) / 3.0;
    float amt = (abs(max - avg) * 2.0) * uVibrance;
    color.r += max != color.r ? (max - color.r) * amt : 0.00;
    color.g += max != color.g ? (max - color.g) * amt : 0.00;
    color.b += max != color.b ? (max - color.b) * amt : 0.00;
    gl_FragColor = color;
  }
`,gb={vibrance:0,mainParameter:"vibrance"};class kl extends $t{getFragmentSource(){return db}applyTo2d(t){let{imageData:{data:e}}=t;if(this.vibrance===0)return;const n=-this.vibrance;for(let r=0;r<e.length;r+=4){const o=Math.max(e[r],e[r+1],e[r+2]),l=(e[r]+e[r+1]+e[r+2])/3,c=Math.abs(o-l)*2/255*n;e[r]+=o!==e[r]?(o-e[r])*c:0,e[r+1]+=o!==e[r+1]?(o-e[r+1])*c:0,e[r+2]+=o!==e[r+2]?(o-e[r+2])*c:0}}getUniformLocations(t,e){return{uVibrance:t.getUniformLocation(e,"uVibrance")}}sendUniformData(t,e){t.uniform1f(e.uVibrance,-this.vibrance)}}D(kl,"type","Vibrance");D(kl,"defaults",gb);q.setClass(kl);var Ps={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Ps.exports;(function(a,t){(function(){var e,n="4.17.21",r=200,o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",c="Invalid `variable` option passed into `_.template`",u="__lodash_hash_undefined__",d=500,g="__lodash_placeholder__",_=1,y=2,x=4,S=1,E=2,P=1,L=2,W=4,Y=8,H=16,z=32,U=64,A=128,R=256,N=512,tt=30,Dt="...",vt=800,Ft=16,yt=1,Mt=2,he=3,ne=1/0,zt=9007199254740991,Gs=17976931348623157e292,Xn=0/0,$=4294967295,gt=$-1,St=$>>>1,ft=[["ary",A],["bind",P],["bindKey",L],["curry",Y],["curryRight",H],["flip",N],["partial",z],["partialRight",U],["rearg",R]],mt="[object Arguments]",ce="[object Array]",Ct="[object AsyncFunction]",Rt="[object Boolean]",Te="[object Date]",Ve="[object DOMException]",ai="[object Error]",li="[object Function]",Ll="[object GeneratorFunction]",Be="[object Map]",Fi="[object Number]",Pd="[object Null]",nn="[object Object]",Fl="[object Promise]",Ad="[object Proxy]",Ri="[object RegExp]",We="[object Set]",Ii="[object String]",Sr="[object Symbol]",Md="[object Undefined]",Bi="[object WeakMap]",kd="[object WeakSet]",Wi="[object ArrayBuffer]",hi="[object DataView]",Us="[object Float32Array]",Vs="[object Float64Array]",Ns="[object Int8Array]",Ks="[object Int16Array]",qs="[object Int32Array]",$s="[object Uint8Array]",Js="[object Uint8ClampedArray]",Zs="[object Uint16Array]",Qs="[object Uint32Array]",Ld=/\b__p \+= '';/g,Fd=/\b(__p \+=) '' \+/g,Rd=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Rl=/&(?:amp|lt|gt|quot|#39);/g,Il=/[&<>"']/g,Id=RegExp(Rl.source),Bd=RegExp(Il.source),Wd=/<%-([\s\S]+?)%>/g,jd=/<%([\s\S]+?)%>/g,Bl=/<%=([\s\S]+?)%>/g,Xd=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Yd=/^\w*$/,Hd=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,to=/[\\^$.*+?()[\]{}|]/g,zd=RegExp(to.source),eo=/^\s+/,Gd=/\s/,Ud=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Vd=/\{\n\/\* \[wrapped with (.+)\] \*/,Nd=/,? & /,Kd=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,qd=/[()=,{}\[\]\/\s]/,$d=/\\(\\)?/g,Jd=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Wl=/\w*$/,Zd=/^[-+]0x[0-9a-f]+$/i,Qd=/^0b[01]+$/i,tg=/^\[object .+?Constructor\]$/,eg=/^0o[0-7]+$/i,ng=/^(?:0|[1-9]\d*)$/,ig=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,br=/($^)/,rg=/['\n\r\u2028\u2029\\]/g,Tr="\\ud800-\\udfff",sg="\\u0300-\\u036f",og="\\ufe20-\\ufe2f",ag="\\u20d0-\\u20ff",jl=sg+og+ag,Xl="\\u2700-\\u27bf",Yl="a-z\\xdf-\\xf6\\xf8-\\xff",lg="\\xac\\xb1\\xd7\\xf7",hg="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",cg="\\u2000-\\u206f",ug=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Hl="A-Z\\xc0-\\xd6\\xd8-\\xde",zl="\\ufe0e\\ufe0f",Gl=lg+hg+cg+ug,no="[']",fg="["+Tr+"]",Ul="["+Gl+"]",Or="["+jl+"]",Vl="\\d+",dg="["+Xl+"]",Nl="["+Yl+"]",Kl="[^"+Tr+Gl+Vl+Xl+Yl+Hl+"]",io="\\ud83c[\\udffb-\\udfff]",gg="(?:"+Or+"|"+io+")",ql="[^"+Tr+"]",ro="(?:\\ud83c[\\udde6-\\uddff]){2}",so="[\\ud800-\\udbff][\\udc00-\\udfff]",ci="["+Hl+"]",$l="\\u200d",Jl="(?:"+Nl+"|"+Kl+")",pg="(?:"+ci+"|"+Kl+")",Zl="(?:"+no+"(?:d|ll|m|re|s|t|ve))?",Ql="(?:"+no+"(?:D|LL|M|RE|S|T|VE))?",th=gg+"?",eh="["+zl+"]?",mg="(?:"+$l+"(?:"+[ql,ro,so].join("|")+")"+eh+th+")*",_g="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",vg="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",nh=eh+th+mg,yg="(?:"+[dg,ro,so].join("|")+")"+nh,xg="(?:"+[ql+Or+"?",Or,ro,so,fg].join("|")+")",Cg=RegExp(no,"g"),wg=RegExp(Or,"g"),oo=RegExp(io+"(?="+io+")|"+xg+nh,"g"),Sg=RegExp([ci+"?"+Nl+"+"+Zl+"(?="+[Ul,ci,"$"].join("|")+")",pg+"+"+Ql+"(?="+[Ul,ci+Jl,"$"].join("|")+")",ci+"?"+Jl+"+"+Zl,ci+"+"+Ql,vg,_g,Vl,yg].join("|"),"g"),bg=RegExp("["+$l+Tr+jl+zl+"]"),Tg=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Og=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Dg=-1,Pt={};Pt[Us]=Pt[Vs]=Pt[Ns]=Pt[Ks]=Pt[qs]=Pt[$s]=Pt[Js]=Pt[Zs]=Pt[Qs]=!0,Pt[mt]=Pt[ce]=Pt[Wi]=Pt[Rt]=Pt[hi]=Pt[Te]=Pt[ai]=Pt[li]=Pt[Be]=Pt[Fi]=Pt[nn]=Pt[Ri]=Pt[We]=Pt[Ii]=Pt[Bi]=!1;var Et={};Et[mt]=Et[ce]=Et[Wi]=Et[hi]=Et[Rt]=Et[Te]=Et[Us]=Et[Vs]=Et[Ns]=Et[Ks]=Et[qs]=Et[Be]=Et[Fi]=Et[nn]=Et[Ri]=Et[We]=Et[Ii]=Et[Sr]=Et[$s]=Et[Js]=Et[Zs]=Et[Qs]=!0,Et[ai]=Et[li]=Et[Bi]=!1;var Eg={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},Pg={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Ag={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Mg={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},kg=parseFloat,Lg=parseInt,ih=typeof tr=="object"&&tr&&tr.Object===Object&&tr,Fg=typeof self=="object"&&self&&self.Object===Object&&self,Jt=ih||Fg||Function("return this")(),ao=t&&!t.nodeType&&t,Yn=ao&&!0&&a&&!a.nodeType&&a,rh=Yn&&Yn.exports===ao,lo=rh&&ih.process,Oe=function(){try{var b=Yn&&Yn.require&&Yn.require("util").types;return b||lo&&lo.binding&&lo.binding("util")}catch(F){}}(),sh=Oe&&Oe.isArrayBuffer,oh=Oe&&Oe.isDate,ah=Oe&&Oe.isMap,lh=Oe&&Oe.isRegExp,hh=Oe&&Oe.isSet,ch=Oe&&Oe.isTypedArray;function _e(b,F,k){switch(k.length){case 0:return b.call(F);case 1:return b.call(F,k[0]);case 2:return b.call(F,k[0],k[1]);case 3:return b.call(F,k[0],k[1],k[2])}return b.apply(F,k)}function Rg(b,F,k,V){for(var nt=-1,pt=b==null?0:b.length;++nt<pt;){var Gt=b[nt];F(V,Gt,k(Gt),b)}return V}function De(b,F){for(var k=-1,V=b==null?0:b.length;++k<V&&F(b[k],k,b)!==!1;);return b}function Ig(b,F){for(var k=b==null?0:b.length;k--&&F(b[k],k,b)!==!1;);return b}function uh(b,F){for(var k=-1,V=b==null?0:b.length;++k<V;)if(!F(b[k],k,b))return!1;return!0}function xn(b,F){for(var k=-1,V=b==null?0:b.length,nt=0,pt=[];++k<V;){var Gt=b[k];F(Gt,k,b)&&(pt[nt++]=Gt)}return pt}function Dr(b,F){var k=b==null?0:b.length;return!!k&&ui(b,F,0)>-1}function ho(b,F,k){for(var V=-1,nt=b==null?0:b.length;++V<nt;)if(k(F,b[V]))return!0;return!1}function kt(b,F){for(var k=-1,V=b==null?0:b.length,nt=Array(V);++k<V;)nt[k]=F(b[k],k,b);return nt}function Cn(b,F){for(var k=-1,V=F.length,nt=b.length;++k<V;)b[nt+k]=F[k];return b}function co(b,F,k,V){var nt=-1,pt=b==null?0:b.length;for(V&&pt&&(k=b[++nt]);++nt<pt;)k=F(k,b[nt],nt,b);return k}function Bg(b,F,k,V){var nt=b==null?0:b.length;for(V&&nt&&(k=b[--nt]);nt--;)k=F(k,b[nt],nt,b);return k}function uo(b,F){for(var k=-1,V=b==null?0:b.length;++k<V;)if(F(b[k],k,b))return!0;return!1}var Wg=fo("length");function jg(b){return b.split("")}function Xg(b){return b.match(Kd)||[]}function fh(b,F,k){var V;return k(b,function(nt,pt,Gt){if(F(nt,pt,Gt))return V=pt,!1}),V}function Er(b,F,k,V){for(var nt=b.length,pt=k+(V?1:-1);V?pt--:++pt<nt;)if(F(b[pt],pt,b))return pt;return-1}function ui(b,F,k){return F===F?Zg(b,F,k):Er(b,dh,k)}function Yg(b,F,k,V){for(var nt=k-1,pt=b.length;++nt<pt;)if(V(b[nt],F))return nt;return-1}function dh(b){return b!==b}function gh(b,F){var k=b==null?0:b.length;return k?po(b,F)/k:Xn}function fo(b){return function(F){return F==null?e:F[b]}}function go(b){return function(F){return b==null?e:b[F]}}function ph(b,F,k,V,nt){return nt(b,function(pt,Gt,bt){k=V?(V=!1,pt):F(k,pt,Gt,bt)}),k}function Hg(b,F){var k=b.length;for(b.sort(F);k--;)b[k]=b[k].value;return b}function po(b,F){for(var k,V=-1,nt=b.length;++V<nt;){var pt=F(b[V]);pt!==e&&(k=k===e?pt:k+pt)}return k}function mo(b,F){for(var k=-1,V=Array(b);++k<b;)V[k]=F(k);return V}function zg(b,F){return kt(F,function(k){return[k,b[k]]})}function mh(b){return b&&b.slice(0,xh(b)+1).replace(eo,"")}function ve(b){return function(F){return b(F)}}function _o(b,F){return kt(F,function(k){return b[k]})}function ji(b,F){return b.has(F)}function _h(b,F){for(var k=-1,V=b.length;++k<V&&ui(F,b[k],0)>-1;);return k}function vh(b,F){for(var k=b.length;k--&&ui(F,b[k],0)>-1;);return k}function Gg(b,F){for(var k=b.length,V=0;k--;)b[k]===F&&++V;return V}var Ug=go(Eg),Vg=go(Pg);function Ng(b){return"\\"+Mg[b]}function Kg(b,F){return b==null?e:b[F]}function fi(b){return bg.test(b)}function qg(b){return Tg.test(b)}function $g(b){for(var F,k=[];!(F=b.next()).done;)k.push(F.value);return k}function vo(b){var F=-1,k=Array(b.size);return b.forEach(function(V,nt){k[++F]=[nt,V]}),k}function yh(b,F){return function(k){return b(F(k))}}function wn(b,F){for(var k=-1,V=b.length,nt=0,pt=[];++k<V;){var Gt=b[k];(Gt===F||Gt===g)&&(b[k]=g,pt[nt++]=k)}return pt}function Pr(b){var F=-1,k=Array(b.size);return b.forEach(function(V){k[++F]=V}),k}function Jg(b){var F=-1,k=Array(b.size);return b.forEach(function(V){k[++F]=[V,V]}),k}function Zg(b,F,k){for(var V=k-1,nt=b.length;++V<nt;)if(b[V]===F)return V;return-1}function Qg(b,F,k){for(var V=k+1;V--;)if(b[V]===F)return V;return V}function di(b){return fi(b)?ep(b):Wg(b)}function je(b){return fi(b)?np(b):jg(b)}function xh(b){for(var F=b.length;F--&&Gd.test(b.charAt(F)););return F}var tp=go(Ag);function ep(b){for(var F=oo.lastIndex=0;oo.test(b);)++F;return F}function np(b){return b.match(oo)||[]}function ip(b){return b.match(Sg)||[]}var rp=function b(F){F=F==null?Jt:gi.defaults(Jt.Object(),F,gi.pick(Jt,Og));var k=F.Array,V=F.Date,nt=F.Error,pt=F.Function,Gt=F.Math,bt=F.Object,yo=F.RegExp,sp=F.String,Ee=F.TypeError,Ar=k.prototype,op=pt.prototype,pi=bt.prototype,Mr=F["__core-js_shared__"],kr=op.toString,xt=pi.hasOwnProperty,ap=0,Ch=function(){var i=/[^.]+$/.exec(Mr&&Mr.keys&&Mr.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}(),Lr=pi.toString,lp=kr.call(bt),hp=Jt._,cp=yo("^"+kr.call(xt).replace(to,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Fr=rh?F.Buffer:e,Sn=F.Symbol,Rr=F.Uint8Array,wh=Fr?Fr.allocUnsafe:e,Ir=yh(bt.getPrototypeOf,bt),Sh=bt.create,bh=pi.propertyIsEnumerable,Br=Ar.splice,Th=Sn?Sn.isConcatSpreadable:e,Xi=Sn?Sn.iterator:e,Hn=Sn?Sn.toStringTag:e,Wr=function(){try{var i=Nn(bt,"defineProperty");return i({},"",{}),i}catch(s){}}(),up=F.clearTimeout!==Jt.clearTimeout&&F.clearTimeout,fp=V&&V.now!==Jt.Date.now&&V.now,dp=F.setTimeout!==Jt.setTimeout&&F.setTimeout,jr=Gt.ceil,Xr=Gt.floor,xo=bt.getOwnPropertySymbols,gp=Fr?Fr.isBuffer:e,Oh=F.isFinite,pp=Ar.join,mp=yh(bt.keys,bt),Ut=Gt.max,Qt=Gt.min,_p=V.now,vp=F.parseInt,Dh=Gt.random,yp=Ar.reverse,Co=Nn(F,"DataView"),Yi=Nn(F,"Map"),wo=Nn(F,"Promise"),mi=Nn(F,"Set"),Hi=Nn(F,"WeakMap"),zi=Nn(bt,"create"),Yr=Hi&&new Hi,_i={},xp=Kn(Co),Cp=Kn(Yi),wp=Kn(wo),Sp=Kn(mi),bp=Kn(Hi),Hr=Sn?Sn.prototype:e,Gi=Hr?Hr.valueOf:e,Eh=Hr?Hr.toString:e;function m(i){if(It(i)&&!it(i)&&!(i instanceof ht)){if(i instanceof Pe)return i;if(xt.call(i,"__wrapped__"))return Pc(i)}return new Pe(i)}var vi=function(){function i(){}return function(s){if(!Lt(s))return{};if(Sh)return Sh(s);i.prototype=s;var h=new i;return i.prototype=e,h}}();function zr(){}function Pe(i,s){this.__wrapped__=i,this.__actions__=[],this.__chain__=!!s,this.__index__=0,this.__values__=e}m.templateSettings={escape:Wd,evaluate:jd,interpolate:Bl,variable:"",imports:{_:m}},m.prototype=zr.prototype,m.prototype.constructor=m,Pe.prototype=vi(zr.prototype),Pe.prototype.constructor=Pe;function ht(i){this.__wrapped__=i,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=$,this.__views__=[]}function Tp(){var i=new ht(this.__wrapped__);return i.__actions__=ue(this.__actions__),i.__dir__=this.__dir__,i.__filtered__=this.__filtered__,i.__iteratees__=ue(this.__iteratees__),i.__takeCount__=this.__takeCount__,i.__views__=ue(this.__views__),i}function Op(){if(this.__filtered__){var i=new ht(this);i.__dir__=-1,i.__filtered__=!0}else i=this.clone(),i.__dir__*=-1;return i}function Dp(){var i=this.__wrapped__.value(),s=this.__dir__,h=it(i),f=s<0,p=h?i.length:0,v=jm(0,p,this.__views__),C=v.start,w=v.end,O=w-C,I=f?w:C-1,B=this.__iteratees__,X=B.length,G=0,K=Qt(O,this.__takeCount__);if(!h||!f&&p==O&&K==O)return Zh(i,this.__actions__);var Z=[];t:for(;O--&&G<K;){I+=s;for(var st=-1,Q=i[I];++st<X;){var lt=B[st],ct=lt.iteratee,Ce=lt.type,se=ct(Q);if(Ce==Mt)Q=se;else if(!se){if(Ce==yt)continue t;break t}}Z[G++]=Q}return Z}ht.prototype=vi(zr.prototype),ht.prototype.constructor=ht;function zn(i){var s=-1,h=i==null?0:i.length;for(this.clear();++s<h;){var f=i[s];this.set(f[0],f[1])}}function Ep(){this.__data__=zi?zi(null):{},this.size=0}function Pp(i){var s=this.has(i)&&delete this.__data__[i];return this.size-=s?1:0,s}function Ap(i){var s=this.__data__;if(zi){var h=s[i];return h===u?e:h}return xt.call(s,i)?s[i]:e}function Mp(i){var s=this.__data__;return zi?s[i]!==e:xt.call(s,i)}function kp(i,s){var h=this.__data__;return this.size+=this.has(i)?0:1,h[i]=zi&&s===e?u:s,this}zn.prototype.clear=Ep,zn.prototype.delete=Pp,zn.prototype.get=Ap,zn.prototype.has=Mp,zn.prototype.set=kp;function rn(i){var s=-1,h=i==null?0:i.length;for(this.clear();++s<h;){var f=i[s];this.set(f[0],f[1])}}function Lp(){this.__data__=[],this.size=0}function Fp(i){var s=this.__data__,h=Gr(s,i);if(h<0)return!1;var f=s.length-1;return h==f?s.pop():Br.call(s,h,1),--this.size,!0}function Rp(i){var s=this.__data__,h=Gr(s,i);return h<0?e:s[h][1]}function Ip(i){return Gr(this.__data__,i)>-1}function Bp(i,s){var h=this.__data__,f=Gr(h,i);return f<0?(++this.size,h.push([i,s])):h[f][1]=s,this}rn.prototype.clear=Lp,rn.prototype.delete=Fp,rn.prototype.get=Rp,rn.prototype.has=Ip,rn.prototype.set=Bp;function sn(i){var s=-1,h=i==null?0:i.length;for(this.clear();++s<h;){var f=i[s];this.set(f[0],f[1])}}function Wp(){this.size=0,this.__data__={hash:new zn,map:new(Yi||rn),string:new zn}}function jp(i){var s=ns(this,i).delete(i);return this.size-=s?1:0,s}function Xp(i){return ns(this,i).get(i)}function Yp(i){return ns(this,i).has(i)}function Hp(i,s){var h=ns(this,i),f=h.size;return h.set(i,s),this.size+=h.size==f?0:1,this}sn.prototype.clear=Wp,sn.prototype.delete=jp,sn.prototype.get=Xp,sn.prototype.has=Yp,sn.prototype.set=Hp;function Gn(i){var s=-1,h=i==null?0:i.length;for(this.__data__=new sn;++s<h;)this.add(i[s])}function zp(i){return this.__data__.set(i,u),this}function Gp(i){return this.__data__.has(i)}Gn.prototype.add=Gn.prototype.push=zp,Gn.prototype.has=Gp;function Xe(i){var s=this.__data__=new rn(i);this.size=s.size}function Up(){this.__data__=new rn,this.size=0}function Vp(i){var s=this.__data__,h=s.delete(i);return this.size=s.size,h}function Np(i){return this.__data__.get(i)}function Kp(i){return this.__data__.has(i)}function qp(i,s){var h=this.__data__;if(h instanceof rn){var f=h.__data__;if(!Yi||f.length<r-1)return f.push([i,s]),this.size=++h.size,this;h=this.__data__=new sn(f)}return h.set(i,s),this.size=h.size,this}Xe.prototype.clear=Up,Xe.prototype.delete=Vp,Xe.prototype.get=Np,Xe.prototype.has=Kp,Xe.prototype.set=qp;function Ph(i,s){var h=it(i),f=!h&&qn(i),p=!h&&!f&&En(i),v=!h&&!f&&!p&&wi(i),C=h||f||p||v,w=C?mo(i.length,sp):[],O=w.length;for(var I in i)(s||xt.call(i,I))&&!(C&&(I=="length"||p&&(I=="offset"||I=="parent")||v&&(I=="buffer"||I=="byteLength"||I=="byteOffset")||hn(I,O)))&&w.push(I);return w}function Ah(i){var s=i.length;return s?i[Lo(0,s-1)]:e}function $p(i,s){return is(ue(i),Un(s,0,i.length))}function Jp(i){return is(ue(i))}function So(i,s,h){(h!==e&&!Ye(i[s],h)||h===e&&!(s in i))&&on(i,s,h)}function Ui(i,s,h){var f=i[s];(!(xt.call(i,s)&&Ye(f,h))||h===e&&!(s in i))&&on(i,s,h)}function Gr(i,s){for(var h=i.length;h--;)if(Ye(i[h][0],s))return h;return-1}function Zp(i,s,h,f){return bn(i,function(p,v,C){s(f,p,h(p),C)}),f}function Mh(i,s){return i&&Ke(s,Vt(s),i)}function Qp(i,s){return i&&Ke(s,de(s),i)}function on(i,s,h){s=="__proto__"&&Wr?Wr(i,s,{configurable:!0,enumerable:!0,value:h,writable:!0}):i[s]=h}function bo(i,s){for(var h=-1,f=s.length,p=k(f),v=i==null;++h<f;)p[h]=v?e:ra(i,s[h]);return p}function Un(i,s,h){return i===i&&(h!==e&&(i=i<=h?i:h),s!==e&&(i=i>=s?i:s)),i}function Ae(i,s,h,f,p,v){var C,w=s&_,O=s&y,I=s&x;if(h&&(C=p?h(i,f,p,v):h(i)),C!==e)return C;if(!Lt(i))return i;var B=it(i);if(B){if(C=Ym(i),!w)return ue(i,C)}else{var X=te(i),G=X==li||X==Ll;if(En(i))return ec(i,w);if(X==nn||X==mt||G&&!p){if(C=O||G?{}:xc(i),!w)return O?Am(i,Qp(C,i)):Pm(i,Mh(C,i))}else{if(!Et[X])return p?i:{};C=Hm(i,X,w)}}v||(v=new Xe);var K=v.get(i);if(K)return K;v.set(i,C),qc(i)?i.forEach(function(Q){C.add(Ae(Q,s,h,Q,i,v))}):Nc(i)&&i.forEach(function(Q,lt){C.set(lt,Ae(Q,s,h,lt,i,v))});var Z=I?O?Go:zo:O?de:Vt,st=B?e:Z(i);return De(st||i,function(Q,lt){st&&(lt=Q,Q=i[lt]),Ui(C,lt,Ae(Q,s,h,lt,i,v))}),C}function tm(i){var s=Vt(i);return function(h){return kh(h,i,s)}}function kh(i,s,h){var f=h.length;if(i==null)return!f;for(i=bt(i);f--;){var p=h[f],v=s[p],C=i[p];if(C===e&&!(p in i)||!v(C))return!1}return!0}function Lh(i,s,h){if(typeof i!="function")throw new Ee(l);return Zi(function(){i.apply(e,h)},s)}function Vi(i,s,h,f){var p=-1,v=Dr,C=!0,w=i.length,O=[],I=s.length;if(!w)return O;h&&(s=kt(s,ve(h))),f?(v=ho,C=!1):s.length>=r&&(v=ji,C=!1,s=new Gn(s));t:for(;++p<w;){var B=i[p],X=h==null?B:h(B);if(B=f||B!==0?B:0,C&&X===X){for(var G=I;G--;)if(s[G]===X)continue t;O.push(B)}else v(s,X,f)||O.push(B)}return O}var bn=oc(Ne),Fh=oc(Oo,!0);function em(i,s){var h=!0;return bn(i,function(f,p,v){return h=!!s(f,p,v),h}),h}function Ur(i,s,h){for(var f=-1,p=i.length;++f<p;){var v=i[f],C=s(v);if(C!=null&&(w===e?C===C&&!xe(C):h(C,w)))var w=C,O=v}return O}function nm(i,s,h,f){var p=i.length;for(h=rt(h),h<0&&(h=-h>p?0:p+h),f=f===e||f>p?p:rt(f),f<0&&(f+=p),f=h>f?0:Jc(f);h<f;)i[h++]=s;return i}function Rh(i,s){var h=[];return bn(i,function(f,p,v){s(f,p,v)&&h.push(f)}),h}function Zt(i,s,h,f,p){var v=-1,C=i.length;for(h||(h=Gm),p||(p=[]);++v<C;){var w=i[v];s>0&&h(w)?s>1?Zt(w,s-1,h,f,p):Cn(p,w):f||(p[p.length]=w)}return p}var To=ac(),Ih=ac(!0);function Ne(i,s){return i&&To(i,s,Vt)}function Oo(i,s){return i&&Ih(i,s,Vt)}function Vr(i,s){return xn(s,function(h){return cn(i[h])})}function Vn(i,s){s=On(s,i);for(var h=0,f=s.length;i!=null&&h<f;)i=i[qe(s[h++])];return h&&h==f?i:e}function Bh(i,s,h){var f=s(i);return it(i)?f:Cn(f,h(i))}function ie(i){return i==null?i===e?Md:Pd:Hn&&Hn in bt(i)?Wm(i):Jm(i)}function Do(i,s){return i>s}function im(i,s){return i!=null&&xt.call(i,s)}function rm(i,s){return i!=null&&s in bt(i)}function sm(i,s,h){return i>=Qt(s,h)&&i<Ut(s,h)}function Eo(i,s,h){for(var f=h?ho:Dr,p=i[0].length,v=i.length,C=v,w=k(v),O=1/0,I=[];C--;){var B=i[C];C&&s&&(B=kt(B,ve(s))),O=Qt(B.length,O),w[C]=!h&&(s||p>=120&&B.length>=120)?new Gn(C&&B):e}B=i[0];var X=-1,G=w[0];t:for(;++X<p&&I.length<O;){var K=B[X],Z=s?s(K):K;if(K=h||K!==0?K:0,!(G?ji(G,Z):f(I,Z,h))){for(C=v;--C;){var st=w[C];if(!(st?ji(st,Z):f(i[C],Z,h)))continue t}G&&G.push(Z),I.push(K)}}return I}function om(i,s,h,f){return Ne(i,function(p,v,C){s(f,h(p),v,C)}),f}function Ni(i,s,h){s=On(s,i),i=bc(i,s);var f=i==null?i:i[qe(ke(s))];return f==null?e:_e(f,i,h)}function Wh(i){return It(i)&&ie(i)==mt}function am(i){return It(i)&&ie(i)==Wi}function lm(i){return It(i)&&ie(i)==Te}function Ki(i,s,h,f,p){return i===s?!0:i==null||s==null||!It(i)&&!It(s)?i!==i&&s!==s:hm(i,s,h,f,Ki,p)}function hm(i,s,h,f,p,v){var C=it(i),w=it(s),O=C?ce:te(i),I=w?ce:te(s);O=O==mt?nn:O,I=I==mt?nn:I;var B=O==nn,X=I==nn,G=O==I;if(G&&En(i)){if(!En(s))return!1;C=!0,B=!1}if(G&&!B)return v||(v=new Xe),C||wi(i)?_c(i,s,h,f,p,v):Im(i,s,O,h,f,p,v);if(!(h&S)){var K=B&&xt.call(i,"__wrapped__"),Z=X&&xt.call(s,"__wrapped__");if(K||Z){var st=K?i.value():i,Q=Z?s.value():s;return v||(v=new Xe),p(st,Q,h,f,v)}}return G?(v||(v=new Xe),Bm(i,s,h,f,p,v)):!1}function cm(i){return It(i)&&te(i)==Be}function Po(i,s,h,f){var p=h.length,v=p,C=!f;if(i==null)return!v;for(i=bt(i);p--;){var w=h[p];if(C&&w[2]?w[1]!==i[w[0]]:!(w[0]in i))return!1}for(;++p<v;){w=h[p];var O=w[0],I=i[O],B=w[1];if(C&&w[2]){if(I===e&&!(O in i))return!1}else{var X=new Xe;if(f)var G=f(I,B,O,i,s,X);if(!(G===e?Ki(B,I,S|E,f,X):G))return!1}}return!0}function jh(i){if(!Lt(i)||Vm(i))return!1;var s=cn(i)?cp:tg;return s.test(Kn(i))}function um(i){return It(i)&&ie(i)==Ri}function fm(i){return It(i)&&te(i)==We}function dm(i){return It(i)&&hs(i.length)&&!!Pt[ie(i)]}function Xh(i){return typeof i=="function"?i:i==null?ge:typeof i=="object"?it(i)?zh(i[0],i[1]):Hh(i):lu(i)}function Ao(i){if(!Ji(i))return mp(i);var s=[];for(var h in bt(i))xt.call(i,h)&&h!="constructor"&&s.push(h);return s}function gm(i){if(!Lt(i))return $m(i);var s=Ji(i),h=[];for(var f in i)f=="constructor"&&(s||!xt.call(i,f))||h.push(f);return h}function Mo(i,s){return i<s}function Yh(i,s){var h=-1,f=fe(i)?k(i.length):[];return bn(i,function(p,v,C){f[++h]=s(p,v,C)}),f}function Hh(i){var s=Vo(i);return s.length==1&&s[0][2]?wc(s[0][0],s[0][1]):function(h){return h===i||Po(h,i,s)}}function zh(i,s){return Ko(i)&&Cc(s)?wc(qe(i),s):function(h){var f=ra(h,i);return f===e&&f===s?sa(h,i):Ki(s,f,S|E)}}function Nr(i,s,h,f,p){i!==s&&To(s,function(v,C){if(p||(p=new Xe),Lt(v))pm(i,s,C,h,Nr,f,p);else{var w=f?f($o(i,C),v,C+"",i,s,p):e;w===e&&(w=v),So(i,C,w)}},de)}function pm(i,s,h,f,p,v,C){var w=$o(i,h),O=$o(s,h),I=C.get(O);if(I){So(i,h,I);return}var B=v?v(w,O,h+"",i,s,C):e,X=B===e;if(X){var G=it(O),K=!G&&En(O),Z=!G&&!K&&wi(O);B=O,G||K||Z?it(w)?B=w:jt(w)?B=ue(w):K?(X=!1,B=ec(O,!0)):Z?(X=!1,B=nc(O,!0)):B=[]:Qi(O)||qn(O)?(B=w,qn(w)?B=Zc(w):(!Lt(w)||cn(w))&&(B=xc(O))):X=!1}X&&(C.set(O,B),p(B,O,f,v,C),C.delete(O)),So(i,h,B)}function Gh(i,s){var h=i.length;if(h)return s+=s<0?h:0,hn(s,h)?i[s]:e}function Uh(i,s,h){s.length?s=kt(s,function(v){return it(v)?function(C){return Vn(C,v.length===1?v[0]:v)}:v}):s=[ge];var f=-1;s=kt(s,ve(J()));var p=Yh(i,function(v,C,w){var O=kt(s,function(I){return I(v)});return{criteria:O,index:++f,value:v}});return Hg(p,function(v,C){return Em(v,C,h)})}function mm(i,s){return Vh(i,s,function(h,f){return sa(i,f)})}function Vh(i,s,h){for(var f=-1,p=s.length,v={};++f<p;){var C=s[f],w=Vn(i,C);h(w,C)&&qi(v,On(C,i),w)}return v}function _m(i){return function(s){return Vn(s,i)}}function ko(i,s,h,f){var p=f?Yg:ui,v=-1,C=s.length,w=i;for(i===s&&(s=ue(s)),h&&(w=kt(i,ve(h)));++v<C;)for(var O=0,I=s[v],B=h?h(I):I;(O=p(w,B,O,f))>-1;)w!==i&&Br.call(w,O,1),Br.call(i,O,1);return i}function Nh(i,s){for(var h=i?s.length:0,f=h-1;h--;){var p=s[h];if(h==f||p!==v){var v=p;hn(p)?Br.call(i,p,1):Io(i,p)}}return i}function Lo(i,s){return i+Xr(Dh()*(s-i+1))}function vm(i,s,h,f){for(var p=-1,v=Ut(jr((s-i)/(h||1)),0),C=k(v);v--;)C[f?v:++p]=i,i+=h;return C}function Fo(i,s){var h="";if(!i||s<1||s>zt)return h;do s%2&&(h+=i),s=Xr(s/2),s&&(i+=i);while(s);return h}function ot(i,s){return Jo(Sc(i,s,ge),i+"")}function ym(i){return Ah(Si(i))}function xm(i,s){var h=Si(i);return is(h,Un(s,0,h.length))}function qi(i,s,h,f){if(!Lt(i))return i;s=On(s,i);for(var p=-1,v=s.length,C=v-1,w=i;w!=null&&++p<v;){var O=qe(s[p]),I=h;if(O==="__proto__"||O==="constructor"||O==="prototype")return i;if(p!=C){var B=w[O];I=f?f(B,O,w):e,I===e&&(I=Lt(B)?B:hn(s[p+1])?[]:{})}Ui(w,O,I),w=w[O]}return i}var Kh=Yr?function(i,s){return Yr.set(i,s),i}:ge,Cm=Wr?function(i,s){return Wr(i,"toString",{configurable:!0,enumerable:!1,value:aa(s),writable:!0})}:ge;function wm(i){return is(Si(i))}function Me(i,s,h){var f=-1,p=i.length;s<0&&(s=-s>p?0:p+s),h=h>p?p:h,h<0&&(h+=p),p=s>h?0:h-s>>>0,s>>>=0;for(var v=k(p);++f<p;)v[f]=i[f+s];return v}function Sm(i,s){var h;return bn(i,function(f,p,v){return h=s(f,p,v),!h}),!!h}function Kr(i,s,h){var f=0,p=i==null?f:i.length;if(typeof s=="number"&&s===s&&p<=St){for(;f<p;){var v=f+p>>>1,C=i[v];C!==null&&!xe(C)&&(h?C<=s:C<s)?f=v+1:p=v}return p}return Ro(i,s,ge,h)}function Ro(i,s,h,f){var p=0,v=i==null?0:i.length;if(v===0)return 0;s=h(s);for(var C=s!==s,w=s===null,O=xe(s),I=s===e;p<v;){var B=Xr((p+v)/2),X=h(i[B]),G=X!==e,K=X===null,Z=X===X,st=xe(X);if(C)var Q=f||Z;else I?Q=Z&&(f||G):w?Q=Z&&G&&(f||!K):O?Q=Z&&G&&!K&&(f||!st):K||st?Q=!1:Q=f?X<=s:X<s;Q?p=B+1:v=B}return Qt(v,gt)}function qh(i,s){for(var h=-1,f=i.length,p=0,v=[];++h<f;){var C=i[h],w=s?s(C):C;if(!h||!Ye(w,O)){var O=w;v[p++]=C===0?0:C}}return v}function $h(i){return typeof i=="number"?i:xe(i)?Xn:+i}function ye(i){if(typeof i=="string")return i;if(it(i))return kt(i,ye)+"";if(xe(i))return Eh?Eh.call(i):"";var s=i+"";return s=="0"&&1/i==-ne?"-0":s}function Tn(i,s,h){var f=-1,p=Dr,v=i.length,C=!0,w=[],O=w;if(h)C=!1,p=ho;else if(v>=r){var I=s?null:Fm(i);if(I)return Pr(I);C=!1,p=ji,O=new Gn}else O=s?[]:w;t:for(;++f<v;){var B=i[f],X=s?s(B):B;if(B=h||B!==0?B:0,C&&X===X){for(var G=O.length;G--;)if(O[G]===X)continue t;s&&O.push(X),w.push(B)}else p(O,X,h)||(O!==w&&O.push(X),w.push(B))}return w}function Io(i,s){return s=On(s,i),i=bc(i,s),i==null||delete i[qe(ke(s))]}function Jh(i,s,h,f){return qi(i,s,h(Vn(i,s)),f)}function qr(i,s,h,f){for(var p=i.length,v=f?p:-1;(f?v--:++v<p)&&s(i[v],v,i););return h?Me(i,f?0:v,f?v+1:p):Me(i,f?v+1:0,f?p:v)}function Zh(i,s){var h=i;return h instanceof ht&&(h=h.value()),co(s,function(f,p){return p.func.apply(p.thisArg,Cn([f],p.args))},h)}function Bo(i,s,h){var f=i.length;if(f<2)return f?Tn(i[0]):[];for(var p=-1,v=k(f);++p<f;)for(var C=i[p],w=-1;++w<f;)w!=p&&(v[p]=Vi(v[p]||C,i[w],s,h));return Tn(Zt(v,1),s,h)}function Qh(i,s,h){for(var f=-1,p=i.length,v=s.length,C={};++f<p;){var w=f<v?s[f]:e;h(C,i[f],w)}return C}function Wo(i){return jt(i)?i:[]}function jo(i){return typeof i=="function"?i:ge}function On(i,s){return it(i)?i:Ko(i,s)?[i]:Ec(_t(i))}var bm=ot;function Dn(i,s,h){var f=i.length;return h=h===e?f:h,!s&&h>=f?i:Me(i,s,h)}var tc=up||function(i){return Jt.clearTimeout(i)};function ec(i,s){if(s)return i.slice();var h=i.length,f=wh?wh(h):new i.constructor(h);return i.copy(f),f}function Xo(i){var s=new i.constructor(i.byteLength);return new Rr(s).set(new Rr(i)),s}function Tm(i,s){var h=s?Xo(i.buffer):i.buffer;return new i.constructor(h,i.byteOffset,i.byteLength)}function Om(i){var s=new i.constructor(i.source,Wl.exec(i));return s.lastIndex=i.lastIndex,s}function Dm(i){return Gi?bt(Gi.call(i)):{}}function nc(i,s){var h=s?Xo(i.buffer):i.buffer;return new i.constructor(h,i.byteOffset,i.length)}function ic(i,s){if(i!==s){var h=i!==e,f=i===null,p=i===i,v=xe(i),C=s!==e,w=s===null,O=s===s,I=xe(s);if(!w&&!I&&!v&&i>s||v&&C&&O&&!w&&!I||f&&C&&O||!h&&O||!p)return 1;if(!f&&!v&&!I&&i<s||I&&h&&p&&!f&&!v||w&&h&&p||!C&&p||!O)return-1}return 0}function Em(i,s,h){for(var f=-1,p=i.criteria,v=s.criteria,C=p.length,w=h.length;++f<C;){var O=ic(p[f],v[f]);if(O){if(f>=w)return O;var I=h[f];return O*(I=="desc"?-1:1)}}return i.index-s.index}function rc(i,s,h,f){for(var p=-1,v=i.length,C=h.length,w=-1,O=s.length,I=Ut(v-C,0),B=k(O+I),X=!f;++w<O;)B[w]=s[w];for(;++p<C;)(X||p<v)&&(B[h[p]]=i[p]);for(;I--;)B[w++]=i[p++];return B}function sc(i,s,h,f){for(var p=-1,v=i.length,C=-1,w=h.length,O=-1,I=s.length,B=Ut(v-w,0),X=k(B+I),G=!f;++p<B;)X[p]=i[p];for(var K=p;++O<I;)X[K+O]=s[O];for(;++C<w;)(G||p<v)&&(X[K+h[C]]=i[p++]);return X}function ue(i,s){var h=-1,f=i.length;for(s||(s=k(f));++h<f;)s[h]=i[h];return s}function Ke(i,s,h,f){var p=!h;h||(h={});for(var v=-1,C=s.length;++v<C;){var w=s[v],O=f?f(h[w],i[w],w,h,i):e;O===e&&(O=i[w]),p?on(h,w,O):Ui(h,w,O)}return h}function Pm(i,s){return Ke(i,No(i),s)}function Am(i,s){return Ke(i,vc(i),s)}function $r(i,s){return function(h,f){var p=it(h)?Rg:Zp,v=s?s():{};return p(h,i,J(f,2),v)}}function yi(i){return ot(function(s,h){var f=-1,p=h.length,v=p>1?h[p-1]:e,C=p>2?h[2]:e;for(v=i.length>3&&typeof v=="function"?(p--,v):e,C&&re(h[0],h[1],C)&&(v=p<3?e:v,p=1),s=bt(s);++f<p;){var w=h[f];w&&i(s,w,f,v)}return s})}function oc(i,s){return function(h,f){if(h==null)return h;if(!fe(h))return i(h,f);for(var p=h.length,v=s?p:-1,C=bt(h);(s?v--:++v<p)&&f(C[v],v,C)!==!1;);return h}}function ac(i){return function(s,h,f){for(var p=-1,v=bt(s),C=f(s),w=C.length;w--;){var O=C[i?w:++p];if(h(v[O],O,v)===!1)break}return s}}function Mm(i,s,h){var f=s&P,p=$i(i);function v(){var C=this&&this!==Jt&&this instanceof v?p:i;return C.apply(f?h:this,arguments)}return v}function lc(i){return function(s){s=_t(s);var h=fi(s)?je(s):e,f=h?h[0]:s.charAt(0),p=h?Dn(h,1).join(""):s.slice(1);return f[i]()+p}}function xi(i){return function(s){return co(ou(su(s).replace(Cg,"")),i,"")}}function $i(i){return function(){var s=arguments;switch(s.length){case 0:return new i;case 1:return new i(s[0]);case 2:return new i(s[0],s[1]);case 3:return new i(s[0],s[1],s[2]);case 4:return new i(s[0],s[1],s[2],s[3]);case 5:return new i(s[0],s[1],s[2],s[3],s[4]);case 6:return new i(s[0],s[1],s[2],s[3],s[4],s[5]);case 7:return new i(s[0],s[1],s[2],s[3],s[4],s[5],s[6])}var h=vi(i.prototype),f=i.apply(h,s);return Lt(f)?f:h}}function km(i,s,h){var f=$i(i);function p(){for(var v=arguments.length,C=k(v),w=v,O=Ci(p);w--;)C[w]=arguments[w];var I=v<3&&C[0]!==O&&C[v-1]!==O?[]:wn(C,O);if(v-=I.length,v<h)return dc(i,s,Jr,p.placeholder,e,C,I,e,e,h-v);var B=this&&this!==Jt&&this instanceof p?f:i;return _e(B,this,C)}return p}function hc(i){return function(s,h,f){var p=bt(s);if(!fe(s)){var v=J(h,3);s=Vt(s),h=function(w){return v(p[w],w,p)}}var C=i(s,h,f);return C>-1?p[v?s[C]:C]:e}}function cc(i){return ln(function(s){var h=s.length,f=h,p=Pe.prototype.thru;for(i&&s.reverse();f--;){var v=s[f];if(typeof v!="function")throw new Ee(l);if(p&&!C&&es(v)=="wrapper")var C=new Pe([],!0)}for(f=C?f:h;++f<h;){v=s[f];var w=es(v),O=w=="wrapper"?Uo(v):e;O&&qo(O[0])&&O[1]==(A|Y|z|R)&&!O[4].length&&O[9]==1?C=C[es(O[0])].apply(C,O[3]):C=v.length==1&&qo(v)?C[w]():C.thru(v)}return function(){var I=arguments,B=I[0];if(C&&I.length==1&&it(B))return C.plant(B).value();for(var X=0,G=h?s[X].apply(this,I):B;++X<h;)G=s[X].call(this,G);return G}})}function Jr(i,s,h,f,p,v,C,w,O,I){var B=s&A,X=s&P,G=s&L,K=s&(Y|H),Z=s&N,st=G?e:$i(i);function Q(){for(var lt=arguments.length,ct=k(lt),Ce=lt;Ce--;)ct[Ce]=arguments[Ce];if(K)var se=Ci(Q),we=Gg(ct,se);if(f&&(ct=rc(ct,f,p,K)),v&&(ct=sc(ct,v,C,K)),lt-=we,K&&lt<I){var Xt=wn(ct,se);return dc(i,s,Jr,Q.placeholder,h,ct,Xt,w,O,I-lt)}var He=X?h:this,fn=G?He[i]:i;return lt=ct.length,w?ct=Zm(ct,w):Z&&lt>1&&ct.reverse(),B&&O<lt&&(ct.length=O),this&&this!==Jt&&this instanceof Q&&(fn=st||$i(fn)),fn.apply(He,ct)}return Q}function uc(i,s){return function(h,f){return om(h,i,s(f),{})}}function Zr(i,s){return function(h,f){var p;if(h===e&&f===e)return s;if(h!==e&&(p=h),f!==e){if(p===e)return f;typeof h=="string"||typeof f=="string"?(h=ye(h),f=ye(f)):(h=$h(h),f=$h(f)),p=i(h,f)}return p}}function Yo(i){return ln(function(s){return s=kt(s,ve(J())),ot(function(h){var f=this;return i(s,function(p){return _e(p,f,h)})})})}function Qr(i,s){s=s===e?" ":ye(s);var h=s.length;if(h<2)return h?Fo(s,i):s;var f=Fo(s,jr(i/di(s)));return fi(s)?Dn(je(f),0,i).join(""):f.slice(0,i)}function Lm(i,s,h,f){var p=s&P,v=$i(i);function C(){for(var w=-1,O=arguments.length,I=-1,B=f.length,X=k(B+O),G=this&&this!==Jt&&this instanceof C?v:i;++I<B;)X[I]=f[I];for(;O--;)X[I++]=arguments[++w];return _e(G,p?h:this,X)}return C}function fc(i){return function(s,h,f){return f&&typeof f!="number"&&re(s,h,f)&&(h=f=e),s=un(s),h===e?(h=s,s=0):h=un(h),f=f===e?s<h?1:-1:un(f),vm(s,h,f,i)}}function ts(i){return function(s,h){return typeof s=="string"&&typeof h=="string"||(s=Le(s),h=Le(h)),i(s,h)}}function dc(i,s,h,f,p,v,C,w,O,I){var B=s&Y,X=B?C:e,G=B?e:C,K=B?v:e,Z=B?e:v;s|=B?z:U,s&=~(B?U:z),s&W||(s&=~(P|L));var st=[i,s,p,K,X,Z,G,w,O,I],Q=h.apply(e,st);return qo(i)&&Tc(Q,st),Q.placeholder=f,Oc(Q,i,s)}function Ho(i){var s=Gt[i];return function(h,f){if(h=Le(h),f=f==null?0:Qt(rt(f),292),f&&Oh(h)){var p=(_t(h)+"e").split("e"),v=s(p[0]+"e"+(+p[1]+f));return p=(_t(v)+"e").split("e"),+(p[0]+"e"+(+p[1]-f))}return s(h)}}var Fm=mi&&1/Pr(new mi([,-0]))[1]==ne?function(i){return new mi(i)}:ca;function gc(i){return function(s){var h=te(s);return h==Be?vo(s):h==We?Jg(s):zg(s,i(s))}}function an(i,s,h,f,p,v,C,w){var O=s&L;if(!O&&typeof i!="function")throw new Ee(l);var I=f?f.length:0;if(I||(s&=~(z|U),f=p=e),C=C===e?C:Ut(rt(C),0),w=w===e?w:rt(w),I-=p?p.length:0,s&U){var B=f,X=p;f=p=e}var G=O?e:Uo(i),K=[i,s,h,f,p,B,X,v,C,w];if(G&&qm(K,G),i=K[0],s=K[1],h=K[2],f=K[3],p=K[4],w=K[9]=K[9]===e?O?0:i.length:Ut(K[9]-I,0),!w&&s&(Y|H)&&(s&=~(Y|H)),!s||s==P)var Z=Mm(i,s,h);else s==Y||s==H?Z=km(i,s,w):(s==z||s==(P|z))&&!p.length?Z=Lm(i,s,h,f):Z=Jr.apply(e,K);var st=G?Kh:Tc;return Oc(st(Z,K),i,s)}function pc(i,s,h,f){return i===e||Ye(i,pi[h])&&!xt.call(f,h)?s:i}function mc(i,s,h,f,p,v){return Lt(i)&&Lt(s)&&(v.set(s,i),Nr(i,s,e,mc,v),v.delete(s)),i}function Rm(i){return Qi(i)?e:i}function _c(i,s,h,f,p,v){var C=h&S,w=i.length,O=s.length;if(w!=O&&!(C&&O>w))return!1;var I=v.get(i),B=v.get(s);if(I&&B)return I==s&&B==i;var X=-1,G=!0,K=h&E?new Gn:e;for(v.set(i,s),v.set(s,i);++X<w;){var Z=i[X],st=s[X];if(f)var Q=C?f(st,Z,X,s,i,v):f(Z,st,X,i,s,v);if(Q!==e){if(Q)continue;G=!1;break}if(K){if(!uo(s,function(lt,ct){if(!ji(K,ct)&&(Z===lt||p(Z,lt,h,f,v)))return K.push(ct)})){G=!1;break}}else if(!(Z===st||p(Z,st,h,f,v))){G=!1;break}}return v.delete(i),v.delete(s),G}function Im(i,s,h,f,p,v,C){switch(h){case hi:if(i.byteLength!=s.byteLength||i.byteOffset!=s.byteOffset)return!1;i=i.buffer,s=s.buffer;case Wi:return!(i.byteLength!=s.byteLength||!v(new Rr(i),new Rr(s)));case Rt:case Te:case Fi:return Ye(+i,+s);case ai:return i.name==s.name&&i.message==s.message;case Ri:case Ii:return i==s+"";case Be:var w=vo;case We:var O=f&S;if(w||(w=Pr),i.size!=s.size&&!O)return!1;var I=C.get(i);if(I)return I==s;f|=E,C.set(i,s);var B=_c(w(i),w(s),f,p,v,C);return C.delete(i),B;case Sr:if(Gi)return Gi.call(i)==Gi.call(s)}return!1}function Bm(i,s,h,f,p,v){var C=h&S,w=zo(i),O=w.length,I=zo(s),B=I.length;if(O!=B&&!C)return!1;for(var X=O;X--;){var G=w[X];if(!(C?G in s:xt.call(s,G)))return!1}var K=v.get(i),Z=v.get(s);if(K&&Z)return K==s&&Z==i;var st=!0;v.set(i,s),v.set(s,i);for(var Q=C;++X<O;){G=w[X];var lt=i[G],ct=s[G];if(f)var Ce=C?f(ct,lt,G,s,i,v):f(lt,ct,G,i,s,v);if(!(Ce===e?lt===ct||p(lt,ct,h,f,v):Ce)){st=!1;break}Q||(Q=G=="constructor")}if(st&&!Q){var se=i.constructor,we=s.constructor;se!=we&&"constructor"in i&&"constructor"in s&&!(typeof se=="function"&&se instanceof se&&typeof we=="function"&&we instanceof we)&&(st=!1)}return v.delete(i),v.delete(s),st}function ln(i){return Jo(Sc(i,e,kc),i+"")}function zo(i){return Bh(i,Vt,No)}function Go(i){return Bh(i,de,vc)}var Uo=Yr?function(i){return Yr.get(i)}:ca;function es(i){for(var s=i.name+"",h=_i[s],f=xt.call(_i,s)?h.length:0;f--;){var p=h[f],v=p.func;if(v==null||v==i)return p.name}return s}function Ci(i){var s=xt.call(m,"placeholder")?m:i;return s.placeholder}function J(){var i=m.iteratee||la;return i=i===la?Xh:i,arguments.length?i(arguments[0],arguments[1]):i}function ns(i,s){var h=i.__data__;return Um(s)?h[typeof s=="string"?"string":"hash"]:h.map}function Vo(i){for(var s=Vt(i),h=s.length;h--;){var f=s[h],p=i[f];s[h]=[f,p,Cc(p)]}return s}function Nn(i,s){var h=Kg(i,s);return jh(h)?h:e}function Wm(i){var s=xt.call(i,Hn),h=i[Hn];try{i[Hn]=e;var f=!0}catch(v){}var p=Lr.call(i);return f&&(s?i[Hn]=h:delete i[Hn]),p}var No=xo?function(i){return i==null?[]:(i=bt(i),xn(xo(i),function(s){return bh.call(i,s)}))}:ua,vc=xo?function(i){for(var s=[];i;)Cn(s,No(i)),i=Ir(i);return s}:ua,te=ie;(Co&&te(new Co(new ArrayBuffer(1)))!=hi||Yi&&te(new Yi)!=Be||wo&&te(wo.resolve())!=Fl||mi&&te(new mi)!=We||Hi&&te(new Hi)!=Bi)&&(te=function(i){var s=ie(i),h=s==nn?i.constructor:e,f=h?Kn(h):"";if(f)switch(f){case xp:return hi;case Cp:return Be;case wp:return Fl;case Sp:return We;case bp:return Bi}return s});function jm(i,s,h){for(var f=-1,p=h.length;++f<p;){var v=h[f],C=v.size;switch(v.type){case"drop":i+=C;break;case"dropRight":s-=C;break;case"take":s=Qt(s,i+C);break;case"takeRight":i=Ut(i,s-C);break}}return{start:i,end:s}}function Xm(i){var s=i.match(Vd);return s?s[1].split(Nd):[]}function yc(i,s,h){s=On(s,i);for(var f=-1,p=s.length,v=!1;++f<p;){var C=qe(s[f]);if(!(v=i!=null&&h(i,C)))break;i=i[C]}return v||++f!=p?v:(p=i==null?0:i.length,!!p&&hs(p)&&hn(C,p)&&(it(i)||qn(i)))}function Ym(i){var s=i.length,h=new i.constructor(s);return s&&typeof i[0]=="string"&&xt.call(i,"index")&&(h.index=i.index,h.input=i.input),h}function xc(i){return typeof i.constructor=="function"&&!Ji(i)?vi(Ir(i)):{}}function Hm(i,s,h){var f=i.constructor;switch(s){case Wi:return Xo(i);case Rt:case Te:return new f(+i);case hi:return Tm(i,h);case Us:case Vs:case Ns:case Ks:case qs:case $s:case Js:case Zs:case Qs:return nc(i,h);case Be:return new f;case Fi:case Ii:return new f(i);case Ri:return Om(i);case We:return new f;case Sr:return Dm(i)}}function zm(i,s){var h=s.length;if(!h)return i;var f=h-1;return s[f]=(h>1?"& ":"")+s[f],s=s.join(h>2?", ":" "),i.replace(Ud,`{
/* [wrapped with `+s+`] */
`)}function Gm(i){return it(i)||qn(i)||!!(Th&&i&&i[Th])}function hn(i,s){var h=typeof i;return s=s==null?zt:s,!!s&&(h=="number"||h!="symbol"&&ng.test(i))&&i>-1&&i%1==0&&i<s}function re(i,s,h){if(!Lt(h))return!1;var f=typeof s;return(f=="number"?fe(h)&&hn(s,h.length):f=="string"&&s in h)?Ye(h[s],i):!1}function Ko(i,s){if(it(i))return!1;var h=typeof i;return h=="number"||h=="symbol"||h=="boolean"||i==null||xe(i)?!0:Yd.test(i)||!Xd.test(i)||s!=null&&i in bt(s)}function Um(i){var s=typeof i;return s=="string"||s=="number"||s=="symbol"||s=="boolean"?i!=="__proto__":i===null}function qo(i){var s=es(i),h=m[s];if(typeof h!="function"||!(s in ht.prototype))return!1;if(i===h)return!0;var f=Uo(h);return!!f&&i===f[0]}function Vm(i){return!!Ch&&Ch in i}var Nm=Mr?cn:fa;function Ji(i){var s=i&&i.constructor,h=typeof s=="function"&&s.prototype||pi;return i===h}function Cc(i){return i===i&&!Lt(i)}function wc(i,s){return function(h){return h==null?!1:h[i]===s&&(s!==e||i in bt(h))}}function Km(i){var s=as(i,function(f){return h.size===d&&h.clear(),f}),h=s.cache;return s}function qm(i,s){var h=i[1],f=s[1],p=h|f,v=p<(P|L|A),C=f==A&&h==Y||f==A&&h==R&&i[7].length<=s[8]||f==(A|R)&&s[7].length<=s[8]&&h==Y;if(!(v||C))return i;f&P&&(i[2]=s[2],p|=h&P?0:W);var w=s[3];if(w){var O=i[3];i[3]=O?rc(O,w,s[4]):w,i[4]=O?wn(i[3],g):s[4]}return w=s[5],w&&(O=i[5],i[5]=O?sc(O,w,s[6]):w,i[6]=O?wn(i[5],g):s[6]),w=s[7],w&&(i[7]=w),f&A&&(i[8]=i[8]==null?s[8]:Qt(i[8],s[8])),i[9]==null&&(i[9]=s[9]),i[0]=s[0],i[1]=p,i}function $m(i){var s=[];if(i!=null)for(var h in bt(i))s.push(h);return s}function Jm(i){return Lr.call(i)}function Sc(i,s,h){return s=Ut(s===e?i.length-1:s,0),function(){for(var f=arguments,p=-1,v=Ut(f.length-s,0),C=k(v);++p<v;)C[p]=f[s+p];p=-1;for(var w=k(s+1);++p<s;)w[p]=f[p];return w[s]=h(C),_e(i,this,w)}}function bc(i,s){return s.length<2?i:Vn(i,Me(s,0,-1))}function Zm(i,s){for(var h=i.length,f=Qt(s.length,h),p=ue(i);f--;){var v=s[f];i[f]=hn(v,h)?p[v]:e}return i}function $o(i,s){if(!(s==="constructor"&&typeof i[s]=="function")&&s!="__proto__")return i[s]}var Tc=Dc(Kh),Zi=dp||function(i,s){return Jt.setTimeout(i,s)},Jo=Dc(Cm);function Oc(i,s,h){var f=s+"";return Jo(i,zm(f,Qm(Xm(f),h)))}function Dc(i){var s=0,h=0;return function(){var f=_p(),p=Ft-(f-h);if(h=f,p>0){if(++s>=vt)return arguments[0]}else s=0;return i.apply(e,arguments)}}function is(i,s){var h=-1,f=i.length,p=f-1;for(s=s===e?f:s;++h<s;){var v=Lo(h,p),C=i[v];i[v]=i[h],i[h]=C}return i.length=s,i}var Ec=Km(function(i){var s=[];return i.charCodeAt(0)===46&&s.push(""),i.replace(Hd,function(h,f,p,v){s.push(p?v.replace($d,"$1"):f||h)}),s});function qe(i){if(typeof i=="string"||xe(i))return i;var s=i+"";return s=="0"&&1/i==-ne?"-0":s}function Kn(i){if(i!=null){try{return kr.call(i)}catch(s){}try{return i+""}catch(s){}}return""}function Qm(i,s){return De(ft,function(h){var f="_."+h[0];s&h[1]&&!Dr(i,f)&&i.push(f)}),i.sort()}function Pc(i){if(i instanceof ht)return i.clone();var s=new Pe(i.__wrapped__,i.__chain__);return s.__actions__=ue(i.__actions__),s.__index__=i.__index__,s.__values__=i.__values__,s}function t_(i,s,h){(h?re(i,s,h):s===e)?s=1:s=Ut(rt(s),0);var f=i==null?0:i.length;if(!f||s<1)return[];for(var p=0,v=0,C=k(jr(f/s));p<f;)C[v++]=Me(i,p,p+=s);return C}function e_(i){for(var s=-1,h=i==null?0:i.length,f=0,p=[];++s<h;){var v=i[s];v&&(p[f++]=v)}return p}function n_(){var i=arguments.length;if(!i)return[];for(var s=k(i-1),h=arguments[0],f=i;f--;)s[f-1]=arguments[f];return Cn(it(h)?ue(h):[h],Zt(s,1))}var i_=ot(function(i,s){return jt(i)?Vi(i,Zt(s,1,jt,!0)):[]}),r_=ot(function(i,s){var h=ke(s);return jt(h)&&(h=e),jt(i)?Vi(i,Zt(s,1,jt,!0),J(h,2)):[]}),s_=ot(function(i,s){var h=ke(s);return jt(h)&&(h=e),jt(i)?Vi(i,Zt(s,1,jt,!0),e,h):[]});function o_(i,s,h){var f=i==null?0:i.length;return f?(s=h||s===e?1:rt(s),Me(i,s<0?0:s,f)):[]}function a_(i,s,h){var f=i==null?0:i.length;return f?(s=h||s===e?1:rt(s),s=f-s,Me(i,0,s<0?0:s)):[]}function l_(i,s){return i&&i.length?qr(i,J(s,3),!0,!0):[]}function h_(i,s){return i&&i.length?qr(i,J(s,3),!0):[]}function c_(i,s,h,f){var p=i==null?0:i.length;return p?(h&&typeof h!="number"&&re(i,s,h)&&(h=0,f=p),nm(i,s,h,f)):[]}function Ac(i,s,h){var f=i==null?0:i.length;if(!f)return-1;var p=h==null?0:rt(h);return p<0&&(p=Ut(f+p,0)),Er(i,J(s,3),p)}function Mc(i,s,h){var f=i==null?0:i.length;if(!f)return-1;var p=f-1;return h!==e&&(p=rt(h),p=h<0?Ut(f+p,0):Qt(p,f-1)),Er(i,J(s,3),p,!0)}function kc(i){var s=i==null?0:i.length;return s?Zt(i,1):[]}function u_(i){var s=i==null?0:i.length;return s?Zt(i,ne):[]}function f_(i,s){var h=i==null?0:i.length;return h?(s=s===e?1:rt(s),Zt(i,s)):[]}function d_(i){for(var s=-1,h=i==null?0:i.length,f={};++s<h;){var p=i[s];f[p[0]]=p[1]}return f}function Lc(i){return i&&i.length?i[0]:e}function g_(i,s,h){var f=i==null?0:i.length;if(!f)return-1;var p=h==null?0:rt(h);return p<0&&(p=Ut(f+p,0)),ui(i,s,p)}function p_(i){var s=i==null?0:i.length;return s?Me(i,0,-1):[]}var m_=ot(function(i){var s=kt(i,Wo);return s.length&&s[0]===i[0]?Eo(s):[]}),__=ot(function(i){var s=ke(i),h=kt(i,Wo);return s===ke(h)?s=e:h.pop(),h.length&&h[0]===i[0]?Eo(h,J(s,2)):[]}),v_=ot(function(i){var s=ke(i),h=kt(i,Wo);return s=typeof s=="function"?s:e,s&&h.pop(),h.length&&h[0]===i[0]?Eo(h,e,s):[]});function y_(i,s){return i==null?"":pp.call(i,s)}function ke(i){var s=i==null?0:i.length;return s?i[s-1]:e}function x_(i,s,h){var f=i==null?0:i.length;if(!f)return-1;var p=f;return h!==e&&(p=rt(h),p=p<0?Ut(f+p,0):Qt(p,f-1)),s===s?Qg(i,s,p):Er(i,dh,p,!0)}function C_(i,s){return i&&i.length?Gh(i,rt(s)):e}var w_=ot(Fc);function Fc(i,s){return i&&i.length&&s&&s.length?ko(i,s):i}function S_(i,s,h){return i&&i.length&&s&&s.length?ko(i,s,J(h,2)):i}function b_(i,s,h){return i&&i.length&&s&&s.length?ko(i,s,e,h):i}var T_=ln(function(i,s){var h=i==null?0:i.length,f=bo(i,s);return Nh(i,kt(s,function(p){return hn(p,h)?+p:p}).sort(ic)),f});function O_(i,s){var h=[];if(!(i&&i.length))return h;var f=-1,p=[],v=i.length;for(s=J(s,3);++f<v;){var C=i[f];s(C,f,i)&&(h.push(C),p.push(f))}return Nh(i,p),h}function Zo(i){return i==null?i:yp.call(i)}function D_(i,s,h){var f=i==null?0:i.length;return f?(h&&typeof h!="number"&&re(i,s,h)?(s=0,h=f):(s=s==null?0:rt(s),h=h===e?f:rt(h)),Me(i,s,h)):[]}function E_(i,s){return Kr(i,s)}function P_(i,s,h){return Ro(i,s,J(h,2))}function A_(i,s){var h=i==null?0:i.length;if(h){var f=Kr(i,s);if(f<h&&Ye(i[f],s))return f}return-1}function M_(i,s){return Kr(i,s,!0)}function k_(i,s,h){return Ro(i,s,J(h,2),!0)}function L_(i,s){var h=i==null?0:i.length;if(h){var f=Kr(i,s,!0)-1;if(Ye(i[f],s))return f}return-1}function F_(i){return i&&i.length?qh(i):[]}function R_(i,s){return i&&i.length?qh(i,J(s,2)):[]}function I_(i){var s=i==null?0:i.length;return s?Me(i,1,s):[]}function B_(i,s,h){return i&&i.length?(s=h||s===e?1:rt(s),Me(i,0,s<0?0:s)):[]}function W_(i,s,h){var f=i==null?0:i.length;return f?(s=h||s===e?1:rt(s),s=f-s,Me(i,s<0?0:s,f)):[]}function j_(i,s){return i&&i.length?qr(i,J(s,3),!1,!0):[]}function X_(i,s){return i&&i.length?qr(i,J(s,3)):[]}var Y_=ot(function(i){return Tn(Zt(i,1,jt,!0))}),H_=ot(function(i){var s=ke(i);return jt(s)&&(s=e),Tn(Zt(i,1,jt,!0),J(s,2))}),z_=ot(function(i){var s=ke(i);return s=typeof s=="function"?s:e,Tn(Zt(i,1,jt,!0),e,s)});function G_(i){return i&&i.length?Tn(i):[]}function U_(i,s){return i&&i.length?Tn(i,J(s,2)):[]}function V_(i,s){return s=typeof s=="function"?s:e,i&&i.length?Tn(i,e,s):[]}function Qo(i){if(!(i&&i.length))return[];var s=0;return i=xn(i,function(h){if(jt(h))return s=Ut(h.length,s),!0}),mo(s,function(h){return kt(i,fo(h))})}function Rc(i,s){if(!(i&&i.length))return[];var h=Qo(i);return s==null?h:kt(h,function(f){return _e(s,e,f)})}var N_=ot(function(i,s){return jt(i)?Vi(i,s):[]}),K_=ot(function(i){return Bo(xn(i,jt))}),q_=ot(function(i){var s=ke(i);return jt(s)&&(s=e),Bo(xn(i,jt),J(s,2))}),$_=ot(function(i){var s=ke(i);return s=typeof s=="function"?s:e,Bo(xn(i,jt),e,s)}),J_=ot(Qo);function Z_(i,s){return Qh(i||[],s||[],Ui)}function Q_(i,s){return Qh(i||[],s||[],qi)}var t0=ot(function(i){var s=i.length,h=s>1?i[s-1]:e;return h=typeof h=="function"?(i.pop(),h):e,Rc(i,h)});function Ic(i){var s=m(i);return s.__chain__=!0,s}function e0(i,s){return s(i),i}function rs(i,s){return s(i)}var n0=ln(function(i){var s=i.length,h=s?i[0]:0,f=this.__wrapped__,p=function(v){return bo(v,i)};return s>1||this.__actions__.length||!(f instanceof ht)||!hn(h)?this.thru(p):(f=f.slice(h,+h+(s?1:0)),f.__actions__.push({func:rs,args:[p],thisArg:e}),new Pe(f,this.__chain__).thru(function(v){return s&&!v.length&&v.push(e),v}))});function i0(){return Ic(this)}function r0(){return new Pe(this.value(),this.__chain__)}function s0(){this.__values__===e&&(this.__values__=$c(this.value()));var i=this.__index__>=this.__values__.length,s=i?e:this.__values__[this.__index__++];return{done:i,value:s}}function o0(){return this}function a0(i){for(var s,h=this;h instanceof zr;){var f=Pc(h);f.__index__=0,f.__values__=e,s?p.__wrapped__=f:s=f;var p=f;h=h.__wrapped__}return p.__wrapped__=i,s}function l0(){var i=this.__wrapped__;if(i instanceof ht){var s=i;return this.__actions__.length&&(s=new ht(this)),s=s.reverse(),s.__actions__.push({func:rs,args:[Zo],thisArg:e}),new Pe(s,this.__chain__)}return this.thru(Zo)}function h0(){return Zh(this.__wrapped__,this.__actions__)}var c0=$r(function(i,s,h){xt.call(i,h)?++i[h]:on(i,h,1)});function u0(i,s,h){var f=it(i)?uh:em;return h&&re(i,s,h)&&(s=e),f(i,J(s,3))}function f0(i,s){var h=it(i)?xn:Rh;return h(i,J(s,3))}var d0=hc(Ac),g0=hc(Mc);function p0(i,s){return Zt(ss(i,s),1)}function m0(i,s){return Zt(ss(i,s),ne)}function _0(i,s,h){return h=h===e?1:rt(h),Zt(ss(i,s),h)}function Bc(i,s){var h=it(i)?De:bn;return h(i,J(s,3))}function Wc(i,s){var h=it(i)?Ig:Fh;return h(i,J(s,3))}var v0=$r(function(i,s,h){xt.call(i,h)?i[h].push(s):on(i,h,[s])});function y0(i,s,h,f){i=fe(i)?i:Si(i),h=h&&!f?rt(h):0;var p=i.length;return h<0&&(h=Ut(p+h,0)),cs(i)?h<=p&&i.indexOf(s,h)>-1:!!p&&ui(i,s,h)>-1}var x0=ot(function(i,s,h){var f=-1,p=typeof s=="function",v=fe(i)?k(i.length):[];return bn(i,function(C){v[++f]=p?_e(s,C,h):Ni(C,s,h)}),v}),C0=$r(function(i,s,h){on(i,h,s)});function ss(i,s){var h=it(i)?kt:Yh;return h(i,J(s,3))}function w0(i,s,h,f){return i==null?[]:(it(s)||(s=s==null?[]:[s]),h=f?e:h,it(h)||(h=h==null?[]:[h]),Uh(i,s,h))}var S0=$r(function(i,s,h){i[h?0:1].push(s)},function(){return[[],[]]});function b0(i,s,h){var f=it(i)?co:ph,p=arguments.length<3;return f(i,J(s,4),h,p,bn)}function T0(i,s,h){var f=it(i)?Bg:ph,p=arguments.length<3;return f(i,J(s,4),h,p,Fh)}function O0(i,s){var h=it(i)?xn:Rh;return h(i,ls(J(s,3)))}function D0(i){var s=it(i)?Ah:ym;return s(i)}function E0(i,s,h){(h?re(i,s,h):s===e)?s=1:s=rt(s);var f=it(i)?$p:xm;return f(i,s)}function P0(i){var s=it(i)?Jp:wm;return s(i)}function A0(i){if(i==null)return 0;if(fe(i))return cs(i)?di(i):i.length;var s=te(i);return s==Be||s==We?i.size:Ao(i).length}function M0(i,s,h){var f=it(i)?uo:Sm;return h&&re(i,s,h)&&(s=e),f(i,J(s,3))}var k0=ot(function(i,s){if(i==null)return[];var h=s.length;return h>1&&re(i,s[0],s[1])?s=[]:h>2&&re(s[0],s[1],s[2])&&(s=[s[0]]),Uh(i,Zt(s,1),[])}),os=fp||function(){return Jt.Date.now()};function L0(i,s){if(typeof s!="function")throw new Ee(l);return i=rt(i),function(){if(--i<1)return s.apply(this,arguments)}}function jc(i,s,h){return s=h?e:s,s=i&&s==null?i.length:s,an(i,A,e,e,e,e,s)}function Xc(i,s){var h;if(typeof s!="function")throw new Ee(l);return i=rt(i),function(){return--i>0&&(h=s.apply(this,arguments)),i<=1&&(s=e),h}}var ta=ot(function(i,s,h){var f=P;if(h.length){var p=wn(h,Ci(ta));f|=z}return an(i,f,s,h,p)}),Yc=ot(function(i,s,h){var f=P|L;if(h.length){var p=wn(h,Ci(Yc));f|=z}return an(s,f,i,h,p)});function Hc(i,s,h){s=h?e:s;var f=an(i,Y,e,e,e,e,e,s);return f.placeholder=Hc.placeholder,f}function zc(i,s,h){s=h?e:s;var f=an(i,H,e,e,e,e,e,s);return f.placeholder=zc.placeholder,f}function Gc(i,s,h){var f,p,v,C,w,O,I=0,B=!1,X=!1,G=!0;if(typeof i!="function")throw new Ee(l);s=Le(s)||0,Lt(h)&&(B=!!h.leading,X="maxWait"in h,v=X?Ut(Le(h.maxWait)||0,s):v,G="trailing"in h?!!h.trailing:G);function K(Xt){var He=f,fn=p;return f=p=e,I=Xt,C=i.apply(fn,He),C}function Z(Xt){return I=Xt,w=Zi(lt,s),B?K(Xt):C}function st(Xt){var He=Xt-O,fn=Xt-I,hu=s-He;return X?Qt(hu,v-fn):hu}function Q(Xt){var He=Xt-O,fn=Xt-I;return O===e||He>=s||He<0||X&&fn>=v}function lt(){var Xt=os();if(Q(Xt))return ct(Xt);w=Zi(lt,st(Xt))}function ct(Xt){return w=e,G&&f?K(Xt):(f=p=e,C)}function Ce(){w!==e&&tc(w),I=0,f=O=p=w=e}function se(){return w===e?C:ct(os())}function we(){var Xt=os(),He=Q(Xt);if(f=arguments,p=this,O=Xt,He){if(w===e)return Z(O);if(X)return tc(w),w=Zi(lt,s),K(O)}return w===e&&(w=Zi(lt,s)),C}return we.cancel=Ce,we.flush=se,we}var F0=ot(function(i,s){return Lh(i,1,s)}),R0=ot(function(i,s,h){return Lh(i,Le(s)||0,h)});function I0(i){return an(i,N)}function as(i,s){if(typeof i!="function"||s!=null&&typeof s!="function")throw new Ee(l);var h=function(){var f=arguments,p=s?s.apply(this,f):f[0],v=h.cache;if(v.has(p))return v.get(p);var C=i.apply(this,f);return h.cache=v.set(p,C)||v,C};return h.cache=new(as.Cache||sn),h}as.Cache=sn;function ls(i){if(typeof i!="function")throw new Ee(l);return function(){var s=arguments;switch(s.length){case 0:return!i.call(this);case 1:return!i.call(this,s[0]);case 2:return!i.call(this,s[0],s[1]);case 3:return!i.call(this,s[0],s[1],s[2])}return!i.apply(this,s)}}function B0(i){return Xc(2,i)}var W0=bm(function(i,s){s=s.length==1&&it(s[0])?kt(s[0],ve(J())):kt(Zt(s,1),ve(J()));var h=s.length;return ot(function(f){for(var p=-1,v=Qt(f.length,h);++p<v;)f[p]=s[p].call(this,f[p]);return _e(i,this,f)})}),ea=ot(function(i,s){var h=wn(s,Ci(ea));return an(i,z,e,s,h)}),Uc=ot(function(i,s){var h=wn(s,Ci(Uc));return an(i,U,e,s,h)}),j0=ln(function(i,s){return an(i,R,e,e,e,s)});function X0(i,s){if(typeof i!="function")throw new Ee(l);return s=s===e?s:rt(s),ot(i,s)}function Y0(i,s){if(typeof i!="function")throw new Ee(l);return s=s==null?0:Ut(rt(s),0),ot(function(h){var f=h[s],p=Dn(h,0,s);return f&&Cn(p,f),_e(i,this,p)})}function H0(i,s,h){var f=!0,p=!0;if(typeof i!="function")throw new Ee(l);return Lt(h)&&(f="leading"in h?!!h.leading:f,p="trailing"in h?!!h.trailing:p),Gc(i,s,{leading:f,maxWait:s,trailing:p})}function z0(i){return jc(i,1)}function G0(i,s){return ea(jo(s),i)}function U0(){if(!arguments.length)return[];var i=arguments[0];return it(i)?i:[i]}function V0(i){return Ae(i,x)}function N0(i,s){return s=typeof s=="function"?s:e,Ae(i,x,s)}function K0(i){return Ae(i,_|x)}function q0(i,s){return s=typeof s=="function"?s:e,Ae(i,_|x,s)}function $0(i,s){return s==null||kh(i,s,Vt(s))}function Ye(i,s){return i===s||i!==i&&s!==s}var J0=ts(Do),Z0=ts(function(i,s){return i>=s}),qn=Wh(function(){return arguments}())?Wh:function(i){return It(i)&&xt.call(i,"callee")&&!bh.call(i,"callee")},it=k.isArray,Q0=sh?ve(sh):am;function fe(i){return i!=null&&hs(i.length)&&!cn(i)}function jt(i){return It(i)&&fe(i)}function tv(i){return i===!0||i===!1||It(i)&&ie(i)==Rt}var En=gp||fa,ev=oh?ve(oh):lm;function nv(i){return It(i)&&i.nodeType===1&&!Qi(i)}function iv(i){if(i==null)return!0;if(fe(i)&&(it(i)||typeof i=="string"||typeof i.splice=="function"||En(i)||wi(i)||qn(i)))return!i.length;var s=te(i);if(s==Be||s==We)return!i.size;if(Ji(i))return!Ao(i).length;for(var h in i)if(xt.call(i,h))return!1;return!0}function rv(i,s){return Ki(i,s)}function sv(i,s,h){h=typeof h=="function"?h:e;var f=h?h(i,s):e;return f===e?Ki(i,s,e,h):!!f}function na(i){if(!It(i))return!1;var s=ie(i);return s==ai||s==Ve||typeof i.message=="string"&&typeof i.name=="string"&&!Qi(i)}function ov(i){return typeof i=="number"&&Oh(i)}function cn(i){if(!Lt(i))return!1;var s=ie(i);return s==li||s==Ll||s==Ct||s==Ad}function Vc(i){return typeof i=="number"&&i==rt(i)}function hs(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=zt}function Lt(i){var s=typeof i;return i!=null&&(s=="object"||s=="function")}function It(i){return i!=null&&typeof i=="object"}var Nc=ah?ve(ah):cm;function av(i,s){return i===s||Po(i,s,Vo(s))}function lv(i,s,h){return h=typeof h=="function"?h:e,Po(i,s,Vo(s),h)}function hv(i){return Kc(i)&&i!=+i}function cv(i){if(Nm(i))throw new nt(o);return jh(i)}function uv(i){return i===null}function fv(i){return i==null}function Kc(i){return typeof i=="number"||It(i)&&ie(i)==Fi}function Qi(i){if(!It(i)||ie(i)!=nn)return!1;var s=Ir(i);if(s===null)return!0;var h=xt.call(s,"constructor")&&s.constructor;return typeof h=="function"&&h instanceof h&&kr.call(h)==lp}var ia=lh?ve(lh):um;function dv(i){return Vc(i)&&i>=-zt&&i<=zt}var qc=hh?ve(hh):fm;function cs(i){return typeof i=="string"||!it(i)&&It(i)&&ie(i)==Ii}function xe(i){return typeof i=="symbol"||It(i)&&ie(i)==Sr}var wi=ch?ve(ch):dm;function gv(i){return i===e}function pv(i){return It(i)&&te(i)==Bi}function mv(i){return It(i)&&ie(i)==kd}var _v=ts(Mo),vv=ts(function(i,s){return i<=s});function $c(i){if(!i)return[];if(fe(i))return cs(i)?je(i):ue(i);if(Xi&&i[Xi])return $g(i[Xi]());var s=te(i),h=s==Be?vo:s==We?Pr:Si;return h(i)}function un(i){if(!i)return i===0?i:0;if(i=Le(i),i===ne||i===-ne){var s=i<0?-1:1;return s*Gs}return i===i?i:0}function rt(i){var s=un(i),h=s%1;return s===s?h?s-h:s:0}function Jc(i){return i?Un(rt(i),0,$):0}function Le(i){if(typeof i=="number")return i;if(xe(i))return Xn;if(Lt(i)){var s=typeof i.valueOf=="function"?i.valueOf():i;i=Lt(s)?s+"":s}if(typeof i!="string")return i===0?i:+i;i=mh(i);var h=Qd.test(i);return h||eg.test(i)?Lg(i.slice(2),h?2:8):Zd.test(i)?Xn:+i}function Zc(i){return Ke(i,de(i))}function yv(i){return i?Un(rt(i),-zt,zt):i===0?i:0}function _t(i){return i==null?"":ye(i)}var xv=yi(function(i,s){if(Ji(s)||fe(s)){Ke(s,Vt(s),i);return}for(var h in s)xt.call(s,h)&&Ui(i,h,s[h])}),Qc=yi(function(i,s){Ke(s,de(s),i)}),us=yi(function(i,s,h,f){Ke(s,de(s),i,f)}),Cv=yi(function(i,s,h,f){Ke(s,Vt(s),i,f)}),wv=ln(bo);function Sv(i,s){var h=vi(i);return s==null?h:Mh(h,s)}var bv=ot(function(i,s){i=bt(i);var h=-1,f=s.length,p=f>2?s[2]:e;for(p&&re(s[0],s[1],p)&&(f=1);++h<f;)for(var v=s[h],C=de(v),w=-1,O=C.length;++w<O;){var I=C[w],B=i[I];(B===e||Ye(B,pi[I])&&!xt.call(i,I))&&(i[I]=v[I])}return i}),Tv=ot(function(i){return i.push(e,mc),_e(tu,e,i)});function Ov(i,s){return fh(i,J(s,3),Ne)}function Dv(i,s){return fh(i,J(s,3),Oo)}function Ev(i,s){return i==null?i:To(i,J(s,3),de)}function Pv(i,s){return i==null?i:Ih(i,J(s,3),de)}function Av(i,s){return i&&Ne(i,J(s,3))}function Mv(i,s){return i&&Oo(i,J(s,3))}function kv(i){return i==null?[]:Vr(i,Vt(i))}function Lv(i){return i==null?[]:Vr(i,de(i))}function ra(i,s,h){var f=i==null?e:Vn(i,s);return f===e?h:f}function Fv(i,s){return i!=null&&yc(i,s,im)}function sa(i,s){return i!=null&&yc(i,s,rm)}var Rv=uc(function(i,s,h){s!=null&&typeof s.toString!="function"&&(s=Lr.call(s)),i[s]=h},aa(ge)),Iv=uc(function(i,s,h){s!=null&&typeof s.toString!="function"&&(s=Lr.call(s)),xt.call(i,s)?i[s].push(h):i[s]=[h]},J),Bv=ot(Ni);function Vt(i){return fe(i)?Ph(i):Ao(i)}function de(i){return fe(i)?Ph(i,!0):gm(i)}function Wv(i,s){var h={};return s=J(s,3),Ne(i,function(f,p,v){on(h,s(f,p,v),f)}),h}function jv(i,s){var h={};return s=J(s,3),Ne(i,function(f,p,v){on(h,p,s(f,p,v))}),h}var Xv=yi(function(i,s,h){Nr(i,s,h)}),tu=yi(function(i,s,h,f){Nr(i,s,h,f)}),Yv=ln(function(i,s){var h={};if(i==null)return h;var f=!1;s=kt(s,function(v){return v=On(v,i),f||(f=v.length>1),v}),Ke(i,Go(i),h),f&&(h=Ae(h,_|y|x,Rm));for(var p=s.length;p--;)Io(h,s[p]);return h});function Hv(i,s){return eu(i,ls(J(s)))}var zv=ln(function(i,s){return i==null?{}:mm(i,s)});function eu(i,s){if(i==null)return{};var h=kt(Go(i),function(f){return[f]});return s=J(s),Vh(i,h,function(f,p){return s(f,p[0])})}function Gv(i,s,h){s=On(s,i);var f=-1,p=s.length;for(p||(p=1,i=e);++f<p;){var v=i==null?e:i[qe(s[f])];v===e&&(f=p,v=h),i=cn(v)?v.call(i):v}return i}function Uv(i,s,h){return i==null?i:qi(i,s,h)}function Vv(i,s,h,f){return f=typeof f=="function"?f:e,i==null?i:qi(i,s,h,f)}var nu=gc(Vt),iu=gc(de);function Nv(i,s,h){var f=it(i),p=f||En(i)||wi(i);if(s=J(s,4),h==null){var v=i&&i.constructor;p?h=f?new v:[]:Lt(i)?h=cn(v)?vi(Ir(i)):{}:h={}}return(p?De:Ne)(i,function(C,w,O){return s(h,C,w,O)}),h}function Kv(i,s){return i==null?!0:Io(i,s)}function qv(i,s,h){return i==null?i:Jh(i,s,jo(h))}function $v(i,s,h,f){return f=typeof f=="function"?f:e,i==null?i:Jh(i,s,jo(h),f)}function Si(i){return i==null?[]:_o(i,Vt(i))}function Jv(i){return i==null?[]:_o(i,de(i))}function Zv(i,s,h){return h===e&&(h=s,s=e),h!==e&&(h=Le(h),h=h===h?h:0),s!==e&&(s=Le(s),s=s===s?s:0),Un(Le(i),s,h)}function Qv(i,s,h){return s=un(s),h===e?(h=s,s=0):h=un(h),i=Le(i),sm(i,s,h)}function ty(i,s,h){if(h&&typeof h!="boolean"&&re(i,s,h)&&(s=h=e),h===e&&(typeof s=="boolean"?(h=s,s=e):typeof i=="boolean"&&(h=i,i=e)),i===e&&s===e?(i=0,s=1):(i=un(i),s===e?(s=i,i=0):s=un(s)),i>s){var f=i;i=s,s=f}if(h||i%1||s%1){var p=Dh();return Qt(i+p*(s-i+kg("1e-"+((p+"").length-1))),s)}return Lo(i,s)}var ey=xi(function(i,s,h){return s=s.toLowerCase(),i+(h?ru(s):s)});function ru(i){return oa(_t(i).toLowerCase())}function su(i){return i=_t(i),i&&i.replace(ig,Ug).replace(wg,"")}function ny(i,s,h){i=_t(i),s=ye(s);var f=i.length;h=h===e?f:Un(rt(h),0,f);var p=h;return h-=s.length,h>=0&&i.slice(h,p)==s}function iy(i){return i=_t(i),i&&Bd.test(i)?i.replace(Il,Vg):i}function ry(i){return i=_t(i),i&&zd.test(i)?i.replace(to,"\\$&"):i}var sy=xi(function(i,s,h){return i+(h?"-":"")+s.toLowerCase()}),oy=xi(function(i,s,h){return i+(h?" ":"")+s.toLowerCase()}),ay=lc("toLowerCase");function ly(i,s,h){i=_t(i),s=rt(s);var f=s?di(i):0;if(!s||f>=s)return i;var p=(s-f)/2;return Qr(Xr(p),h)+i+Qr(jr(p),h)}function hy(i,s,h){i=_t(i),s=rt(s);var f=s?di(i):0;return s&&f<s?i+Qr(s-f,h):i}function cy(i,s,h){i=_t(i),s=rt(s);var f=s?di(i):0;return s&&f<s?Qr(s-f,h)+i:i}function uy(i,s,h){return h||s==null?s=0:s&&(s=+s),vp(_t(i).replace(eo,""),s||0)}function fy(i,s,h){return(h?re(i,s,h):s===e)?s=1:s=rt(s),Fo(_t(i),s)}function dy(){var i=arguments,s=_t(i[0]);return i.length<3?s:s.replace(i[1],i[2])}var gy=xi(function(i,s,h){return i+(h?"_":"")+s.toLowerCase()});function py(i,s,h){return h&&typeof h!="number"&&re(i,s,h)&&(s=h=e),h=h===e?$:h>>>0,h?(i=_t(i),i&&(typeof s=="string"||s!=null&&!ia(s))&&(s=ye(s),!s&&fi(i))?Dn(je(i),0,h):i.split(s,h)):[]}var my=xi(function(i,s,h){return i+(h?" ":"")+oa(s)});function _y(i,s,h){return i=_t(i),h=h==null?0:Un(rt(h),0,i.length),s=ye(s),i.slice(h,h+s.length)==s}function vy(i,s,h){var f=m.templateSettings;h&&re(i,s,h)&&(s=e),i=_t(i),s=us({},s,f,pc);var p=us({},s.imports,f.imports,pc),v=Vt(p),C=_o(p,v),w,O,I=0,B=s.interpolate||br,X="__p += '",G=yo((s.escape||br).source+"|"+B.source+"|"+(B===Bl?Jd:br).source+"|"+(s.evaluate||br).source+"|$","g"),K="//# sourceURL="+(xt.call(s,"sourceURL")?(s.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Dg+"]")+`
`;i.replace(G,function(Q,lt,ct,Ce,se,we){return ct||(ct=Ce),X+=i.slice(I,we).replace(rg,Ng),lt&&(w=!0,X+=`' +
__e(`+lt+`) +
'`),se&&(O=!0,X+=`';
`+se+`;
__p += '`),ct&&(X+=`' +
((__t = (`+ct+`)) == null ? '' : __t) +
'`),I=we+Q.length,Q}),X+=`';
`;var Z=xt.call(s,"variable")&&s.variable;if(!Z)X=`with (obj) {
`+X+`
}
`;else if(qd.test(Z))throw new nt(c);X=(O?X.replace(Ld,""):X).replace(Fd,"$1").replace(Rd,"$1;"),X="function("+(Z||"obj")+`) {
`+(Z?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(w?", __e = _.escape":"")+(O?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+X+`return __p
}`;var st=au(function(){return pt(v,K+"return "+X).apply(e,C)});if(st.source=X,na(st))throw st;return st}function yy(i){return _t(i).toLowerCase()}function xy(i){return _t(i).toUpperCase()}function Cy(i,s,h){if(i=_t(i),i&&(h||s===e))return mh(i);if(!i||!(s=ye(s)))return i;var f=je(i),p=je(s),v=_h(f,p),C=vh(f,p)+1;return Dn(f,v,C).join("")}function wy(i,s,h){if(i=_t(i),i&&(h||s===e))return i.slice(0,xh(i)+1);if(!i||!(s=ye(s)))return i;var f=je(i),p=vh(f,je(s))+1;return Dn(f,0,p).join("")}function Sy(i,s,h){if(i=_t(i),i&&(h||s===e))return i.replace(eo,"");if(!i||!(s=ye(s)))return i;var f=je(i),p=_h(f,je(s));return Dn(f,p).join("")}function by(i,s){var h=tt,f=Dt;if(Lt(s)){var p="separator"in s?s.separator:p;h="length"in s?rt(s.length):h,f="omission"in s?ye(s.omission):f}i=_t(i);var v=i.length;if(fi(i)){var C=je(i);v=C.length}if(h>=v)return i;var w=h-di(f);if(w<1)return f;var O=C?Dn(C,0,w).join(""):i.slice(0,w);if(p===e)return O+f;if(C&&(w+=O.length-w),ia(p)){if(i.slice(w).search(p)){var I,B=O;for(p.global||(p=yo(p.source,_t(Wl.exec(p))+"g")),p.lastIndex=0;I=p.exec(B);)var X=I.index;O=O.slice(0,X===e?w:X)}}else if(i.indexOf(ye(p),w)!=w){var G=O.lastIndexOf(p);G>-1&&(O=O.slice(0,G))}return O+f}function Ty(i){return i=_t(i),i&&Id.test(i)?i.replace(Rl,tp):i}var Oy=xi(function(i,s,h){return i+(h?" ":"")+s.toUpperCase()}),oa=lc("toUpperCase");function ou(i,s,h){return i=_t(i),s=h?e:s,s===e?qg(i)?ip(i):Xg(i):i.match(s)||[]}var au=ot(function(i,s){try{return _e(i,e,s)}catch(h){return na(h)?h:new nt(h)}}),Dy=ln(function(i,s){return De(s,function(h){h=qe(h),on(i,h,ta(i[h],i))}),i});function Ey(i){var s=i==null?0:i.length,h=J();return i=s?kt(i,function(f){if(typeof f[1]!="function")throw new Ee(l);return[h(f[0]),f[1]]}):[],ot(function(f){for(var p=-1;++p<s;){var v=i[p];if(_e(v[0],this,f))return _e(v[1],this,f)}})}function Py(i){return tm(Ae(i,_))}function aa(i){return function(){return i}}function Ay(i,s){return i==null||i!==i?s:i}var My=cc(),ky=cc(!0);function ge(i){return i}function la(i){return Xh(typeof i=="function"?i:Ae(i,_))}function Ly(i){return Hh(Ae(i,_))}function Fy(i,s){return zh(i,Ae(s,_))}var Ry=ot(function(i,s){return function(h){return Ni(h,i,s)}}),Iy=ot(function(i,s){return function(h){return Ni(i,h,s)}});function ha(i,s,h){var f=Vt(s),p=Vr(s,f);h==null&&!(Lt(s)&&(p.length||!f.length))&&(h=s,s=i,i=this,p=Vr(s,Vt(s)));var v=!(Lt(h)&&"chain"in h)||!!h.chain,C=cn(i);return De(p,function(w){var O=s[w];i[w]=O,C&&(i.prototype[w]=function(){var I=this.__chain__;if(v||I){var B=i(this.__wrapped__),X=B.__actions__=ue(this.__actions__);return X.push({func:O,args:arguments,thisArg:i}),B.__chain__=I,B}return O.apply(i,Cn([this.value()],arguments))})}),i}function By(){return Jt._===this&&(Jt._=hp),this}function ca(){}function Wy(i){return i=rt(i),ot(function(s){return Gh(s,i)})}var jy=Yo(kt),Xy=Yo(uh),Yy=Yo(uo);function lu(i){return Ko(i)?fo(qe(i)):_m(i)}function Hy(i){return function(s){return i==null?e:Vn(i,s)}}var zy=fc(),Gy=fc(!0);function ua(){return[]}function fa(){return!1}function Uy(){return{}}function Vy(){return""}function Ny(){return!0}function Ky(i,s){if(i=rt(i),i<1||i>zt)return[];var h=$,f=Qt(i,$);s=J(s),i-=$;for(var p=mo(f,s);++h<i;)s(h);return p}function qy(i){return it(i)?kt(i,qe):xe(i)?[i]:ue(Ec(_t(i)))}function $y(i){var s=++ap;return _t(i)+s}var Jy=Zr(function(i,s){return i+s},0),Zy=Ho("ceil"),Qy=Zr(function(i,s){return i/s},1),tx=Ho("floor");function ex(i){return i&&i.length?Ur(i,ge,Do):e}function nx(i,s){return i&&i.length?Ur(i,J(s,2),Do):e}function ix(i){return gh(i,ge)}function rx(i,s){return gh(i,J(s,2))}function sx(i){return i&&i.length?Ur(i,ge,Mo):e}function ox(i,s){return i&&i.length?Ur(i,J(s,2),Mo):e}var ax=Zr(function(i,s){return i*s},1),lx=Ho("round"),hx=Zr(function(i,s){return i-s},0);function cx(i){return i&&i.length?po(i,ge):0}function ux(i,s){return i&&i.length?po(i,J(s,2)):0}return m.after=L0,m.ary=jc,m.assign=xv,m.assignIn=Qc,m.assignInWith=us,m.assignWith=Cv,m.at=wv,m.before=Xc,m.bind=ta,m.bindAll=Dy,m.bindKey=Yc,m.castArray=U0,m.chain=Ic,m.chunk=t_,m.compact=e_,m.concat=n_,m.cond=Ey,m.conforms=Py,m.constant=aa,m.countBy=c0,m.create=Sv,m.curry=Hc,m.curryRight=zc,m.debounce=Gc,m.defaults=bv,m.defaultsDeep=Tv,m.defer=F0,m.delay=R0,m.difference=i_,m.differenceBy=r_,m.differenceWith=s_,m.drop=o_,m.dropRight=a_,m.dropRightWhile=l_,m.dropWhile=h_,m.fill=c_,m.filter=f0,m.flatMap=p0,m.flatMapDeep=m0,m.flatMapDepth=_0,m.flatten=kc,m.flattenDeep=u_,m.flattenDepth=f_,m.flip=I0,m.flow=My,m.flowRight=ky,m.fromPairs=d_,m.functions=kv,m.functionsIn=Lv,m.groupBy=v0,m.initial=p_,m.intersection=m_,m.intersectionBy=__,m.intersectionWith=v_,m.invert=Rv,m.invertBy=Iv,m.invokeMap=x0,m.iteratee=la,m.keyBy=C0,m.keys=Vt,m.keysIn=de,m.map=ss,m.mapKeys=Wv,m.mapValues=jv,m.matches=Ly,m.matchesProperty=Fy,m.memoize=as,m.merge=Xv,m.mergeWith=tu,m.method=Ry,m.methodOf=Iy,m.mixin=ha,m.negate=ls,m.nthArg=Wy,m.omit=Yv,m.omitBy=Hv,m.once=B0,m.orderBy=w0,m.over=jy,m.overArgs=W0,m.overEvery=Xy,m.overSome=Yy,m.partial=ea,m.partialRight=Uc,m.partition=S0,m.pick=zv,m.pickBy=eu,m.property=lu,m.propertyOf=Hy,m.pull=w_,m.pullAll=Fc,m.pullAllBy=S_,m.pullAllWith=b_,m.pullAt=T_,m.range=zy,m.rangeRight=Gy,m.rearg=j0,m.reject=O0,m.remove=O_,m.rest=X0,m.reverse=Zo,m.sampleSize=E0,m.set=Uv,m.setWith=Vv,m.shuffle=P0,m.slice=D_,m.sortBy=k0,m.sortedUniq=F_,m.sortedUniqBy=R_,m.split=py,m.spread=Y0,m.tail=I_,m.take=B_,m.takeRight=W_,m.takeRightWhile=j_,m.takeWhile=X_,m.tap=e0,m.throttle=H0,m.thru=rs,m.toArray=$c,m.toPairs=nu,m.toPairsIn=iu,m.toPath=qy,m.toPlainObject=Zc,m.transform=Nv,m.unary=z0,m.union=Y_,m.unionBy=H_,m.unionWith=z_,m.uniq=G_,m.uniqBy=U_,m.uniqWith=V_,m.unset=Kv,m.unzip=Qo,m.unzipWith=Rc,m.update=qv,m.updateWith=$v,m.values=Si,m.valuesIn=Jv,m.without=N_,m.words=ou,m.wrap=G0,m.xor=K_,m.xorBy=q_,m.xorWith=$_,m.zip=J_,m.zipObject=Z_,m.zipObjectDeep=Q_,m.zipWith=t0,m.entries=nu,m.entriesIn=iu,m.extend=Qc,m.extendWith=us,ha(m,m),m.add=Jy,m.attempt=au,m.camelCase=ey,m.capitalize=ru,m.ceil=Zy,m.clamp=Zv,m.clone=V0,m.cloneDeep=K0,m.cloneDeepWith=q0,m.cloneWith=N0,m.conformsTo=$0,m.deburr=su,m.defaultTo=Ay,m.divide=Qy,m.endsWith=ny,m.eq=Ye,m.escape=iy,m.escapeRegExp=ry,m.every=u0,m.find=d0,m.findIndex=Ac,m.findKey=Ov,m.findLast=g0,m.findLastIndex=Mc,m.findLastKey=Dv,m.floor=tx,m.forEach=Bc,m.forEachRight=Wc,m.forIn=Ev,m.forInRight=Pv,m.forOwn=Av,m.forOwnRight=Mv,m.get=ra,m.gt=J0,m.gte=Z0,m.has=Fv,m.hasIn=sa,m.head=Lc,m.identity=ge,m.includes=y0,m.indexOf=g_,m.inRange=Qv,m.invoke=Bv,m.isArguments=qn,m.isArray=it,m.isArrayBuffer=Q0,m.isArrayLike=fe,m.isArrayLikeObject=jt,m.isBoolean=tv,m.isBuffer=En,m.isDate=ev,m.isElement=nv,m.isEmpty=iv,m.isEqual=rv,m.isEqualWith=sv,m.isError=na,m.isFinite=ov,m.isFunction=cn,m.isInteger=Vc,m.isLength=hs,m.isMap=Nc,m.isMatch=av,m.isMatchWith=lv,m.isNaN=hv,m.isNative=cv,m.isNil=fv,m.isNull=uv,m.isNumber=Kc,m.isObject=Lt,m.isObjectLike=It,m.isPlainObject=Qi,m.isRegExp=ia,m.isSafeInteger=dv,m.isSet=qc,m.isString=cs,m.isSymbol=xe,m.isTypedArray=wi,m.isUndefined=gv,m.isWeakMap=pv,m.isWeakSet=mv,m.join=y_,m.kebabCase=sy,m.last=ke,m.lastIndexOf=x_,m.lowerCase=oy,m.lowerFirst=ay,m.lt=_v,m.lte=vv,m.max=ex,m.maxBy=nx,m.mean=ix,m.meanBy=rx,m.min=sx,m.minBy=ox,m.stubArray=ua,m.stubFalse=fa,m.stubObject=Uy,m.stubString=Vy,m.stubTrue=Ny,m.multiply=ax,m.nth=C_,m.noConflict=By,m.noop=ca,m.now=os,m.pad=ly,m.padEnd=hy,m.padStart=cy,m.parseInt=uy,m.random=ty,m.reduce=b0,m.reduceRight=T0,m.repeat=fy,m.replace=dy,m.result=Gv,m.round=lx,m.runInContext=b,m.sample=D0,m.size=A0,m.snakeCase=gy,m.some=M0,m.sortedIndex=E_,m.sortedIndexBy=P_,m.sortedIndexOf=A_,m.sortedLastIndex=M_,m.sortedLastIndexBy=k_,m.sortedLastIndexOf=L_,m.startCase=my,m.startsWith=_y,m.subtract=hx,m.sum=cx,m.sumBy=ux,m.template=vy,m.times=Ky,m.toFinite=un,m.toInteger=rt,m.toLength=Jc,m.toLower=yy,m.toNumber=Le,m.toSafeInteger=yv,m.toString=_t,m.toUpper=xy,m.trim=Cy,m.trimEnd=wy,m.trimStart=Sy,m.truncate=by,m.unescape=Ty,m.uniqueId=$y,m.upperCase=Oy,m.upperFirst=oa,m.each=Bc,m.eachRight=Wc,m.first=Lc,ha(m,function(){var i={};return Ne(m,function(s,h){xt.call(m.prototype,h)||(i[h]=s)}),i}(),{chain:!1}),m.VERSION=n,De(["bind","bindKey","curry","curryRight","partial","partialRight"],function(i){m[i].placeholder=m}),De(["drop","take"],function(i,s){ht.prototype[i]=function(h){h=h===e?1:Ut(rt(h),0);var f=this.__filtered__&&!s?new ht(this):this.clone();return f.__filtered__?f.__takeCount__=Qt(h,f.__takeCount__):f.__views__.push({size:Qt(h,$),type:i+(f.__dir__<0?"Right":"")}),f},ht.prototype[i+"Right"]=function(h){return this.reverse()[i](h).reverse()}}),De(["filter","map","takeWhile"],function(i,s){var h=s+1,f=h==yt||h==he;ht.prototype[i]=function(p){var v=this.clone();return v.__iteratees__.push({iteratee:J(p,3),type:h}),v.__filtered__=v.__filtered__||f,v}}),De(["head","last"],function(i,s){var h="take"+(s?"Right":"");ht.prototype[i]=function(){return this[h](1).value()[0]}}),De(["initial","tail"],function(i,s){var h="drop"+(s?"":"Right");ht.prototype[i]=function(){return this.__filtered__?new ht(this):this[h](1)}}),ht.prototype.compact=function(){return this.filter(ge)},ht.prototype.find=function(i){return this.filter(i).head()},ht.prototype.findLast=function(i){return this.reverse().find(i)},ht.prototype.invokeMap=ot(function(i,s){return typeof i=="function"?new ht(this):this.map(function(h){return Ni(h,i,s)})}),ht.prototype.reject=function(i){return this.filter(ls(J(i)))},ht.prototype.slice=function(i,s){i=rt(i);var h=this;return h.__filtered__&&(i>0||s<0)?new ht(h):(i<0?h=h.takeRight(-i):i&&(h=h.drop(i)),s!==e&&(s=rt(s),h=s<0?h.dropRight(-s):h.take(s-i)),h)},ht.prototype.takeRightWhile=function(i){return this.reverse().takeWhile(i).reverse()},ht.prototype.toArray=function(){return this.take($)},Ne(ht.prototype,function(i,s){var h=/^(?:filter|find|map|reject)|While$/.test(s),f=/^(?:head|last)$/.test(s),p=m[f?"take"+(s=="last"?"Right":""):s],v=f||/^find/.test(s);p&&(m.prototype[s]=function(){var C=this.__wrapped__,w=f?[1]:arguments,O=C instanceof ht,I=w[0],B=O||it(C),X=function(lt){var ct=p.apply(m,Cn([lt],w));return f&&G?ct[0]:ct};B&&h&&typeof I=="function"&&I.length!=1&&(O=B=!1);var G=this.__chain__,K=!!this.__actions__.length,Z=v&&!G,st=O&&!K;if(!v&&B){C=st?C:new ht(this);var Q=i.apply(C,w);return Q.__actions__.push({func:rs,args:[X],thisArg:e}),new Pe(Q,G)}return Z&&st?i.apply(this,w):(Q=this.thru(X),Z?f?Q.value()[0]:Q.value():Q)})}),De(["pop","push","shift","sort","splice","unshift"],function(i){var s=Ar[i],h=/^(?:push|sort|unshift)$/.test(i)?"tap":"thru",f=/^(?:pop|shift)$/.test(i);m.prototype[i]=function(){var p=arguments;if(f&&!this.__chain__){var v=this.value();return s.apply(it(v)?v:[],p)}return this[h](function(C){return s.apply(it(C)?C:[],p)})}}),Ne(ht.prototype,function(i,s){var h=m[s];if(h){var f=h.name+"";xt.call(_i,f)||(_i[f]=[]),_i[f].push({name:s,func:h})}}),_i[Jr(e,L).name]=[{name:"wrapper",func:e}],ht.prototype.clone=Tp,ht.prototype.reverse=Op,ht.prototype.value=Dp,m.prototype.at=n0,m.prototype.chain=i0,m.prototype.commit=r0,m.prototype.next=s0,m.prototype.plant=a0,m.prototype.reverse=l0,m.prototype.toJSON=m.prototype.valueOf=m.prototype.value=h0,m.prototype.first=m.prototype.head,Xi&&(m.prototype[Xi]=o0),m},gi=rp();Yn?((Yn.exports=gi)._=gi,ao._=gi):Jt._=gi}).call(tr)})(Ps,Ps.exports);var wb=Ps.exports,Ed={exports:{}};(function(a){(function(t,e,n){if(!t)return;for(var r={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},o={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},l={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},c={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},u,d=1;d<20;++d)r[111+d]="f"+d;for(d=0;d<=9;++d)r[d+96]=d.toString();function g(A,R,N){if(A.addEventListener){A.addEventListener(R,N,!1);return}A.attachEvent("on"+R,N)}function _(A){if(A.type=="keypress"){var R=String.fromCharCode(A.which);return A.shiftKey||(R=R.toLowerCase()),R}return r[A.which]?r[A.which]:o[A.which]?o[A.which]:String.fromCharCode(A.which).toLowerCase()}function y(A,R){return A.sort().join(",")===R.sort().join(",")}function x(A){var R=[];return A.shiftKey&&R.push("shift"),A.altKey&&R.push("alt"),A.ctrlKey&&R.push("ctrl"),A.metaKey&&R.push("meta"),R}function S(A){if(A.preventDefault){A.preventDefault();return}A.returnValue=!1}function E(A){if(A.stopPropagation){A.stopPropagation();return}A.cancelBubble=!0}function P(A){return A=="shift"||A=="ctrl"||A=="alt"||A=="meta"}function L(){if(!u){u={};for(var A in r)A>95&&A<112||r.hasOwnProperty(A)&&(u[r[A]]=A)}return u}function W(A,R,N){return N||(N=L()[A]?"keydown":"keypress"),N=="keypress"&&R.length&&(N="keydown"),N}function Y(A){return A==="+"?["+"]:(A=A.replace(/\+{2}/g,"+plus"),A.split("+"))}function H(A,R){var N,tt,Dt,vt=[];for(N=Y(A),Dt=0;Dt<N.length;++Dt)tt=N[Dt],c[tt]&&(tt=c[tt]),R&&R!="keypress"&&l[tt]&&(tt=l[tt],vt.push("shift")),P(tt)&&vt.push(tt);return R=W(tt,vt,R),{key:tt,modifiers:vt,action:R}}function z(A,R){return A===null||A===e?!1:A===R?!0:z(A.parentNode,R)}function U(A){var R=this;if(A=A||e,!(R instanceof U))return new U(A);R.target=A,R._callbacks={},R._directMap={};var N={},tt,Dt=!1,vt=!1,Ft=!1;function yt($){$=$||{};var gt=!1,St;for(St in N){if($[St]){gt=!0;continue}N[St]=0}gt||(Ft=!1)}function Mt($,gt,St,ft,mt,ce){var Ct,Rt,Te=[],Ve=St.type;if(!R._callbacks[$])return[];for(Ve=="keyup"&&P($)&&(gt=[$]),Ct=0;Ct<R._callbacks[$].length;++Ct)if(Rt=R._callbacks[$][Ct],!(!ft&&Rt.seq&&N[Rt.seq]!=Rt.level)&&Ve==Rt.action&&(Ve=="keypress"&&!St.metaKey&&!St.ctrlKey||y(gt,Rt.modifiers))){var ai=!ft&&Rt.combo==mt,li=ft&&Rt.seq==ft&&Rt.level==ce;(ai||li)&&R._callbacks[$].splice(Ct,1),Te.push(Rt)}return Te}function he($,gt,St,ft){R.stopCallback(gt,gt.target||gt.srcElement,St,ft)||$(gt,St)===!1&&(S(gt),E(gt))}R._handleKey=function($,gt,St){var ft=Mt($,gt,St),mt,ce={},Ct=0,Rt=!1;for(mt=0;mt<ft.length;++mt)ft[mt].seq&&(Ct=Math.max(Ct,ft[mt].level));for(mt=0;mt<ft.length;++mt){if(ft[mt].seq){if(ft[mt].level!=Ct)continue;Rt=!0,ce[ft[mt].seq]=1,he(ft[mt].callback,St,ft[mt].combo,ft[mt].seq);continue}Rt||he(ft[mt].callback,St,ft[mt].combo)}var Te=St.type=="keypress"&&vt;St.type==Ft&&!P($)&&!Te&&yt(ce),vt=Rt&&St.type=="keydown"};function ne($){typeof $.which!="number"&&($.which=$.keyCode);var gt=_($);if(gt){if($.type=="keyup"&&Dt===gt){Dt=!1;return}R.handleKey(gt,x($),$)}}function zt(){clearTimeout(tt),tt=setTimeout(yt,1e3)}function Gs($,gt,St,ft){N[$]=0;function mt(Ve){return function(){Ft=Ve,++N[$],zt()}}function ce(Ve){he(St,Ve,$),ft!=="keyup"&&(Dt=_(Ve)),setTimeout(yt,10)}for(var Ct=0;Ct<gt.length;++Ct){var Rt=Ct+1===gt.length,Te=Rt?ce:mt(ft||H(gt[Ct+1]).action);Xn(gt[Ct],Te,ft,$,Ct)}}function Xn($,gt,St,ft,mt){R._directMap[$+":"+St]=gt,$=$.replace(/\s+/g," ");var ce=$.split(" "),Ct;if(ce.length>1){Gs($,ce,gt,St);return}Ct=H($,St),R._callbacks[Ct.key]=R._callbacks[Ct.key]||[],Mt(Ct.key,Ct.modifiers,{type:Ct.action},ft,$,mt),R._callbacks[Ct.key][ft?"unshift":"push"]({callback:gt,modifiers:Ct.modifiers,action:Ct.action,seq:ft,level:mt,combo:$})}R._bindMultiple=function($,gt,St){for(var ft=0;ft<$.length;++ft)Xn($[ft],gt,St)},g(A,"keypress",ne),g(A,"keydown",ne),g(A,"keyup",ne)}U.prototype.bind=function(A,R,N){var tt=this;return A=A instanceof Array?A:[A],tt._bindMultiple.call(tt,A,R,N),tt},U.prototype.unbind=function(A,R){var N=this;return N.bind.call(N,A,function(){},R)},U.prototype.trigger=function(A,R){var N=this;return N._directMap[A+":"+R]&&N._directMap[A+":"+R]({},A),N},U.prototype.reset=function(){var A=this;return A._callbacks={},A._directMap={},A},U.prototype.stopCallback=function(A,R){var N=this;if((" "+R.className+" ").indexOf(" mousetrap ")>-1||z(R,N.target))return!1;if("composedPath"in A&&typeof A.composedPath=="function"){var tt=A.composedPath()[0];tt!==A.target&&(R=tt)}return R.tagName=="INPUT"||R.tagName=="SELECT"||R.tagName=="TEXTAREA"||R.isContentEditable},U.prototype.handleKey=function(){var A=this;return A._handleKey.apply(A,arguments)},U.addKeycodes=function(A){for(var R in A)A.hasOwnProperty(R)&&(r[R]=A[R]);u=null},U.init=function(){var A=U(e);for(var R in A)R.charAt(0)!=="_"&&(U[R]=function(N){return function(){return A[N].apply(A,arguments)}}(R))},U.init(),t.Mousetrap=U,a.exports&&(a.exports=U),typeof n=="function"&&n.amd&&n(function(){return U})})(typeof window<"u"?window:null,typeof window<"u"?document:null)})(Ed);var pb=Ed.exports;const Sb=fx(pb);export{Ws as A,Re as C,Wn as E,qt as F,en as G,jn as I,pl as P,yn as R,vr as S,Hs as T,gl as a,xb as b,q as c,M as d,vb as e,me as f,xr as g,Ie as h,yb as i,Li as j,at as k,wb as l,be as m,Hu as n,Sb as o,wt as p,_b as q};
